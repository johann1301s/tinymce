/*!
 * Source version: 1.6.19 
 * Copyright (C) 2024 LoopIndex - All Rights Reserved
 * You should have received a copy of the LoopIndex Track Changes plugin license with
 * this file. If not, please write to: loopindex@gmail.com, or visit http://www.loopindex.com
 *
 * Third party licenses:
 * 
 * Rangy library:
 * Copyright 2018, Tim Down
 * https://github.com/timdown/rangy
 * license: MIT (See Below)
 *
 * jQuery
 * Copyright JS Foundation and other contributors, https://js.foundation/
 * https://github.com/jquery/jquery
 * license: MIT (See Below)
 *
 *
 * Mutation summary
 * Copyright (c) 2018 Rafael Weinstein
 * https://github.com/rafaelw/mutation-summary
 * license: Apache (See Below)
 * 
 *
 * LICENSES
 * 
 * The MIT License (MIT)
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * =====
 *
 * Apache license: see http://www.apache.org/licenses/
 *
 * written by (David *)Frenkiel (https://github.com/imdfl) 
 */!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){var r;!function(){"use strict";var t,n,i={};
/*!
 * jQuery JavaScript Library v3.5.0 -ajax,-ajax/jsonp,-ajax/load,-ajax/script,-ajax/var/location,-ajax/var/nonce,-ajax/var/rquery,-ajax/xhr,-manipulation/_evalUrl,-deprecated/ajax-event-alias,-effects,-effects/Tween,-effects/animatedSelector
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2020-04-10T15:07Z
 */!function(e){var t=window.LOOPINDEX;t&&"object"==typeof t&&t.$&&t.VERSION||(t={},Object.defineProperties(t,{VERSION:{value:"1.8.16",enumerable:!0,writable:!1,configurable:!1}}));var n=window.LOOPINDEX=t;n.$&&n.$.fn&&n.$.fn.jquery||Object.defineProperty(t,"$",{value:e,enumerable:!0,writable:!1,configurable:!1})}(function(t){var n="3.5.0 -ajax,-ajax/jsonp,-ajax/load,-ajax/script,-ajax/var/location,-ajax/var/nonce,-ajax/var/rquery,-ajax/xhr,-manipulation/_evalUrl,-deprecated/ajax-event-alias,-effects,-effects/Tween,-effects/animatedSelector",o=[],s=Object.getPrototypeOf,a=o.slice,l=o.flat?function(e){return o.flat.call(e)}:function(e){return o.concat.apply([],e)},c=o.push,d=o.indexOf,u={},h=u.toString,g=u.hasOwnProperty,f=g.toString,p=f.call(Object),m={},v=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},y=function(e){return null!=e&&e===e.window},_=t.document,C={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||_).createElement("script");if(o.text=e,t)for(r in C)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function N(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?u[h.call(e)]||"object":typeof e}var T=function(e,t){return new T.fn.init(e,t)};function E(e){var t=!!e&&"length"in e&&e.length,n=N(e);return!v(e)&&!y(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}T.fn=T.prototype={jquery:n,constructor:T,length:0,toArray:function(){return a.call(this)},get:function(e){return null==e?a.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=T.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return T.each(this,e)},map:function(e){return this.pushStack(T.map(this,(function(t,n){return e.call(t,n,t)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(T.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(T.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:c,sort:o.sort,splice:o.splice},T.extend=T.fn.extend=function(){var e,t,n,r,i,o,s=arguments[0]||{},a=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[a]||{},a++),"object"==typeof s||v(s)||(s={}),a===l&&(s=this,a--);a<l;a++)if(null!=(e=arguments[a]))for(t in e)r=e[t],"__proto__"!==t&&s!==r&&(c&&r&&(T.isPlainObject(r)||(i=Array.isArray(r)))?(n=s[t],o=i&&!Array.isArray(n)?[]:i||T.isPlainObject(n)?n:{},i=!1,s[t]=T.extend(c,o,r)):void 0!==r&&(s[t]=r));return s},T.extend({expando:"jQuery"+(n+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==h.call(e))&&(!(t=s(e))||"function"==typeof(n=g.call(t,"constructor")&&t.constructor)&&f.call(n)===p)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(E(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(E(Object(e))?T.merge(n,"string"==typeof e?[e]:e):c.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:d.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,s=!n;i<o;i++)!t(e[i],i)!==s&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,s=[];if(E(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&s.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&s.push(i);return l(s)},guid:1,support:m}),"function"==typeof Symbol&&(T.fn[Symbol.iterator]=o[Symbol.iterator]),T.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){u["[object "+t+"]"]=t.toLowerCase()}));var S=
/*!
		 * Sizzle CSS Selector Engine v2.3.5
		 * https://sizzlejs.com/
		 *
		 * Copyright JS Foundation and other contributors
		 * Released under the MIT license
		 * https://js.foundation/
		 *
		 * Date: 2020-03-14
		 */
function(e){var t,n,r,i,o,s,a,l,c,d,u,h,g,f,p,m,v,y,_,C="sizzle"+1*new Date,b=e.document,N=0,T=0,E=le(),S=le(),k=le(),x=le(),w=function(e,t){return e===t&&(u=!0),0},O={}.hasOwnProperty,A=[],R=A.pop,I=A.push,D=A.push,L=A.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},M="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",B="[\\x20\\t\\r\\n\\f]",F="(?:\\\\[\\da-fA-F]{1,6}"+B+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",U="\\["+B+"*("+F+")(?:"+B+"*([*^$|!~]?=)"+B+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+F+"))|)"+B+"*\\]",j=":("+F+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+U+")*)|.*)\\)|)",H=new RegExp(B+"+","g"),$=new RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g"),q=new RegExp("^"+B+"*,"+B+"*"),W=new RegExp("^"+B+"*([>+~]|"+B+")"+B+"*"),G=new RegExp(B+"|>"),V=new RegExp(j),z=new RegExp("^"+F+"$"),K={ID:new RegExp("^#("+F+")"),CLASS:new RegExp("^\\.("+F+")"),TAG:new RegExp("^("+F+"|[*])"),ATTR:new RegExp("^"+U),PSEUDO:new RegExp("^"+j),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),bool:new RegExp("^(?:"+M+")$","i"),needsContext:new RegExp("^"+B+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+B+"*((?:-\\d)?\\d*)"+B+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,X=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+B+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"ï¿½":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){h()},se=Ce((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{D.apply(A=L.call(b.childNodes),b.childNodes),A[b.childNodes.length].nodeType}catch(e){D={apply:A.length?function(e,t){I.apply(e,L.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function ae(e,t,r,i){var o,a,c,d,u,f,v,y=t&&t.ownerDocument,b=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==b&&9!==b&&11!==b)return r;if(!i&&(h(t),t=t||g,p)){if(11!==b&&(u=Z.exec(e)))if(o=u[1]){if(9===b){if(!(c=t.getElementById(o)))return r;if(c.id===o)return r.push(c),r}else if(y&&(c=y.getElementById(o))&&_(t,c)&&c.id===o)return r.push(c),r}else{if(u[2])return D.apply(r,t.getElementsByTagName(e)),r;if((o=u[3])&&n.getElementsByClassName&&t.getElementsByClassName)return D.apply(r,t.getElementsByClassName(o)),r}if(n.qsa&&!x[e+" "]&&(!m||!m.test(e))&&(1!==b||"object"!==t.nodeName.toLowerCase())){if(v=e,y=t,1===b&&(G.test(e)||W.test(e))){for((y=ee.test(e)&&ve(t.parentNode)||t)===t&&n.scope||((d=t.getAttribute("id"))?d=d.replace(re,ie):t.setAttribute("id",d=C)),a=(f=s(e)).length;a--;)f[a]=(d?"#"+d:":scope")+" "+_e(f[a]);v=f.join(",")}try{return D.apply(r,y.querySelectorAll(v)),r}catch(t){x(e,!0)}finally{d===C&&t.removeAttribute("id")}}}return l(e.replace($,"$1"),t,r,i)}function le(){var e=[];return function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}}function ce(e){return e[C]=!0,e}function de(e){var t=g.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ue(e,t){for(var n=e.split("|"),i=n.length;i--;)r.attrHandle[n[i]]=t}function he(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function ge(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function fe(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function pe(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&se(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function me(e){return ce((function(t){return t=+t,ce((function(n,r){for(var i,o=e([],n.length,t),s=o.length;s--;)n[i=o[s]]&&(n[i]=!(r[i]=n[i]))}))}))}function ve(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in n=ae.support={},o=ae.isXML=function(e){var t=e.namespaceURI,n=(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},h=ae.setDocument=function(e){var t,i,s=e?e.ownerDocument||e:b;return s!=g&&9===s.nodeType&&s.documentElement?(f=(g=s).documentElement,p=!o(g),b!=g&&(i=g.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",oe,!1):i.attachEvent&&i.attachEvent("onunload",oe)),n.scope=de((function(e){return f.appendChild(e).appendChild(g.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),n.attributes=de((function(e){return e.className="i",!e.getAttribute("className")})),n.getElementsByTagName=de((function(e){return e.appendChild(g.createComment("")),!e.getElementsByTagName("*").length})),n.getElementsByClassName=Q.test(g.getElementsByClassName),n.getById=de((function(e){return f.appendChild(e).id=C,!g.getElementsByName||!g.getElementsByName(C).length})),n.getById?(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&p){var n=t.getElementById(e);return n?[n]:[]}}):(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&p){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];for(i=t.getElementsByName(e),r=0;o=i[r++];)if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),r.find.TAG=n.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},r.find.CLASS=n.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&p)return t.getElementsByClassName(e)},v=[],m=[],(n.qsa=Q.test(g.querySelectorAll))&&(de((function(e){var t;f.appendChild(e).innerHTML="<a id='"+C+"'></a><select id='"+C+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+B+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+B+"*(?:value|"+M+")"),e.querySelectorAll("[id~="+C+"-]").length||m.push("~="),(t=g.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||m.push("\\["+B+"*name"+B+"*="+B+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+C+"+*").length||m.push(".#.+[+~]"),e.querySelectorAll("\\\f"),m.push("[\\r\\n\\f]")})),de((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=g.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+B+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),f.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")}))),(n.matchesSelector=Q.test(y=f.matches||f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&de((function(e){n.disconnectedMatch=y.call(e,"*"),y.call(e,"[s!='']:x"),v.push("!=",j)})),m=m.length&&new RegExp(m.join("|")),v=v.length&&new RegExp(v.join("|")),t=Q.test(f.compareDocumentPosition),_=t||Q.test(f.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},w=t?function(e,t){if(e===t)return u=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!n.sortDetached&&t.compareDocumentPosition(e)===r?e==g||e.ownerDocument==b&&_(b,e)?-1:t==g||t.ownerDocument==b&&_(b,t)?1:d?P(d,e)-P(d,t):0:4&r?-1:1)}:function(e,t){if(e===t)return u=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,s=[e],a=[t];if(!i||!o)return e==g?-1:t==g?1:i?-1:o?1:d?P(d,e)-P(d,t):0;if(i===o)return he(e,t);for(n=e;n=n.parentNode;)s.unshift(n);for(n=t;n=n.parentNode;)a.unshift(n);for(;s[r]===a[r];)r++;return r?he(s[r],a[r]):s[r]==b?-1:a[r]==b?1:0},g):g},ae.matches=function(e,t){return ae(e,null,null,t)},ae.matchesSelector=function(e,t){if(h(e),n.matchesSelector&&p&&!x[t+" "]&&(!v||!v.test(t))&&(!m||!m.test(t)))try{var r=y.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){x(t,!0)}return ae(t,g,null,[e]).length>0},ae.contains=function(e,t){return(e.ownerDocument||e)!=g&&h(e),_(e,t)},ae.attr=function(e,t){(e.ownerDocument||e)!=g&&h(e);var i=r.attrHandle[t.toLowerCase()],o=i&&O.call(r.attrHandle,t.toLowerCase())?i(e,t,!p):void 0;return void 0!==o?o:n.attributes||!p?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null},ae.escape=function(e){return(e+"").replace(re,ie)},ae.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ae.uniqueSort=function(e){var t,r=[],i=0,o=0;if(u=!n.detectDuplicates,d=!n.sortStable&&e.slice(0),e.sort(w),u){for(;t=e[o++];)t===e[o]&&(i=r.push(o));for(;i--;)e.splice(r[i],1)}return d=null,e},i=ae.getText=function(e){var t,n="",r=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[r++];)n+=i(t);return n},(r=ae.selectors={cacheLength:50,createPseudo:ce,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ae.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ae.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return K.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&V.test(n)&&(t=s(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=E[e+" "];return t||(t=new RegExp("(^|"+B+")"+e+"("+B+"|$)"))&&E(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(r){var i=ae.attr(r,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace(H," ")+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,l){var c,d,u,h,g,f,p=o!==s?"nextSibling":"previousSibling",m=t.parentNode,v=a&&t.nodeName.toLowerCase(),y=!l&&!a,_=!1;if(m){if(o){for(;p;){for(h=t;h=h[p];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;f=p="only"===e&&!f&&"nextSibling"}return!0}if(f=[s?m.firstChild:m.lastChild],s&&y){for(_=(g=(c=(d=(u=(h=m)[C]||(h[C]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===N&&c[1])&&c[2],h=g&&m.childNodes[g];h=++g&&h&&h[p]||(_=g=0)||f.pop();)if(1===h.nodeType&&++_&&h===t){d[e]=[N,g,_];break}}else if(y&&(_=g=(c=(d=(u=(h=t)[C]||(h[C]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===N&&c[1]),!1===_)for(;(h=++g&&h&&h[p]||(_=g=0)||f.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++_||(y&&((d=(u=h[C]||(h[C]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]=[N,_]),h!==t)););return(_-=i)===r||_%r==0&&_/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||ae.error("unsupported pseudo: "+e);return i[C]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?ce((function(e,n){for(var r,o=i(e,t),s=o.length;s--;)e[r=P(e,o[s])]=!(n[r]=o[s])})):function(e){return i(e,0,n)}):i}},pseudos:{not:ce((function(e){var t=[],n=[],r=a(e.replace($,"$1"));return r[C]?ce((function(e,t,n,i){for(var o,s=r(e,null,i,[]),a=e.length;a--;)(o=s[a])&&(e[a]=!(t[a]=o))})):function(e,i,o){return t[0]=e,r(t,null,o,n),t[0]=null,!n.pop()}})),has:ce((function(e){return function(t){return ae(e,t).length>0}})),contains:ce((function(e){return e=e.replace(te,ne),function(t){return(t.textContent||i(t)).indexOf(e)>-1}})),lang:ce((function(e){return z.test(e||"")||ae.error("unsupported lang: "+e),e=e.replace(te,ne).toLowerCase(),function(t){var n;do{if(n=p?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===g.activeElement&&(!g.hasFocus||g.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:pe(!1),disabled:pe(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return X.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:me((function(){return[0]})),last:me((function(e,t){return[t-1]})),eq:me((function(e,t,n){return[n<0?n+t:n]})),even:me((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:me((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:me((function(e,t,n){for(var r=n<0?n+t:n>t?t:n;--r>=0;)e.push(r);return e})),gt:me((function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e}))}}).pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=ge(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=fe(t);function ye(){}function _e(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function Ce(e,t,n){var r=t.dir,i=t.next,o=i||r,s=n&&"parentNode"===o,a=T++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||s)return e(t,n,i);return!1}:function(t,n,l){var c,d,u,h=[N,a];if(l){for(;t=t[r];)if((1===t.nodeType||s)&&e(t,n,l))return!0}else for(;t=t[r];)if(1===t.nodeType||s)if(d=(u=t[C]||(t[C]={}))[t.uniqueID]||(u[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((c=d[o])&&c[0]===N&&c[1]===a)return h[2]=c[2];if(d[o]=h,h[2]=e(t,n,l))return!0}return!1}}function be(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function Ne(e,t,n,r,i){for(var o,s=[],a=0,l=e.length,c=null!=t;a<l;a++)(o=e[a])&&(n&&!n(o,r,i)||(s.push(o),c&&t.push(a)));return s}function Te(e,t,n,r,i,o){return r&&!r[C]&&(r=Te(r)),i&&!i[C]&&(i=Te(i,o)),ce((function(o,s,a,l){var c,d,u,h=[],g=[],f=s.length,p=o||function(e,t,n){for(var r=0,i=t.length;r<i;r++)ae(e,t[r],n);return n}(t||"*",a.nodeType?[a]:a,[]),m=!e||!o&&t?p:Ne(p,h,e,a,l),v=n?i||(o?e:f||r)?[]:s:m;if(n&&n(m,v,a,l),r)for(c=Ne(v,g),r(c,[],a,l),d=c.length;d--;)(u=c[d])&&(v[g[d]]=!(m[g[d]]=u));if(o){if(i||e){if(i){for(c=[],d=v.length;d--;)(u=v[d])&&c.push(m[d]=u);i(null,v=[],c,l)}for(d=v.length;d--;)(u=v[d])&&(c=i?P(o,u):h[d])>-1&&(o[c]=!(s[c]=u))}}else v=Ne(v===s?v.splice(f,v.length):v),i?i(null,s,v,l):D.apply(s,v)}))}function Ee(e){for(var t,n,i,o=e.length,s=r.relative[e[0].type],a=s||r.relative[" "],l=s?1:0,d=Ce((function(e){return e===t}),a,!0),u=Ce((function(e){return P(t,e)>-1}),a,!0),h=[function(e,n,r){var i=!s&&(r||n!==c)||((t=n).nodeType?d(e,n,r):u(e,n,r));return t=null,i}];l<o;l++)if(n=r.relative[e[l].type])h=[Ce(be(h),n)];else{if((n=r.filter[e[l].type].apply(null,e[l].matches))[C]){for(i=++l;i<o&&!r.relative[e[i].type];i++);return Te(l>1&&be(h),l>1&&_e(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace($,"$1"),n,l<i&&Ee(e.slice(l,i)),i<o&&Ee(e=e.slice(i)),i<o&&_e(e))}h.push(n)}return be(h)}return ye.prototype=r.filters=r.pseudos,r.setFilters=new ye,s=ae.tokenize=function(e,t){var n,i,o,s,a,l,c,d=S[e+" "];if(d)return t?0:d.slice(0);for(a=e,l=[],c=r.preFilter;a;){for(s in n&&!(i=q.exec(a))||(i&&(a=a.slice(i[0].length)||a),l.push(o=[])),n=!1,(i=W.exec(a))&&(n=i.shift(),o.push({value:n,type:i[0].replace($," ")}),a=a.slice(n.length)),r.filter)!(i=K[s].exec(a))||c[s]&&!(i=c[s](i))||(n=i.shift(),o.push({value:n,type:s,matches:i}),a=a.slice(n.length));if(!n)break}return t?a.length:a?ae.error(e):S(e,l).slice(0)},a=ae.compile=function(e,t){var n,i=[],o=[],a=k[e+" "];if(!a){for(t||(t=s(e)),n=t.length;n--;)(a=Ee(t[n]))[C]?i.push(a):o.push(a);(a=k(e,function(e,t){var n=t.length>0,i=e.length>0,o=function(o,s,a,l,d){var u,f,m,v=0,y="0",_=o&&[],C=[],b=c,T=o||i&&r.find.TAG("*",d),E=N+=null==b?1:Math.random()||.1,S=T.length;for(d&&(c=s==g||s||d);y!==S&&null!=(u=T[y]);y++){if(i&&u){for(f=0,s||u.ownerDocument==g||(h(u),a=!p);m=e[f++];)if(m(u,s||g,a)){l.push(u);break}d&&(N=E)}n&&((u=!m&&u)&&v--,o&&_.push(u))}if(v+=y,n&&y!==v){for(f=0;m=t[f++];)m(_,C,s,a);if(o){if(v>0)for(;y--;)_[y]||C[y]||(C[y]=R.call(l));C=Ne(C)}D.apply(l,C),d&&!o&&C.length>0&&v+t.length>1&&ae.uniqueSort(l)}return d&&(N=E,c=b),_};return n?ce(o):o}(o,i))).selector=e}return a},l=ae.select=function(e,t,n,i){var o,l,c,d,u,h="function"==typeof e&&e,g=!i&&s(e=h.selector||e);if(n=n||[],1===g.length){if((l=g[0]=g[0].slice(0)).length>2&&"ID"===(c=l[0]).type&&9===t.nodeType&&p&&r.relative[l[1].type]){if(!(t=(r.find.ID(c.matches[0].replace(te,ne),t)||[])[0]))return n;h&&(t=t.parentNode),e=e.slice(l.shift().value.length)}for(o=K.needsContext.test(e)?0:l.length;o--&&(c=l[o],!r.relative[d=c.type]);)if((u=r.find[d])&&(i=u(c.matches[0].replace(te,ne),ee.test(l[0].type)&&ve(t.parentNode)||t))){if(l.splice(o,1),!(e=i.length&&_e(l)))return D.apply(n,i),n;break}}return(h||a(e,g))(i,t,!p,n,!t||ee.test(e)&&ve(t.parentNode)||t),n},n.sortStable=C.split("").sort(w).join("")===C,n.detectDuplicates=!!u,h(),n.sortDetached=de((function(e){return 1&e.compareDocumentPosition(g.createElement("fieldset"))})),de((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||ue("type|href|height|width",(function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),n.attributes&&de((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||ue("value",(function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),de((function(e){return null==e.getAttribute("disabled")}))||ue(M,(function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null})),ae}(t);T.find=S,T.expr=S.selectors,T.expr[":"]=T.expr.pseudos,T.uniqueSort=T.unique=S.uniqueSort,T.text=S.getText,T.isXMLDoc=S.isXML,T.contains=S.contains,T.escapeSelector=S.escape;var k=function(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&T(e).is(n))break;r.push(e)}return r},x=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},w=T.expr.match.needsContext;function O(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var A=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function R(e,t,n){return v(t)?T.grep(e,(function(e,r){return!!t.call(e,r,e)!==n})):t.nodeType?T.grep(e,(function(e){return e===t!==n})):"string"!=typeof t?T.grep(e,(function(e){return d.call(t,e)>-1!==n})):T.filter(t,e,n)}T.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?T.find.matchesSelector(r,e)?[r]:[]:T.find.matches(e,T.grep(t,(function(e){return 1===e.nodeType})))},T.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(T(e).filter((function(){for(t=0;t<r;t++)if(T.contains(i[t],this))return!0})));for(n=this.pushStack([]),t=0;t<r;t++)T.find(e,i[t],n);return r>1?T.uniqueSort(n):n},filter:function(e){return this.pushStack(R(this,e||[],!1))},not:function(e){return this.pushStack(R(this,e||[],!0))},is:function(e){return!!R(this,"string"==typeof e&&w.test(e)?T(e):e||[],!1).length}});var I,D=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(T.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||I,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:D.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof T?t[0]:t,T.merge(this,T.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:_,!0)),A.test(r[1])&&T.isPlainObject(t))for(r in t)v(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=_.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):v(e)?void 0!==n.ready?n.ready(e):e(T):T.makeArray(e,this)}).prototype=T.fn,I=T(_);var L=/^(?:parents|prev(?:Until|All))/,P={children:!0,contents:!0,next:!0,prev:!0};function M(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}T.fn.extend({has:function(e){var t=T(e,this),n=t.length;return this.filter((function(){for(var e=0;e<n;e++)if(T.contains(this,t[e]))return!0}))},closest:function(e,t){var n,r=0,i=this.length,o=[],s="string"!=typeof e&&T(e);if(!w.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&T.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?T.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?d.call(T(e),this[0]):d.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(T.uniqueSort(T.merge(this.get(),T(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),T.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return k(e,"parentNode")},parentsUntil:function(e,t,n){return k(e,"parentNode",n)},next:function(e){return M(e,"nextSibling")},prev:function(e){return M(e,"previousSibling")},nextAll:function(e){return k(e,"nextSibling")},prevAll:function(e){return k(e,"previousSibling")},nextUntil:function(e,t,n){return k(e,"nextSibling",n)},prevUntil:function(e,t,n){return k(e,"previousSibling",n)},siblings:function(e){return x((e.parentNode||{}).firstChild,e)},children:function(e){return x(e.firstChild)},contents:function(e){return null!=e.contentDocument&&s(e.contentDocument)?e.contentDocument:(O(e,"template")&&(e=e.content||e),T.merge([],e.childNodes))}},(function(e,t){T.fn[e]=function(n,r){var i=T.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=T.filter(r,i)),this.length>1&&(P[e]||T.uniqueSort(i),L.test(e)&&i.reverse()),this.pushStack(i)}}));var B=/[^\x20\t\r\n\f]+/g;function F(e){return e}function U(e){throw e}function j(e,t,n,r){var i;try{e&&v(i=e.promise)?i.call(e).done(t).fail(n):e&&v(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}T.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return T.each(e.match(B)||[],(function(e,n){t[n]=!0})),t}(e):T.extend({},e);var t,n,r,i,o=[],s=[],a=-1,l=function(){for(i=i||e.once,r=t=!0;s.length;a=-1)for(n=s.shift();++a<o.length;)!1===o[a].apply(n[0],n[1])&&e.stopOnFalse&&(a=o.length,n=!1);e.memory||(n=!1),t=!1,i&&(o=n?[]:"")},c={add:function(){return o&&(n&&!t&&(a=o.length-1,s.push(n)),function t(n){T.each(n,(function(n,r){v(r)?e.unique&&c.has(r)||o.push(r):r&&r.length&&"string"!==N(r)&&t(r)}))}(arguments),n&&!t&&l()),this},remove:function(){return T.each(arguments,(function(e,t){for(var n;(n=T.inArray(t,o,n))>-1;)o.splice(n,1),n<=a&&a--})),this},has:function(e){return e?T.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return i=s=[],o=n="",this},disabled:function(){return!o},lock:function(){return i=s=[],n||t||(o=n=""),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=[e,(n=n||[]).slice?n.slice():n],s.push(n),t||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},T.extend({Deferred:function(e){var n=[["notify","progress",T.Callbacks("memory"),T.Callbacks("memory"),2],["resolve","done",T.Callbacks("once memory"),T.Callbacks("once memory"),0,"resolved"],["reject","fail",T.Callbacks("once memory"),T.Callbacks("once memory"),1,"rejected"]],r="pending",i={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var e=arguments;return T.Deferred((function(t){T.each(n,(function(n,r){var i=v(e[r[4]])&&e[r[4]];o[r[1]]((function(){var e=i&&i.apply(this,arguments);e&&v(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[r[0]+"With"](this,i?[e]:arguments)}))})),e=null})).promise()},then:function(e,r,i){var o=0;function s(e,n,r,i){return function(){var a=this,l=arguments,c=function(){var t,c;if(!(e<o)){if((t=r.apply(a,l))===n.promise())throw new TypeError("Thenable self-resolution");c=t&&("object"==typeof t||"function"==typeof t)&&t.then,v(c)?i?c.call(t,s(o,n,F,i),s(o,n,U,i)):(o++,c.call(t,s(o,n,F,i),s(o,n,U,i),s(o,n,F,n.notifyWith))):(r!==F&&(a=void 0,l=[t]),(i||n.resolveWith)(a,l))}},d=i?c:function(){try{c()}catch(t){T.Deferred.exceptionHook&&T.Deferred.exceptionHook(t,d.stackTrace),e+1>=o&&(r!==U&&(a=void 0,l=[t]),n.rejectWith(a,l))}};e?d():(T.Deferred.getStackHook&&(d.stackTrace=T.Deferred.getStackHook()),t.setTimeout(d))}}return T.Deferred((function(t){n[0][3].add(s(0,t,v(i)?i:F,t.notifyWith)),n[1][3].add(s(0,t,v(e)?e:F)),n[2][3].add(s(0,t,v(r)?r:U))})).promise()},promise:function(e){return null!=e?T.extend(e,i):i}},o={};return T.each(n,(function(e,t){var s=t[2],a=t[5];i[t[1]]=s.add,a&&s.add((function(){r=a}),n[3-e][2].disable,n[3-e][3].disable,n[0][2].lock,n[0][3].lock),s.add(t[3].fire),o[t[0]]=function(){return o[t[0]+"With"](this===o?void 0:this,arguments),this},o[t[0]+"With"]=s.fireWith})),i.promise(o),e&&e.call(o,o),o},when:function(e){var t=arguments.length,n=t,r=Array(n),i=a.call(arguments),o=T.Deferred(),s=function(e){return function(n){r[e]=this,i[e]=arguments.length>1?a.call(arguments):n,--t||o.resolveWith(r,i)}};if(t<=1&&(j(e,o.done(s(n)).resolve,o.reject,!t),"pending"===o.state()||v(i[n]&&i[n].then)))return o.then();for(;n--;)j(i[n],s(n),o.reject);return o.promise()}});var H=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;T.Deferred.exceptionHook=function(e,n){t.console&&t.console.warn&&e&&H.test(e.name)&&t.console.warn("jQuery.Deferred exception: "+e.message,e.stack,n)},T.readyException=function(e){t.setTimeout((function(){throw e}))};var $=T.Deferred();function q(){_.removeEventListener("DOMContentLoaded",q),t.removeEventListener("load",q),T.ready()}T.fn.ready=function(e){return $.then(e).catch((function(e){T.readyException(e)})),this},T.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--T.readyWait:T.isReady)||(T.isReady=!0,!0!==e&&--T.readyWait>0||$.resolveWith(_,[T]))}}),T.ready.then=$.then,"complete"===_.readyState||"loading"!==_.readyState&&!_.documentElement.doScroll?t.setTimeout(T.ready):(_.addEventListener("DOMContentLoaded",q),t.addEventListener("load",q));var W=function(e,t,n,r,i,o,s){var a=0,l=e.length,c=null==n;if("object"===N(n))for(a in i=!0,n)W(e,t,a,n[a],!0,o,s);else if(void 0!==r&&(i=!0,v(r)||(s=!0),c&&(s?(t.call(e,r),t=null):(c=t,t=function(e,t,n){return c.call(T(e),n)})),t))for(;a<l;a++)t(e[a],n,s?r:r.call(e[a],a,t(e[a],n)));return i?e:c?t.call(e):l?t(e[0],n):o},G=/^-ms-/,V=/-([a-z])/g;function z(e,t){return t.toUpperCase()}function K(e){return e.replace(G,"ms-").replace(V,z)}var Y=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function X(){this.expando=T.expando+X.uid++}X.uid=1,X.prototype={cache:function(e){var t=e[this.expando];return t||(t=Object.create(null),Y(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[K(t)]=n;else for(r in t)i[K(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][K(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(K):(t=K(t))in r?[t]:t.match(B)||[]).length;for(;n--;)delete r[t[n]]}(void 0===t||T.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!T.isEmptyObject(t)}};var J=new X,Q=new X,Z=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ee=/[A-Z]/g;function te(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(ee,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Z.test(e)?JSON.parse(e):e)}(n)}catch(e){}Q.set(e,t,n)}else n=void 0;return n}T.extend({hasData:function(e){return Q.hasData(e)||J.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return J.access(e,t,n)},_removeData:function(e,t){J.remove(e,t)}}),T.fn.extend({data:function(e,t){var n,r,i,o=this[0],s=o&&o.attributes;if(void 0===e){if(this.length&&(i=Q.get(o),1===o.nodeType&&!J.get(o,"hasDataAttrs"))){for(n=s.length;n--;)s[n]&&0===(r=s[n].name).indexOf("data-")&&(r=K(r.slice(5)),te(o,r,i[r]));J.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof e?this.each((function(){Q.set(this,e)})):W(this,(function(t){var n;if(o&&void 0===t)return void 0!==(n=Q.get(o,e))||void 0!==(n=te(o,e))?n:void 0;this.each((function(){Q.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){Q.remove(this,e)}))}}),T.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=J.get(e,t),n&&(!r||Array.isArray(n)?r=J.access(e,t,T.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=T.queue(e,t),r=n.length,i=n.shift(),o=T._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,(function(){T.dequeue(e,t)}),o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return J.get(e,n)||J.access(e,n,{empty:T.Callbacks("once memory").add((function(){J.remove(e,[t+"queue",n])}))})}}),T.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?T.queue(this[0],e):void 0===t?this:this.each((function(){var n=T.queue(this,e,t);T._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&T.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){T.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=T.Deferred(),o=this,s=this.length,a=function(){--r||i.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)(n=J.get(o[s],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(a));return a(),i.promise(t)}});var ne=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,re=new RegExp("^(?:([+-])=|)("+ne+")([a-z%]*)$","i"),ie=["Top","Right","Bottom","Left"],oe=_.documentElement,se=function(e){return T.contains(e.ownerDocument,e)},ae={composed:!0};oe.getRootNode&&(se=function(e){return T.contains(e.ownerDocument,e)||e.getRootNode(ae)===e.ownerDocument});var le=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&se(e)&&"none"===T.css(e,"display")};function ce(e,t,n,r){var i,o,s=20,a=r?function(){return r.cur()}:function(){return T.css(e,t,"")},l=a(),c=n&&n[3]||(T.cssNumber[t]?"":"px"),d=e.nodeType&&(T.cssNumber[t]||"px"!==c&&+l)&&re.exec(T.css(e,t));if(d&&d[3]!==c){for(l/=2,c=c||d[3],d=+l||1;s--;)T.style(e,t,d+c),(1-o)*(1-(o=a()/l||.5))<=0&&(s=0),d/=o;d*=2,T.style(e,t,d+c),n=n||[]}return n&&(d=+d||+l||0,i=n[1]?d+(n[1]+1)*n[2]:+n[2],r&&(r.unit=c,r.start=d,r.end=i)),i}var de={};function ue(e){var t,n=e.ownerDocument,r=e.nodeName,i=de[r];return i||(t=n.body.appendChild(n.createElement(r)),i=T.css(t,"display"),t.parentNode.removeChild(t),"none"===i&&(i="block"),de[r]=i,i)}function he(e,t){for(var n,r,i=[],o=0,s=e.length;o<s;o++)(r=e[o]).style&&(n=r.style.display,t?("none"===n&&(i[o]=J.get(r,"display")||null,i[o]||(r.style.display="")),""===r.style.display&&le(r)&&(i[o]=ue(r))):"none"!==n&&(i[o]="none",J.set(r,"display",n)));for(o=0;o<s;o++)null!=i[o]&&(e[o].style.display=i[o]);return e}T.fn.extend({show:function(){return he(this,!0)},hide:function(){return he(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each((function(){le(this)?T(this).show():T(this).hide()}))}});var ge,fe,pe=/^(?:checkbox|radio)$/i,me=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,ve=/^$|^module$|\/(?:java|ecma)script/i;ge=_.createDocumentFragment().appendChild(_.createElement("div")),(fe=_.createElement("input")).setAttribute("type","radio"),fe.setAttribute("checked","checked"),fe.setAttribute("name","t"),ge.appendChild(fe),m.checkClone=ge.cloneNode(!0).cloneNode(!0).lastChild.checked,ge.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!ge.cloneNode(!0).lastChild.defaultValue,ge.innerHTML="<option></option>",m.option=!!ge.lastChild;var ye={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function _e(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&O(e,t)?T.merge([e],n):n}function Ce(e,t){for(var n=0,r=e.length;n<r;n++)J.set(e[n],"globalEval",!t||J.get(t[n],"globalEval"))}ye.tbody=ye.tfoot=ye.colgroup=ye.caption=ye.thead,ye.th=ye.td,m.option||(ye.optgroup=ye.option=[1,"<select multiple='multiple'>","</select>"]);var be=/<|&#?\w+;/;function Ne(e,t,n,r,i){for(var o,s,a,l,c,d,u=t.createDocumentFragment(),h=[],g=0,f=e.length;g<f;g++)if((o=e[g])||0===o)if("object"===N(o))T.merge(h,o.nodeType?[o]:o);else if(be.test(o)){for(s=s||u.appendChild(t.createElement("div")),a=(me.exec(o)||["",""])[1].toLowerCase(),l=ye[a]||ye._default,s.innerHTML=l[1]+T.htmlPrefilter(o)+l[2],d=l[0];d--;)s=s.lastChild;T.merge(h,s.childNodes),(s=u.firstChild).textContent=""}else h.push(t.createTextNode(o));for(u.textContent="",g=0;o=h[g++];)if(r&&T.inArray(o,r)>-1)i&&i.push(o);else if(c=se(o),s=_e(u.appendChild(o),"script"),c&&Ce(s),n)for(d=0;o=s[d++];)ve.test(o.type||"")&&n.push(o);return u}var Te=/^key/,Ee=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Se=/^([^.]*)(?:\.(.+)|)/;function ke(){return!0}function xe(){return!1}function we(e,t){return e===function(){try{return _.activeElement}catch(e){}}()==("focus"===t)}function Oe(e,t,n,r,i,o){var s,a;if("object"==typeof t){for(a in"string"!=typeof n&&(r=r||n,n=void 0),t)Oe(e,a,n,r,t[a],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=xe;else if(!i)return e;return 1===o&&(s=i,(i=function(e){return T().off(e),s.apply(this,arguments)}).guid=s.guid||(s.guid=T.guid++)),e.each((function(){T.event.add(this,t,i,r,n)}))}function Ae(e,t,n){n?(J.set(e,t,!1),T.event.add(e,t,{namespace:!1,handler:function(e){var r,i,o=J.get(this,t);if(1&e.isTrigger&&this[t]){if(o.length)(T.event.special[t]||{}).delegateType&&e.stopPropagation();else if(o=a.call(arguments),J.set(this,t,o),r=n(this,t),this[t](),o!==(i=J.get(this,t))||r?J.set(this,t,!1):i={},o!==i)return e.stopImmediatePropagation(),e.preventDefault(),i.value}else o.length&&(J.set(this,t,{value:T.event.trigger(T.extend(o[0],T.Event.prototype),o.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===J.get(e,t)&&T.event.add(e,t,ke)}T.event={global:{},add:function(e,t,n,r,i){var o,s,a,l,c,d,u,h,g,f,p,m=J.get(e);if(Y(e))for(n.handler&&(n=(o=n).handler,i=o.selector),i&&T.find.matchesSelector(oe,i),n.guid||(n.guid=T.guid++),(l=m.events)||(l=m.events=Object.create(null)),(s=m.handle)||(s=m.handle=function(t){return void 0!==T&&T.event.triggered!==t.type?T.event.dispatch.apply(e,arguments):void 0}),c=(t=(t||"").match(B)||[""]).length;c--;)g=p=(a=Se.exec(t[c])||[])[1],f=(a[2]||"").split(".").sort(),g&&(u=T.event.special[g]||{},g=(i?u.delegateType:u.bindType)||g,u=T.event.special[g]||{},d=T.extend({type:g,origType:p,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&T.expr.match.needsContext.test(i),namespace:f.join(".")},o),(h=l[g])||((h=l[g]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(e,r,f,s)||e.addEventListener&&e.addEventListener(g,s)),u.add&&(u.add.call(e,d),d.handler.guid||(d.handler.guid=n.guid)),i?h.splice(h.delegateCount++,0,d):h.push(d),T.event.global[g]=!0)},remove:function(e,t,n,r,i){var o,s,a,l,c,d,u,h,g,f,p,m=J.hasData(e)&&J.get(e);if(m&&(l=m.events)){for(c=(t=(t||"").match(B)||[""]).length;c--;)if(g=p=(a=Se.exec(t[c])||[])[1],f=(a[2]||"").split(".").sort(),g){for(u=T.event.special[g]||{},h=l[g=(r?u.delegateType:u.bindType)||g]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=h.length;o--;)d=h[o],!i&&p!==d.origType||n&&n.guid!==d.guid||a&&!a.test(d.namespace)||r&&r!==d.selector&&("**"!==r||!d.selector)||(h.splice(o,1),d.selector&&h.delegateCount--,u.remove&&u.remove.call(e,d));s&&!h.length&&(u.teardown&&!1!==u.teardown.call(e,f,m.handle)||T.removeEvent(e,g,m.handle),delete l[g])}else for(g in l)T.event.remove(e,g+t[c],n,r,!0);T.isEmptyObject(l)&&J.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,s,a=new Array(arguments.length),l=T.event.fix(e),c=(J.get(this,"events")||Object.create(null))[l.type]||[],d=T.event.special[l.type]||{};for(a[0]=l,t=1;t<arguments.length;t++)a[t]=arguments[t];if(l.delegateTarget=this,!d.preDispatch||!1!==d.preDispatch.call(this,l)){for(s=T.event.handlers.call(this,l,c),t=0;(i=s[t++])&&!l.isPropagationStopped();)for(l.currentTarget=i.elem,n=0;(o=i.handlers[n++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==o.namespace&&!l.rnamespace.test(o.namespace)||(l.handleObj=o,l.data=o.data,void 0!==(r=((T.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,a))&&!1===(l.result=r)&&(l.preventDefault(),l.stopPropagation()));return d.postDispatch&&d.postDispatch.call(this,l),l.result}},handlers:function(e,t){var n,r,i,o,s,a=[],l=t.delegateCount,c=e.target;if(l&&c.nodeType&&!("click"===e.type&&e.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||!0!==c.disabled)){for(o=[],s={},n=0;n<l;n++)void 0===s[i=(r=t[n]).selector+" "]&&(s[i]=r.needsContext?T(i,this).index(c)>-1:T.find(i,this,null,[c]).length),s[i]&&o.push(r);o.length&&a.push({elem:c,handlers:o})}return c=this,l<t.length&&a.push({elem:c,handlers:t.slice(l)}),a},addProp:function(e,t){Object.defineProperty(T.Event.prototype,e,{enumerable:!0,configurable:!0,get:v(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[T.expando]?e:new T.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&O(t,"input")&&Ae(t,"click",ke),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&O(t,"input")&&Ae(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&O(t,"input")&&J.get(t,"click")||O(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},T.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},T.Event=function(e,t){if(!(this instanceof T.Event))return new T.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?ke:xe,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&T.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[T.expando]=!0},T.Event.prototype={constructor:T.Event,isDefaultPrevented:xe,isPropagationStopped:xe,isImmediatePropagationStopped:xe,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=ke,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=ke,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=ke,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},T.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&Te.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Ee.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},T.event.addProp),T.each({focus:"focusin",blur:"focusout"},(function(e,t){T.event.special[e]={setup:function(){return Ae(this,e,we),!1},trigger:function(){return Ae(this,e),!0},delegateType:t}})),T.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(e,t){T.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return i&&(i===r||T.contains(r,i))||(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}})),T.fn.extend({on:function(e,t,n,r){return Oe(this,e,t,n,r)},one:function(e,t,n,r){return Oe(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,T(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=xe),this.each((function(){T.event.remove(this,e,n,t)}))}});var Re=/<script|<style|<link/i,Ie=/checked\s*(?:[^=]|=\s*.checked.)/i,De=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Le(e,t){return O(e,"table")&&O(11!==t.nodeType?t:t.firstChild,"tr")&&T(e).children("tbody")[0]||e}function Pe(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Me(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Be(e,t){var n,r,i,o,s,a;if(1===t.nodeType){if(J.hasData(e)&&(a=J.get(e).events))for(i in J.remove(t,"handle events"),a)for(n=0,r=a[i].length;n<r;n++)T.event.add(t,i,a[i][n]);Q.hasData(e)&&(o=Q.access(e),s=T.extend({},o),Q.set(t,s))}}function Fe(e,t){var n=t.nodeName.toLowerCase();"input"===n&&pe.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function Ue(e,t,n,r){t=l(t);var i,o,s,a,c,d,u=0,h=e.length,g=h-1,f=t[0],p=v(f);if(p||h>1&&"string"==typeof f&&!m.checkClone&&Ie.test(f))return e.each((function(i){var o=e.eq(i);p&&(t[0]=f.call(this,i,o.html())),Ue(o,t,n,r)}));if(h&&(o=(i=Ne(t,e[0].ownerDocument,!1,e,r)).firstChild,1===i.childNodes.length&&(i=o),o||r)){for(a=(s=T.map(_e(i,"script"),Pe)).length;u<h;u++)c=i,u!==g&&(c=T.clone(c,!0,!0),a&&T.merge(s,_e(c,"script"))),n.call(e[u],c,u);if(a)for(d=s[s.length-1].ownerDocument,T.map(s,Me),u=0;u<a;u++)c=s[u],ve.test(c.type||"")&&!J.access(c,"globalEval")&&T.contains(d,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?T._evalUrl&&!c.noModule&&T._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},d):b(c.textContent.replace(De,""),c,d))}return e}function je(e,t,n){for(var r,i=t?T.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||T.cleanData(_e(r)),r.parentNode&&(n&&se(r)&&Ce(_e(r,"script")),r.parentNode.removeChild(r));return e}T.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,s,a=e.cloneNode(!0),l=se(e);if(!(m.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||T.isXMLDoc(e)))for(s=_e(a),r=0,i=(o=_e(e)).length;r<i;r++)Fe(o[r],s[r]);if(t)if(n)for(o=o||_e(e),s=s||_e(a),r=0,i=o.length;r<i;r++)Be(o[r],s[r]);else Be(e,a);return(s=_e(a,"script")).length>0&&Ce(s,!l&&_e(e,"script")),a},cleanData:function(e){for(var t,n,r,i=T.event.special,o=0;void 0!==(n=e[o]);o++)if(Y(n)){if(t=n[J.expando]){if(t.events)for(r in t.events)i[r]?T.event.remove(n,r):T.removeEvent(n,r,t.handle);n[J.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),T.fn.extend({detach:function(e){return je(this,e,!0)},remove:function(e){return je(this,e)},text:function(e){return W(this,(function(e){return void 0===e?T.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return Ue(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Le(this,e).appendChild(e)}))},prepend:function(){return Ue(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Le(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return Ue(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return Ue(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(T.cleanData(_e(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return T.clone(this,e,t)}))},html:function(e){return W(this,(function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Re.test(e)&&!ye[(me.exec(e)||["",""])[1].toLowerCase()]){e=T.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(T.cleanData(_e(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return Ue(this,arguments,(function(t){var n=this.parentNode;T.inArray(this,e)<0&&(T.cleanData(_e(this)),n&&n.replaceChild(t,this))}),e)}}),T.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(e,t){T.fn[e]=function(e){for(var n,r=[],i=T(e),o=i.length-1,s=0;s<=o;s++)n=s===o?this:this.clone(!0),T(i[s])[t](n),c.apply(r,n.get());return this.pushStack(r)}}));var He=new RegExp("^("+ne+")(?!px)[a-z%]+$","i"),$e=function(e){var n=e.ownerDocument.defaultView;return n&&n.opener||(n=t),n.getComputedStyle(e)},qe=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},We=new RegExp(ie.join("|"),"i");function Ge(e,t,n){var r,i,o,s,a=e.style;return(n=n||$e(e))&&(""!==(s=n.getPropertyValue(t)||n[t])||se(e)||(s=T.style(e,t)),!m.pixelBoxStyles()&&He.test(s)&&We.test(t)&&(r=a.width,i=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=n.width,a.width=r,a.minWidth=i,a.maxWidth=o)),void 0!==s?s+"":s}function Ve(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(d){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",d.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",oe.appendChild(c).appendChild(d);var e=t.getComputedStyle(d);r="1%"!==e.top,l=12===n(e.marginLeft),d.style.right="60%",s=36===n(e.right),i=36===n(e.width),d.style.position="absolute",o=12===n(d.offsetWidth/3),oe.removeChild(c),d=null}}function n(e){return Math.round(parseFloat(e))}var r,i,o,s,a,l,c=_.createElement("div"),d=_.createElement("div");d.style&&(d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===d.style.backgroundClip,T.extend(m,{boxSizingReliable:function(){return e(),i},pixelBoxStyles:function(){return e(),s},pixelPosition:function(){return e(),r},reliableMarginLeft:function(){return e(),l},scrollboxSize:function(){return e(),o},reliableTrDimensions:function(){var e,n,r,i;return null==a&&(e=_.createElement("table"),n=_.createElement("tr"),r=_.createElement("div"),e.style.cssText="position:absolute;left:-11111px",n.style.height="1px",r.style.height="9px",oe.appendChild(e).appendChild(n).appendChild(r),i=t.getComputedStyle(n),a=parseInt(i.height)>3,oe.removeChild(e)),a}}))}();var ze=["Webkit","Moz","ms"],Ke=_.createElement("div").style,Ye={};function Xe(e){var t=T.cssProps[e]||Ye[e];return t||(e in Ke?e:Ye[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=ze.length;n--;)if((e=ze[n]+t)in Ke)return e}(e)||e)}var Je=/^(none|table(?!-c[ea]).+)/,Qe=/^--/,Ze={position:"absolute",visibility:"hidden",display:"block"},et={letterSpacing:"0",fontWeight:"400"};function tt(e,t,n){var r=re.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function nt(e,t,n,r,i,o){var s="width"===t?1:0,a=0,l=0;if(n===(r?"border":"content"))return 0;for(;s<4;s+=2)"margin"===n&&(l+=T.css(e,n+ie[s],!0,i)),r?("content"===n&&(l-=T.css(e,"padding"+ie[s],!0,i)),"margin"!==n&&(l-=T.css(e,"border"+ie[s]+"Width",!0,i))):(l+=T.css(e,"padding"+ie[s],!0,i),"padding"!==n?l+=T.css(e,"border"+ie[s]+"Width",!0,i):a+=T.css(e,"border"+ie[s]+"Width",!0,i));return!r&&o>=0&&(l+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-l-a-.5))||0),l}function rt(e,t,n){var r=$e(e),i=(!m.boxSizingReliable()||n)&&"border-box"===T.css(e,"boxSizing",!1,r),o=i,s=Ge(e,t,r),a="offset"+t[0].toUpperCase()+t.slice(1);if(He.test(s)){if(!n)return s;s="auto"}return(!m.boxSizingReliable()&&i||!m.reliableTrDimensions()&&O(e,"tr")||"auto"===s||!parseFloat(s)&&"inline"===T.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===T.css(e,"boxSizing",!1,r),(o=a in e)&&(s=e[a])),(s=parseFloat(s)||0)+nt(e,t,n||(i?"border":"content"),o,r,s)+"px"}T.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ge(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,s,a=K(t),l=Qe.test(t),c=e.style;if(l||(t=Xe(a)),s=T.cssHooks[t]||T.cssHooks[a],void 0===n)return s&&"get"in s&&void 0!==(i=s.get(e,!1,r))?i:c[t];"string"===(o=typeof n)&&(i=re.exec(n))&&i[1]&&(n=ce(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||l||(n+=i&&i[3]||(T.cssNumber[a]?"":"px")),m.clearCloneStyle||""!==n||0!==t.indexOf("background")||(c[t]="inherit"),s&&"set"in s&&void 0===(n=s.set(e,n,r))||(l?c.setProperty(t,n):c[t]=n))}},css:function(e,t,n,r){var i,o,s,a=K(t);return Qe.test(t)||(t=Xe(a)),(s=T.cssHooks[t]||T.cssHooks[a])&&"get"in s&&(i=s.get(e,!0,n)),void 0===i&&(i=Ge(e,t,r)),"normal"===i&&t in et&&(i=et[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),T.each(["height","width"],(function(e,t){T.cssHooks[t]={get:function(e,n,r){if(n)return!Je.test(T.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?rt(e,t,r):qe(e,Ze,(function(){return rt(e,t,r)}))},set:function(e,n,r){var i,o=$e(e),s=!m.scrollboxSize()&&"absolute"===o.position,a=(s||r)&&"border-box"===T.css(e,"boxSizing",!1,o),l=r?nt(e,t,r,a,o):0;return a&&s&&(l-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(o[t])-nt(e,t,"border",!1,o)-.5)),l&&(i=re.exec(n))&&"px"!==(i[3]||"px")&&(e.style[t]=n,n=T.css(e,t)),tt(0,n,l)}}})),T.cssHooks.marginLeft=Ve(m.reliableMarginLeft,(function(e,t){if(t)return(parseFloat(Ge(e,"marginLeft"))||e.getBoundingClientRect().left-qe(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+"px"})),T.each({margin:"",padding:"",border:"Width"},(function(e,t){T.cssHooks[e+t]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];r<4;r++)i[e+ie[r]+t]=o[r]||o[r-2]||o[0];return i}},"margin"!==e&&(T.cssHooks[e+t].set=tt)})),T.fn.extend({css:function(e,t){return W(this,(function(e,t,n){var r,i,o={},s=0;if(Array.isArray(t)){for(r=$e(e),i=t.length;s<i;s++)o[t[s]]=T.css(e,t[s],!1,r);return o}return void 0!==n?T.style(e,t,n):T.css(e,t)}),e,t,arguments.length>1)}}),T.fn.delay=function(e,n){return e=T.fx&&T.fx.speeds[e]||e,n=n||"fx",this.queue(n,(function(n,r){var i=t.setTimeout(n,e);r.stop=function(){t.clearTimeout(i)}}))},function(){var e=_.createElement("input"),t=_.createElement("select").appendChild(_.createElement("option"));e.type="checkbox",m.checkOn=""!==e.value,m.optSelected=t.selected,(e=_.createElement("input")).value="t",e.type="radio",m.radioValue="t"===e.value}();var it,ot=T.expr.attrHandle;T.fn.extend({attr:function(e,t){return W(this,T.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){T.removeAttr(this,e)}))}}),T.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?T.prop(e,t,n):(1===o&&T.isXMLDoc(e)||(i=T.attrHooks[t.toLowerCase()]||(T.expr.match.bool.test(t)?it:void 0)),void 0!==n?null===n?void T.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=T.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!m.radioValue&&"radio"===t&&O(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(B);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),it={set:function(e,t,n){return!1===t?T.removeAttr(e,n):e.setAttribute(n,n),n}},T.each(T.expr.match.bool.source.match(/\w+/g),(function(e,t){var n=ot[t]||T.find.attr;ot[t]=function(e,t,r){var i,o,s=t.toLowerCase();return r||(o=ot[s],ot[s]=i,i=null!=n(e,t,r)?s:null,ot[s]=o),i}}));var st=/^(?:input|select|textarea|button)$/i,at=/^(?:a|area)$/i;function lt(e){return(e.match(B)||[]).join(" ")}function ct(e){return e.getAttribute&&e.getAttribute("class")||""}function dt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(B)||[]}T.fn.extend({prop:function(e,t){return W(this,T.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[T.propFix[e]||e]}))}}),T.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&T.isXMLDoc(e)||(t=T.propFix[t]||t,i=T.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=T.find.attr(e,"tabindex");return t?parseInt(t,10):st.test(e.nodeName)||at.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(T.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),T.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){T.propFix[this.toLowerCase()]=this})),T.fn.extend({addClass:function(e){var t,n,r,i,o,s,a,l=0;if(v(e))return this.each((function(t){T(this).addClass(e.call(this,t,ct(this)))}));if((t=dt(e)).length)for(;n=this[l++];)if(i=ct(n),r=1===n.nodeType&&" "+lt(i)+" "){for(s=0;o=t[s++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(a=lt(r))&&n.setAttribute("class",a)}return this},removeClass:function(e){var t,n,r,i,o,s,a,l=0;if(v(e))return this.each((function(t){T(this).removeClass(e.call(this,t,ct(this)))}));if(!arguments.length)return this.attr("class","");if((t=dt(e)).length)for(;n=this[l++];)if(i=ct(n),r=1===n.nodeType&&" "+lt(i)+" "){for(s=0;o=t[s++];)for(;r.indexOf(" "+o+" ")>-1;)r=r.replace(" "+o+" "," ");i!==(a=lt(r))&&n.setAttribute("class",a)}return this},toggleClass:function(e,t){var n=typeof e,r="string"===n||Array.isArray(e);return"boolean"==typeof t&&r?t?this.addClass(e):this.removeClass(e):v(e)?this.each((function(n){T(this).toggleClass(e.call(this,n,ct(this),t),t)})):this.each((function(){var t,i,o,s;if(r)for(i=0,o=T(this),s=dt(e);t=s[i++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else void 0!==e&&"boolean"!==n||((t=ct(this))&&J.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":J.get(this,"__className__")||""))}))},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+lt(ct(n))+" ").indexOf(t)>-1)return!0;return!1}});var ut=/\r/g;T.fn.extend({val:function(e){var t,n,r,i=this[0];return arguments.length?(r=v(e),this.each((function(n){var i;1===this.nodeType&&(null==(i=r?e.call(this,n,T(this).val()):e)?i="":"number"==typeof i?i+="":Array.isArray(i)&&(i=T.map(i,(function(e){return null==e?"":e+""}))),(t=T.valHooks[this.type]||T.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))}))):i?(t=T.valHooks[i.type]||T.valHooks[i.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:"string"==typeof(n=i.value)?n.replace(ut,""):null==n?"":n:void 0}}),T.extend({valHooks:{option:{get:function(e){var t=T.find.attr(e,"value");return null!=t?t:lt(T.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,s="select-one"===e.type,a=s?null:[],l=s?o+1:i.length;for(r=o<0?l:s?o:0;r<l;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!O(n.parentNode,"optgroup"))){if(t=T(n).val(),s)return t;a.push(t)}return a},set:function(e,t){for(var n,r,i=e.options,o=T.makeArray(t),s=i.length;s--;)((r=i[s]).selected=T.inArray(T.valHooks.option.get(r),o)>-1)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),T.each(["radio","checkbox"],(function(){T.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=T.inArray(T(e).val(),t)>-1}},m.checkOn||(T.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})})),m.focusin="onfocusin"in t;var ht=/^(?:focusinfocus|focusoutblur)$/,gt=function(e){e.stopPropagation()};T.extend(T.event,{trigger:function(e,n,r,i){var o,s,a,l,c,d,u,h,f=[r||_],p=g.call(e,"type")?e.type:e,m=g.call(e,"namespace")?e.namespace.split("."):[];if(s=h=a=r=r||_,3!==r.nodeType&&8!==r.nodeType&&!ht.test(p+T.event.triggered)&&(p.indexOf(".")>-1&&(m=p.split("."),p=m.shift(),m.sort()),c=p.indexOf(":")<0&&"on"+p,(e=e[T.expando]?e:new T.Event(p,"object"==typeof e&&e)).isTrigger=i?2:3,e.namespace=m.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),n=null==n?[e]:T.makeArray(n,[e]),u=T.event.special[p]||{},i||!u.trigger||!1!==u.trigger.apply(r,n))){if(!i&&!u.noBubble&&!y(r)){for(l=u.delegateType||p,ht.test(l+p)||(s=s.parentNode);s;s=s.parentNode)f.push(s),a=s;a===(r.ownerDocument||_)&&f.push(a.defaultView||a.parentWindow||t)}for(o=0;(s=f[o++])&&!e.isPropagationStopped();)h=s,e.type=o>1?l:u.bindType||p,(d=(J.get(s,"events")||Object.create(null))[e.type]&&J.get(s,"handle"))&&d.apply(s,n),(d=c&&s[c])&&d.apply&&Y(s)&&(e.result=d.apply(s,n),!1===e.result&&e.preventDefault());return e.type=p,i||e.isDefaultPrevented()||u._default&&!1!==u._default.apply(f.pop(),n)||!Y(r)||c&&v(r[p])&&!y(r)&&((a=r[c])&&(r[c]=null),T.event.triggered=p,e.isPropagationStopped()&&h.addEventListener(p,gt),r[p](),e.isPropagationStopped()&&h.removeEventListener(p,gt),T.event.triggered=void 0,a&&(r[c]=a)),e.result}},simulate:function(e,t,n){var r=T.extend(new T.Event,n,{type:e,isSimulated:!0});T.event.trigger(r,null,t)}}),T.fn.extend({trigger:function(e,t){return this.each((function(){T.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var n=this[0];if(n)return T.event.trigger(e,t,n,!0)}}),m.focusin||T.each({focus:"focusin",blur:"focusout"},(function(e,t){var n=function(e){T.event.simulate(t,e.target,T.event.fix(e))};T.event.special[t]={setup:function(){var r=this.ownerDocument||this.document||this,i=J.access(r,t);i||r.addEventListener(e,n,!0),J.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this.document||this,i=J.access(r,t)-1;i?J.access(r,t,i):(r.removeEventListener(e,n,!0),J.remove(r,t))}}})),T.parseXML=function(e){var n;if(!e||"string"!=typeof e)return null;try{n=(new t.DOMParser).parseFromString(e,"text/xml")}catch(e){n=void 0}return n&&!n.getElementsByTagName("parsererror").length||T.error("Invalid XML: "+e),n};var ft,pt=/\[\]$/,mt=/\r?\n/g,vt=/^(?:submit|button|image|reset|file)$/i,yt=/^(?:input|select|textarea|keygen)/i;function _t(e,t,n,r){var i;if(Array.isArray(t))T.each(t,(function(t,i){n||pt.test(e)?r(e,i):_t(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,n,r)}));else if(n||"object"!==N(t))r(e,t);else for(i in t)_t(e+"["+i+"]",t[i],n,r)}T.param=function(e,t){var n,r=[],i=function(e,t){var n=v(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!T.isPlainObject(e))T.each(e,(function(){i(this.name,this.value)}));else for(n in e)_t(n,e[n],t,i);return r.join("&")},T.fn.extend({serialize:function(){return T.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=T.prop(this,"elements");return e?T.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!T(this).is(":disabled")&&yt.test(this.nodeName)&&!vt.test(e)&&(this.checked||!pe.test(e))})).map((function(e,t){var n=T(this).val();return null==n?null:Array.isArray(n)?T.map(n,(function(e){return{name:t.name,value:e.replace(mt,"\r\n")}})):{name:t.name,value:n.replace(mt,"\r\n")}})).get()}}),T.fn.extend({wrapAll:function(e){var t;return this[0]&&(v(e)&&(e=e.call(this[0])),t=T(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return v(e)?this.each((function(t){T(this).wrapInner(e.call(this,t))})):this.each((function(){var t=T(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)}))},wrap:function(e){var t=v(e);return this.each((function(n){T(this).wrapAll(t?e.call(this,n):e)}))},unwrap:function(e){return this.parent(e).not("body").each((function(){T(this).replaceWith(this.childNodes)})),this}}),T.expr.pseudos.hidden=function(e){return!T.expr.pseudos.visible(e)},T.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},m.createHTMLDocument=((ft=_.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===ft.childNodes.length),T.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(m.createHTMLDocument?((r=(t=_.implementation.createHTMLDocument("")).createElement("base")).href=_.location.href,t.head.appendChild(r)):t=_),o=!n&&[],(i=A.exec(e))?[t.createElement(i[1])]:(i=Ne([e],t,o),o&&o.length&&T(o).remove(),T.merge([],i.childNodes)));var r,i,o},T.offset={setOffset:function(e,t,n){var r,i,o,s,a,l,c=T.css(e,"position"),d=T(e),u={};"static"===c&&(e.style.position="relative"),a=d.offset(),o=T.css(e,"top"),l=T.css(e,"left"),("absolute"===c||"fixed"===c)&&(o+l).indexOf("auto")>-1?(s=(r=d.position()).top,i=r.left):(s=parseFloat(o)||0,i=parseFloat(l)||0),v(t)&&(t=t.call(e,n,T.extend({},a))),null!=t.top&&(u.top=t.top-a.top+s),null!=t.left&&(u.left=t.left-a.left+i),"using"in t?t.using.call(e,u):("number"==typeof u.top&&(u.top+="px"),"number"==typeof u.left&&(u.left+="px"),d.css(u))}},T.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){T.offset.setOffset(this,e,t)}));var t,n,r=this[0];return r?r.getClientRects().length?(t=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===T.css(r,"position"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===T.css(e,"position");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=T(e).offset()).top+=T.css(e,"borderTopWidth",!0),i.left+=T.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-T.css(r,"marginTop",!0),left:t.left-i.left-T.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&"static"===T.css(e,"position");)e=e.offsetParent;return e||oe}))}}),T.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(e,t){var n="pageYOffset"===t;T.fn[e]=function(r){return W(this,(function(e,r,i){var o;if(y(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===i)return o?o[t]:e[r];o?o.scrollTo(n?o.pageXOffset:i,n?i:o.pageYOffset):e[r]=i}),e,r,arguments.length)}})),T.each(["top","left"],(function(e,t){T.cssHooks[t]=Ve(m.pixelPosition,(function(e,n){if(n)return n=Ge(e,t),He.test(n)?T(e).position()[t]+"px":n}))})),T.each({Height:"height",Width:"width"},(function(e,t){T.each({padding:"inner"+e,content:t,"":"outer"+e},(function(n,r){T.fn[r]=function(i,o){var s=arguments.length&&(n||"boolean"!=typeof i),a=n||(!0===i||!0===o?"margin":"border");return W(this,(function(t,n,i){var o;return y(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===i?T.css(t,n,a):T.style(t,n,i,a)}),t,s?i:void 0,s)}}))})),T.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),T.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(e,t){T.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}));var Ct=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;T.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),v(e))return r=a.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(a.call(arguments)))}).guid=e.guid=e.guid||T.guid++,i},T.holdReady=function(e){e?T.readyWait++:T.ready(!0)},T.isArray=Array.isArray,T.parseJSON=JSON.parse,T.nodeName=O,T.isFunction=v,T.isWindow=y,T.camelCase=K,T.type=N,T.now=Date.now,T.isNumeric=function(e){var t=T.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},T.trim=function(e){return null==e?"":(e+"").replace(Ct,"")},void 0===(r=function(){return T}.apply(i,[]))||(e.exports=r);var bt=t.jQuery,Nt=t.$;T.noConflict=function(e){return t.$===T&&(t.$=Nt),e&&t.jQuery===T&&(t.jQuery=bt),T};var Tt,Et,St=/^(?:toggle|show|hide)$/,kt=/queueHooks$/;function xt(){Et&&(!1===_.hidden&&t.requestAnimationFrame?t.requestAnimationFrame(xt):t.setTimeout(xt,T.fx.interval),T.fx.tick())}function wt(){return t.setTimeout((function(){Tt=void 0})),Tt=Date.now()}function Ot(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ie[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function At(e,t,n,r,i){return new At.prototype.init(e,t,n,r,i)}function Rt(e,t,n){for(var r,i=(It.tweeners[t]||[]).concat(It.tweeners["*"]),o=0,s=i.length;o<s;o++)if(r=i[o].call(n,t,e))return r}function It(e,t,n){var r,i,o=0,s=It.prefilters.length,a=T.Deferred().always((function(){delete l.elem})),l=function(){if(i)return!1;for(var t=Tt||wt(),n=Math.max(0,c.startTime+c.duration-t),r=1-(n/c.duration||0),o=0,s=c.tweens.length;o<s;o++)c.tweens[o].run(r);return a.notifyWith(e,[c,r,n]),r<1&&s?n:(s||a.notifyWith(e,[c,1,0]),a.resolveWith(e,[c]),!1)},c=a.promise({elem:e,props:T.extend({},t),opts:T.extend(!0,{specialEasing:{},easing:T.easing._default},n),originalProperties:t,originalOptions:n,startTime:Tt||wt(),duration:n.duration,tweens:[],createTween:function(t,n){var r=T.Tween(e,c.opts,t,n,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(r),r},stop:function(t){var n=0,r=t?c.tweens.length:0;if(i)return this;for(i=!0;n<r;n++)c.tweens[n].run(1);return t?(a.notifyWith(e,[c,1,0]),a.resolveWith(e,[c,t])):a.rejectWith(e,[c,t]),this}}),d=c.props;for(!function(e,t){var n,r,i,o,s;for(n in e)if(i=t[r=K(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(s=T.cssHooks[r])&&"expand"in s)for(n in o=s.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(d,c.opts.specialEasing);o<s;o++)if(r=It.prefilters[o].call(c,e,d,c.opts))return v(r.stop)&&(T._queueHooks(c.elem,c.opts.queue).stop=r.stop.bind(r)),r;return T.map(d,Rt,c),v(c.opts.start)&&c.opts.start.call(e,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),T.fx.timer(T.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c}return T.Tween=At,At.prototype={constructor:At,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||T.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(T.cssNumber[n]?"":"px")},cur:function(){var e=At.propHooks[this.prop];return e&&e.get?e.get(this):At.propHooks._default.get(this)},run:function(e){var t,n=At.propHooks[this.prop];return this.options.duration?this.pos=t=T.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):At.propHooks._default.set(this),this}},At.prototype.init.prototype=At.prototype,At.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=T.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){T.fx.step[e.prop]?T.fx.step[e.prop](e):1!==e.elem.nodeType||!T.cssHooks[e.prop]&&null==e.elem.style[Xe(e.prop)]?e.elem[e.prop]=e.now:T.style(e.elem,e.prop,e.now+e.unit)}}},At.propHooks.scrollTop=At.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},T.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},T.fx=At.prototype.init,T.fx.step={},T.Animation=T.extend(It,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return ce(n.elem,e,re.exec(t),n),n}]},tweener:function(e,t){v(e)?(t=e,e=["*"]):e=e.match(B);for(var n,r=0,i=e.length;r<i;r++)n=e[r],It.tweeners[n]=It.tweeners[n]||[],It.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,s,a,l,c,d,u="width"in t||"height"in t,h=this,g={},f=e.style,p=e.nodeType&&le(e),m=J.get(e,"fxshow");for(r in n.queue||(null==(s=T._queueHooks(e,"fx")).unqueued&&(s.unqueued=0,a=s.empty.fire,s.empty.fire=function(){s.unqueued||a()}),s.unqueued++,h.always((function(){h.always((function(){s.unqueued--,T.queue(e,"fx").length||s.empty.fire()}))}))),t)if(i=t[r],St.test(i)){if(delete t[r],o=o||"toggle"===i,i===(p?"hide":"show")){if("show"!==i||!m||void 0===m[r])continue;p=!0}g[r]=m&&m[r]||T.style(e,r)}if((l=!T.isEmptyObject(t))||!T.isEmptyObject(g))for(r in u&&1===e.nodeType&&(n.overflow=[f.overflow,f.overflowX,f.overflowY],null==(c=m&&m.display)&&(c=J.get(e,"display")),"none"===(d=T.css(e,"display"))&&(c?d=c:(he([e],!0),c=e.style.display||c,d=T.css(e,"display"),he([e]))),("inline"===d||"inline-block"===d&&null!=c)&&"none"===T.css(e,"float")&&(l||(h.done((function(){f.display=c})),null==c&&(d=f.display,c="none"===d?"":d)),f.display="inline-block")),n.overflow&&(f.overflow="hidden",h.always((function(){f.overflow=n.overflow[0],f.overflowX=n.overflow[1],f.overflowY=n.overflow[2]}))),l=!1,g)l||(m?"hidden"in m&&(p=m.hidden):m=J.access(e,"fxshow",{display:c}),o&&(m.hidden=!p),p&&he([e],!0),h.done((function(){for(r in p||he([e]),J.remove(e,"fxshow"),g)T.style(e,r,g[r])}))),l=Rt(p?m[r]:0,r,h),r in m||(m[r]=l.start,p&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?It.prefilters.unshift(e):It.prefilters.push(e)}}),T.speed=function(e,t,n){var r=e&&"object"==typeof e?T.extend({},e):{complete:n||!n&&t||v(e)&&e,duration:e,easing:n&&t||t&&!v(t)&&t};return T.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in T.fx.speeds?r.duration=T.fx.speeds[r.duration]:r.duration=T.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){v(r.old)&&r.old.call(this),r.queue&&T.dequeue(this,r.queue)},r},T.fn.extend({fadeTo:function(e,t,n,r){return this.filter(le).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=T.isEmptyObject(e),o=T.speed(t,n,r),s=function(){var t=It(this,T.extend({},e),o);(i||J.get(this,"finish"))&&t.stop(!0)};return s.finish=s,i||!1===o.queue?this.each(s):this.queue(o.queue,s)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each((function(){var t=!0,i=null!=e&&e+"queueHooks",o=T.timers,s=J.get(this);if(i)s[i]&&s[i].stop&&r(s[i]);else for(i in s)s[i]&&s[i].stop&&kt.test(i)&&r(s[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));!t&&n||T.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||"fx"),this.each((function(){var t,n=J.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=T.timers,s=r?r.length:0;for(n.finish=!0,T.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<s;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish}))}}),T.each(["toggle","show","hide"],(function(e,t){var n=T.fn[t];T.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(Ot(t,!0),e,r,i)}})),T.each({slideDown:Ot("show"),slideUp:Ot("hide"),slideToggle:Ot("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(e,t){T.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}})),T.timers=[],T.fx.tick=function(){var e,t=0,n=T.timers;for(Tt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||T.fx.stop(),Tt=void 0},T.fx.timer=function(e){T.timers.push(e),T.fx.start()},T.fx.interval=13,T.fx.start=function(){Et||(Et=!0,xt())},T.fx.stop=function(){Et=null},T.fx.speeds={slow:600,fast:200,_default:400},T}(window)),Object.defineProperty(i,"__esModule",{value:!0}),function(e,t){if(!t||!t.VERSION||!t.$)return void console.error("Loopindex Utils: window.LOOPINDEX must be properly defined");const n=e=>{const t={major:0,minor:0,build:0};if(!e||["string","number"].indexOf(typeof e)<0)return t;if(!(e=String(e||"").trim()))return t;function n(e){if(!e)return 0;const t=parseInt(e.replace(/[^\d]+/g,""));return isNaN(t)?0:t}const r=e.match(/(\d+)(\.\d+)?(\.\d+)?/);return r?{major:n(r[1]),minor:n(r[2]),build:n(r[3])}:t},r=(e,t)=>{const r=n(e),i=n(t);return Math.sign(r.major-i.major)||Math.sign(r.minor-i.minor)||Math.sign(r.build-i.build)};if(t.utils&&r("1.8.16",t.utils.VERSION)<1)return;const i=t.$,o=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,s=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d\.\%]+)\s*\)/;new Set(["TEXTAREA","INPUT","OL","UL","TABLE","TR","IMG","SCRIPT","LINK","svg","BR"]);class a{constructor(e,t){this.prefix=e,this._config={log:!1,debug:!1,warn:!1,error:!0,trace:!1},this._logs=[],this.timeout=null,this.config(t)}config(e){if(e){const t={};Object.entries(this._config).forEach(([n,r])=>{const i=e[n];typeof r==typeof i&&(t[n]=i)}),i.extend(this._config,t)}return i.extend({},this._config)}ignore(){}log(...e){this._config.log&&this._log("log",Array.from(e))}error(...e){this._config.error&&this._log("error",Array.from(e))}debug(...e){this._config.debug&&this._log("log",Array.from(e))}trace(...e){if(this._config.trace){const t=Error().stack,n=t?[t.replace("Error","Debug:"),"\n"]:[];this._log("log",n.concat(Array.from(e)))}}warn(...e){this._config.warn&&this._log("warn",Array.from(e))}_log(e,t){const n=new Date,r=[n.getMinutes(),n.getSeconds(),n.getMilliseconds()].join(":");t.unshift(r+">"),t.unshift(this.prefix),"error"===e||"warn"===e?console[e].apply(console,t):(this._logs.push({method:e,logs:t}),this.scheduleDump())}dump(){const e=this._logs.slice();this._logs.length=0,e.forEach((function(e){console[e.method].apply(console,e.logs)}))}scheduleDump(){this.timeout||(this.timeout=setTimeout(function(){this.timeout=null,this.dump()}.bind(this),100))}}class l{merge(e,n,r,i=!1){const o=null===r?(e,t)=>e===t:(e,t)=>e===t||e&&t&&e[r]===t[r];e=e||[];const s=[];return(n=n||[]).forEach(n=>{let r=!1;for(let s=0,a=e.length;!r&&s<a;++s){const a=e[s];o(a,n)&&(e[s]=i&&a&&n?t.$.extend(a,n):n,r=!0)}r||s.push(n)}),e.push(...s),e}firstIndex(e,t){const n=null==e?void 0:e.length;if(!n||!t)return-1;if(Array.isArray(e))return e.findIndex(t);for(let r=0;r<n;++r)if(t(e[r],r,e))return r;return-1}first(e,t){const n=this.firstIndex(e,t);return n<0?null:e[n]}remove(e,n){if(!(null==e?void 0:e.length))return Array.isArray(e)?e:[];const r=n.element,i=n.test;if(void 0!==r===Boolean(i))return t.logger.warn("provide exactly one of element/test in array remove"),e;const o=!1!==n.inPlace&&Array.isArray(e)?e:Array.from(e);let s=0;n.from&&(n.from>=0&&n.from<o.length?s=Math.floor(n.from):t.logger.warn("Invalid from field in array remove "+n.from));const a=!1===n.all?1:o.length;if(0===s&&1===a){const e=i?o.findIndex(i):o.indexOf(r);return e>=0&&o.splice(e,1),o}for(let e=o.length-1,t=0;e>=s&&t<a;--e){(i?i(o[e],e,o):o[e]===r)&&(o.splice(e,1),++t)}return o}}class c{constructor(e){if(this._doc=e,!e)throw new Error("CSS Loader: null document");this._styleId=t.utils.strings.randomString(8),this._loadedStyleIds={}}get document(){return this._doc}getOwnStyleSheet(e){let t=this._doc.getElementById(this._styleId);return!t&&e&&(t=this._doc.createElement("style"),t.appendChild(this._doc.createTextNode("")),t.setAttribute("id",this._styleId),this._loadedStyleIds[this._styleId]=!0,this.$head.append(t)),t&&t.sheet}loadCSSString(e,t){if(!(e=null==e?void 0:e.trim()))return;const n="li-style-"+e.split("").reduce((e,t,n)=>e+n*t.charCodeAt(0),0),r=this.$head;if(r.find(`style[id='${n}']`).length)return;const i=this._doc.createElement("style");i.id=n,this._loadedStyleIds[n]=!0,i.appendChild(this._doc.createTextNode(e)),r.append(i)}loadCSS(e,n){const r=this.$head,o=this._doc,s=t.utils.strings.toStringArray(e),a={ok:!0,loaded:[],failed:[]},l=({url:e,error:n})=>{n?(a.ok=!1,a.failed.push({url:e,error:n}),t.logger.warn("Error loading css "+e)):a.loaded.push(e),c()},c=()=>{if(!s.length||!a.ok)return void(n&&setTimeout(()=>n(a),1));const e=s.shift();if(!e)return c();const d=`_loopindex-${e.replace(/[^0-9a-z]+/gi,"_")}_`;if(0===i(r).find(`link[data-loopindex-id='${d}']`).length){const n=o.createElement("link"),s=i(n);t.utils.dom.attachCBToLink(n,e,l),s.attr({rel:"stylesheet",type:"text/css","data-loopindex-id":d,href:e}),this._loadedStyleIds[d]=!0,r.append(s)}else l({url:e})};c()}addRule(e,n){var r;if(!n||"object"!=typeof n)return;const i=this.getOwnStyleSheet(!0);if(!i)return void t.logger.warn("LoopIndex CSSLoader cannot create stylesheet");const o=(null===(r=i.cssRules)||void 0===r?void 0:r.length)||0,s=this._makeRule(n);"function"==typeof i.addRule?i.addRule(e,s,o):"function"==typeof i.insertRule?i.insertRule(`${e} { ${this._makeRule(n)} }`,o):t.logger.error("CSSLoader addRule: no matching function")}reset(){const e=this.getOwnStyleSheet(!1);if(e&&e.deleteRule)for(let t=e.cssRules.length-1;t>=0;--t)e.deleteRule(t)}dispose(){if(!this._doc)return;const e=this.$head;Object.keys(this._loadedStyleIds).forEach(t=>{setTimeout(()=>{try{e.find("#"+t).remove()}catch(e){}},0)}),this._loadedStyleIds={},this._doc=null}get $head(){return t.$(this._doc&&(this._doc.head||this._doc.getElementsByTagName("head")[0]))}_makeRule(e){return Object.keys(e||{}).map(t=>`${t}: ${e[t]};`).join("\n")}}class d{constructor(){this._map=new Map,this._items=[]}get(e){var t,n;return null!==(n=null===(t=this._map.get(e))||void 0===t?void 0:t.item)&&void 0!==n?n:null}contains(e){const t=this._items.find(t=>t.item===e);return Boolean(t)}get length(){return this._items.length}hasId(e){return this._map.has(e)}clear(){return this._items.length=0,this._refresh(),this}firstIndex(e){for(let t=0,n=this.length;t<n;++t)if(e(this._items[t].item,t))return t;return-1}first(e){const t=this.firstIndex(e);return t>=0?this._items[t].item:null}filter(e){return this._items.reduce((t,n,r)=>(e(n.item,r)&&t.push(n.item),t),[])}count(e){let t=0;for(let n=0,r=this._items.length;n<r;++n)e(this._items[n].item,n)&&t++;return t}map(e){return this._items.map((t,n)=>e(t.item,n))}get asMap(){return this._items.reduce((e,t)=>(e.set(t.id,t.item),e),new Map)}get asObject(){const e={};return this._map.forEach((t,n)=>{e[n]=t.item}),e}get items(){return this._items.map(e=>e.item)}getItemIndex(e){var t;const n=this._map.get(e);return null!==(t=null==n?void 0:n.index)&&void 0!==t?t:-1}getAt(e){const n=this._validateIndex(e,!1);return n.error?(t.logger.error("getAt: "+n.error),null):this._items[n.index].item}move(e,n){const r=e?this._map.get(e):null;if(!r)return t.logger.error("maparray move: unkonw id "+e),this;const i=this._validateIndex(n,!1);if(i.error)return t.logger.error("maparray move: invalid index "+n),this;if(r.index!==i.index){const t=this._items[r.index];this._items.splice(r.index,1),this._items.splice(i.index,0,t),this._map.set(e,{item:r.item,index:i.index})}return this}moveBefore(e,n){if(!e||!n||e===n)return t.logger.error(`moveBefore: invalid input ${e}, ${n}`),!1;const r=this._map.get(e),i=this._map.get(n);if(!r||!i)return t.logger.error(`moveBefore: can't find items ${e} and/or ${n}`),!1;const o=i.index-1;if(r.index===o)return!1;let s=r.index<o?1:0;return this._items.splice(r.index,1),this._items.splice(i.index-s,0,{item:r.item,id:e}),this._refresh(),!0}moveAfter(e,t){return this.moveBefore(t,e)}push({item:e,id:t}){return this.add({item:e,id:t,index:this.length})}add({item:e,id:t,index:n,replace:r}){if(!e||!t)throw new Error("ArrayMap add: null element and/or id");if(!r&&this.get(t))throw new Error(`Element with id ${t} already in ArrayMap`);(void 0===n||isNaN(n))&&(n=this.length);const i=this._validateIndex(n,!0);if(i.error)throw new Error(`ArrayMap add: illegal index ${n} for id ${t}`);const o={id:t,item:e};return 0===(n=i.index)?this._items.unshift(o):n===this._items.length?this._items.push(o):this._items.splice(n,0,o),this._refresh(),this}removeById(e){const n=this._map.get(e);return n?(this._items.splice(n.index,1),this._refresh(),this):(t.logger.warn("ArrayMap.removeById: no item with id "+e),this)}forEach(e){const t=this._items.slice();for(let n=0,r=t.length;n<r;++n){const r=t[n];if(this.hasId(r.id)){if(!1===e(t[n].item,n))break}}}removeByIndex(e){const n=this._validateIndex(e,!1);return n.error?t.logger.error("Arraymap remove by index: "+n.error):(this._items.splice(n.index,1),this._refresh()),this}_refresh(){this._map.clear(),this._items.forEach((e,t)=>{this._map.set(e.id,{item:e.item,index:t})})}_validateIndex(e,t){const n=this._items.length-(t?0:1);return!isNaN(e)&&e>=0&&e<=n?{error:"",index:Math.floor(e)}:{error:"invalid index "+e}}}class u extends d{constructor(e){super(),this.idGet=e}pushItem(e){return this.addItem({item:e,index:this.length})}addItem(e){return this.add(Object.assign(Object.assign({},e),{id:this.idGet(e.item)}))}removeItem(e){return this.removeById(this.idGet(e))}}const h=e=>"string"==typeof e?e.toLowerCase():String(e).toLowerCase();class g extends Map{set(e,t){return super.set(h(e),t)}get(e){return super.get(h(e))}has(e){return super.has(h(e))}clone(){return new g(this.entries())}}class f extends Set{add(e){return super.add(h(e))}delete(e){return super.delete(h(e))}has(e){return super.has(h(e))}clone(){return new f(this.values())}}class p{constructor(){this.VERSION="1.8.16",this.array=new l}compareVersions(e,t){const n=r(e,t);return n>0?1:0===n?0:-1}parseVersion(e){return n(e)}createCIMap(e,...n){let r=[],i=!1;return e&&(Array.isArray(e)?e.length&&(Array.isArray(e[0])?r.push(...e):(r.push(e),i=!0)):Object.entries(e).forEach(([e,t])=>{r.push([e,t])})),i?n.forEach(e=>r.push(e)):n.length&&t.logger.error("createCIMap: can't pass more arguments after record/array of tuples"),new g(r)}createCISet(e,...t){const n=this.strings.toStringArray(e);return(null==t?void 0:t.length)?new f([...n,...t]):new f(n)}createArrayMap(){return new d}createTypedArrayMap(e){return new u(e)}clearObject(e){return e?(Object.keys(e).forEach(t=>{try{delete e[t]}catch(e){}}),e):{}}getRelativeTimezoneOffset(e){if(!e)return 0;try{const t=new Date,n=t.toLocaleString("en-us",{timeZone:e});return Date.parse(n)-t.getTime()}catch(n){return t.logger.error("convertDateToTimezone",e,n),0}}convertDateToTimezone(e,n){if(e=e||new Date,!n)return e;try{const r=t.utils.getRelativeTimezoneOffset(n);return new Date(e.getTime()+r)}catch(r){return t.logger.error("convertDateToTimezone",n,r),e}}get CSSLoader(){return c}intensifyColor(e,t){const n=e.match(o);let r=n?null:e.match(s);const i=r||r;let a,l=10;i?a=[i[1],i[2],i[3]]:(l=16,(e=String(e).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),a=[e.substr(0,2),e.substr(2,2),e.substr(4,2)]),t=t||0;const c=[];let d;for(let e=0;e<3;e++)d=parseInt(a[e],l),c.push(Math.round(Math.min(Math.max(0,d+d*t),255)));return n?`rgb(${c[0]},${c[1]},${c[2]})`:r?`rgba(${c[0]},${c[1]},${c[2]}, ${r[4]})`:"#"+c.map(e=>e<16?"0"+e.toString(16):e.toString(16)).join("")}getUniqueNumber(){return p.nextId++}getUniqueId(e,n){return`${e}${t.utils.getUniqueNumber()}${n||""}`}yes(...e){return!0}no(...e){return!1}always(e){return function(...t){return e}}noop(...e){}getCurrentScriptPath(){const e=t.utils.getCurrentScriptURL();if(!e)return null;const n=/^(.+\/)[^\/]+\.js/i.exec(e);return n&&n[1]}getCurrentScriptURL(){try{const e=document&&document.currentScript;if(e)return e.src;const t=window.import,n=t&&t.meta;return void 0!==n&&n.url?n.url:null}catch(e){return null}}scrollToElement(e,n){const r=t.utils.dom.toJQuery(e);return r&&r.scrollintoview(n)}joinPath(...e){const t=e.length-1,n=e.map((e,n)=>e?(0!==n&&(e=e.replace(/^[\s\/]+/,"")),n<t&&(e=e.replace(/[\s\/]+$/,"")),e):"").filter(Boolean).join("/").split("/"),r=[];for(let e=0,t=n.length-1;e<=t;e++){const t=n[e];"."!==t&&(".."===t&&r.length>0?r.length--:r.push(t))}return r.join("/")}isAbsoluteUrl(e){return!!e&&("/"===e[0]||/^[a-z]+\:\/\//i.test(e)||/^data:/.test(e))}}p.nextId=Math.round(Date.now()%1e5);const m={mixin:function(e){const n={};let r=!1;const o=function(e){return n[e]=n[e]||[]},s=function(){const e=n;Object.keys(e).forEach(t=>{const n=e[t];(null==n?void 0:n.length)||delete e[t]})},a=function(e,...n){if(!e)return void t.logger.warn("cannot trigger empty event");if(r)return;const i=o(e),a=i.length?i.slice():i,l=[];a.forEach(e=>{e.muted||e.callback.apply(e.scope,n),e.options&&e.options.count&&(--e.options.count,e.options.count<=0&&l.push(e))}),l.length&&(l.forEach((function(e){i.splice(i.indexOf(e),1)})),s())},l={on:function(e,n,r,s){if(!e)return t.logger.warn("cannot register to empty event"),this;if(i.isArray(e))e.forEach(e=>{this.addListener(e,n,r,s)});else if("function"==typeof n){o(e).push({scope:r,muted:!1,callback:n,options:s})}else t.logger.error("events mixin addListener: bad callback",n);return this},off:function(e,t){if(!e&&!t)return this.removeAllListeners();if(!t&&e&&"object"==typeof e&&(t=e,e=null),e&&e instanceof Array)return e.forEach(e=>{this.off(e,t)}),this;function r(e,n){return e&&(!t||e.scope===t||e.callback===t)}const i=n;return Object.keys(i).forEach(t=>{e&&e!==t||i[t].filter(r).forEach(e=>{const n=i[t].indexOf(e);n>=0&&i[t].splice(n,1)})}),s(),this},removeAllListeners:function(){return Object.keys(n).forEach(e=>delete n[e]),this},muteListener:function(e,t){if(!e)return this;t=Boolean(t);const r=n;return Object.keys(r).forEach(n=>{const i=r[n];i&&i.forEach(n=>{n&&n.scope===e&&(n.muted=t)})}),this},muteEvents:function(){return r=!0,this},unmuteEvents:function(){return r=!1,this},once:function(e,t,n,r){return(r=r||{}).count=1,this.on(e,t,n,r)},trigger:function(e,...t){return a.apply(this,[e].concat(t)),this}};Object.keys(l).forEach(t=>{const n=l[t];"function"==typeof n&&Object.defineProperty(e,t,{value:n,enumerable:!0,writable:!1,configurable:!1})});const c={fire:l.trigger,removeListener:l.off,bind:l.on,addListener:l.on};return Object.keys(c).forEach(t=>{Object.defineProperty(e,t,{enumerable:!0,value:c[t],writable:!1,configurable:!1})}),e}};!function(){if(!i||!i.fn)return console.warn("Cannot define scrollintoview: no $");if(i.fn.scrollintoview)return console.warn("$ scrollintoview already defined");var e={vertical:{x:!1,y:!0},horizontal:{x:!0,y:!1},both:{x:!0,y:!0},x:{x:!0,y:!1},y:{x:!1,y:!0}};const n={duration:"fast",direction:{x:!1,y:!0},margin:0},r=/^(?:html)$/i,o=function(e,t){var n;const r=null===(n=null==e?void 0:e.ownerDocument)||void 0===n?void 0:n.defaultView;if(!r)return{top:0,left:0,bottom:0,right:0,vertical:0,horizontal:0};const o=Boolean(r.getComputedStyle);t=t||o?r.getComputedStyle(e,null):e.currentStyle;const s=!!o,a={top:parseFloat(s?t.borderTopWidth:i.css(e,"borderTopWidth"))||0,left:parseFloat(s?t.borderLeftWidth:i.css(e,"borderLeftWidth"))||0,bottom:parseFloat(s?t.borderBottomWidth:i.css(e,"borderBottomWidth"))||0,right:parseFloat(s?t.borderRightWidth:i.css(e,"borderRightWidth"))||0};return{top:a.top,left:a.left,bottom:a.bottom,right:a.right,vertical:a.top+a.bottom,horizontal:a.left+a.right}},s=function(e,t){const n=i(window),s=e[0],a=r.test(s.nodeName);return{border:a?{top:0,left:0,bottom:0,right:0}:o(s,null),scroll:{top:(a?n:e).scrollTop(),left:(a?n:e).scrollLeft()},scrollbar:{right:a?0:e.innerWidth()-s.clientWidth,bottom:a?0:e.innerHeight()-s.clientHeight},rect:function(){const e=s.getBoundingClientRect(),n=2*(t+5),r=e.width>n?t:0,i=e.height>n?t:0;return{top:a?i:e.top+i,left:a?r:e.left+r,bottom:a?s.clientHeight-i:e.bottom-i,right:a?s.clientWidth-r:e.right-r}}()}};function a(e){if(e.scrollers.length<1)return this;const t=e.scrollers.slice();let n=i(t.pop());const o=e.$element,l=s(o,0),c=s(n,e.margin),d={top:l.rect.top-(c.rect.top+c.border.top),bottom:c.rect.bottom-c.border.bottom-c.scrollbar.bottom-l.rect.bottom,left:l.rect.left-(c.rect.left+c.border.left),right:c.rect.right-c.border.right-c.scrollbar.right-l.rect.right},u={};return e.direction.y&&(d.top<0?u.scrollTop=c.scroll.top+d.top:d.top>0&&d.bottom<0&&(u.scrollTop=c.scroll.top+Math.min(d.top,-d.bottom))),e.direction.x&&(d.left<0?u.scrollLeft=c.scroll.left+d.left:d.left>0&&d.right<0&&(u.scrollLeft=c.scroll.left+Math.min(d.left,-d.right))),i.isEmptyObject(u)?i.isFunction(e.complete)&&e.complete.call(n[0]):(r.test(n[0].nodeName)&&(n=i(n[0].ownerDocument).find("html,body")),n.animate(u,e.duration).eq(0).queue((function(r){t.length<1?i.isFunction(e.complete)&&e.complete.call(n[0]):a.call(this,Object.assign(Object.assign({},e),{scrollers:t})),r()}))),this}i.fn.extend({scrollintoview:function(r){const o=i.extend({},n,r),s=Object.assign({},o);s.direction="string"==typeof o.direction?e[o.direction.toLowerCase()]:o.direction;const l=s.direction.x?s.direction.y?"both":"horizontal":s.direction.y?"vertical":"";if(!l)return t.logger.warn("scrollintoview with no direction"),this;s.dirStr=l,s.margin&&!isNaN(s.margin)||(s.margin=0);const c=(s.$element=this.eq(0)).parents(":scrollable("+l+")").toArray().reverse();return c.length<1?this:a.call(this,Object.assign(Object.assign({},s),{scrollers:c}))}});const l={auto:!0,scroll:!0,visible:!1,hidden:!1};i.extend(i.expr[":"],{scrollable:function(t,n,i,o){const s=e[i&&"string"==typeof i[3]&&i[3].toLowerCase()]||e.both,a=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t,null):t.currentStyle,c={x:l[a.overflowX.toLowerCase()]||!1,y:l[a.overflowY.toLowerCase()]||!1,isRoot:r.test(t.nodeName)};if(!c.x&&!c.y&&!c.isRoot)return!1;const d={height:{scroll:t.scrollHeight,client:t.clientHeight},width:{scroll:t.scrollWidth,client:t.clientWidth},scrollableX:function(){return(c.x||c.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(c.y||c.isRoot)&&this.height.scroll>this.height.client}};return s.y&&d.scrollableY()||s.x&&d.scrollableX()}})}();const v=new class{constructor(){this.msie=!1,this.type="unknown",this.webkit=!1,this.chrome=!1,this.safari=!1,this.firefox=!1,this.webkitType=null;const e=navigator.userAgent.toLowerCase(),t=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}}(e);t.browser&&(this[t.browser]=!0,this.version=t.version||"0",this.type=t.browser),this.chrome?this.webkit=!0:this.webkit&&(this.safari=!0),this.webkit&&(this.type="webkit",this.webkitType="webkit"!==this.type?null:Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0?"safari":"chrome"),this.firefox=!0===/firefox/i.test(e),this.msie||(this.msie=Boolean(/trident/i.test(e)))&&(this.type="msie")}},y=new a("LoopIndex"),_={createLogger:(e,t)=>new a(e,t),logger:y,utils:new p,URLArguments:new class{constructor(){this._args=null,this._url=""}getArgument(e,t){return this._parseLocation(),this._args.hasOwnProperty(e)?decodeURIComponent(this._args[e]):t}getNumericArgument(e,t){var n=this.getArgument(e,""),r=parseInt(n,10);return isNaN(r)&&(r=t),r}getAllArguments(){this._parseLocation();var e,t={};for(e in this._args)this._args.hasOwnProperty(e)&&(t[e]=this._args[e]);return t}createSearchString(e){if(!e)return"";let t,n,r="";for(t in e)e.hasOwnProperty(t)&&(n=e[t],"function"!=typeof n&&(r.length&&(r+="&"),r+=t+"="+decodeURIComponent(n)));return r}parse(e,t){if(t=t||{},"string"!=typeof e||e.length<1)return{};const n=e.charAt(0);"?"!==n&&"#"!==n||(e=e.substring(1));var r,i,o,s,a=e.split("&"),l={true:!0,false:!1};for(r=a.length-1;r>=0;--r)(i=a[r])&&(o=i.indexOf("="))>0&&(s=decodeURIComponent(i.substring(o+1)),l.hasOwnProperty(s)&&(s=l[s]),t[i.substring(0,o)]=s);return t}_parseLocation(){var t=e.location;if(this._url!==t.href||!this._args){this._url=t.href;var n={};this.parse(t.search,n),this.parse(t.hash,n),this._args=n}return this._args}},mixinEvents:m.mixin};Object.keys(_).forEach(e=>{try{Object.defineProperty(t,e,{value:_[e],writable:!1,configurable:!0,enumerable:!1})}catch(t){y.error(`Error defining LOOPINDEX property ${e}: ${t}`)}}),Object.defineProperties(t,{browser:{get:function(){return t.$.extend(!0,{},v)},configurable:!0}})}(window,window.LOOPINDEX),Object.defineProperty(i,"__esModule",{value:!0}),function(e){if(!(null==e?void 0:e.utils))throw new Error("More utils: utils object not found");class t{constructor(e){this._scopes=[],this._options=Object.assign({},{timeout:100},e)}add(e,t){let n=this.findScope(e);n?n.state=this._options.update?this._options.update(n.state,t):t:n=this.addScope(e,t),n.timeout&&!this._options.continuous&&(clearTimeout(n.timeout),n.timeout=0),n.timeout=n.timeout||setTimeout(this.onTimeout.bind(this,n),this._options.timeout)}remove(e){const t=this.findScopeIndex(e);this._removeScopeAt(t)}removeAll(){for(let e=this._scopes.length;e>=0;--e)this._removeScopeAt(e);this._scopes.length=0}getStateFor(e){const t=this.findScope(e);return null==t?void 0:t.state}_removeScopeAt(e){if(!(e>=0&&e<this._scopes.length))return null;const t=this._scopes[e];return this._scopes.splice(e,1),(null==t?void 0:t.timeout)&&clearTimeout(t.timeout),t}onTimeout(t){const n=this.findScopeIndex(null==t?void 0:t.scope);if(n<0)return e.logger.warn("debounce timeout: can't find record");t=this._scopes[n],this._scopes.splice(n,1),this._options.callback(t.scope,t.state)}addScope(e,t){const n={scope:e,state:t,timeout:0};return this._scopes.push(n),n}findScope(e){const t=this.findScopeIndex(e);return t>=0?this._scopes[t]:null}findScopeIndex(e){for(let t=this._scopes.length-1;t>=0;--t)if(this._options.compare(this._scopes[t].scope,e))return t;return-1}}class n{constructor(){this._debouncers=new Map}createDebouncer(e,n){if(!e||this._debouncers.has(e))throw new Error("Bad or existing debouncer name "+e);let r=new t(n);return this._debouncers.set(e,r),r}getDebouncer(e){var t;return null!==(t=this._debouncers.get(e))&&void 0!==t?t:null}removeDebouncer(e){const t=this._debouncers.get(e);return!!t&&(this._debouncers.delete(e),t.removeAll(),!0)}dispose(){try{this._debouncers.forEach(e=>{e.removeAll()})}catch(t){e.logger.error("While disposing debouncer: "+t)}finally{this._debouncers.clear()}}}class r{constructor(){this._timeoutMap=new Map}dispose(){this.stopAll(),this.clear()}clear(){this._timeoutMap.clear()}setTimer(e,t,n){const r="temp-"+Date.now()*Math.random();return this.createTimer(r,{callback:e,timeoutMSecs:t,repeatCount:n,autoDispose:!0}).start()}createTimer(e,t){if(!e)throw new Error("setTimer requires a timer id");if(this._timeoutMap.has(e))throw new Error(`A timer with the name ${e} already exists`);if(!t.callback)throw new Error(`setTimer ${e}: callback required`);const n=this.upgradeOptions(t),r=new i(n,()=>{this._timeoutMap.delete(e)});return this._timeoutMap.set(e,r),r}startTimer(e){var t;const n=this._getTimer(e);return null!==(t=null==n?void 0:n.start())&&void 0!==t?t:null}stopAll(){this._timeoutMap.forEach((e,t)=>this.stopTimer(t))}stopTimer(e){const t=this._getTimer(e);return null==t||t.stop(),t}removeTimer(e){const t=this._getTimer(e);return null==t||t.dispose(),Boolean(t)}elapsed(e){const t=this._getTimer(e);return(null==t?void 0:t.elapsed)||0}_getTimer(t){var n;const r=this._timeoutMap.get(t);return r||e.logger.error("Missing timeout with id "+t),null!==(n=r)&&void 0!==n?n:null}upgradeOptions(t){return e.$.extend({},{repeatCount:1,timeoutMSecs:-1,maxTimeSecs:0,autoDispose:!0},t)}}r.FOREVER=999999999;class i{constructor(t,n){if(this.done=n,this._elapsed=0,this._callCount=0,this._startTime=0,this._stop=null,!t.callback)throw new Error("Timeout constructor: callback required");this._options=e.$.extend({},t),this._callback=()=>{this._elapsed=Date.now()-this._startTime,this._options.maxTimeSecs>0&&1e3*this._options.maxTimeSecs<this._elapsed&&this.stop(),this._options.callback(this);const e=this._options.repeatCount;this._options&&(e<=0||++this._callCount>=e)&&(this.stop(),this._options.autoDispose&&this.dispose())}}get data(){return this._options.data}get isRunning(){return Boolean(this._stop)}dispose(){if(this.stop(),Object.keys(this._options).forEach(e=>delete this._options[e]),this._callback=null,this.done){const e=this.done;this.done=null,e()}}start(){if(this.isRunning)return this;let e;this.reset();const t=this._options.repeatCount;return(isNaN(t)||"number"!=typeof t||t<0)&&(this._options.repeatCount=1),this._startTime=Date.now(),e=setInterval(this._callback,this._options.timeoutMSecs),this._stop=()=>clearInterval(e),this}reset(){return this._elapsed=0,this._callCount=0,this.isRunning&&(this.stop(),this.start()),this}stop(){if(this._stop){const e=this._stop;this._stop=null,e()}return this}update(e){const t=this._options;return e.repeatCount>0&&(t.repeatCount=e.repeatCount),e.timeoutMSecs>=0&&(t.timeoutMSecs=e.timeoutMSecs),e.maxTimeSecs>=0&&(t.maxTimeSecs=e.maxTimeSecs),void 0!==e.data&&(t.data=e.data),this}get elapsed(){return this._elapsed}get isRepeating(){return this._options.repeatCount>0}}class o{constructor(e){this._values=[e]}get value(){return this._values[this._values.length-1]}pushValue(e){const t=this._values.length;return this._values.push(e),e=>{const n=()=>(this._values.splice(t,1),this._values[this._values.length-1]);return e>=0?(setTimeout(n,e),this.value):n()}}}class s{constructor(){this._methods={},this.configure({})}configure(e){Object.entries(s._defaultMethods).forEach(([t,n])=>{"function"==typeof e[t]?this._methods[t]=e[t]:this._methods[t]=n})}alert(e){return this._methods.alert(e)}confirm(e){return this._methods.confirm(e)}prompt(e){return this._methods.prompt(e)}}s._defaultMethods={alert:e=>new Promise(t=>(window.alert(e.text),t())),confirm:e=>new Promise(t=>t(window.confirm(e.text))),prompt:e=>new Promise(t=>t(window.prompt(e.text,e.defaultValue)))};const a={createDebouncerManager:()=>new n,createTimeoutClient:()=>new r,createStateStack:e=>new o(e),alertManager:new s};Object.entries(a).forEach(([t,n])=>{e.utils.hasOwnProperty(t)||Object.defineProperty(e.utils,t,{value:n,writable:!1,enumerable:!1})})}(window.LOOPINDEX),Object.defineProperty(i,"__esModule",{value:!0}),function(e){if(e.utils.strings&&e.utils.compareVersions("1.8.16",e.utils.strings.VERSION)<1)return;const t={strings:new class{constructor(){this.VERSION="1.8.16"}validateEnum(t,n,r){if(null==t)return r;const i=`Invalid config value ${t}, allowed values: ${n}`;if("string"!=typeof t)return e.logger.warn(i),r;const o=t.trim().toLowerCase();for(let e of n)if(e.trim().toLowerCase()===o)return e;return e.logger.warn(i),r}getRealTextLength(t){if(!t)return 0;let n=t.length;for(;n&&e.utils.strings.isEmptyString(t[n-1]);)--n;return n}toMap(e,t,n){const r={};let i;const o=Boolean(t),s=Boolean(n);let a;for(let l=0,c=e&&e.length||0;l<c;++l)a=e[l],null!=a&&(i=s?a[n]:a,o?r[String(a[t])]=i:r[String(a)]=1);return r}toStringMap(e,t){const n={},r=t?"upper"===t?e=>e.toUpperCase():e=>e.toLowerCase():null;for(let t=0,i=e&&e.length||0;t<i;++t)n[String(r?r(e[t]):e[t])]=1;return n}toStringArray(t,n){if(!(null==t?void 0:t.length))return[];"string"==typeof n&&(n={transform:n});let r,i="upper"===(null==n?void 0:n.transform)?String.prototype.toUpperCase:"lower"===(null==n?void 0:n.transform)?String.prototype.toLowerCase:null;const o=!1!==(null==n?void 0:n.trim);if("string"==typeof t)r=t.split(",");else{if(!Array.isArray(t))return e.logger.warn("illegal format of string array"),[];r=t}if(r.forEach((e,t)=>{null==e&&(e=""),e=String(e),o&&(e=e.trim()),i&&(e=i.apply(e)),r[t]=e}),null==n?void 0:n.unique){const e=new Set(r);return Array.from(e.values())}return r}padString(e,t,n,r){let i;i=null==e?"":String(e);const o=(n=String(n)).length,s=[i];for(let e=i.length;e<t;e+=o)r?s.push(n):s.unshift(n);return s.join("")}padNumber(t,n){return e.utils.strings.padString(t,n,"0",!1)}randomString(e){(!e||isNaN(e)||e<1)&&(e=6);const t=String((1+Math.random())*Date.now());let n=btoa(t).replace(/[^a-z]/gi,"");for(;n.length<e;)n+=n;return n.length>e&&(n=n.substring(n.length-e)),n}htmlToText(t){if(!(null==t?void 0:t.length))return"";const n=t.replace(/<[^>]*>/g," ").replace(/[ \t]{2}/g," "),r=null===window||void 0===window?void 0:window.document;if(!r)return e.logger.warn("HTML Entity conversion is not implemented outside the browser"),n;this._htmlConvertElement||(this._htmlConvertElement=r.createElement("div"));try{return this._htmlConvertElement.innerHTML=n,this._htmlConvertElement.textContent}catch(r){return e.logger.warn(`Error converting HTML Entities in ${n} (original: ${t})`),n}}isEmptyString(e){let t,n=(null==e?void 0:e.length)||0;for(;n>0;)if(t=e[--n],t&&"â"!==t&&"\ufeff"!==t)return!1;return!0}getEffectiveStringLength(e){let t,n=e&&e.length||0,r=0;for(;n>0;)t=e.charCodeAt(--n),0!==t&&8203!==t&&65279!==t&&++r;return r}getEffectiveStringIndex(e,t){if(isNaN(t)||t<0)return 0;let n,r=e&&e.length||0;if(t>=r)return r;let i=0;for(let o=0;o<r;++o)if(n=e.charCodeAt(o),0!==n&&8203!==n&&65279!==n&&++i>t)return o;return r}}};Object.assign(e.utils,t)}(window.LOOPINDEX),Object.defineProperty(i,"__esModule",{value:!0}),function(e){if(e.utils.dom&&e.utils.compareVersions("1.8.16",e.utils.dom.VERSION)<1)return;if(!e.utils.strings)return e.logger.error("dom utils requires string utils");const t=e.$,n=function(){const e=function(...e){return 1};return e.acceptNode=function(...e){return 1},e}();class r{constructor(){this.VERSION="1.8.16",this._matchSelector=null}getNodeWindow(e){var t,n;return null!==(n=null===(t=null==e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView)&&void 0!==n?n:null}findEmptySVG(e,n){var r;return null!==(r=t(n).find(`svg[data-loopindex-id='${e}'][data-li-placeholder='true']`)[0])&&void 0!==r?r:null}getEmptySVG(t,n,r){t>=0||(e.logger.warn("getEmptySVG: Invalid width "+t),t=0),n>=0||(e.logger.warn("getEmptySVG: Invalid height "+n),n=0);const i=t/2,o=n/2;return`<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="${t}" height="${n}"\nviewBox="0 0 ${t} ${n}" xml:space="preserve" data-loopindex-id="${r}" data-li-placeholder="true">\n<g transform="matrix(1 0 0 1 ${i} ${o})" id="6ff8975c-0c66-4e85-b9c0-cb50ce01e9fb"  >\n<rect style="stroke: none; stroke-width: 1; fill: rgb(255,255,255); fill-rule: nonzero; opacity: 1; visibility: hidden;" \nx="-${i}" y="-${o}" rx="0" ry="0" width="${t}" height="${n}" />\n</g></svg>`}getNodeIframe(e){var t;const n=this.getNodeWindow(e);return null!==(t=null==n?void 0:n.frameElement)&&void 0!==t?t:null}isScrollable(e){if(1!==(null==e?void 0:e.nodeType))return!1;const t=e;return t.scrollHeight>t.clientHeight}findScrollParent(e){const t=null==e?void 0:e.parentNode;return t?this.isScrollable(t)?t:this.findScrollParent(t):null}getScrollParents(e){const t=this.findScrollParent(e);if(t)return[t,...this.getScrollParents(t)];const n=this.getNodeIframe(e);return n?this.getScrollParents(n):[]}saveScrollPosition(e){const t=(this.isScrollable(e)?[e]:[]).concat(this.getScrollParents(e)).map(e=>({el:e,scrollY:e.scrollTop}));return()=>{t.forEach(e=>{e.el.scrollTop=e.scrollY})}}getRangeAnchors(e){var t;const n=e.startContainer;let r=null,i=null,o=null,s=null;3===n.nodeType?(r=n,0===e.startOffset&&(o=r.previousSibling)):1===n.nodeType&&(r=n.childNodes[e.startOffset],o=null!==(t=n.childNodes[e.startOffset-1])&&void 0!==t?t:null);const a=e.endContainer;for(3===a.nodeType?(i=a,e.endOffset>=a.length&&(s=a.nextSibling)):1===a.nodeType&&(i=a.childNodes[e.endOffset],s=null==i?void 0:i.nextSibling);this.isEmptyTextNode(s);)s=s.nextSibling;for(;this.isEmptyTextNode(o);)o=o.previousSibling;return{first:r,last:i!==r?i:null,prev:o,next:s}}getIntersectingNodes(e,...t){if(!(null==e?void 0:e.commonAncestorContainer))return[];const n=[];for(let r=0;r<t.length;r++){const i=t[r];(null==i?void 0:i.nodeType)&&e.intersectsNode(i)&&n.push(i)}return n}elementToHtml({el:e,xml:n,withRoot:r,encode:i}){const o=null==e?void 0:e.nodeType;if(!o)return"";if(3===o)return i?i(e.data):e.data;if(1!==o)return String(e.nodeValue);const s=new Map;let a,l=0;function c(e,t){if(s.has(e))return s.get(e).sub;{const e="â¼ââ¦"+l++;return s.set(e,{enc:t,sub:e}),e}}if(i){const n=t(e).find("*").toArray();r&&n.push(e),n.forEach(e=>{var t;for(let n=(null===(t=e.attributes)||void 0===t?void 0:t.length)-1;n>=0;--n){const t=e.attributes.item(n),r=null==t?void 0:t.value;if(r){const e=i(r);e!==r&&(t.value=c(r,e))}}}),this.forAllTextChildren(e,e=>{const t=e.data,n=i(t);t!==n&&(e.data=c(t,n))})}if(n){const t=new XMLSerializer,n=e=>{let n=t.serializeToString(e);return 1!==e.nodeType||e.getAttribute("xmlns")||(n=n.replace(/\s*xmlns="[^"]+"/,"")),n};r&&(a=n(e));const i=[];for(let t=e.firstChild;t;t=t.nextSibling)3===t.nodeType?i.push(t.data):i.push(n(t));a=i.join("")}else a=r?e.outerHTML:e.innerHTML;return s.forEach(({sub:e,enc:t},n)=>{a=a.replace(new RegExp(e,"g"),t)}),a}attachCBToLink(t,n,r){if(!t||!n||"function"!=typeof r)return void e.logger.warn("attachCBToElement: bad input");const i=function(){t.removeEventListener("load",i),t.removeEventListener("error",o),r({url:n})};function o(e){t.removeEventListener("load",i),t.removeEventListener("error",o),r({url:n,error:String(e)||"error"})}"function"==typeof t.addEventListener?(t.addEventListener("load",i),t.addEventListener("error",o)):(t.onload=function(){i()},t.onerror=function(e){o(e)})}getElementOwnStyle(e,t){var n;const r=this.toElement(e),i=null===(n=null==r?void 0:r.style)||void 0===n?void 0:n[t];return null==i?null:i}getElementOwnIntStyle(e,t){const n=this.getElementOwnStyle(e,t);return null===n?NaN:parseInt(n)}getElementOwnFloatStyle(e,t){const n=this.getElementOwnStyle(e,t);return null===n?NaN:parseFloat(n)}static myNormalizeNode(e){if(!e||1!==e.nodeType)return;let t=e.firstChild;for(;t;){if(1===t.nodeType)r.myNormalizeNode(t);else if(3==t.nodeType){let n;for(;(n=t.nextSibling)&&3==n.nodeType;){const r=n.nodeValue;r&&(t.nodeValue=t.nodeValue+r),e.removeChild(n)}}t=t.nextSibling}}getPositioningParent(e){let t,n=this.toJQuery(e),r=n;for(;(n=n.parent()).length&&n[0].ownerDocument&&(r=n,t=r.css("position"),"relative"!==t&&"absolute"!==t&&"fixed"!==t););return r}addScriptToDocument(t,n){n=n||window.document;const r=e.utils.strings.toStringArray(t),i={ok:!0,failed:[],loaded:[]};return new Promise(o=>{const s=r=>{if(!(null==r?void 0:r.length))return o(i);const a=r[0];try{if(r=r.slice(1),!a)return e.logger.warn("null script found in addScriptToDocument input"),s(r);const t=n.createElement("script");t.setAttribute("type","text/javascript"),this.attachCBToLink(t,a,t=>{t.error?(i.ok=!1,i.failed.push({url:a,error:t.error}),e.logger.error(`Error loading script ${a}: ${t.error}`)):i.loaded.push(a),s(r)}),t.setAttribute("src",a),document.head.appendChild(t)}catch(n){e.logger.error(`Exception While loading script ${t}\n${n}`),i.ok=!1,i.failed.push({url:a,error:String(n)}),o(i)}};s(r)}).then(e=>e)}get NodeIteratorUniversalFunction(){return n}isContentEditable(e,t,n){let r;for(let n=e&&e.parentNode;n&&n!==t;n=n.parentNode)if(1===n.nodeType&&(r=n.getAttribute("contenteditable"),r)){if(r=r.toLowerCase(),"true"===r)return!0;if("false"===r)return!1}return n}createTreeWalker(t,r,i){const o=t&&t.ownerDocument;if(!o)return null;let s=i?function(){const e=e=>i(e);return e.acceptNode=()=>1,e}():e.browser.msie?n:null;return o.createTreeWalker(t,r,s,!1)}createNodeIterator(t,r,i){const o=t&&t.ownerDocument;if(!o)return null;let s=i?function(){const e=e=>i(e);return e["]acceptNode"]=()=>1,e}():e.browser.msie?n:null;return o.createNodeIterator(t,r,s,!1)}getNodeIndex(e){if(!e)return-1;let t=0;for(;e=e.previousSibling;)++t;return t}insertNodeAt(e,t,n){return!(!e||!t||1!==t.nodeType||n<0)&&(t.insertBefore(e,t.childNodes[n]),!0)}normalizeNode(e){return e?"function"==typeof e.normalize?(e.normalize(),e):(r.myNormalizeNode(e),e):null}isEmptyTextNode(t){if(3!==(null==t?void 0:t.nodeType))return!1;const n=t;return 0===n.length||e.utils.strings.isEmptyString(n.nodeValue)}getNodeLength(e){const t=e&&e.nodeType;return 1===t?e.childNodes.length:3===t?e.length:0}getNodeTextContent(e){return t(e).text()}isOnlyChild(e){const t=e&&e.parentNode;return Boolean(t&&t.firstChild===e&&t.lastChild===e)}insertAfter(e,t,n){return e?(n=n||t&&t.parentNode,t&&t.parentNode!==n&&(t=null),n?t?n.insertBefore(e,t.nextSibling):n.insertBefore(e,n.firstChild):void 0):null}contents(e){return t.makeArray(t(e).contents())}extractContent(e){for(var t,n=document.createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}toElement(e){return e&&"object"==typeof e?e[0]&&"string"==typeof e.jquery?e[0]:1===e.nodeType?e:null:null}toNode(e){return e&&"object"==typeof e?e[0]&&"string"==typeof e.jquery?e[0]:1===e.nodeType||3===e.nodeType?e:null:null}toJQuery(t,n=!1){if(!t)return e.$("");let r=t;if(!(r instanceof e.$))try{r=e.$(t)}catch(t){return e.$("")}return!n&&r.length>1&&(r=r.eq(0)),r}getRealTextLength(t){return t&&t.data?e.utils.strings.getRealTextLength(t.data):0}isDescendantOf(t,n){if(!n||!t)return!1;const r="string"==typeof n&&n;if(!r){const e=n;if(9===e.nodeType)n=n.body;else if(1!==e.nodeType)return!1}try{for(;t&&t.parentNode;){if(r){if(e.utils.dom.matchesSelector(t.parentNode,r))return!0}else if(t.parentNode===n)return!0;t=t.parentNode}}catch(e){}return!1}clearNodeBackgroundImage(e){e&&e.style&&e.style["background-image"]&&(e.style["background-image"]=null)}getElementPageOffset(e,t){if(!e||!e.getBoundingClientRect)return{top:0,left:0};const n=e.getBoundingClientRect(),r=e.ownerDocument,i=r.defaultView,o=r.body,s=r.documentElement,a=i.pageYOffset||s.scrollTop||i.scrollY||o.scrollTop||0,l=i.pageXOffset||s.scrollLeft||i.scrollX||o.scrollLeft||0,c=s.clientTop||o.clientTop||0,d=s.clientLeft||o.clientLeft||0,u=n.top+a-c,h=n.left+l-d,g={top:Math.round(u),left:Math.round(h)};return t&&(g.top+=o.scrollTop||0,g.left+=o.scrollLeft||0),g}compareNodePosition(e,t){if(e===t)return 0;var n=e.compareDocumentPosition(t);return 4&n||8&n?-1:1}forAllTextChildren(e,t){if(e&&t&&1===e.nodeType)for(let n=e.firstChild,r=n&&n.nextSibling;n;n=r,r=n&&n.nextSibling)1===n.nodeType?this.forAllTextChildren(n,t):3===n.nodeType&&t(n)}getFirstNodeInRange(t){const n=t&&t.startContainer;if(!n)return null;if(3===n.nodeType)return n;var r=this.getNthChild(n,t.startOffset);if(r)return r;const i=e.utils.dom.createNodeIterator(n,NodeFilter.SHOW_TEXT||NodeFilter.SHOW_ELEMENT);return null==i?void 0:i.nextNode()}getLastNodeInRange(t){const n=t&&t.endContainer;if(!n)return null;if(3===n.nodeType)return n;var r=this.getNthChild(n,t.endOffset-1);if(r)return r;const i=e.utils.dom.createNodeIterator(n,NodeFilter.SHOW_TEXT||NodeFilter.SHOW_ELEMENT);return null==i?void 0:i.previousNode()}hasTextSelection(e){if(!e||e.collapsed)return!1;if(3===e.startContainer.nodeType&&e.startOffset<e.startContainer.length)return!0;if(3===e.endContainer.nodeType&&e.endOffset<e.endContainer.length)return!0;let t=!1;return this.walkRange(e,(e,n)=>!(3===e.nodeType&&e.length>0)||(t=!0,!1)),t}getNthChild(e,t){if(!e||1!==e.nodeType)return null;for(let n=e.firstChild;n&&t>=0;n=n.nextSibling,--t)if(0===t)return n;return null}getSelectedTextNodes(e){if(!e||e.collapsed)return[];const t=[];return this.walkRange(e,(e,n)=>{if(3===e.nodeType){const r=this.processTextNode(e,n);r&&t.push(r)}return!0}),t}extractTextNode(e){if(!e||!e.node)return null;if(!e.partial)return e.node;let t=e.node;return e.end<t.length&&t.splitText(e.end),e.start>0&&(t=t.splitText(e.start)),t}extractInlineNode(t){let n=null==t?void 0:t.node;if(3!==(null==n?void 0:n.nodeType))return e.logger.warn("extractInlinecontent: null or not text node"),null;if(!t.partial)return n;const i=(t=>{for(;t.parentNode&&r.INLINE_RE.test(e.$(t.parentNode).css("display"));)t=t.parentNode;return t})(n);if(i===n)return this.extractTextNode(t);let o=i;if(t.end<n.length){o=this.splitNode(o,n,t.end);let e=o.lastChild;for(;e&&1===e.nodeType;)e=e.lastChild;n=3===(null==e?void 0:e.nodeType)?e:null}return t.start>0&&n&&this.splitNode(o,n,t.start),o}splitNode(t,n,r){if(0===r&&(n===t||n===t.firstChild))return t;if(r>=e.utils.dom.getNodeLength(n)&&(n===t||n===t.lastChild))return t;const i=t.parentNode,o=e.utils.dom.getNodeIndex(t),s=n.ownerDocument.createRange();s.setStart(i,o),s.setEnd(n,r);const a=s.extractContents();return i.insertBefore(a,t),t.previousSibling||t}walkRange(t,n){if(!t||t.collapsed)return;let r;const i=this.getFirstNodeInRange(t),o=this.getLastNodeInRange(t);if(!i||!o)return;let s=!1,a=!1;const l=e.utils.dom.createNodeIterator(t.commonAncestorContainer,NodeFilter.SHOW_ALL);if(l)for(;(r=l.nextNode())&&(!a||e.utils.dom.isDescendantOf(r,o));){if(!s){if(r!=i)continue;s=!0}if(!n(r,t))return;r===o&&(a=!0)}}processTextNode(e,t){let n;if(!e||3!==e.nodeType||!(n=e.length))return null;const r={node:e,start:0,end:n,partial:!1};if(e===t.startContainer&&t.startOffset>0){if(t.startOffset>=n)return null;r.partial=!0,r.start=t.startOffset}return e===t.endContainer&&t.endOffset<n&&(r.partial=!0,r.end=t.endOffset),r}hasClass(e,t){if(!e||1!==e.nodeType)return!1;const n=e,r=n.classList||n.className&&n.className.split(/\s/);if(r&&r.length)for(let e=r.length-1;e>=0;--e)if(r[e]===t)return!0;return!1}wrapElement(n,r){if(!n)return{$element:t()};if("string"==typeof n)try{return{$element:t(r.createElement("div")).html(n),isString:!0}}catch(r){return e.logger.error(`wrapElement ${n}: ${r}`),{$element:t()}}return{$element:e.utils.dom.toJQuery(n)}}getScrollParent(e){const n=t(e.node),r=n.css("position"),i="absolute"===r,o=e.hidden?/(auto|scroll|hidden)/:/(auto|scroll)/,s=n.parents().filter((function(){const e=t(this);return(!i||"static"!==e.css("position"))&&o.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))})).eq(0);return"fixed"!==r&&s.length?s[0]:n[0].ownerDocument||document}matchesSelector(e,n){if(!e||1!==e.nodeType||!n)return!1;if(!this._matchSelector){const n=e;let r;r="function"==typeof n.matches?(e,t)=>e.matches(t):"function"==typeof n.msMatchesSelector?(e,t)=>e.msMatchesSelector(t):"function"==typeof n.webkitMatchesSelector?(e,t)=>e.webkitMatchesSelector(t):(e,n)=>t(e).is(n),this._matchSelector=r}return this._matchSelector(e,n)}}r.INLINE_RE=/inline/i;const i={dom:new r};Object.assign(e.utils,i)}(window.LOOPINDEX),Object.defineProperty(i,"__esModule",{value:!0}),function(e){const t=e.$;if(e.utils.pluginUtils&&e.utils.compareVersions("1.8.16",e.utils.pluginUtils.VERSION)<1)return;class n{constructor(e,n){try{const r=t(e),i=r.filter("svg");let o;if(o=i.length?i.first():r.find("svg").first(),!(null==o?void 0:o.length))throw new Error("Failed to find svg element");["fill"].forEach(e=>{o.find("path").each((t,n)=>{const r=n.getAttribute(e);r&&(n.style.fill=r)})}),n&&o.attr(n),this._html=o[0].outerHTML}catch(t){throw new Error(`Error creating svg from ${e}: ${t}`)}}get html(){return this._html}get svg(){return t(this._html)[0]}setAttributes({selector:e,attrs:n,className:r}){if(!this._html)return this;const i=t(this._html),o=e?i.find(e):i;return n&&o.attr(n),r&&o.addClass(r),this._html=i[0].outerHTML,this}}class r{constructor(){this._cache=new Map}async loadIcon(e,t){const r=this._cache.get(e);let i=null;return i=r?new n(r):await this._loadIcon(e),i?t?i.setAttributes({attrs:{"data-loopindex-id":t}}):i:null}getByPath(e,t){var r;const i=e&&null!==(r=this._cache.get(e))&&void 0!==r?r:null;if(i){const e=new n(i);return t?e.setAttributes({attrs:{"data-loopindex-id":t}}):e}return null}async _loadIcon(t){try{const e=await fetch(t);if(e.ok){const r=await e.text(),i=new n(r,{"data-li-path":t.replace(/.+icons\//,"")});return this._cache.set(t,i.html),i}}catch(n){e.logger.error(`Error loading icon from ${t}: ${n}`)}return null}}class i{constructor(){this._nativeHandlers=new Map,this._pluginHandlers=new Map}dispose(){this.removeAll(),this._pluginHandlers.clear(),this._nativeHandlers.clear()}removeAll(){return[this._nativeHandlers,this._pluginHandlers].forEach((e,t)=>{Array.from(e.keys()).forEach(t=>{this._removeBinding(t,e)})}),this}addNativeBinding(t){const{el:n,event:r,callback:i,capture:o=!1}=t,s=this._nativeHandlers;s.has(r)||s.set(r,[]);return s.get(r).push({isSet:!1,_set:()=>{n.addEventListener(r,i,o)},_unset:()=>n.removeEventListener(r,i,o),binding:Object.assign({},t),active:e.utils.createStateStack(!1)}),this.activateNativeBinding(r,t.scope),this}addPluginBinding(t){const{event:n,set:r}=t;if(!n||!r||!t.unset)throw new Error("addBinding requires event, set, unset");const i=this._pluginHandlers;i.has(n)||i.set(n,[]);return i.get(n).push({isSet:!1,_set:r,binding:Object.assign({},t),active:e.utils.createStateStack(!1)}),this.activatePluginBinding(n,t.scope),this}activateNativeBinding(e,t){return this._activateBinding(e,this._nativeHandlers,!0,t)}activatePluginBinding(e,t){return this._activateBinding(e,this._pluginHandlers,!0,t)}deactivatePluginBinding(e,t){return this._deactivateBinding(e,this._pluginHandlers,!0,t)}deactivateNativeBinding(e,t){return this._deactivateBinding(e,this._nativeHandlers,!0,t)}removePluginBinding(e){return this._removeBinding(e,this._pluginHandlers),this}removeNativeBinding(e){return this._removeBinding(e,this._nativeHandlers),this}_removeBinding(t,n,r){if(!(null==n?void 0:n.has(t)))return void e.logger.warn(`EventManager remove binding: no binding found for ${t}}`);const i=n.get(t);this._deactivateBinding(t,n,!1,r),r?e.utils.array.remove(i,{test:e=>e.binding.scope===r}):i.length=0,0===i.length&&n.delete(t)}_deactivateBinding(t,n,r,i){if(!(null==n?void 0:n.has(t)))return e.logger.warn("activate non existent binding for event "+t),e.utils.yes;const o=n.get(t),s=i?o.filter(e=>e.binding.scope===i):o,a=[];return s.forEach(o=>{var s;if(r){const e=o.active.pushValue(!1);a.push(()=>{e(),o.active.value&&this._activateBinding(t,n,!1,i)})}try{o.isSet&&(null===(s=o._unset)||void 0===s||s.call(o),o.isSet=!1)}catch(n){e.logger.error(`Error activating event binding for ${t}}`)}}),this._makeRestoreFunction(a)}_activateBinding(t,n,r,i){if(!(null==n?void 0:n.has(t)))throw new Error("activate non existent binding for event "+t);const o=n.get(t),s=i?o.filter(e=>e.binding.scope===i):o,a=[];return s.forEach(o=>{if(r){const e=o.active.pushValue(!0);a.push(()=>{e(),o.active.value||this._deactivateBinding(t,n,!1,i)})}if(!o.isSet)try{const e=o._set();o.isSet=!0,"function"==typeof o.binding.unset&&(o._unset=()=>{o.binding.unset(e)})}catch(n){e.logger.error("Error activating event binding for "+t)}}),this._makeRestoreFunction(a)}_makeRestoreFunction(t){let n=!1;return r=>{if(n)throw new Error("Restore function called more than once");n=!0;const i=()=>{try{t.forEach(e=>e())}catch(t){e.logger.error("while restoring event state: "+t)}};r>=0?setTimeout(i,r):i()}}}const o={pluginUtils:new class{constructor(){this.VERSION="1.8.16",this._svgCache=new r}isDarkMode(e=window.top){var t;return Boolean(null===(t=null==e?void 0:e.matchMedia)||void 0===t?void 0:t.call(e,"(prefers-color-scheme: dark)").matches)}disableTracking(e){return e.fireEditorEvent("disable-tracking"),()=>{e.fireEditorEvent("enable-tracking")}}get svgCache(){return this._svgCache}getPluginAssetPath(t){const n=(t.config("assetPath")||"").trim();return n?e.utils.isAbsoluteUrl(n)?n:e.utils.joinPath(t.path,n):t.path}async loadPluginPageStyles(t){const n=t.config("pageUrls");if(!(null==n?void 0:n.length))return Promise.resolve(!0);const r=n.map(e=>t.resolvePath(e));return!!t.getEditorUIContainer()&&new Promise(t=>{new e.utils.CSSLoader(document).loadCSS(r,e=>{t(e.ok)})}).then(e=>e).catch(e=>!1)}logEditorEvents(t,n,r,i){let o=n&&void 0!==i?{log:i,editor:n,exclude:r,plugin:t}:t;const s=o.editor,a=o.method||"fire",l=o.plugin;if(r=e.utils.strings.toStringArray(o.exclude),!s||!l)return e.logger.warn("logEditorEvents: missing params");if(!s[a])return e.logger.warn("logEditorEvents: editor doesn't include method "+a);if(Boolean(o.log)!==Boolean(l.savedEditorFireMethod))if(o.log){l.savedEditorFireMethod=s[a];const t=r.length?new RegExp(r.join("|"),"i"):/mouse|key|selection|click|focus|undo|redo|snapshot|resolvename/i,n=function(e){return!e||t.test(e)};s[a]=(...t)=>{var r;return n(t[0])||e.logger.debug("Editor event "+t[0]),null===(r=l.savedEditorFireMethod)||void 0===r?void 0:r.apply(s,t)}}else s[a]=l.savedEditorFireMethod,l.savedEditorFireMethod=null}upgradeConfigCommands(t,n){let r,i=!1;if(!n)return t.slice();if("string"==typeof n)r=e.utils.strings.toStringArray(n),i=!0;else{if(!Array.isArray(n))throw new Error("illegal value for commands type "+typeof n);r=n,i=n.every(e=>"string"==typeof e)}const o=r.reduce((e,t)=>("string"==typeof t?e.set(t,{toolbar:!0}):t.command&&e.set(t.command,t),e),new Map);return t.map(e=>{const t=o.get(e.command);return t?Object.assign(Object.assign({},e),t):Object.assign(Object.assign({},e),{toolbar:!i&&e.toolbar})})}initLoopindexPlugin(t){this.addPluginProperty(t,{key:"_debounceManager",value:e.utils.createDebouncerManager()}),this.addPluginProperty(t,{key:"$",value:e.$}),this.addPluginProperty(t,{key:"_timeoutClient",value:e.utils.createTimeoutClient()}),this.addPluginProperty(t,{key:"eventManager",value:new i});const n=e.utils.createStateStack(!1);this.addPluginProperty(t,{key:"_isSelecting",value:function(){return n.value}}),this.addPluginProperty(t,{key:"_pushSelecting",value:function(e){return n.pushValue(e)}}),this.addPluginProperty(t,{key:"onSelectionChanged",value:function(){this._isSelecting()||this._timeoutClient.startTimer("selection-changed")}}),this.addPluginProperty(t,{key:"addDictionary",value:function(e,t){this.localizer.addDictionary(e,t),this.onLocaleChanged()}}),this.addPluginProperty(t,{key:"config",value:function(t,n){const r=()=>e.$.extend(!0,{},this._config);if(!t)return r();const i=this._config;return void 0===n?i[t]:(i[t]=n,r())}}),t._timeoutClient.createTimer("selection-changed",{autoDispose:!1,callback:()=>{t._isSelecting()||t._onSelectionChanged()},timeoutMSecs:40});const r=this.getPluginAssetPath(t);return this.addPluginProperty(t,{key:"resolvePath",value:function(...t){return((t,...n)=>{const r=e.utils.isAbsoluteUrl(n[0])?Array.from(n):[t].concat(n);return e.utils.joinPath(...r)})(r,...t)}}),t}stringToLoopindexSVG(n){try{const e=t(n).filter("svg").first();if(e.length)return e.addClass("loopindex-button"),e.find("path").addClass("loopindex-svg-icon"),e[0]}catch(t){e.logger.error("Error parsing svg: "+t)}return null}isSelectionInDocument(e){const t=e.getBody(),n=t&&e.getSelectedRange();if(!n)return!1;const r=n.commonAncestorContainer;return t===r||t.contains(r)}addPluginProperty(e,t){const n=/^_/.test(String(t.key));return Object.defineProperty(e,t.key,{value:t.value,writable:!0===t.writable,configurable:!1,enumerable:!n}),e}addPluginProperties(e,t){for(const n in t)this.addPluginProperty(e,{key:n,value:t[n],writable:!1});return e}}};Object.assign(e.utils,o)}(window.LOOPINDEX),Object.defineProperty(i,"__esModule",{value:!0}),function(e){const t=new Set(["TEXTAREA","INPUT","OL","UL","TABLE","TR","IMG","SCRIPT","LINK","svg","BR"]),n=/\[\[([^\]]+)\]\]/g,r=e=>{if(!e)return[""];if(!n.test(e))return[e];const t=new RegExp(n),r=[];let i=0;for(;;){const n=t.exec(e);if(!n){i<e.length-1&&r.push(e.substring(i));break}n.index>i&&r.push(e.substring(i,n.index)),r.push(n[1]),i=t.lastIndex}return r};class i{constructor(e,t){this.owner=e,this.domain=t.domain,this._locale=t.locale,this._localizer=e.getLocalizer(this.domain,this._locale)}get locale(){return this._locale}addDictionary(e,t){this.owner.loadLocales(this.domain,{[e]:t})}loadLocale(e){return this.owner.loadLocale(this.domain,e).then(t=>(t||(this._locale=e,this._localizer=this.owner.getLocalizer(this.domain,e)),t))}localizeString(e){return this._localizer(e)}localizeUI(r){const o=e.utils.dom.toJQuery(r);if(!(null==o?void 0:o.length))return o;const s=(e,...t)=>this._localizer(t[0]),a=(e,t)=>{const r="data-li-"+t,i="text"===t,o=e.getAttribute(r),a=o||(i?e.textContent:e.getAttribute(t));if(!a)return;if(!n.test(a))return void(a||(i?e.textContent=o:e.setAttribute(t,String(o))));let l=a;do{l=l.replace(n,s)}while(n.test(l));e.setAttribute(r,a),i?e.textContent=l:e.setAttribute(t,l)};return o.each((e,n)=>{a(n,"title"),a(n,"placeholder"),(e=>{if(1!==(null==e?void 0:e.nodeType))return!1;if(t.has(e.nodeName))return!1;let n=!1;for(let t=e.firstChild;t;t=t.nextSibling){if(3!==t.nodeType)return!1;n=!0}return n})(n)?a(n,"text"):o.children().each((e,t)=>{1!==t.nodeType||i.FINAL_TAGS.has(t.nodeName)||this.localizeUI(t)})}),o}}i.FINAL_TAGS=new Set(["svg","path","IMG","BR"]);const o=e=>e.trim().toLowerCase().replace(/_+/g,"-"),s=t=>{const n=new Map;return t?(Object.entries(t).forEach(([t,r])=>{const i=o(t);e.utils.strings.toStringArray(r).forEach(e=>n.set(o(e),i))}),n):n};class a{constructor(e){const t=this._dictionaries=new Map;e.locales.forEach(e=>t.set(e,{status:"none",dictionary:new Map})),this.assetPath=e.assetPath,this.defaultLocale=e.defaultLocale,this._localeMapping=s(e.localeMapping)}setLocaleMapping(e){const t=s(e);this._localeMapping.clear(),t.forEach((e,t)=>{this._localeMapping.set(t,e)})}mapLocale(e){var t;return null!==(t=this._localeMapping.get(e))&&void 0!==t?t:e}isLoading(e){var t;return"loading"===(null===(t=this._dictionaries.get(e))||void 0===t?void 0:t.status)}isLoaded(e){var t;return"loaded"===(null===(t=this._dictionaries.get(e))||void 0===t?void 0:t.status)}getStatus(e){return this._dictionaries.get(e).status}setStatus(e,t){const n=this._dictionaries.get(e);this._dictionaries.set(e,{status:t,dictionary:n.dictionary})}setLoading(e){const t=this._dictionaries.get(e);this._dictionaries.set(e,{dictionary:t.dictionary,status:"loading"})}hasLocale(e){return this._dictionaries.has(e)}hasDictionary(e){var t;return"loaded"===(null===(t=this._dictionaries.get(e))||void 0===t?void 0:t.status)}getDictionary(e){const t=this._dictionaries.get(e);return(null==t?void 0:t.dictionary)||null}load(e,t,n){if(!t||"object"!=typeof t)return;const r=(e,t,n)=>{if(!t||"object"!=typeof t)return;const i=e?e+".":"";Object.keys(t).forEach(e=>{const o=t[e],s=typeof o;"string"===s||"number"===s||"boolean"===s?n.set(`${i}${e}`,String(o)):r(`${i}${e}`,o,n)})},i=this._dictionaries.get(e),o=i.dictionary;r("",t,o),this._dictionaries.set(e,{status:n?"loaded":i.status,dictionary:o})}}const l={LocaleServer:new class{constructor(){this._domainMap=new Map}hasDomain(e){return this._domainMap.has(e)}defineDomain({domain:t,locales:n,assetPath:r,defaultLocale:i,localeMapping:s}){if(this._domainMap.has(t))return e.logger.warn(`Localizer: client ${t} already defined`),this;if(!i||"string"!=typeof i)throw new Error("Localizer createClient: illegal default language "+i);let l=o(i);if(0===(n=e.utils.strings.toStringArray(n,{unique:!0,transform:"lower"})).length)throw new Error("Localizer createClient: no locales provided");if(n.indexOf(l)<0)if(n.indexOf(l.substring(0,2))>=0)l=l.substring(0,2);else{if(!(n.indexOf("en")>=0))throw new Error(`Localizer createClient: default language ${i} not found in ${n}`);e.logger.warn(`Setting default locale to English, locale ${i} not found`),l="en"}const c=new a({assetPath:r,locales:n,defaultLocale:l,localeMapping:s});return this._domainMap.set(t,c),this}setDomainLocaleMapping(e,t){const n=this._domainMap.get(e);if(!n)throw new Error("setDomainLocaleMapping: unknown domain "+e);n.setLocaleMapping(t)}loadLocales(t,n){if(!n||"object"!=typeof n)return e.logger.error("Load dictionary: null or invalid dictionaries object"),this;if(Array.isArray(n))return e.logger.error("Load dictionary: dictionaries can't be an array"),this;const r=this._domainMap.get(t);return r?(Object.entries(n).forEach(([t,n])=>{const i=this._validateLocale(r,t,!1);if(!i)return e.logger.warn("load locales: skipping unknown locale "+t);r.load(i,n,!1)}),this):(e.logger.error("Unknown domain "+t),this)}loadLocale(t,n){const r=this._domainMap.get(t);return r?(n=this._validateLocale(r,n),r.isLoaded(n)?Promise.resolve(""):r.isLoading(n)?this._waitFor(r,n):new Promise(i=>{r.setLoading(n);const o=e.utils.joinPath(r.assetPath,n+".json");fetch(o,{method:"GET"}).then(e=>e.json()).then(e=>e&&"object"==typeof e?(r.load(n,e,!0),i("")):i(`Invalid data in domain ${t} locale ${n}`)).catch(e=>{r.setStatus(n,"error"),i(String(e))})}).then(e=>e)):Promise.resolve(`Cannot load locale ${n} in unknown domain ${t}`)}createClient(e,t){const n=this._domainMap.get(e);if(!n)throw new Error("Unknown localization client "+e);return new i(this,{domain:e,locale:t||n.defaultLocale})}getLocalizer(e,t){const n=e=>r(e).join("");if(!e||!t)return n;const i=this._domainMap.get(e);if(!i)return n;t=this._validateLocale(i,t);const o=i.getDictionary(t);return o?e=>r(e).map(e=>{let n=o.get(e);if(n)return n;if(t!==i.defaultLocale){const t=i.getDictionary(i.defaultLocale);n=null==t?void 0:t.get(e)}return n||e}).join(""):n}_waitFor(e,t){return new Promise(n=>{let r,i=0;const o=e=>(clearInterval(r),n(e||""));r=setInterval(()=>e.isLoading(t)?++i>50?o("timed out"):void 0:o(),100)})}_validateLocale(e,t,n=!0){return t?(t=e.mapLocale(o(t)),e.hasLocale(t)||t.length>2&&(t=t.substring(0,2),e.hasLocale(t))?t:n?e.defaultLocale:""):e.defaultLocale}}};Object.entries(l).forEach(([t,n])=>{e.utils.hasOwnProperty(t)||Object.defineProperty(e.utils,t,{value:n,writable:!1,enumerable:!1})})}(window.LOOPINDEX),Object.defineProperty(i,"__esModule",{value:!0}),function(e){const t=new RegExp("s*quicktip-position-[a-z]+","g"),n={color:{daffodil:{r:255,g:230,b:23},daisy:{r:250,g:211,b:28},mustard:{r:253,g:183,b:23},"citrus zest":{r:250,g:170,b:33},pumpkin:{r:241,g:117,b:63},tangerine:{r:237,g:87,b:36},salmon:{r:240,g:70,b:57},persimmon:{r:234,g:40,b:48},rouge:{r:188,g:35,b:38},scarlet:{r:140,g:12,b:3},"hot pink":{r:229,g:24,b:93},princess:{r:243,g:132,b:174},petal:{r:250,g:198,b:210},lilac:{r:178,g:150,b:199},lavender:{r:123,g:103,b:174},violet:{r:95,g:53,b:119},cloud:{r:195,g:222,b:241},dream:{r:85,g:190,b:237},gulf:{r:49,g:168,b:224},turquoise:{r:35,g:138,b:204},sky:{r:13,g:96,b:174},indigo:{r:20,g:59,b:134},navy:{r:0,g:27,b:74},"sea foam":{r:125,g:205,b:194},teal:{r:0,g:168,b:168},peacock:{r:18,g:149,b:159},ceadon:{r:193,g:209,b:138},olive:{r:121,g:145,b:85},bamboo:{r:128,g:188,b:66},grass:{r:74,g:160,b:63},kelly:{r:22,g:136,b:74},forrest:{r:0,g:63,b:46},chocolate:{r:56,g:30,b:17},"terra cotta":{r:192,g:92,b:32},camel:{r:191,g:155,b:107},linen:{r:233,g:212,b:167},stone:{r:231,g:230,b:225},smoke:{r:207,g:208,b:210},steel:{r:138,g:139,b:143},slate:{r:119,g:133,b:144},charcoal:{r:71,g:77,b:77},black:{r:5,g:6,b:8},white:{r:255,g:255,b:255},"metalic silver":{r:152,g:162,b:171},"metalic gold":{r:159,g:135,b:89},"metalic copper":{r:140,g:102,b:65}},stickTo:{bottom:"bottom",left:"left",right:"right",top:"top"}},r={animateDuration:300,animateFunction:"fadein",delay:500,disableAnimation:!1,hideDelay:300,persistent:!1,stickTo:n.stickTo.bottom,stickDistance:10,unique:!1,useTitle:!1,canShow:void 0,dismissEvents:["keydown","mousedown"]};class i{static setElementPositionClass(e,n){var r;return e.className=(null!==(r=e.className)&&void 0!==r?r:"").replace(t,""),e.classList.add("quicktip-position-"+n),e}static getElementsBySelector(t,n){if(!t)return[];try{return Array.prototype.slice.call((n||document).querySelectorAll(t))}catch(t){return e.logger.warn("get Elements By Selector error: "+t),[]}}static destroyObject(e){if(e)if(Array.isArray(e))e.length=0;else{Object.keys(e).forEach(t=>{try{e[t]=void 0}catch(e){}})}}static attachAnimationCallback({el:t,callback:n,duration:r}){let i=0;const o=()=>{t.removeEventListener("transitionend",o),t.removeEventListener("webkitTransitionEnd",o),i&&(clearTimeout(i),i=0),n(t)};t.addEventListener("transitionend",o),t.addEventListener("webkitTransitionEnd",o),r=Number(r)||300,i=setTimeout(()=>{e.logger.log("Animation timeout fired after "+r),o()},r)}static px(e){return(e||0).toFixed(0)+"px"}static px0(e){return i.px(Math.max(0,e||0))}static toArray(e,t=0){return Array.from(e).slice(t)}static isChildOf(e,t){if(!e||!t)return!1;let n;for(;n=null==e?void 0:e.parentNode;){if(n===t)return!0;e=n}return!1}static findOptionsTargets(e){var t;const n=1===(null===(t=e.target)||void 0===t?void 0:t.nodeType)?[e.target]:[];if(e.targetSelector){i.getElementsBySelector(e.targetSelector,e.root).forEach(e=>{n.includes(e)||n.push(e)})}return n}static argsToObj(e){var t=i.toArray(e).map(e=>typeof e),n={};if("object"===t[0])n=e[0];else if("string"===t[0]){const t=e[0].split(" ");for(var r in t)n[t[r]]=e[1]}else"function"===t[0]&&(n={"":e[0]});return n}static gainAnchorElements(e){return{box:e.querySelector(".quicktips-box"),more:e.querySelector(".quicktips-more"),moreText:e.querySelector(".quicktips-more .quicktips-text"),text:e.querySelector(":not(.quicktips-more) .quicktips-text")}}static extractOptionAttribute(e,t,n){for(var r=e.getAttribute(t),i=e;!r&&(i=i.parentNode)&&i.getAttribute;)r=i.getAttribute(t);return r||String(n)}static extractBooleanAttribute(t,n,r){const o=i.extractOptionAttribute(t,n,String(r));return!!/^(true|yes|on|1)$/i.test(o)||!/^(false|no|off|0)$/i.test(o)&&(e.logger.error(`Illegal value ${o} for attribute ${n}`),r)}static extractNumberAttribute(e,t,n){const r=i.extractOptionAttribute(e,t,String(n)),o=parseFloat(r);return isNaN(o)?n:o}}class o{static getNodeWindow(e){var t,n;return null!==(n=null===(t=null==e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView)&&void 0!==n?n:null}static getNodeIframe(e){var t;const n=o.getNodeWindow(e);return null!==(t=null==n?void 0:n.frameElement)&&void 0!==t?t:null}static getNodeFrames(e,t=!1){const n=[];let r=e;for(;r;){const e=o.getNodeIframe(r);(e||t)&&n.push(o.getNodeWindow(r)),r=e}return n}static canAttach(e){var t;const n=null!==(t=this.MY_FRAMES)&&void 0!==t?t:this.MY_FRAMES=o.getNodeFrames(window.document.head);if(!n.length)return!0;return o.getNodeFrames(e).includes(n[n.length-1])}static getGlobalRect(e,t){let n=e.getBoundingClientRect();t=null!=t?t:o.getNodeFrames(e);for(const e of t){const t=e.frameElement.getBoundingClientRect();n=new DOMRect(n.x+t.x,n.y+t.y,n.width,n.height)}return n}static getRelativeRect(t,n){let r=t.getBoundingClientRect();const i=o.getNodeFrames(t),s=o.getNodeFrames(n);if(!i.length)return s.length&&e.logger.error("Can't attach tooltip in super frame"),r;if(!s.length)return this.getGlobalRect(t,i);const a=s[0];for(const e of i){if(e===a)break;const t=e.frameElement.getBoundingClientRect();r=new DOMRect(r.x+t.x,r.y+t.y,r.width,r.height)}return r}static attachGlobalObservers(e,t){return(Array.isArray(e)?e:[e]).reduce((e,t)=>(o.getNodeFrames(t,!0).forEach(t=>{e.includes(t)||e.push(t)}),e),[]).forEach(e=>{o.AttachedWindows.has(e)||(o.AttachedWindows.set(e,[]),o._attachToWindow(e));const n=o.AttachedWindows.get(e);n.includes(t)||n.push(t)}),()=>{o.AttachedWindows.forEach(e=>{let n=0;for(;(n=e.indexOf(t))>=0;)e.splice(n,1)})}}static _attachToWindow(e){let t=0;const n=n=>{t||(t=setTimeout(()=>{t=0;const r=o.AttachedWindows.get(e);(null==r?void 0:r.length)&&r.forEach(e=>e(n))},50))};for(const t of["resize","scroll","keydown"])e.addEventListener(t,()=>n(t),!1)}}o.AttachedWindows=new Map;class s{constructor(e,t){this.eventCallbacks={},this.modelObservers={},this._elements=[],this._anchors=null,this.notifyTimeoutID={},this.publ=e,this.model={},this._instantiate=()=>{if(!this._elements.length){const e=document.createElement("div");e.innerHTML=t,this._elements.push(...i.toArray(e.children)),this._anchors=i.gainAnchorElements(e)}}}on(...e){const t=i.argsToObj(e);for(const e in t){const n=t[e];if("function"!=typeof n)throw new Error(`Tooltip component: On ${e} received invalid callback`);this.eventCallbacks[e]=this.eventCallbacks[e]||[],this.eventCallbacks[e].push(n)}}get anchors(){return this._instantiate(),this._anchors}dispatch(e,...t){setTimeout(()=>{for(let n in this.eventCallbacks[e])this.eventCallbacks[e][n].apply(this.publ,t)})}get element(){return this._instantiate(),this._elements[0]}unmount(){this._elements.forEach(e=>{var t;null===(t=e.parentNode)||void 0===t||t.removeChild(e)})}destroy(){this.unmount(),i.destroyObject(this.eventCallbacks),i.destroyObject(this._anchors),i.destroyObject(this._elements)}onModelUpdate(...e){const t=i.argsToObj(e),n=this.model;for(let e in t)n[e]=n[e]||null,this.modelObservers[e]=this.modelObservers[e]||[],this.modelObservers[e].push(t[e]),this.notifyObservers(e)}mount(e){e=e||document.body,this._instantiate();try{this._elements.forEach(t=>{t.parentNode!==e&&e.appendChild(t)})}catch(e){throw"Could not mount tooltip component: "+String(e)}}set(e){const t=this.model;Object.entries(e).forEach(([e,n])=>{("function"==typeof n||void 0!==n&&t[e]!==n)&&(t[e]=n,this.notifyObservers(e))})}notifyObservers(t){clearTimeout(this.notifyTimeoutID[t]),this.notifyTimeoutID[t]=setTimeout(()=>{const n=this.model;for(let r in this.modelObservers[t])try{this.modelObservers[t][r](n[t])}catch(t){e.logger.warn("tooltips notification error "+t)}if(this.modelObservers[""])for(let e in this.modelObservers[""])this.modelObservers[""][e]()})}}class a{constructor(){var e;this._isShown=!1,this._eventCallbacks=new Map([["destroy",[]],["hide",[]],["show",[]]]);const t=this.component=new s(this,'\n<div class="quicktips-tooltip" style="box-sizing:border-box;position:fixed;z-index:2147483647">\n  <div class="quicktips-box">\n    <div class="quicktips-text"></div>\n    <div class="quicktips-more" style="overflow:hidden;">\n      <div class="quicktips-text"></div>\n    </div>\n  </div>\n</div>');this.resetTooltipPosition(),(this._cachedTitle=null===(e=this.target)||void 0===e?void 0:e.getAttribute("title"))&&this.target.removeAttribute("title"),this.addEventCallback({event:"show",cb:()=>this.refresh()}),this.useTitle()?t.onModelUpdate({contentText:e=>{this._updateTitleAttr(e)}}):t.onModelUpdate({color:function(e){if(n.color[e]){const t=n.color[e];e="rgb("+t.r+", "+t.g+", "+t.b+")"}t.anchors.box.style.backgroundColor=e},contentText:e=>{this._updateTitleContent({component:t,contentText:e})},contentMore:e=>{this._updateTitleContent({component:t,contentMore:e})},stickTo:function(e){i.setElementPositionClass(t.element,e)}})}refresh(){if(!this.isShown)return;const e=this.model;this.useTitle()?this._updateTitleAttr(e.contentText):this._updateTitleContent({component:this.component,contentText:e.contentText,contentMore:e.contentMore})}get target(){var e,t;return null!==(t=null===(e=this.model)||void 0===e?void 0:e.target)&&void 0!==t?t:null}addEventCallback(e){const t=e.cb;if(t){const n=this._eventCallbacks.get(e.event);n.find(e=>e.cb===t)||n.push(e)}return this}set(e){this.component.set(e)}useTitle(){var e;return Boolean(null===(e=this.model)||void 0===e?void 0:e.useTitle)}get isShown(){return this._isShown}get model(){return this.component.model}get element(){return this.component.element}unmount(){this._onHide(),this.resetTooltipPosition(),this._isShown=!1,this.component.unmount()}destroy(){var e;this._cachedTitle&&(null===(e=this.target)||void 0===e||e.setAttribute("title",this._cachedTitle),this._cachedTitle=""),this._onHide(),this._onDestroy(),this.component.destroy()}on(...e){return this.component.on(...e)}showMore(){this.show().then(e=>{if(!e)return;const t=this.component.element,n=this.component.anchors.more,r=this.model;if(r.contentMore&&(n.style.display="block",n.style.visibility="visible"),"block"!==n.style.display&&r.contentMore){n.style.display="block",this.animateElementClass(t),this.moveTooltip();const e=n.getBoundingClientRect().height;n.style.visibility="visible",n.style.height="0",this.animateElementClass(n,t=>{t.style.height=e>0?i.px(e):"auto"})}})}async show(){if(this._isShown)return!0;const t=this.model;if(t.canShow&&!t.canShow())return!1;const n=this.component.model.target;return!(!(null==n?void 0:n.parentNode)||!n.ownerDocument)&&(this.useTitle()?(this._updateTitleAttr(this.toText(t.contentText)),!1):(this.model.unique&&c.hideTooltipsInDocument(n.ownerDocument),this._isShown=!0,new Promise(e=>{this.component.mount();const t=this.component.element;"visible"!==t.style.visibility&&(t.style.visibility="visible",setTimeout(()=>{e(this._show())}))}).then(e=>e).catch(t=>(e.logger.error("Show tooltip error "+t),!1))))}moveTooltip(){const t=this.component.element,r=this.component.model;if(!this.component.model.target||"visible"!==t.style.visibility)return;t.style.width="auto";const s=t.getBoundingClientRect(),a=parseInt(r.maxWidth);a&&(t.style.width=s.width>a?i.px(a):"auto");const l=o.getRelativeRect(r.target,t),c=t.getBoundingClientRect();switch(r.stickTo){case n.stickTo.bottom:t.style.left=i.px0(l.left+(l.width-c.width)/2),t.style.top=i.px0(l.top+l.height+r.stickDistance);break;case n.stickTo.left:t.style.left=i.px0(l.left-c.width-r.stickDistance),t.style.top=i.px0(l.top+(l.height-c.height)/2);break;case n.stickTo.right:t.style.left=i.px0(l.left+l.width+r.stickDistance),t.style.top=i.px0(l.top+(l.height-c.height)/2);break;case n.stickTo.top:t.style.left=i.px0(l.left+(l.width-c.width)/2),t.style.top=i.px0(l.top-c.height-r.stickDistance);break;default:e.logger.error("Unkonwn tooltip position "+r.stickTo)}}async hide(){if(!this._isShown)return;this._isShown=!1;const e=this.model,t=this.component.anchors.box;return this._onHide(),new Promise(n=>{this.applyAnimationClass(t,e.animateFunction+"-to",e.animateFunction+"-from",()=>{this._isShown||this.resetTooltipPosition(),n()})}).then(()=>{}).catch(e=>{})}_updateTitleAttr(e){const t=this.target,n=this._cachedTitle?`${this._cachedTitle} (${this.toText(e)})`:this.toText(e);t.setAttribute("title",n)}_updateTitleContent(e){const{text:t,moreText:n}=e.component.anchors;t&&e.contentText&&(t.innerHTML=this.toText(e.contentText)),e.contentMore&&n&&(n.innerHTML=this.toText(e.contentMore))}toText(e,t=!1){return"function"==typeof e?e(this,t):String(e)}_show(){if(!this._isShown)return!1;this.addEventCallback({event:"hide",cb:o.attachGlobalObservers([this.element,this.target],e=>{"resize"!==e&&"scroll"!==e||this.moveTooltip()}),once:!0}),this.moveTooltip();const e=this.model,t=e.dismissEvents||[],n=()=>{this.hide()},r=this.target.ownerDocument.body;return t.forEach(e=>r.addEventListener(e,n,!0)),this.addEventCallback({event:"hide",cb:()=>{var e;const r=null===(e=this.target)||void 0===e?void 0:e.ownerDocument.body;t.forEach(e=>null==r?void 0:r.removeEventListener(e,n,!0))},once:!0}),this.applyAnimationClass(this.component.anchors.box,e.animateFunction+"-from",e.animateFunction+"-to"),this._runEventCallbacks("show"),!0}resetTooltipPosition(){if(this.useTitle())return;const e=this.component.element,t=this.component.anchors.more;e&&t&&("collapse"!==e.style.visibility&&(e.style.visibility="collapse"),e.style.left="-9999px",e.style.top="-9999px","none"!==t.style.display&&(t.style.display="none",t.style.visibility="collapse",t.style.height="auto"))}_onDestroy(){this._runEventCallbacks("destroy"),this._eventCallbacks.clear()}_runEventCallbacks(e){const t=this._eventCallbacks.get(e);let n=!1;t.forEach(e=>{try{e.cb(this)}catch(e){}n=n||Boolean(e.once)}),n&&this._eventCallbacks.set(e,t.filter(e=>!e.once))}_onHide(){this._runEventCallbacks("hide")}applyAnimationClass(e,t,n,r){const o=this.component.model;o.disableAnimation?r&&r():(e.classList.add(t),e.getBoundingClientRect(),e.classList.add("animating"),e.classList.remove(t),e.classList.add(n),i.attachAnimationCallback({el:e,callback:()=>{e.classList.remove("animating"),e.classList.remove(n),r&&r()},duration:o.animateDuration}),setTimeout((function(){e.classList.remove("animating"),e.classList.remove(n),r&&r()}),o.animateDuration))}animateElementClass(e,t){const n=this.component.model;n.disableAnimation?t&&t(e):(e.getBoundingClientRect(),i.attachAnimationCallback({el:e,callback:()=>{e.classList.remove("animating"),t&&t(e)},duration:n.animateDuration}),e.classList.add("animating"))}}class l{constructor(){this.allTooltips=[]}findTooltipByTarget(e){var t;return null!==(t=this.allTooltips.find(t=>t.model.target===e))&&void 0!==t?t:null}createTooltip(e){const t=e.target;if(1!==(null==t?void 0:t.nodeType))throw new Error("Can't create tooltip for null or non element target");const n=this.findTooltipByTarget(t);if(n)return n.component.set(e),n;const r=new a;let i,o;function s(e){const t=e.target;t===i&&(i=null),t===o&&(o=null)}function l(){t!==i&&r.element!==i&&(r.model.persistent?r.hide().then((function(){r.unmount()})):r.unmount())}function c(){i=null,t!==o&&(r.model.persistent?setTimeout(l,r.model.hideDelay):l())}this.allTooltips.push(r),r.addEventCallback({event:"destroy",cb:e=>{s(e);const t=this.allTooltips.indexOf(e);t>=0&&this.allTooltips.splice(t,1)}}).addEventCallback({event:"hide",cb:s}),r.component.set(Object.assign(Object.assign({},e),{target:t}));const d={mouseenter:function(){this!==i&&this!==o&&(i=this,setTimeout(()=>{this===i&&r.show()},r.useTitle()?1:r.model.delay))},mouseleave:c,focus:function(){r.useTitle()||!/INPUT|TEXTAREA/.test(this.tagName)&&"true"!==this.getAttribute("contenteditable")||(o=this,r.showMore())},blur:function(){o===this&&(o=null),i!==r.element&&r.unmount()}};Object.entries(d).forEach(([e,n])=>{t.addEventListener(e,n)});const u={mouseenter:function(){i=this},mouseleave:c},h=r.element;return Object.entries(u).forEach(([e,t])=>{h.addEventListener(e,t)}),r.addEventCallback({event:"destroy",cb:e=>{var t;const n=e.element,r=null===(t=e.model)||void 0===t?void 0:t.target;n&&Object.entries(u).forEach(([e,t])=>{n.removeEventListener(e,t)}),r&&Object.entries(d).forEach(([e,t])=>{r.removeEventListener(e,t)})}}),r}createUserTooltips(t){t.forEach(t=>{const n=t.target?[t.target]:i.getElementsBySelector(t.targetSelector,t.root);if(0===n.length)return e.logger.warn("create tooltips: no targets found");const s=Object.assign({},r,t);n.forEach(t=>{if(!o.canAttach(t))return e.logger.error("Can't create tooltip in a sibling/parent iframe");s.target=t,this.createTooltip(s)})})}forAllTips(e,t){(t?this.allTooltips.filter(t):this.allTooltips).forEach(t=>e(t))}forAllVisibleTips(e,t){this.allTooltips.filter(e=>Boolean(e.isShown)).filter(null!=t?t:()=>!0).forEach(t=>e(t))}init(e){const t=Array.isArray(e)?e:[e];this.createUserTooltips(t)}refresh(e){this.forAllTips(e=>e.refresh(),t=>{var n,r,i;return(null===(i=null===(r=null===(n=t.component)||void 0===n?void 0:n.model)||void 0===r?void 0:r.target)||void 0===i?void 0:i.ownerDocument)===e})}getTooltipByTarget(e){return e?this.findTooltipByTarget(e):null}destroyTooltipsInDocument(e){this.forAllTips(e=>e.destroy(),t=>{var n,r,i;return(null===(i=null===(r=null===(n=t.component)||void 0===n?void 0:n.model)||void 0===r?void 0:r.target)||void 0===i?void 0:i.ownerDocument)===e})}destroyTooltipsInElement(e){this.forAllTips(e=>e.destroy(),t=>{var n,r;return i.isChildOf(null===(r=null===(n=t.component)||void 0===n?void 0:n.model)||void 0===r?void 0:r.target,e)})}hideTooltipsInDocument(e){this.forAllVisibleTips(e=>e.hide(),t=>{var n,r,i;return(null===(i=null===(r=null===(n=t.component)||void 0===n?void 0:n.model)||void 0===r?void 0:r.target)||void 0===i?void 0:i.ownerDocument)===e})}hideTooltipsInElement(e){this.forAllVisibleTips(e=>e.hide(),t=>{var n,r;return i.isChildOf(null===(r=null===(n=t.component)||void 0===n?void 0:n.model)||void 0===r?void 0:r.target,e)})}hideElementTooltip(t){const n=e.Tooltips.getTooltipByTarget(t);null==n||n.hide()}destroyElementTooltip(t){const n=e.Tooltips.getTooltipByTarget(t);null==n||n.destroy()}}let c=null;e.Tooltips||(c=new l,Object.defineProperty(e,"Tooltips",{writable:!1,configurable:!1,enumerable:!1,value:c}))}(window.LOOPINDEX),Object.defineProperty(i,"__esModule",{value:!0}),function(e){const t=e.$;const n={ckeditor:new class{setButtonTitle({editor:n,titles:r}){const i=null==n?void 0:n.container;if(!(null==i?void 0:i.$))return e.logger.warn("Missing editor top container");const o=t(i.$);Object.keys(r).forEach(e=>{const t=e.replace(".","_"),i=n.ui.get(e),s=null==i?void 0:i._.id,a=[".cke_button__"+t];s&&a.push("#"+s);const l=a.join(",");o.find(l).each((t,n)=>{n.setAttribute("title",r[e]);const i=n.getAttribute("aria-labelledby");i&&o.find("#"+i).text(r[e])})})}saveUndo(e,t){t?e.undoManager.update():e.undoManager.save(!0,null,!1)}getEditorUIContainer(e){var t,n,r;return null!==(r=null===(n=null===(t=null==e?void 0:e.element)||void 0===t?void 0:t.getWindow())||void 0===n?void 0:n.$)&&void 0!==r?r:null}setCommandsState({editor:t,commands:n,enabled:r,active:i=!1}){let o;n=e.utils.strings.toStringArray(n);const s=!0===i?CKEDITOR.TRISTATE_ON:r?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED;for(let e=n.length-1;e>=0;--e)o=t.getCommand(n[e]),o&&o.setState(s)}updateToolbarSetting(e,t,n){const r=null==e?void 0:e.config;if(!r||!(null==t?void 0:t.length))return;const i="string"==typeof r.toolbar?"toolbar_"+r.toolbar:"toolbar",o=r[i];if(!Array.isArray(o))return;const s=new RegExp(`^${n}$`,"i"),a=t.filter(e=>!1!==e.toolbar).map(e=>e.command);let l=!1;const c=e=>{var t;if(!e)return e;if("string"==typeof e)return s.test(e)?(l=!0,a):[e];if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const r=e[n],i=Array.isArray(r),o=c(r);!i&&Array.isArray(o)?t.push(...o):t.push(o)}return t}const n=e;return"object"==typeof n&&s.test(n.name)&&!(null===(t=n.items)||void 0===t?void 0:t.length)?(l=!0,[Object.assign(Object.assign({},e),{items:a})]):[n]},d=c(o);l&&(r[i]=d)}getSelectedRange(t,n){var r,i;const o=null===(r=null==t?void 0:t.getSelection())||void 0===r?void 0:r.getNative();let s=(null==o?void 0:o.rangeCount)>0&&o.getRangeAt(0);if(s)return s;const a=t.editable(),l=null==t?void 0:t.getSelection();if(!a||!l)return null;a.isInline()||n||l.isFake||l.reset();const c=l.getRanges(),d=null==c?void 0:c[0];if(!d)return null;try{const e=null===(i=a.$)||void 0===i?void 0:i.ownerDocument,t=c[c.length-1];return s=e.createRange(),s.setStart(d.startContainer.$,d.startOffset),s.setEnd(t.endContainer.$,t.endOffset),1===c.length&&d.collapsed&&s.collapse(),s}catch(t){return e.logger.debug("Error getting ckeditor selected range",t),null}}setSelectedRange(t,n){const r=t.getSelection(),i=e=>1===e.nodeType?new CKEDITOR.dom.element(e):3===e.nodeType&&new CKEDITOR.dom.text(e);try{const e=new CKEDITOR.dom.range(t.document),o=i(n.startContainer);o&&e.setStart(o,n.startOffset);const s=o&&i(n.endContainer);if(s&&e.setEnd(s,n.endOffset),o&&s)return r.selectRanges([e]),!0}catch(t){e.logger.error("setSelectedRange: "+t)}return!1}}};Object.assign(e,n)}(window.LOOPINDEX),Object.defineProperty(i,"__esModule",{value:!0}),function(e){const t=e.$;class n{constructor(t,n){this.editor=t,this._svgUpdates=new Set,this._commands=new Map,this._timeoutClient=e.utils.createTimeoutClient(),this._timeoutClient.createTimer("update-svg",{autoDispose:!1,timeoutMSecs:100,callback:()=>{this._updateAllSVG()}}),n>=50?(this._disableButton=(e,t)=>{e.setEnabled?e.setEnabled(!t):e.setDisabled(t)},this._activateButton=(e,t)=>{e&&e.setActive&&e.setActive(t)}):(this._disableButton=(e,t)=>{e.disabled(t)},this._activateButton=(e,t)=>{e&&e.active&&e.active(t)})}updateSVG(e){this._svgUpdates.add(e),this._timeoutClient.startTimer("update-svg")}setCommandSVG(n){var r;this._getUIButtonRecord(n.command,{svgData:{iconName:n.iconName,svg:n.svg}});const i=this.editor.getContainer();t(null===(r=null==i?void 0:i.ownerDocument)||void 0===r?void 0:r.body).find(".tox-toolbar__group").each((r,i)=>{const o=e.utils.dom.findEmptySVG(n.iconName,i);o&&t(o).replaceWith(n.svg.svg)})}setCommandsState(e,t){"string"==typeof e&&(e=[e]);for(let n=e.length-1;n>=0;--n){const r=this._getUIButtonRecord(e[n],t);let i=r.button;i&&(this._disableButton(i,!r.enabled),"boolean"==typeof r.active&&this._activateButton(i,r.active))}}getCommandState(e){return this._getUIButtonRecord(e)}dispose(){this._commands.clear(),this._timeoutClient.dispose()}_updateAllSVG(){const e=Array.from(this._svgUpdates.values());this._svgUpdates.clear(),e.forEach(e=>{const t=this._getUIButtonRecord(e);(null==t?void 0:t.svgData)&&this.setCommandSVG(Object.assign({command:t.command},t.svgData))})}_getUIButtonRecord(e,t){var n,r;let i=this._commands.get(e);if(i&&!t)return i;i=null!=i?i:{active:void 0,button:null,command:e,enabled:!1};const o={button:null!==(n=null==t?void 0:t.button)&&void 0!==n?n:i.button,enabled:"boolean"==typeof(null==t?void 0:t.enabled)?t.enabled:i.enabled,active:"boolean"==typeof(null==t?void 0:t.active)?t.active:i.active,svgData:null!==(r=null==t?void 0:t.svgData)&&void 0!==r?r:i.svgData};return Object.assign(i,o),this._commands.set(e,i),i}}new RegExp("â¼ââ¦","g");const r=/\.svg(\?|$)/i;const i={tinymce:new class{getHTMLStringEncoder(t){const n=e.tinymce.getEditorSetting(t,"entity_encoding")||"named",r=window.tinymce.html.Entities.getEncodeFunc(n);return null!=r?r:null}setSelectedRange(e,t){var n;const r=null==e?void 0:e.selection,i=null===(n=e.getDoc())||void 0===n?void 0:n.createRange();return!(!r||!i)&&(i.setStart(t.startContainer,t.startOffset),i.setEnd(t.endContainer,t.endOffset),r.setRng(i),!0)}getSelectedRange(e){var t,n;return(null===(n=null===(t=null==e?void 0:e.selection)||void 0===t?void 0:t.getRng)||void 0===n?void 0:n.call(t,!0))||null}getEditorSetting(e,t){var n;return"function"==typeof(null===(n=e.options)||void 0===n?void 0:n.get)?e.options.get(t):e.settings?e.settings[t]:"function"==typeof e.getParam?e.getParam(t):null}setEditorSetting(t,n,r){var i;try{if("function"==typeof(null===(i=t.options)||void 0===i?void 0:i.set))return void t.options.set(n,r);if(t.settings)return void(t.settings[n]=r);e.logger.warn(`can't set editor setting ${n} to ${r}`)}catch(t){e.logger.error(`set editor setting ${n} to ${r}: ${t}`)}}saveUndo(e,t){const n=e.undoManager;null==n||n.add()}getEditorUIContainer(e){var t,n;const r=null==e?void 0:e.getContainer();return null!==(n=null===(t=null==r?void 0:r.ownerDocument)||void 0===t?void 0:t.defaultView)&&void 0!==n?n:null}applyToolbarConfiguration(t,n,r){if(!n||!(null==r?void 0:r.length))return;const i=r.filter(e=>!1!==e.toolbar).map(e=>e.command),o=new RegExp(`\\b${n}([\\s|]|$)`,"i");function s(n){const r=e.tinymce.getEditorSetting(t,n);return!!r&&(Array.isArray(r)?r.forEach((e,t)=>{if(!e)return;const n=typeof e;"string"===n&&o.test(e)?r[t]=e.replace(o,i.join(" ")):"object"===n&&o.test(e.name)&&(!e.items||Array.isArray(e.items)&&!e.items.length)&&(e.items=i.slice())}):"string"==typeof r&&o.test(r)&&e.tinymce.setEditorSetting(t,n,r.replace(o,i.join(" "))),!0)}s("toolbar");for(let e=1;e<10;++e)s("toolbar"+e)}createButtonHandler(e,t){return new n(e,t)}addCommandAndButton(e){return e.editorVersion>=50?this.addButton5(e):this.addButton4(e)}loadToolbarIcons({editorVersion:t,editor:n,commands:i,handler:o}){if(t<50)return Promise.resolve(!1);const s=(i=i.filter(e=>e.iconName&&!e.svg&&r.test(e.iconUrl))).map(async t=>{const r=await e.utils.pluginUtils.svgCache.loadIcon(t.iconUrl,t.iconName);return r?(this._redefineIcon(n,t.iconName,r),o.setCommandSVG({iconName:t.iconName,command:t.command,svg:r}),!0):(e.logger.error("Failed to load icon from "+t.iconUrl),!1)});return Promise.all(s).then(t=>{const n=!t.includes(!1);return e.logger.debug("Loaded icons, success: "+n),n}).catch(t=>(e.logger.error("Error loading icons "+t),!1))}addButton4({editor:t,command:n,handler:r}){if(t.addCommand(n.command,n.callback,this),!1===n.toolbar)return;if(!n.iconUrl)return e.logger.warn(`Can't add button ${n.command}, no icon url`);const i={tooltip:n.title,image:n.iconUrl,cmd:n.command,onPostRender:e=>{r.setCommandsState(n.command,{button:e.control})}};t.addButton(n.name||n.command,i)}addButton5({editor:t,command:n,handler:i}){const o=t;if(o.addCommand(n.command,n.callback,this),!1===n.toolbar)return;const s=e.utils.pluginUtils.svgCache.getByPath(n.iconUrl);if(s)this._redefineIcon(t,n.iconName,s);else if(n.svg)o.ui.registry.addIcon(n.iconName,n.svg);else{if(!n.iconUrl)return e.logger.warn("Missing svg AND iconUrl for command "+n.command);if(!r.test(n.iconUrl))return e.logger.warn(`Tinymce supports only svg icons, ${n.iconUrl} can't be displayed. command ${n.command} will not be added to the toolbar`);o.ui.registry.addIcon(n.iconName,e.utils.dom.getEmptySVG(24,24,n.iconName))}const a={tooltip:n.title,disabled:!1,icon:n.iconName,onAction:()=>{o.execCommand(n.command)},onSetup:e=>{i.setCommandsState(n.command,{button:e}),i.updateSVG(n.command)}};o.ui.registry.addToggleButton(n.command,a)}_redefineIcon(e,t,n){n.setAttributes({className:"loopindex-button"}).setAttributes({selector:"path",className:"loopindex-svg-icon"}),e.ui.registry.addIcon(t,n.html)}}};Object.assign(e,i)}(window.LOOPINDEX),Object.defineProperty(i,"__esModule",{value:!0}),function(e){const t=e.$;class n{constructor(e){this.editor=e,this._commands=new Map,this._refresh=new Map,this._refreshTimeout=0}setCommandsState(t,n,r=!0){for(let r=(t=e.utils.strings.toStringArray(t)).length-1;r>=0;--r)this._scheduleRefresh(t[r],n)}async loadCommandSVG(t,n){if(!/.svg$/i.test(n))return!1;const r=await e.utils.pluginUtils.svgCache.loadIcon(n);return!!r&&(this._setCommandSVG(t,r),!0)}getCommandState(e){return this._getUIButtonRecord(e)}dispose(){this._commands.clear(),this._refresh.clear(),this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=0)}_setCommandSVG(e,t){const n=this._getUIButtonRecord(e);n.button?this._setButtonSVG(n.button,t):this._scheduleRefresh(e,{svg:t})}_setButtonSVG(e,n){n.setAttributes({className:"loopindex-button"}).setAttributes({selector:"path",className:"loopindex-svg-icon"});const r=e.find("svg");if(r.length){const e=n.svg,i=r[0];i.className&&t(e).addClass(i.className),["focusable"].forEach(t=>{const n=i.getAttribute(t);n&&e.setAttribute(t,n)}),r.replaceWith(e)}else e.empty(),e.append(n.svg)}_getUIButtonRecord(e,t){var n;let r=this._commands.get(e);return r&&!t||(r=null!=r?r:{active:void 0,button:null,command:e,enabled:!1,title:""},Object.assign(r,{button:null!==(n=null==t?void 0:t.button)&&void 0!==n?n:r.button,enabled:"boolean"==typeof(null==t?void 0:t.enabled)?t.enabled:r.enabled,active:"boolean"==typeof(null==t?void 0:t.active)?t.active:r.active,title:(null==t?void 0:t.title)||r.title,svg:(null==t?void 0:t.svg)||r.svg}),this._commands.set(e,r)),Object.assign({},r)}_highlightButton(e,t){void 0!==t&&e.toggleClass("flite-froala-button-highlight",t).toggleClass("fr-active",t)}_setButtonTitle(e,t){e.attr({"aria-label":t,title:t})}_enableButton(e,t){e.toggleClass("fr-disabled",!t),t||this._highlightButton(e,!1)}_scheduleRefresh(e,t){if(!t)return;const n=this._refresh.get(e);n?(Object.entries(t).forEach(([e,t])=>{(t||!1===t)&&(n[e]=t)}),this._refresh.set(e,n)):this._refresh.set(e,t),this._refreshTimeout||setTimeout(()=>{this._refreshTimeout=0,this._refreshAll()},10)}_refreshAll(){if(0!==this._refresh.size)try{this._refresh.forEach((e,t)=>{this._rendereAndUpdateButton(t,e)})}catch(t){e.logger.error("While refreshing tinymce buttons: "+t)}finally{this._refresh.clear()}}_rendereAndUpdateButton(e,t){var n;t=null!=t?t:{};const r=this._getUIButtonRecord(e),i=null!==(n=t.button)&&void 0!==n?n:r.button;if(!i)return void this._getUIButtonRecord(e,t);if(Boolean(t.button&&t.button!==r.button)){const n=this._getUIButtonRecord(e,t);return this._enableButton(i,n.enabled),this._highlightButton(i,n.active),this._setButtonTitle(i,n.title),void(n.svg&&this._setButtonSVG(i,n.svg))}"boolean"==typeof t.enabled&&r.enabled!==t.enabled&&this._enableButton(i,t.enabled),"boolean"==typeof t.active&&r.active!==t.active&&this._highlightButton(i,t.active),t.title&&t.title!==r.title&&this._setButtonTitle(i,t.title),this._getUIButtonRecord(e,t)}}const r={froala:new class{createButtonHandler(e){return new n(e)}getSelectedRange(e){var t,n;const r=null===(t=null==e?void 0:e.selection)||void 0===t?void 0:t.ranges;return null!==(n=null==r?void 0:r(0))&&void 0!==n?n:null}setSelectedRange(e,t){var n,r;const i=e.selection.get(),o=null===(r=null===(n=e.el)||void 0===n?void 0:n.ownerDocument)||void 0===r?void 0:r.createRange();return!!o&&(o.setStart(t.startContainer,t.startOffset),o.setEnd(t.endContainer,t.endOffset),i.addRange(o),e.selection.save(),e.selection.restore(),!0)}getEditorUIContainer(e){var t,n,r,i,o;const s=(null===(t=null==e?void 0:e.$tb)||void 0===t?void 0:t.length)?e.$tb:(null===(n=null==e?void 0:e.$box)||void 0===n?void 0:n.length)?e.$box:null;return null!==(o=null===(i=null===(r=null==s?void 0:s[0])||void 0===r?void 0:r.ownerDocument)||void 0===i?void 0:i.defaultView)&&void 0!==o?o:null}}};Object.assign(e,r)}(window.LOOPINDEX),function(e){const t=window.LOOPINDEX;if(!t)throw new Error("FLITE: global LOOPINDEX is not defined");if(t.FLITE)return console.error("FLITE NS included more than once");t.FLITE={},Object.defineProperty(t.FLITE,"logger",{value:t.createLogger("FLITE"),writable:!1,configurable:!1})}(),t=function(e){var t=e.FLITE,n=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],r=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],i=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],o=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function s(e,t){var n=typeof e[t];return"function"==n||!("object"!=n||!e[t])||"unknown"==n}function a(e,t){return!("object"!=typeof e[t]||!e[t])}function l(e,t){return void 0!==e[t]}function c(e){return function(t,n){for(var r=n.length;r--;)if(!e(t,n[r]))return!1;return!0}}var d=c(s),u=c(a),h=c(l);function g(e){return e&&d(e,o)&&h(e,i)}function f(e){return a(e,"body")?e.body:e.getElementsByTagName("body")[0]}var p,m,v={},y="undefined"!=typeof window&&"undefined"!=typeof document,_={isHostMethod:s,isHostObject:a,isHostProperty:l,areHostMethods:d,areHostObjects:u,areHostProperties:h,isTextRange:g,getBody:f,forEach:[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,r=e.length;n<r;++n)t(e[n],n)}},C={version:"1.3.0",initialized:!1,isBrowser:y,supported:!0,util:_,features:{},modules:v,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:"undefined"==typeof rangyAutoInitialize||rangyAutoInitialize}};function b(e){t.logger.debug("Rangy: "+e)}function N(e){t.logger.warn("rangy module fail",e),C.initialized=!0,C.supported=!1}C.fail=N,C.warn=function(e){b("Rangy warning: "+e,C.config.alertOnWarn)},{}.hasOwnProperty?(_.extend=p=function(e,t,n){var r,i;for(var o in t)t.hasOwnProperty(o)&&(r=e[o],i=t[o],n&&null!==r&&"object"==typeof r&&null!==i&&"object"==typeof i&&p(r,i,!0),e[o]=i);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},_.createOptions=function(e,t){var n={};return p(n,t),e&&p(n,e),n}):N("hasOwnProperty not supported"),y||N("Rangy can only run in a browser"),function(){var e;if(y){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(e){return n.call(e,0)})}catch(e){}}e||(e=function(e){for(var t=[],n=0,r=e.length;n<r;++n)t[n]=e[n];return t}),_.toArray=e}(),y&&(s(document,"addEventListener")?m=function(e,t,n){e.addEventListener(t,n,!1)}:s(document,"attachEvent")?m=function(e,t,n){e.attachEvent("on"+t,n)}:N("Document does not have required addEventListener or attachEvent method"),_.addListener=m);var T=[];function E(e){return e.message||e.description||String(e)}function S(){if(y&&!C.initialized){var e,t=!1,i=!1;s(document,"createRange")&&(e=document.createRange(),d(e,r)&&h(e,n)&&(t=!0));var o=f(document);if(o&&"body"==o.nodeName.toLowerCase())if(o&&s(o,"createTextRange")&&g(e=o.createTextRange())&&(i=!0),t||i){var a;for(var l in C.initialized=!0,C.features={implementsDomRange:t,implementsTextRange:i},v)(a=v[l])instanceof O&&a.init(a,C);for(var c=0,u=T.length;c<u;++c)try{T[c](C)}catch(e){b("Rangy init listener threw an exception. Continuing. Detail: "+E(e))}}else N("Neither Range nor TextRange are available");else N("No body element found")}}function k(e,t,n){n&&(e+=" in module "+n.name),C.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function x(e,t,n,r){e[t]=function(){return k(t,n,r),e[n].apply(e,_.toArray(arguments))}}_.deprecationNotice=k,_.createAliasForDeprecatedMethod=x,C.init=S,C.addInitListener=function(e){C.initialized?e(C):T.push(e)};var w=[];function O(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function A(e,t,n){var r=new O(e,t,(function(t){if(!0!==t.initialized)try{n(C,t),t.supported=!0}catch(t){b("Module '"+e+"' failed to load: "+E(t)),t.stack&&b(t.stack)}}));return v[e]=r,r}function R(){}C.addShimListener=function(e){w.push(e)},y&&(C.shim=C.createMissingNativeApi=function(e){e=e||window,S();for(var t=0,n=w.length;t<n;++t)w[t](e)},x(C,"createMissingNativeApi","shim")),O.prototype={init:function(){for(var e,t,n=this.dependencies||[],r=0,i=n.length;r<i;++r){if(t=n[r],!((e=v[t])&&e instanceof O))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this),this.initialized=!0},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){C.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){C.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},C.createModule=function(e){var t,n;2===arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var r=A(e,n,t);C.initialized&&C.supported&&r.init()},C.createCoreModule=function(e,t,n){A(e,t,n)},C.RangePrototype=R,C.rangePrototype=new R,C.selectionPrototype=new function(){},C.createCoreModule("DomUtil",[],(function(e,t){var n="undefined",r=e.util,i=r.getBody;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),r.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var o=document.createElement("div");r.areHostMethods(o,["insertBefore","appendChild","cloneNode"]||!1)||t.fail("Incomplete Element implementation"),r.isHostProperty(o,"innerHTML")||t.fail("Element is missing innerHTML property");var s=document.createTextNode("test");r.areHostMethods(s,["splitText","deleteData","insertData","appendData","cloneNode"]||!1)||t.fail("Incomplete Text Node implementation");var a=function(e,t){return e.indexOf(t)>=0};function l(e){for(var t=0;e=e.previousSibling;)++t;return t}function c(e,t){var n,r=[];for(n=e;n;n=n.parentNode)r.push(n);for(n=t;n;n=n.parentNode)if(a(r,n))return n;return null}function d(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function u(e,t,n){for(var r,i=n?e:e.parentNode;i;){if((r=i.parentNode)===t)return i;i=r}return null}function h(e){var t=e.nodeType;return 3==t||4==t||8==t}function g(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function f(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=n)return e.ownerDocument;if(typeof e.document!=n)return e.document;if(e.parentNode)return f(e.parentNode);throw t.createError("getDocument: no document found for node")}function p(e){var r=f(e);if(typeof r.defaultView!=n)return r.defaultView;if(typeof r.parentWindow!=n)return r.parentWindow;throw t.createError("Cannot get a window object for node")}function m(e){if(typeof e.contentDocument!=n)return e.contentDocument;if(typeof e.contentWindow!=n)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function v(e){return e&&r.isHostMethod(e,"setTimeout")&&r.isHostObject(e,"document")}var y,_=!1;function C(e){try{return e.parentNode,!1}catch(e){return!0}}function b(e){if(!e)return"[No node]";if(_&&C(e))return"[Broken node]";if(h(e))return'{txt: "'+String(e.data).substring(0,10)+'..."}';if(1==e.nodeType){var t=e.id?"#"+e.id:"",n=e.className?"."+e.className:"";return"<"+e.nodeName+t+n+">[index:"+l(e)+"]"}return e.nodeName}function N(e){this.root=e,this._next=e,this._current=null}function T(e,t){this.node=e,this.offset=t}function E(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br />",_=C(n),e.features.crashyTextNodes=_}(),typeof window.getComputedStyle!=n?y=function(e,t){return p(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=n?y=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),N.prototype={hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n&&n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},T.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+b(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},E.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},E.prototype.toString=function(){return this.message},e.dom={arrayContains:a,isHtmlNamespace:function(e){var t;return typeof e.namespaceURI==n||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t},parentElement:function(e){var t=e.parentNode;return 1==t.nodeType?t:null},getNodeIndex:l,getNodeLength:function(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}},getCommonAncestor:c,isAncestorOf:d,isOrIsAncestorOf:function(e,t){return d(e,t,!0)},getClosestAncestorIn:u,isCharacterDataNode:h,isTextOrCommentNode:function(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t},insertAfter:g,splitDataNode:function(e,t,n){if(!e||3!==e.nodeType||t<0||t>=e.length)return e;var r=e.cloneNode(!1);if(r.deleteData(0,t),e.deleteData(t,e.length-t),g(r,e),n)for(var i,o=0;i=n[o++];)i.node==e&&i.offset>t?(i.node=r,i.offset-=t):i.node==e.parentNode&&i.offset>l(e)&&++i.offset;return r},getDocument:f,getWindow:p,getIframeWindow:function(e){if(typeof e.contentWindow!=n)return e.contentWindow;if(typeof e.contentDocument!=n)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")},getIframeDocument:m,getBody:i,isWindow:v,getContentDocument:function(e,t,n){var i;if(e?r.isHostProperty(e,"nodeType")?i=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?m(e):f(e):v(e)&&(i=e.document):i=document,!i)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return i},getRootContainer:function(e){for(var t;t=e.parentNode;)e=t;return e},comparePoints:function(e,n,r,i){var o,s,a,d,h;if(e==r)return n===i?0:n<i?-1:1;if(o=u(r,e,!0))return n<=l(o)?-1:1;if(o=u(e,r,!0))return l(o)<i?-1:1;if(!(s=c(e,r)))throw new Error("comparePoints error: nodes have no common ancestor");if((a=e===s?s:u(e,s,!0))===(d=r===s?s:u(r,s,!0)))throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(h=s.firstChild;h;){if(h===a)return-1;if(h===d)return 1;h=h.nextSibling}},isBrokenNode:C,inspectNode:b,getComputedStyleProperty:y,createTestElement:function(e,t,n){var r=i(e),o=e.createElement("div");o.contentEditable=""+!!n,t&&(o.innerHTML=t);var s=r.firstChild;return s?r.insertBefore(o,s):r.appendChild(o),o},removeNode:function(e){return e&&e.parentNode&&e.parentNode.removeChild(e)},fragmentFromNodeChildren:function(e){for(var t,n=f(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},createIterator:function(e){return new N(e)},DomPosition:T},e.DOMException=E})),C.createCoreModule("DomRange",["DomUtil"],(function(n,r){var i=n.dom,o=n.util,s=i.DomPosition,a=n.DOMException,l=i.isCharacterDataNode,c=i.getNodeIndex,d=i.isOrIsAncestorOf,u=i.getDocument,h=i.comparePoints,g=i.splitDataNode,f=i.getClosestAncestorIn,p=i.getNodeLength,m=i.arrayContains,v=i.getRootContainer,y=n.features.crashyTextNodes,_=i.removeNode;function C(e,t){return 3!=e.nodeType&&(d(e,t.startContainer)||d(e,t.endContainer))}function b(e){return e.document||u(e.startContainer)}function N(e){return new s(e.parentNode,c(e))}function T(e){return new s(e.parentNode,c(e)+1)}function E(e,t,n){var r=11==e.nodeType?e.firstChild:e;return l(t)?n==t.length?i.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:g(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),r}function S(e,t,n){if(K(e),K(t),b(t)!=b(e))throw new a("WRONG_DOCUMENT_ERR");var r=h(e.startContainer,e.startOffset,t.endContainer,t.endOffset),i=h(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?r<=0&&i>=0:r<0&&i>0}function k(t){for(var n,r=0,i=0,o=t.length;i<o;++i)"string"==typeof(n=t[i])?r+=e.utils.strings.getEffectiveStringLength(n):r++;return r}function x(t,n,r,o){var s,a,l,c;for(r=r||{stop:!1};l=t.next();)if(!o||!e.utils.dom.matchesSelector(l,o))if(t.isPartiallySelectedSubtree()){if(!1===n(l))return void(r.stop=!0);if(x(c=t.getSubtreeIterator(),n,r,o),c.detach(),r.stop)return}else if(3===l.nodeType){if(!1===n(l))return void(r.stop=!0)}else for(s=i.createIterator(l);a=s.next();)if(!1===n(a))return void(r.stop=!0)}function w(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(w(t=e.getSubtreeIterator()),t.detach()):e.remove()}function O(e){for(var t,n,r=b(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(O(n)),n.detach()):e.remove(),10==t.nodeType)throw new a("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function A(e){return"["+(void 0===e.getName?"Range":e.getName())+"("+i.inspectNode(e.startContainer)+":"+e.startOffset+", "+i.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function R(e,t){if(this.range=e,this._current=null,this._next=null,this._first=null,this._last=null,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&l(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=l(this.sc)?f(this.sc,n,!0):this.sc.childNodes[this.so],this._last=l(this.ec)?f(this.ec,n,!0):this.ec.childNodes[this.eo-1]||this.ec)}}R.prototype={isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=d(e,this._last)?null:e.nextSibling,l(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!l(n)||n!==this.sc&&n!==this.ec?n.parentNode&&_(n):(e=n===this.sc?this.so:0)!=(t=n===this.ec?this.eo:n.length)&&n.deleteData(e,t-e)},isPartiallySelectedSubtree:function(){return C(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)(e=this.range.cloneRange()).collapse(!1);else{e=new le(b(this.range));var t=this._current,n=t,r=0,i=t,o=p(t);d(t,this.sc)&&(n=this.sc,r=this.so),d(t,this.ec)&&(i=this.ec,o=this.eo),ae(e,n,r,i,o)}return new R(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var I=[1,3,4,5,7,8,10],D=[2,9,11],L=[1,3,4,5,7,8,10,11],P=[1,3,4,5,7,8];function M(e){return function(t,n){for(var r,i=n?t:t.parentNode;i;){if(r=i.nodeType,m(e,r))return i;i=i.parentNode}return null}}var B=M([9,11]),F=M([5,6,10,12]),U=M([6,10,12]);function j(e,t){if(U(e,t))throw new a("INVALID_NODE_TYPE_ERR")}function H(e,t){if(!m(t,e.nodeType))throw new a("INVALID_NODE_TYPE_ERR")}function $(e,t){if(t<0||t>(l(e)?e.length:e.childNodes.length))throw new a("INDEX_SIZE_ERR")}function q(e,t){if(B(e,!0)!==B(t,!0))throw new a("WRONG_DOCUMENT_ERR")}function W(e){if(F(e,!0))throw new a("NO_MODIFICATION_ALLOWED_ERR")}function G(e,t){if(!e)throw new a(t)}function V(e,t){return t<=(l(e)?e.length:e.childNodes.length)}function z(e){return!!e.startContainer&&!!e.endContainer&&!(y&&(i.isBrokenNode(e.startContainer)||i.isBrokenNode(e.endContainer)))&&v(e.startContainer)==v(e.endContainer)&&V(e.startContainer,e.startOffset)&&V(e.endContainer,e.endOffset)}function K(e){if(!z(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}var Y=document.createElement("style"),X=!1;try{Y.innerHTML="<b>x</b>",X=3==Y.firstChild.nodeType}catch(e){}n.features.htmlParsingConforms=X;var J=X?function(e){var t=this.startContainer,n=u(t);if(!t)throw new a("INVALID_STATE_ERR");var r=null;return 1==t.nodeType?r=t:l(t)&&(r=i.parentElement(t)),(r=null===r||"HTML"==r.nodeName&&i.isHtmlNamespace(u(r).documentElement)&&i.isHtmlNamespace(r)?n.createElement("body"):r.cloneNode(!1)).innerHTML=e,i.fragmentFromNodeChildren(r)}:function(e){var t=b(this).createElement("body");return t.innerHTML=e,i.fragmentFromNodeChildren(t)};function Q(e,t){K(e);var n=e.startContainer,r=e.startOffset,i=e.endContainer,o=e.endOffset,s=n===i;l(i)&&o>0&&o<i.length&&g(i,o,t),l(n)&&r>0&&r<n.length&&(n=g(n,r,t),s?(o-=r,i=n):i==n.parentNode&&o>=c(n)&&o++,r=0),e.setStartAndEnd(n,r,i,o)}function Z(e){K(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}var ee=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],te=function(e,t,n,r,i){if(!n||isNaN(Number(n)))return!1;var o=e.collapsed;switch(n=Number(n),t){case"char":return n>0?e.moveCharRight(r,n,i):e.moveCharLeft(r,-1*n,i);case"word":default:throw new Error("move by 'word' not implemented")}o&&e.collapse(r)};function ne(e){e.START_TO_START=0,e.START_TO_END=1,e.END_TO_END=2,e.END_TO_START=3,e.NODE_BEFORE=0,e.NODE_AFTER=1,e.NODE_BEFORE_AND_AFTER=2,e.NODE_INSIDE=3}function re(e){ne(e),ne(e.prototype)}function ie(e,t){return function(){K(this);var n,r=this.startContainer,i=this.startOffset,o=this.commonAncestorContainer,s=new R(this,!0);r!==o&&(r=(n=T(f(r,o,!0))).node,i=n.offset),x(s,W),s.reset();var a=e(s);return s.detach(),t(this,r,i,r,i),a}}function oe(e,t){function r(e,t){return function(n){H(n,I),H(v(n),D);var r=(e?N:T)(n);(t?i:s)(this,r.node,r.offset)}}function i(e,n,r){var i=e.endContainer,o=e.endOffset;n===e.startContainer&&r===e.startOffset||(v(n)==v(i)&&1!=h(n,r,i,o)||(i=n,o=r),t(e,n,r,i,o))}function s(e,n,r){var i=e.startContainer,o=e.startOffset;n===e.endContainer&&r===e.endOffset||(v(n)==v(i)&&-1!=h(n,r,i,o)||(i=n,o=r),t(e,i,o,n,r))}var a=function(){};a.prototype=n.rangePrototype,e.prototype=new a,o.extend(e.prototype,{setStart:function(e,t){j(e,!0),$(e,t),i(this,e,t)},setEnd:function(e,t){j(e,!0),$(e,t),s(this,e,t)},setStartAndEnd:function(){var e=arguments,n=e[0],r=e[1],i=n,o=r;switch(e.length){case 3:o=e[2];break;case 4:i=e[2],o=e[3]}t(this,n,r,i,o)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:r(!0,!0),setStartAfter:r(!1,!0),setEndBefore:r(!0,!1),setEndAfter:r(!1,!1),collapse:function(e){return K(this),e?t(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):t(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset),this},selectNodeContents:function(e){return j(e,!0),t(this,e,0,e,p(e)),this},selectNode:function(e){j(e,!1),H(e,I);var n=N(e),r=T(e);return t(this,n.node,n.offset,r.node,r.offset),this},extractContents:ie(O,t),deleteContents:ie(w,t),canSurroundContents:function(){K(this),W(this.startContainer),W(this.endContainer);var e=new R(this,!0),t=e._first&&C(e._first,this)||e._last&&C(e._last,this);return e.detach(),!t},splitBoundaries:function(){return Q(this),this},splitBoundariesPreservingPositions:function(e){return Q(this,e),this},normalizeBoundaries:function(){K(this);var e,n=this.startContainer,r=this.startOffset,i=this.endContainer,o=this.endOffset,s=function(e){var t=e.nextSibling;t&&t.nodeType===e.nodeType&&(i=e,o=e.length,e.appendData(t.data),_(t))},a=function(e){var t=e.previousSibling;if(t&&t.nodeType===e.nodeType){n=e;var s=e.length;if(r=t.length,e.insertData(0,t.data),_(t),n==i)o+=r,i=n;else if(i==e.parentNode){var a=c(e);o==a?(i=e,o=s):o>a&&o--}}},d=!0;if(l(i))o==i.length?s(i):0==o&&(e=i.previousSibling)&&e.nodeType==i.nodeType&&(o=e.length,n==i&&(d=!1),e.appendData(i.data),_(i),i=e);else{if(o>0){var u=i.childNodes[o-1];u&&l(u)&&s(u)}d=!this.collapsed}if(d){if(l(n))0==r?a(n):r==n.length&&(e=n.nextSibling)&&e.nodeType==n.nodeType&&(i==e&&(i=n,o+=n.length),n.appendData(e.data),_(e));else if(r<n.childNodes.length){var h=n.childNodes[r];h&&l(h)&&a(h)}}else n=i,r=o;t(this,n,r,i,o)},collapseToPoint:function(e,t){j(e,!0),$(e,t),this.setStartAndEnd(e,t)}}),re(e)}function se(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:i.getCommonAncestor(e.startContainer,e.endContainer)}function ae(e,t,n,r,o){e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=o,e.document=i.getDocument(t),se(e)}function le(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,se(this)}o.extend(n.rangePrototype,{moveStart:function(e,t,n){return te(this,e,t,!0,n)},moveEnd:function(e,t,n){return te(this,e,t,!1,n)},setRange:function(e,t,n){e?this.setStart(t,n):this.setEnd(t,n)},moveCharLeft:function(t,n,r){var i,o,s=this.collapsed;if(t?(i=this.startContainer,o=this.startOffset):(i=this.endContainer,o=this.endOffset),1===i.nodeType)if(i.hasChildNodes()&&o>0){var a=i.childNodes[o-1],l=e.domUtils.getLastSelectableChild(a,r);if(!(i=l||e.domUtils.getPreviousSelectableNode(a,r)))return!1;o=i.data.length-n}else o=-1*n;else o-=n;for(;o<0;){if(!(i=e.domUtils.getPreviousSelectableNode(i,r)))return!1;1===i.nodeType?o++:o+=i.data.length}return s&&this.collapse(t),this.setRange(t,i,o),!0},moveCharRight:function(t,n,r){var i,o,s=this.collapsed;if(t?(i=this.startContainer,o=this.startOffset):(i=this.endContainer,o=this.endOffset),1===i.nodeType){var a=e.domUtils.getNextSelectableNode(i.childNodes[Math.min(o,i.childNodes.length-1)],r);i=a||e.domUtils.getFirstSelectableChild(e.domUtils.getNextContainer(i,r),r),o=n}else o+=n;if(!i)return!1;var l=o-(3===i.nodeType?i.data.length:1);if(l>0){for(;l>0;){if(!(i=e.domUtils.getFirstSelectableChild(e.domUtils.getNextContainer(i,r),r)))return!1;if(1!==i.nodeType){if(i.data.length>=l)break;i.data.length>0&&(l-=i.data.length)}else r&&r.filter&&r.filter(i)&&--l}o=l}return s&&this.collapse(t),1===i.nodeType?this.setRange(t,i,0):this.setRange(t,i,o),!0},getHTMLContents:function(e){e||(e=this.cloneContents());var t=self.env.document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML},getHTMLContentsObj:function(){return this.cloneContents()},compareBoundaryPoints:function(e,t){var n,r,i,o;K(this),q(this.startContainer,t.startContainer);var s=3==e||0==e?"start":"end",a=1==e||0==e?"start":"end";return n=this[s+"Container"],r=this[s+"Offset"],i=t[a+"Container"],o=t[a+"Offset"],h(n,r,i,o)},insertNode:function(e){if(K(this),H(e,L),W(this.startContainer),d(e,this.startContainer))throw new a("HIERARCHY_REQUEST_ERR");var t=E(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){var e,t;if(K(this),this.collapsed)return b(this).createDocumentFragment();if(this.startContainer===this.endContainer&&l(this.startContainer))return(e=this.startContainer.cloneNode(!0)).data=e.data.slice(this.startOffset,this.endOffset),(t=b(this).createDocumentFragment()).appendChild(e),t;var n=new R(this,!0);return e=function e(t){for(var n,r,i,o=b(t.range).createDocumentFragment();r=t.next();){if(n=t.isPartiallySelectedSubtree(),r=r.cloneNode(!n),n&&(i=t.getSubtreeIterator(),r.appendChild(e(i)),i.detach()),10==r.nodeType)throw new a("HIERARCHY_REQUEST_ERR");o.appendChild(r)}return o}(n),n.detach(),e},canSurroundContents:function(){K(this),W(this.startContainer),W(this.endContainer);var e=new R(this,!0),t=e._first&&C(e._first,this)||e._last&&C(e._last,this);return e.detach(),!t},surroundContents:function(e){if(H(e,P),!this.canSurroundContents())throw new a("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);E(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){K(this);for(var e,t=new le(b(this)),n=ee.length;n--;)t[e=ee[n]]=this[e];return t},toString:function(){K(this);var t=this.startContainer;if(t===this.endContainer&&l(t))return 3==t.nodeType||4==t.nodeType?t.data.slice(this.startOffset,this.endOffset):"";var n=[],r=new R(this,!0);return x(r,(function(t){(3==t.nodeType||4==t.nodeType&&!e.utils.isEmptyString(t.data))&&n.push(t.data)})),r.detach(),n.join("")},compareNode:function(e){K(this);var t=e.parentNode,n=c(e);if(!t)throw new a("NOT_FOUND_ERR");var r=this.comparePoint(t,n),i=this.comparePoint(t,n+1);return r<0?i>0?2:0:i>0?1:3},comparePoint:function(e,t){return K(this),G(e,"HIERARCHY_REQUEST_ERR"),q(e,this.startContainer),h(e,t,this.startContainer,this.startOffset)<0?-1:h(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:J,toHtml:function(){return Z(this)},intersectsNode:function(e,t){if(K(this),v(e)!=v(this.startContainer))return!1;var n=e.parentNode,r=c(e);if(!n)return!0;var i=h(n,r,this.endContainer,this.endOffset),o=h(n,r+1,this.startContainer,this.startOffset);return t?i<=0&&o>=0:i<0&&o>0},isPointInRange:function(e,t){return K(this),G(e,"HIERARCHY_REQUEST_ERR"),q(e,this.startContainer),h(e,t,this.startContainer,this.startOffset)>=0&&h(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return S(this,e,!1)},intersectsOrTouchesRange:function(e){return S(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=h(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=h(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return-1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==h(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==h(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new a("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):3==this.compareNode(e)},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,p(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();return t.setEnd(r,r.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return K(this),function(e,t,n){var r,i=Boolean(t&&t.length);i&&(r=new RegExp("^("+t.join("|")+")$"));var o=[];return x(new R(e,!1),(function(t){if((!i||r.test(t.nodeType))&&(!n||n(t))){var s=e.startContainer;if(t!=s||!l(s)||e.startOffset!=s.length){var a=e.endContainer;t==a&&l(a)&&0===e.endOffset||o.push(t)}}})),o}(this,e,t)},getDocument:function(){return b(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},collapseAt:function(e,t){if(!e)return this;if(3===e.nodeType)t?this.setStart(e,0):this.setEnd(e,e.length);else{var n=c(e);t?this.setStart(e.parentNode,n):this.setEnd(e.parentNode,n+1)}return this.collapse(t),this},collectTextParts:function(t,n){if(!z(this))return[];var r=[],i=this.startContainer,o=this.endContainer,s=this.startOffset,a=this.endOffset;if(i===o&&l(i))return 3==i.nodeType||4==i.nodeType?i.data.slice(s,a):"";var c=new R(this,!0);return x(c,(function(n){if(!t||!e.utils.dom.isDescendantOf(n,t))if(3===n.nodeType)if(n===i)r.push(start>0?n.data.slice(start):n.data);else if(n===o){if(0===a)return;r.push(a<n.length?n.data.slice(0,a):n.data)}else r.push(n.data);else t&&e.utils.dom.matchesSelector(n,t)&&r.push(n)}),null,n),c.detach(),r},getFullBookmark:function(e,r,o){if(!r)return this.getBookmark(e,!0);var s=b(this),a=n.createRange(s);e=e||i.getBody(s),a.selectNodeContents(e);var l=this.intersection(a),c=0,d=0;if(l){a.setEnd(l.startContainer,l.startOffset);var u=a.collectTextParts(r,o);c=k(u),u=l.collectTextParts(r,o),d=Math.max(c,c+k(u))}else t.logger.debug("getFullBookmark: null intersection");return{start:c,end:d,containerNode:e,isFiltered:!0,selector:r,ignoreSelector:o,after:Boolean(c>0&&0===this.endOffset),type:"extended"}},getBookmark:function(t,r){var o=b(this),s=n.createRange(o);t=t||i.getBody(o),s.selectNodeContents(t);var a=this.intersection(s),l=0,c=0;return a&&(s.setEnd(a.startContainer,a.startOffset),c=(l=r?e.utils.strings.getEffectiveStringLength(s.toString()):s.toString().length)+(r?e.utils.strings.getEffectiveStringLength(a.toString()):a.toString().length)),{start:l,end:c,containerNode:t,isFiltered:Boolean(r)}},moveToBookmark:function(n,r){if(r&&n.type)return this._moveToExtendedBookmark(n,r);var i=n.containerNode;t.logger.warn("moving to an uncollapsed bookmark");var o=0;this.setStart(i,0),this.collapse(!0);for(var s,a,l,c,d=[i],u=!1,h=!1;!h&&(s=d.pop());)if(3==s.nodeType){if(!e.utils.strings.isEmptyString(s.data))continue;a=o+s.length,!u&&n.start>=o&&n.start<=a&&(this.setStart(s,n.start-o),u=!0),u&&n.end>=o&&n.end<=a&&(this.setEnd(s,n.end-o),h=!0),o=a}else for(l=(c=s.childNodes).length;l--;)d.push(c[l])},_getBookmarkSetter:function(e){if(e.start===e.end)return function(e,t,n){e.setStart()}},_moveToExtendedBookmark:function(n,r){if(!function(e){if(!e||!e.containerNode)return!1;if(e.start>-1||(e.start=0),e.end>-1||(e.end=0),e.end<e.start){var t=e.start;e.start=e.end,e.end=t}return!0}(n))return t.logger.warn("move to invalid bookmark",n);var i=n.containerNode,o=0,s=Boolean(n.after&&!1!==r.after||r.after);"left"===r.move&&(n.start=Math.max(0,n.start-1)),this.setStart(i,0),this.collapse(!0);var a,l,c=[{node:i,index:0}],d=0===n.end,u=0,h=0,g=null,f=0,p=n.start,m=this,v=0;function y(){return!(p<n.end&&(b=C,p=n.end,d=!1,s=!1,1))}for(var _=function(){return s&&p===n.end},C=function(e,t){return m.setEnd(e,t)},b=function(e,t){m.setStart(e,t),m.setEnd(e,t)};l=c.pop();)if(3===(a=l.node).nodeType){if(d&&(b(a,0),y()))return;if((u=o+(h=n.isFiltered?e.utils.strings.getEffectiveStringLength(a.data):a.length))<1)continue;if(p>=o&&p<=u){if(v=n.isFiltered?e.utils.strings.getEffectiveStringIndex(a.data,p-o):p-o,b(a,v),p<n.end&&u>=n.end){if(v=n.isFiltered?e.utils.strings.getEffectiveStringIndex(a.data,n.end-o):n.end-o,!s||v<h)return void this.setEnd(a,v);d=!0;continue}if(_())d=!0;else if(y())return}o=u,g=a}else{if(n.ignoreSelector&&e.utils.dom.matchesSelector(a,n.ignoreSelector))continue;if(n.selector&&e.utils.dom.matchesSelector(a,n.selector)){if(u=o+1,p>=o&&p<=u){if((d||!_())&&(b(a.parentNode,l.index+(d?0:1)),y()))return;d=!0}o=u,g=a.parentNode,f=l.index}else for(var N=a.lastChild,T=a.childNodes.length;N;N=N.previousSibling)c.push({node:N,index:--T})}g&&b(g,3===g.nodeType?g.length:f+1)},getName:function(){return"DomRange"},equals:function(e){return Boolean(e&&le.rangesEqual(this,e))},isValid:function(){return z(this)},inspect:function(){return A(this)},detach:function(){}}),oe(le,ae),o.extend(le,{rangeProperties:ee,RangeIterator:R,copyComparisonConstants:re,createPrototypeRange:oe,inspect:A,toHtml:Z,getRangeDocument:b,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),n.DomRange=le})),C.createCoreModule("WrappedRange",["DomRange"],(function(e,n){var r,i,o=e.dom,s=e.util,a=o.DomPosition,l=e.DomRange,c=o.getBody,d=o.getContentDocument,u=o.isCharacterDataNode;if(e.features.implementsDomRange&&function(){var i,a,u=l.rangeProperties;function h(e){for(var t,n=u.length;n--;)e[t=u[n]]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}r=function(e){if(!e)throw n.createError("WrappedRange: Range must be specified");this.nativeRange=e,h(this)},l.createPrototypeRange(r,(function(e,t,n,r,i){var o=e.startContainer!==t||e.startOffset!=n,s=e.endContainer!==r||e.endOffset!=i,a=!e.equals(e.nativeRange);(o||s||a)&&(e.setEnd(r,i),e.setStart(t,n))})),(i=r.prototype).selectNode=function(e){return 3===e.nodeType?(this.nativeRange.setStart(e,0),this.nativeRange.setEnd(e,e.length)):this.nativeRange.selectNode(e),h(this),this},i.cloneContents=function(){return this.nativeRange.cloneContents()},i.surroundContents=function(e){return this.nativeRange.surroundContents(e),h(this),this},i.collapse=function(e){return this.nativeRange.collapse(e),h(this),this},i.cloneRange=function(){return this.syncToNative(),new r(this.nativeRange.cloneRange())},i.refresh=function(){return h(this),this},i.toString=function(){return this.nativeRange.toString()};var g=document.createTextNode("test");c(document).appendChild(g);var f=document.createRange();f.setStart(g,0),f.setEnd(g,0);try{f.setStart(g,1),i.setStart=function(e,t){this.nativeRange.setStart(e,t),h(this)},i.setEnd=function(e,t){this.nativeRange.setEnd(e,t),h(this)},a=function(e){return function(t){this.nativeRange[e](t),h(this)}}}catch(e){i.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}h(this)},i.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}h(this)},a=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}h(this)}}}i.setStartBefore=a("setStartBefore","setEndBefore"),i.setStartAfter=a("setStartAfter","setEndAfter"),i.setEndBefore=a("setEndBefore","setStartBefore"),i.setEndAfter=a("setEndAfter","setStartAfter"),i.selectNodeContents=function(e){this.setStartAndEnd(e,0,o.getNodeLength(e))},i.syncToNative=function(){return this.nativeRange||t.logger.warn("synctonative: no native range"),this.nativeRange.setStart(this.startContainer,this.startOffset),this.nativeRange.setEnd(this.endContainer,this.endOffset),this},f.selectNodeContents(g),f.setEnd(g,3);var p=document.createRange();p.selectNodeContents(g),p.setEnd(g,4),p.setStart(g,2),-1==f.compareBoundaryPoints(f.START_TO_END,p)&&1==f.compareBoundaryPoints(f.END_TO_START,p)?i.compareBoundaryPoints=function(e,t){return e==(t=t.nativeRange||t).START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:i.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var m=document.createElement("div");m.innerHTML="123";var v=m.firstChild,y=c(document);y.appendChild(m),f.setStart(v,1),f.setEnd(v,2),f.deleteContents(),"13"==v.data&&(i.deleteContents=function(){this.nativeRange.deleteContents(),h(this)},i.extractContents=function(){var e=this.nativeRange.extractContents();return h(this),e}),y.removeChild(m),y=null,s.isHostMethod(f,"createContextualFragment")&&(i.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),c(document).removeChild(g),i.getName=function(){return"WrappedRange"},e.WrappedRange=r,e.createNativeRange=function(e){return(e=d(e,n,"createNativeRange")).createRange()}}(),e.features.implementsTextRange){var h=function(e,t,n,r,i){var s=e.duplicate();s.collapse(n);var l=s.parentElement();if(o.isOrIsAncestorOf(t,l)||(l=t),!l.canHaveHTML){var c=new a(l.parentNode,o.getNodeIndex(l));return{boundaryPosition:c,nodeInfo:{nodeIndex:c.offset,containerElement:c.node}}}var d=o.getDocument(l).createElement("span");d.parentNode&&o.removeNode(d);for(var h,g,f,p,m,v=n?"StartToStart":"StartToEnd",y=i&&i.containerElement==l?i.nodeIndex:0,_=l.childNodes.length,C=_,b=C;b==_?l.appendChild(d):l.insertBefore(d,l.childNodes[b]),s.moveToElementText(d),0!=(h=s.compareEndPoints(v,e))&&y!=C;){if(-1==h){if(C==y+1)break;y=b}else C=C==y+1?y:b;b=Math.floor((y+C)/2),l.removeChild(d)}if(m=d.nextSibling,-1==h&&m&&u(m)){var N;if(s.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(m.data)){var T=s.duplicate(),E=T.text.replace(/\r\n/g,"\r").length;for(N=T.moveStart("character",E);-1==(h=T.compareEndPoints("StartToEnd",T));)N++,T.moveStart("character",1)}else N=s.text.length;p=new a(m,N)}else g=(r||!n)&&d.previousSibling,p=(f=(r||n)&&d.nextSibling)&&u(f)?new a(f,0):g&&u(g)?new a(g,g.data.length):new a(l,o.getNodeIndex(d));return o.removeNode(d),{boundaryPosition:p,nodeInfo:{nodeIndex:b,containerElement:l}}},g=function(e,t){var n,r,i,s,a=e.offset,l=o.getDocument(e.node),d=c(l).createTextRange(),h=u(e.node);return h?r=(n=e.node).parentNode:(n=a<(s=e.node.childNodes).length?s[a]:null,r=e.node),(i=l.createElement("span")).innerHTML="&#feff;",n?r.insertBefore(i,n):r.appendChild(i),d.moveToElementText(i),d.collapse(!t),r.removeChild(i),h&&d[t?"moveStart":"moveEnd"]("character",a),d};((i=function(e){this.textRange=e,this.refresh()}).prototype=new l(document)).refresh=function(){var e,t,n,r,i=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();(n=e.duplicate()).collapse(!1);var i=n.parentElement(),s=r==i?r:o.getCommonAncestor(r,i);return s==t?s:o.getCommonAncestor(t,s)}(this.textRange);0==(r=this.textRange).compareEndPoints("StartToEnd",r)?t=e=h(this.textRange,i,!0,!0).boundaryPosition:(e=(n=h(this.textRange,i,!0,!1)).boundaryPosition,t=h(this.textRange,i,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},i.prototype.getName=function(){return"WrappedTextRange"},l.copyComparisonConstants(i);var f=function(e){if(e.collapsed)return g(new a(e.startContainer,e.startOffset),!0);var t=g(new a(e.startContainer,e.startOffset),!0),n=g(new a(e.endContainer,e.endOffset),!1),r=c(l.getRangeDocument(e)).createTextRange();return r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r};if(i.rangeToTextRange=f,i.prototype.toTextRange=function(){return f(this)},e.WrappedTextRange=i,!e.features.implementsDomRange||e.config.preferTextRange){var p=Function("return this;")();void 0===p.Range&&(p.Range=i),e.createNativeRange=function(e){return e=d(e,n,"createNativeRange"),c(e).createTextRange()},e.WrappedRange=i}}e.createRange=function(t){return t=d(t,n,"createRange"),new e.WrappedRange(e.createNativeRange(t))},e.createRangeFromNative=function(t){var n=t&&t.commonAncestorContainer;if(!n||!n.ownerDocument)throw new Error("createFromNativeRange: null input or no owner document");return new e.WrappedRange(t)},e.createRangyRange=function(e){return e=d(e,n,"createRangyRange"),new l(e)},s.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),s.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener((function(t){var n=t.document;void 0===n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null}))})),C.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],(function(e,t){e.config.checkSelectionRanges=!0;var n,r,i=e.dom,o=e.util,s=o.isHostMethod,a=e.DomRange,l=e.WrappedRange,c=e.DOMException,d=i.DomPosition,u=e.features,h=i.getDocument,g=i.getBody,f=a.rangesEqual;function p(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function m(e,n){if(e){if(i.isWindow(e))return e;if(e instanceof $)return e.win;var r=i.getContentDocument(e,t,n);return i.getWindow(r)}return window}function v(e){return m(e,"getDocSelection").document.selection}function y(e){var t=!1;return e.anchorNode&&(t=1==i.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}var _=s(window,"getSelection"),C=o.isHostObject(document,"selection");u.implementsWinGetSelection=_,u.implementsDocSelection=C;var b=C&&(!_||e.config.preferTextRange);if(b)n=v,e.isSelectionValid=function(e){var t=m(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||h(n.createRange().parentElement())==t};else{if(!_)return t.fail("Neither document.selection or window.getSelection() detected."),!1;n=function(e){return m(e,"getWinSelection").getSelection()},e.isSelectionValid=function(){return!0}}e.getNativeSelection=n;var N=n();if(!N)return t.fail("Native selection was null (possibly issue 138?)"),!1;var T=e.createNativeRange(document),E=g(document),S=o.areHostProperties(N,["anchorNode","focusNode","anchorOffset","focusOffset"]);u.selectionHasAnchorAndFocus=S;var k=s(N,"extend");u.selectionHasExtend=k;var x="number"==typeof N.rangeCount;u.selectionHasRangeCount=x;var w=!1,O=!0,A=k?function(t,n){var r=a.getRangeDocument(n),i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset),t.addRange(M(i)),t.extend(n.startContainer,n.startOffset)}:null;o.areHostMethods(N,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof N.rangeCount&&u.implementsDomRange&&function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,r=n>1,o=[],s=y(t),a=0;a<n;++a)o[a]=t.getRangeAt(a);var l=i.createTestElement(document,"",!1),c=l.appendChild(document.createTextNode("Â Â Â ")),d=document.createRange();if(d.setStart(c,1),d.collapse(!0),t.removeAllRanges(),t.addRange(d),O=1==t.rangeCount,t.removeAllRanges(),!r){var u=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(u&&parseInt(u[1])>=36)w=!1;else{var h=d.cloneRange();d.setStart(c,0),h.setEnd(c,3),h.setStart(c,2),t.addRange(d),t.addRange(h),w=2==t.rangeCount}}for(i.removeNode(l),t.removeAllRanges(),a=0;a<n;++a)0==a&&s?A?A(t,o[a]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(o[a])):t.addRange(o[a])}}(),u.selectionSupportsMultipleRanges=w,u.collapsedNonEditableSelectionsSupported=O;var R,I,D=!1;function L(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function P(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges=e._ranges||[],e._ranges.length=0}function M(t){var n;return t instanceof a?((n=e.createNativeRange(t.getDocument())).setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof l?n=t.nativeRange:u.implementsDomRange&&t instanceof i.getWindow(t.startContainer).Range&&(n=t),n}function B(e){var n=e.getNodes();if(!function(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;t<n;++t)if(!i.isAncestorOf(e[0],e[t]))return!1;return!0}(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function F(e){return!!e&&void 0!==e.text}function U(e,t){var n=new l(t);e._ranges=[n],L(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function j(t){if(t._ranges.length=0,"None"==t.docSelection.type)P(t);else{var n=t.docSelection.createRange();if(F(n))U(t,n);else{t.rangeCount=n.length;for(var r,i=h(n.item(0)),o=0;o<t.rangeCount;++o)(r=e.createRange(i)).selectNode(n.item(o)),t._ranges.push(r);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,L(t,t._ranges[t.rangeCount-1],!1)}}}function H(e,n){for(var r=e.docSelection.createRange(),i=B(n),o=h(r.item(0)),s=g(o).createControlRange(),a=0,l=r.length;a<l;++a)s.add(r.item(a));try{s.add(i)}catch(e){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}s.select(),j(e)}function $(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function q(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}E&&s(E,"createControlRange")&&(R=E.createControlRange(),o.areHostProperties(R,["item","add"])&&(D=!0)),u.implementsControlRange=D,r=S?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed},s(N,"getRangeAt")?I=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:S&&(I=function(t){var n=h(t.anchorNode),r=e.createRange(n);return r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),r}),$.prototype=e.selectionPrototype;var W=[];function G(e,t){for(var n,r,i=W.length;i--;)if(r=(n=W[i]).selection,"deleteAll"==t)q(r);else if(n.win==e)return"delete"==t?(W.splice(i,1),!0):r;return"deleteAll"==t&&(W.length=0),null}var V=function(e){if(e&&e instanceof $)return e.refresh(),e;var t=G(e=m(e,"getNativeSelection")),r=n(e),i=C?v(e):null;return t?(t.nativeSelection=r,t.docSelection=i,t.refresh()):(t=new $(r,i,e),W.push({win:e,selection:t})),t};e.getSelection=V,o.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var z,K=$.prototype;function Y(e,n){for(var r,i=h(n[0].startContainer),o=g(i).createControlRange(),s=0,a=n.length;s<a;++s){r=B(n[s]);try{o.add(r)}catch(e){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}o.select(),j(e)}if(!b&&S&&o.areHostMethods(N,["removeAllRanges","addRange"])){K.removeAllRanges=function(){try{this.nativeSelection.removeAllRanges()}catch(e){}P(this)};var X=function(e,t){A(e.nativeSelection,t),e.refresh()};K.addRange=x?function(t,n){if(D&&C&&"Control"==this.docSelection.type)H(this,t);else if(p(n)&&k)X(this,t);else{var i;w?i=this.rangeCount:(this.removeAllRanges(),i=0);var o=M(t).cloneRange();try{this.nativeSelection.addRange(o)}catch(e){console.error(e,t)}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==i+1){if(e.config.checkSelectionRanges){var s=I(this.nativeSelection,this.rangeCount-1);s&&!f(s,t)&&(t=new l(s))}this._ranges[this.rangeCount-1]=t,L(this,t,J(this.nativeSelection)),this.isCollapsed=r(this)}else this.refresh()}}:function(e,t){p(t)&&k?X(this,e):(this.nativeSelection.addRange(M(e)),this.refresh())},K.setRanges=function(e){if(D&&C&&e.length>1)Y(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(s(N,"empty")&&s(T,"select")&&D&&b))return t.fail("No means of selecting a Range or TextRange was found"),!1;K.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=h(this.anchorNode);else if("Control"==this.docSelection.type){var t=this.docSelection.createRange();t.length&&(e=h(t.item(0)))}e&&(g(e).createTextRange().select(),this.docSelection.empty())}}catch(e){}P(this)},K.addRange=function(t){"Control"==this.docSelection.type?H(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,L(this,t,!1))},K.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?Y(this,e):t&&this.addRange(e[0])}}if(K.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new c("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()},b)z=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=g(t.win.document).createTextRange()).collapse(!0),"Control"==t.docSelection.type?j(t):F(n)?U(t,n):P(t)};else if(s(N,"getRangeAt")&&"number"==typeof N.rangeCount)z=function(t){if(D&&C&&"Control"==t.docSelection.type)j(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection&&t.nativeSelection.rangeCount||0,t.rangeCount){for(var n=0,i=t.rangeCount;n<i;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));L(t,t._ranges[t.rangeCount-1],J(t.nativeSelection)),t.isCollapsed=r(t)}else P(t)};else{if(!S||"boolean"!=typeof N.isCollapsed||"boolean"!=typeof T.collapsed||!u.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;z=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=I(n,0),e._ranges=[t],e.rangeCount=1,function(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}(e),e.isCollapsed=r(e)):P(e)}}K.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;if(z(this),e){var i=t.length;if(i!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;for(;i--;)if(!f(t[i],this._ranges[i]))return!0;return!1}};var J,Q=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,i=n.length;r<i;++r)f(t,n[r])||e.addRange(n[r]);e.rangeCount||P(e)};function Z(e,t){if(e.win.document!=h(t))throw new c("WRONG_DOCUMENT_ERR")}function ee(t){return function(n,r){var i;this.rangeCount?(i=this.getRangeAt(0))["set"+(t?"Start":"End")](n,r):(i=e.createRange(this.win.document)).setStartAndEnd(n,r),this.setSingleRange(i,this.isBackward())}}function te(e){var t=[],n=new d(e.anchorNode,e.anchorOffset),r=new d(e.focusNode,e.focusOffset),i="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(var o=0,s=e.rangeCount;o<s;++o)t[o]=a.inspect(e.getRangeAt(o));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}K.removeRange=D&&C?function(e){if("Control"==this.docSelection.type){for(var t=this.docSelection.createRange(),n=B(e),r=h(t.item(0)),i=g(r).createControlRange(),o=!1,s=0,a=t.length;s<a;++s)t.item(s)!==n||o?i.add(t.item(s)):o=!0;i.select(),j(this)}else Q(this,e)}:function(e){Q(this,e)},!b&&S&&u.implementsDomRange?(J=y,K.isBackward=function(){return J(this)}):J=K.isBackward=function(){return!1},K.isBackwards=K.isBackward,K.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},K.collapse=function(t,n){Z(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},K.collapseToStart=function(){if(!this.rangeCount)throw new c("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},K.collapseToEnd=function(){if(!this.rangeCount)throw new c("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},K.selectAllChildren=function(t){Z(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},K.deleteFromDocument=function(){if(D&&C&&"Control"==this.docSelection.type){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),i.removeNode(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,o=n.length;r<o;++r)n[r].deleteContents();this.addRange(n[o-1])}}},K.eachRange=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(e(this.getRangeAt(n)))return t},K.getAllRanges=function(){var e=[];return this.eachRange((function(t){e.push(t)})),e},K.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},K.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange((function(r){n.push(r[e].apply(r,t||[]))})),n},K.setStart=ee(!0),K.setEnd=ee(!1),e.rangePrototype.select=function(e){V(this.getDocument()).setSingleRange(this,e)},K.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange((function(n){e(n),t.push(n)})),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},K.containsNode=function(e,t){return this.eachRange((function(n){return n.containsNode(e,t)}),!0)||!1},K.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},K.moveToBookmark=function(t){for(var n,r,i=[],o=0;n=t.rangeBookmarks[o++];)(r=e.createRange(this.win)).moveToBookmark(n),i.push(r);t.backward?this.setSingleRange(i[0],"backward"):this.setRanges(i)},K.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},K.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&0==n)},K.toHtml=function(){var e=[];return this.eachRange((function(t){e.push(a.toHtml(t))})),e.join("")},u.implementsTextRange&&(K.getNativeTextRange=function(){var n;if(n=this.docSelection){var r=n.createRange();if(F(r))return r;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),K.getName=function(){return"WrappedSelection"},K.inspect=function(){return te(this)},K.detach=function(){G(this.win,"delete"),q(this)},K.detachAll=function(){G(null,"deleteAll")},$.detachAll=function(){G(null,"deleteAll")},$.inspect=te,$.isDirectionBackward=p,e.Selection=$,e.selectionPrototype=K,e.addShimListener((function(e){void 0===e.getSelection&&(e.getSelection=function(){return V(e)}),e=null}))}));var I=!1,D=function(e){I||(I=!0,!C.initialized&&C.config.autoInitialize&&S())};return y&&("complete"==document.readyState?D():(s(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",D,!1),m(window,"load",D))),C.isInitialized=function(e){var n;for(var r in e&&!I&&D(),this.modules)if(!(n=this.modules[r])||!n.initialized||!n.supported)return t.logger.debug("rangy NOT initialized: module",r,"initialized",n.initialized,"supported",n.supported),!1;return!0},C},(n=window.LOOPINDEX)||console.error("rangy: root is undefined"),n.FLITE.rangy=t(n),n.logger.scheduleDump(),Object.defineProperty(i,"__esModule",{value:!0}),function(e){const t=null==e?void 0:e.FLITE,n=null==e?void 0:e.$;if(!t||!n)throw new Error("Cannot initialize Mutation Summary without FLITE globals");let r;!function(e){e[e.STAYED_OUT=0]="STAYED_OUT",e[e.ENTERED=1]="ENTERED",e[e.STAYED_IN=2]="STAYED_IN",e[e.REPARENTED=3]="REPARENTED",e[e.REORDERED=4]="REORDERED",e[e.EXITED=5]="EXITED"}(r||(r={}));const i=["added","removed","reordered","reparented","valueChanged","characterDataChanged"],o=()=>new Map;class s{constructor(e,t=!1,n=!1,r=!1,i=null,o=!1,s=null,a=null){this.node=e,this.childList=t,this.attributes=n,this.characterData=r,this.oldParentNode=i,this.added=o,this.attributeOldValues=s,this.characterDataOldValue=a,this.isCaseInsensitive=1===this.node.nodeType&&this.node instanceof HTMLElement&&this.node.ownerDocument instanceof HTMLDocument}getAttributeOldValue(e){if(this.attributeOldValues)return this.isCaseInsensitive&&(e=e.toLowerCase()),this.attributeOldValues[e]}getAttributeNamesMutated(){const e=[];if(!this.attributeOldValues)return e;for(let t in this.attributeOldValues)e.push(t);return e}attributeMutated(e,t){this.attributes=!0,this.attributeOldValues=this.attributeOldValues||{},e in this.attributeOldValues||(this.attributeOldValues[e]=t)}characterDataMutated(e){this.characterData||(this.characterData=!0,this.characterDataOldValue=e)}removedFromParent(e){this.childList=!0,this.added||this.oldParentNode?(this.added=!1,this.oldParentNode=this.oldParentNode||e):this.oldParentNode=e}insertedIntoParent(){this.childList=!0,this.added=!0}getOldParent(){if(this.childList){if(this.oldParentNode)return this.oldParentNode;if(this.added)return null}return this.node.parentNode}}class a{constructor(){this.added=new Set,this.removed=new Set,this.maybeMoved=new Set,this.oldPrevious=o(),this.moved=void 0}}class l{constructor(e,t,n){let r,i,s;n=n||(e=>!0),this.rootNode=e,this._changeMap=o(),this.reachableCache=void 0,this.wasReachableCache=void 0,this.anyParentsChanged=!1,this.anyAttributesChanged=!1,this.anyCharacterDataChanged=!1;for(let e=0;e<t.length;e++)switch(s=t[e],s.type){case"childList":this.anyParentsChanged=!0;for(let e=0;e<s.removedNodes.length;e++)r=s.removedNodes[e],this.getChange(r).removedFromParent(s.target);for(let e=0;e<s.addedNodes.length;e++)r=s.addedNodes[e],this.getChange(r).insertedIntoParent();break;case"attributes":this.anyAttributesChanged=!0,n(s.target)&&(i=this.getChange(s.target),i.attributeMutated(s.attributeName,s.oldValue));break;case"characterData":this.anyCharacterDataChanged=!0,n(s.target)&&(i=this.getChange(s.target),i.characterDataMutated(s.oldValue))}}get(e){return this._changeMap.get(e)}getNodes(){return Array.from(this._changeMap.keys())}getChange(e){let t=this._changeMap.get(e);return t||(t=new s(e),this._changeMap.set(e,t)),t}getOldParent(e){const t=this._changeMap.get(e);return t?t.getOldParent():e.parentNode}getIsReachable(e){if(e===this.rootNode)return!0;if(!e)return!1;this.reachableCache=this.reachableCache||o();let t=this.reachableCache.get(e);return void 0===t&&(t=this.getIsReachable(e.parentNode),this.reachableCache.set(e,t)),t}getWasReachable(e){if(e===this.rootNode)return!0;if(!e)return!1;this.wasReachableCache=this.wasReachableCache||o();let t=this.wasReachableCache.get(e);return void 0===t&&(t=this.getWasReachable(this.getOldParent(e)),this.wasReachableCache.set(e,t)),t}reachabilityChange(e){return this.getIsReachable(e)?this.getWasReachable(e)?r.STAYED_IN:r.ENTERED:this.getWasReachable(e)?r.EXITED:r.STAYED_OUT}}class c{constructor(t,n,r,i,s,a){this.rootNode=t,this.mutations=n,this.selectors=r,this.calcReordered=i,this.calcOldPreviousSibling=s,this.nodeFilter=a,this.nodeFilter=this.nodeFilter||e.utils.yes,this.treeChanges=new l(t,n,this.nodeFilter),this.entered=[],this.exited=[],this.stayedIn=o(),this.visited=o(),this.childListChangeMap=void 0,this.characterDataOnly=void 0,this.matchCache=void 0,this.processMutations()}processMutations(){if(!this.treeChanges.anyParentsChanged&&!this.treeChanges.anyAttributesChanged)return;const e=this.treeChanges.getNodes();for(let t=0;t<e.length;t++)this.visitNode(e[t],void 0)}visitNode(e,t){if(this.visited.has(e))return;this.visited.set(e,!0);const n=this.treeChanges.get(e);let i=t;if((n&&n.childList||null==i)&&(i=this.treeChanges.reachabilityChange(e)),i!==r.STAYED_OUT){if(this.matchabilityChange(e),i===r.ENTERED)this.entered.push(e);else if(i===r.EXITED)this.exited.push(e),this.ensureHasOldPreviousSiblingIfNeeded(e);else if(i===r.STAYED_IN){let t=r.STAYED_IN;n&&n.childList&&(n.oldParentNode!==e.parentNode?(t=r.REPARENTED,this.ensureHasOldPreviousSiblingIfNeeded(e)):this.calcReordered&&this.wasReordered(e)&&(t=r.REORDERED)),this.stayedIn.set(e,t)}if(i!==r.STAYED_IN)for(let t=e.firstChild;t;t=t.nextSibling)this.visitNode(t,i)}}ensureHasOldPreviousSiblingIfNeeded(e){if(!this.calcOldPreviousSibling)return;this.processChildlistChanges();let t=e.parentNode,n=this.treeChanges.get(e);n&&n.oldParentNode&&(t=n.oldParentNode);let r=this.childListChangeMap.get(t);r||(r=new a,this.childListChangeMap.set(t,r)),!e.previousSibling&&r.oldPrevious.has(e)||r.oldPrevious.set(e,e.previousSibling)}getChanged(e,t,n){let i,o;this.selectors=t,this.characterDataOnly=n;for(let t=0;t<this.entered.length;t++)i=this.entered[t],o=this.matchabilityChange(i),o!==r.ENTERED&&o!==r.STAYED_IN||e.added.push(i);const s=Array.from(this.stayedIn.keys());let a;for(let t=0;t<s.length;t++)if(i=s[t],a=3===i.nodeType&&this.stayedIn.get(i)===r.REPARENTED,o=this.matchabilityChange(i,a?r.STAYED_IN:null),o===r.ENTERED)e.added.push(i);else if(o===r.EXITED)e.removed.push(i);else if(o===r.STAYED_IN&&(e.reparented||e.reordered)){const t=this.stayedIn.get(i);e.reparented&&t===r.REPARENTED?e.reparented.push(i):e.reordered&&t===r.REORDERED&&e.reordered.push(i)}for(let t=0;t<this.exited.length;t++)i=this.exited[t],o=this.matchabilityChange(i),o!==r.EXITED&&o!==r.STAYED_IN||e.removed.push(i)}getOldParentNode(e){const n=this.treeChanges.get(e);if(n&&n.childList)return n.oldParentNode?n.oldParentNode:null;const i=this.treeChanges.reachabilityChange(e);return i===r.STAYED_OUT||i===r.ENTERED?(t.logger.warn("getOldParentNode requested on invalid node."),null):e.parentNode}getOldPreviousSibling(e){let t=e.parentNode;const n=this.treeChanges.get(e);n&&n.oldParentNode&&(t=n.oldParentNode);const r=this.childListChangeMap.get(t);if(!r)throw Error("getOldPreviousSibling requested on invalid node.");return r.oldPrevious.get(e)}getOldAttribute(e,t){const n=this.treeChanges.get(e);if(!n||!n.attributes)throw Error("getOldAttribute requested on invalid node.");const r=n.getAttributeOldValue(t);if(void 0===r)throw Error("getOldAttribute requested for unchanged attribute name.");return r}attributeChangedNodes(e){if(!this.treeChanges.anyAttributesChanged)return{};let t,n;if(e){t={},n={};for(let r=0;r<e.length;r++){const i=e[r];t[i]=!0,n[i.toLowerCase()]=i}}const i={},o=this.treeChanges.getNodes();let s,a;for(let e=0;e<o.length;e++){s=o[e];const l=this.treeChanges.get(s);if(!l.attributes)continue;if(r.STAYED_IN!==this.treeChanges.reachabilityChange(s)||r.STAYED_IN!==this.matchabilityChange(s))continue;a=s;const c=l.getAttributeNamesMutated();let d,u;for(let e=0;e<c.length;e++)d=c[e],(!t||t[d]||l.isCaseInsensitive&&n[d])&&(u=l.getAttributeOldValue(d),u!==a.getAttribute(d)&&(n&&l.isCaseInsensitive&&(d=n[d]),i[d]=i[d]||[],i[d].push(a)))}return i}getOldCharacterData(e){const t=this.treeChanges.get(e);if(!t||!t.characterData)throw Error("getOldCharacterData requested on invalid node.");return t.characterDataOldValue}getCharacterDataChanged(){if(!this.treeChanges.anyCharacterDataChanged)return[];const e=this.treeChanges.getNodes(),t=[];let n,i;for(let o=0;o<e.length;o++)n=e[o],r.STAYED_IN===this.treeChanges.reachabilityChange(n)&&(i=this.treeChanges.get(n),i.characterData&&n.textContent!=i.characterDataOldValue&&t.push(n));return t}computeMatchabilityChange(e,t){this.matchCache||(this.matchCache=[]),this.matchCache[e.uid]||(this.matchCache[e.uid]=o());const n=this.matchCache[e.uid];let r=n.get(t);return void 0===r&&(r=e.matchabilityChange(t,this.treeChanges.get(t)),n.set(t,r)),r}matchabilityChange(e,t){if(this.characterDataOnly)switch(e.nodeType){case Node.COMMENT_NODE:case 3:return r.STAYED_IN;default:return r.STAYED_OUT}if(!this.selectors)return r.STAYED_IN;if(1!==e.nodeType)return null==t?e.parentNode?r.STAYED_IN:r.STAYED_OUT:t;let n=e;const i=this.selectors.map(e=>this.computeMatchabilityChange(e,n));let o=r.STAYED_OUT,s=0;for(;o!==r.STAYED_IN&&s<i.length;){switch(i[s]){case r.STAYED_IN:o=r.STAYED_IN;break;case r.ENTERED:o=o===r.EXITED?r.STAYED_IN:r.ENTERED;break;case r.EXITED:o=o===r.ENTERED?r.STAYED_IN:r.EXITED}s++}return o}getChildlistChange(e){let t=this.childListChangeMap.get(e);return t||(t=new a,this.childListChangeMap.set(e,t)),t}processChildlistChanges(){if(this.childListChangeMap)return;let e,t,n,i;this.childListChangeMap=o();const s=function(e,t,n){!e||n.added.has(e)||n.maybeMoved.has(e)||t&&!n.oldPrevious.get(e)&&(t&&(n.added.has(t)||n.maybeMoved.has(t))||n.oldPrevious.set(e,t))};for(let o=0;o<this.mutations.length;o++)if(e=this.mutations[o],"childList"==e.type&&(this.treeChanges.reachabilityChange(e.target)===r.STAYED_IN||this.calcOldPreviousSibling)){n=this.getChildlistChange(e.target),i=e.previousSibling;for(let r=0;r<e.removedNodes.length;r++)t=e.removedNodes[r],s(t,i,n),n.added.has(t)?n.added.delete(t):(n.removed.add(t),n.maybeMoved.delete(t)),i=t;s(e.nextSibling,i,n);for(let r=0;r<e.addedNodes.length;r++)t=e.addedNodes[r],n.removed.has(t)?(n.removed.delete(t),n.maybeMoved.add(t)):n.added.add(t)}}wasReordered(e){if(!this.treeChanges.anyParentsChanged)return!1;this.processChildlistChanges();let t=e.parentNode;const n=this.treeChanges.get(e);n&&n.oldParentNode&&(t=n.oldParentNode);const r=this.childListChangeMap.get(t);if(!r)return!1;if(r.moved)return r.moved.has(e);r.moved=o();const i=o();function s(e){if(!e)return!1;if(!r.maybeMoved.has(e))return!1;let t=r.moved.get(e);return void 0!==t||(i.has(e)?t=!0:(i.set(e,!0),t=function(e){if(l.has(e))return l.get(e);let t=e.previousSibling;for(;t&&(r.added.has(t)||s(t));)t=t.previousSibling;return l.set(e,t),t}(e)!==function e(t){let n=a.get(t);if(void 0!==n)return n;n=r.oldPrevious.get(t);for(;n&&(r.removed.has(n)||s(n));)n=e(n);void 0===n&&(n=t.previousSibling);return a.set(t,n),n}(e)),i.has(e)?(i.delete(e),r.moved.set(e,t)):t=r.moved.get(e)),t}const a=o();const l=o();return r.maybeMoved.forEach(s),r.moved.get(e)}}class d{constructor(e,t){if(this.projection=e,this.added=[],this.removed=[],this.reparented=t.all||t.element||t.characterData?[]:void 0,this.reordered=t.all?[]:void 0,this.projection=e,e.getChanged(this,t.elementFilter,t.characterData),t.all||t.attribute||t.attributeList){const n=t.attribute?[t.attribute]:t.attributeList,r=e.attributeChangedNodes(n);t.attribute?this.valueChanged=r[t.attribute]||[]:(this.attributeChanged=r,t.attributeList&&t.attributeList.forEach(e=>{this.attributeChanged.hasOwnProperty(e)||(this.attributeChanged[e]=[])}))}if(t.all||t.characterData){const n=e.getCharacterDataChanged();t.characterData?this.valueChanged=n:this.characterDataChanged=n}this.reordered&&(this.getOldPreviousSibling=e.getOldPreviousSibling.bind(e))}getOldParentNode(e){return this.projection.getOldParentNode(e)}getOldAttribute(e,t){return this.projection.getOldAttribute(e,t)}getOldPreviousSibling(e){return this.projection.getOldPreviousSibling(e)}getOldCharacterData(e){return this.projection.getOldCharacterData(e)}getCharacterDataChanged(){return this.projection.getCharacterDataChanged()}}const u=/[a-zA-Z_]+/,h=/[a-zA-Z0-9_\-]+/;function g(e){return'"'+e.replace(/"/,'\\"')+'"'}class f{constructor(){}matches(e){if(null===e)return!1;if(void 0===this.attrValue)return!0;if(!this.contains)return this.attrValue==e;const t=e.split(" ");for(let e=0;e<t.length;e++)if(this.attrValue===t[e])return!0;return!1}toString(){const e="["+this.attrName+"]";return"class"===this.attrName&&this.contains?"."+this.attrValue:"id"!==this.attrName||this.contains?this.contains?"["+this.attrName+"~="+g(this.attrValue)+"]":"attrValue"in this?"["+this.attrName+"="+g(this.attrValue)+"]":e:"#"+this.attrValue}}class p{get caseInsensitiveTagName(){return this.tagName.toUpperCase()}get selectorString(){return this.tagName+this.qualifiers.join("")}constructor(){this.uid=p.nextUid++,this.qualifiers=[]}isMatching(e){return null==e?void 0:e.matches(this.selectorString)}wasMatching(e,t,n){if(!t||!t.attributes)return n;const r=t.isCaseInsensitive?this.caseInsensitiveTagName:this.tagName;if("*"!==r&&r!==e.tagName)return!1;const i=[];let o,s=!1;for(let e=0;e<this.qualifiers.length;e++){o=this.qualifiers[e];const n=t.getAttributeOldValue(o.attrName);i.push(n),s=s||void 0!==n}if(!s)return n;for(let t=0;t<this.qualifiers.length;t++){o=this.qualifiers[t];let n=i[t];if(void 0===n&&(n=e.getAttribute(o.attrName)),!o.matches(n))return!1}return!0}matchabilityChange(e,t){return this.isMatching(e)?this.wasMatching(e,t,!0)?r.STAYED_IN:r.ENTERED:this.wasMatching(e,t,!1)?r.EXITED:r.STAYED_OUT}static parseSelectors(e){const t=[];let n,r;function i(){n&&(r&&(n.qualifiers.push(r),r=void 0),t.push(n)),n=new p}function o(){r&&n.qualifiers.push(r),r=new f}const s=/\s/;let a;const l="Invalid or unsupported selector syntax.";let c,d=1,g=0;for(;g<e.length;)switch(c=e[g++],d){case 1:if(c.match(u)){i(),n.tagName=c,d=2;break}if("*"===c){i(),n.tagName="*",d=3;break}if("."===c){i(),o(),n.tagName="*",r.attrName="class",r.contains=!0,d=4;break}if("#"===c){i(),o(),n.tagName="*",r.attrName="id",d=4;break}if("["===c){i(),o(),n.tagName="*",r.attrName="",d=6;break}if(c.match(s))break;throw Error(l);case 2:if(c.match(h)){n.tagName+=c;break}if("."===c){o(),r.attrName="class",r.contains=!0,d=4;break}if("#"===c){o(),r.attrName="id",d=4;break}if("["===c){o(),r.attrName="",d=6;break}if(c.match(s)){d=14;break}if(","===c){d=1;break}throw Error(l);case 3:if("."===c){o(),r.attrName="class",r.contains=!0,d=4;break}if("#"===c){o(),r.attrName="id",d=4;break}if("["===c){o(),r.attrName="",d=6;break}if(c.match(s)){d=14;break}if(","===c){d=1;break}throw Error(l);case 4:if(c.match(u)){r.attrValue=c,d=5;break}throw Error(l);case 5:if(c.match(h)){r.attrValue+=c;break}if("."===c){o(),r.attrName="class",r.contains=!0,d=4;break}if("#"===c){o(),r.attrName="id",d=4;break}if("["===c){o(),d=6;break}if(c.match(s)){d=14;break}if(","===c){d=1;break}throw Error(l);case 6:if(c.match(u)){r.attrName=c,d=7;break}if(c.match(s))break;throw Error(l);case 7:if(c.match(h)){r.attrName+=c;break}if(c.match(s)){d=8;break}if("~"===c){r.contains=!0,d=9;break}if("="===c){r.attrValue="",d=11;break}if("]"===c){d=3;break}throw Error(l);case 8:if("~"===c){r.contains=!0,d=9;break}if("="===c){r.attrValue="",d=11;break}if("]"===c){d=3;break}if(c.match(s))break;throw Error(l);case 9:if("="===c){r.attrValue="",d=11;break}throw Error(l);case 10:if("]"===c){d=3;break}if(c.match(s))break;throw Error(l);case 11:if(c.match(s))break;if('"'===c||"'"===c){a=c,d=13;break}r.attrValue+=c,d=12;break;case 12:if(c.match(s)){d=10;break}if("]"===c){d=3;break}if("'"===c||'"'==c)throw Error(l);r.attrValue+=c;break;case 13:if(c===a){d=10;break}r.attrValue+=c;break;case 14:if(c.match(s))break;if(","===c){d=1;break}throw Error(l)}switch(d){case 1:case 2:case 3:case 5:case 14:i();break;default:throw Error(l)}if(!t.length)throw Error(l);return t}}p.nextUid=1,p.matchesSelector="matchesSelector";const m=/^([a-zA-Z:_]+[a-zA-Z0-9_\-:\.]*)$/;function v(e){if("string"!=typeof e)throw Error("Invalid request opion. attribute must be a non-zero length string.");if(!(e=e.trim()))throw Error("Invalid request opion. attribute must be a non-zero length string.");if(!e.match(m))throw Error("Invalid request option. invalid attribute name: "+e);return e}function y(e){if(!e.trim().length)throw Error("Invalid request option: elementAttributes must contain at least one attribute.");const t={},n={},r=e.split(/\s+/);let i,o;for(let e=0;e<r.length;e++)if(i=r[e],i){if(i=v(i),o=i.toLowerCase(),t[o])throw Error("Invalid request option: observing multiple case variations of the same attribute is not supported.");n[i]=!0,t[o]=!0}return Object.keys(n)}class _{constructor(e,t){this.connected=!1,this.options=_.validateOptions(e),this.observerOptions=_.createObserverOptions(this.options.queries),this.root=this.options.rootNode,this._summaryGuard=new C,this._callbacks={current:null,callbacks:n.extend({},{},e.callbacks)},this.elementFilter=Array.prototype.concat.apply([],this.options.queries.map(e=>e.elementFilter?e.elementFilter:[])),this.elementFilter.length||(this.elementFilter=void 0),this.calcReordered=this.options.queries.some(e=>e.all),this.queryValidators=[],_.createQueryValidator&&(this.queryValidators=this.options.queries.map(e=>_.createQueryValidator(this.root,e))),this.observer=new MutationObserver(e=>{this.observerCallback(e)}),t&&this.reconnect()}setCallback(e,t){const n=this._callbacks.current;if(!(e in this._callbacks.callbacks))throw new Error("unknown mutation summary callback key "+e);return this._callbacks.current=e,t&&(this._callbacks.callbacks[e]=t),n}ignoreNextMutation(){this._summaryGuard.set(1)}get callback(){return this._callbacks.callbacks[this._callbacks.current]}filterIgnoredMutations(e){return e}filterIgnoredMutations1(e){if(!e)return e;const t=this.options.mutationFilter&&this.options.mutationFilter(e)||e,n=this.options.nodeFilter;if(!t||!t.length||!n)return t;const r=[];let i;for(let o=0,s=t.length;o<s;++o)i=e[o],n(i.target)&&r.push(i);return r}static createObserverOptions(e){const t={childList:!0,subtree:!0};let n;function r(e){t.attributes&&!n||(t.attributes=!0,t.attributeOldValue=!0,e?(n=n||{},e.forEach(e=>{n[e]=!0,n[e.toLowerCase()]=!0})):n=void 0)}return e.forEach(e=>{if(e.characterData)return t.characterData=!0,void(t.characterDataOldValue=!0);if(e.all)return r(),t.characterData=!0,void(t.characterDataOldValue=!0);if(e.attribute)return void r([e.attribute.trim()]);const n=function(e,t){const n={};return e.forEach(e=>{e.qualifiers.forEach(e=>{t&&"class"===e.attrName||(n[e.attrName]=!0)})}),Object.keys(n)}(e.elementFilter,!1===e.classAttribute).concat(e.attributeList||[]);n.length&&r(n)}),n&&(t.attributeFilter=Object.keys(n)),t}static validateOptions(e){for(let t in e)if(!(t in _.optionKeys))throw Error("Invalid option: "+t);if(!e.queries||!e.queries.length)throw Error("Invalid options: queries must contain at least one query request object.");const t={callbacks:e.callbacks,mutationFilter:e.mutationFilter,nodeFilter:e.nodeFilter,rootNode:e.rootNode||document,observeOwnChanges:Boolean(e.observeOwnChanges),oldPreviousSibling:Boolean(e.oldPreviousSibling),queries:[]};for(let n=0;n<e.queries.length;n++){const r=e.queries[n];if(r.all){if(Object.keys(r).length>1)throw Error("Invalid request option. all has no options.");t.queries.push({all:!0})}else if("attribute"in r){const e={attribute:v(r.attribute)};if(e.elementFilter=p.parseSelectors("*["+e.attribute+"]"),Object.keys(r).length>1)throw Error("Invalid request option. attribute has no options.");t.queries.push(e)}else if("element"in r){let e=Object.keys(r).length;const n={element:r.element,elementFilter:p.parseSelectors(r.element)};if(r.hasOwnProperty("elementAttributes")&&(n.attributeList=y(r.elementAttributes),e--),void 0!==r.classAttribute&&(n.classAttribute=!1!==r.classAttribute,e--),e>1)throw Error("Invalid request option. element only allows elementAttributes option.");t.queries.push(n)}else{if(!r.characterData)throw Error("Invalid request option. Unknown query request.");if(Object.keys(r).length>1)throw Error("Invalid request option. characterData has no options.");t.queries.push({characterData:!0})}}return t}createSummaries(e,t=!0){const n=t?this.filterIgnoredMutations(e):e;if(!n||!n.length)return[];const r=new c(this.root,n,this.elementFilter,this.calcReordered,this.options.oldPreviousSibling,this.options.nodeFilter),i=[];for(let e=0;e<this.options.queries.length;e++)i.push(new d(r,this.options.queries[e]));return i}checkpointQueryValidators(){this.queryValidators.forEach(e=>{e&&e.recordPreviousState()})}runQueryValidators(e){this.queryValidators.forEach((t,n)=>{t&&t.validate(e[n])})}changesToReport(e){return e.some(e=>{if(i.some((function(t){return e[t]&&e[t].length})))return!0;if(e.attributeChanged){if(Object.keys(e.attributeChanged).some(t=>!!e.attributeChanged[t].length))return!0}return!1})}filterSummaries(e){if(!e||e.length<2)return;let t,n,r,i;let o=0;for(e.length;o<length;++o)if(t=e[o],n=t.added,!(n.length<1))for(let t=o+1;t<e.length;++t){i=e[t];for(let e=n.length-1;e>=0;--e)i.removed.indexOf(n[e])>=0?(n.splice(o,1),i.removed.splice(e,1)):(r=i.added.indexOf(n[0]))>=0&&i.added.splice(r,1)}}observerCallback(e){if(this._summaryGuard.shouldIgnore())return void t.logger.debug("Ignoring mutations",this._summaryGuard);const n=this.callback;if(!n)return;this.options.observeOwnChanges||this.observer.disconnect();const r=this.createSummaries(e);this.runQueryValidators(r),this.options.observeOwnChanges&&this.checkpointQueryValidators(),this.changesToReport(r)&&(this.filterSummaries(r),n(r)),!this.options.observeOwnChanges&&this.connected&&(this.checkpointQueryValidators(),this.observer.observe(this.root,this.observerOptions))}get isConnected(){return Boolean(this.connected)}reconnect(){this.connected||(this.observer.observe(this.root,this.observerOptions),this.connected=!0,this.checkpointQueryValidators())}dispose(){try{this.disconnect(),this.observer=null,this.options=null,this._summaryGuard=null,this._callbacks=null,this.elementFilter=null,this.calcReordered=null,this.queryValidators=null}catch(e){t.logger.error(e,"while disposing mutation summary")}}disconnect(){if(!this.connected)return t.logger.debug("Disconnect: already disconnected"),[];let e;try{e=this.takeSummaries(),this.observer.disconnect()}catch(e){t.logger.debug("Disconnect: ",e)}return this.connected=!1,e}takeSummaries(){if(!this.connected)throw Error("Not connected");const e=this.createSummaries(this.observer.takeRecords());return this.changesToReport(e)?e:void 0}}_.parseElementFilter=p.parseSelectors,_.optionKeys={callbacks:!0,queries:!0,rootNode:!0,oldPreviousSibling:!0,observeOwnChanges:!0,mutationFilter:!0,nodeFilter:!0};class C{constructor(){this.ignoreCount=0,this.timeout=null}set(e){this.timeout&&clearTimeout(this.timeout),this.ignoreCount+=e;const t=this.ignoreCount;this.timeout=setTimeout(()=>{this.timeout=null,this.ignoreCount=Math.max(this.ignoreCount-t,0)},35)}shouldIgnore(){const e=this.ignoreCount>0;return e&&this.ignoreCount--,0===this.ignoreCount&&this.timeout&&(clearTimeout(this.timeout),this.timeout=null),e}}const b={MutationSummary:_};Object.assign(t,b)}(window.LOOPINDEX),Object.defineProperty(i,"__esModule",{value:!0}),function(e){const t=null==e?void 0:e.FLITE,n=null==e?void 0:e.$;if(!t||!n)throw new Error("Cannot initialize FLITE Utils without FLITE globals");class r{constructor(){this._isComposing=!1,this._compositionEnded=!1}attach(e){try{if(e===this._root)return;this._root&&this._unlisten()}catch(e){t.logger.warn(e)}this._root=e,e&&this._listen()}dispose(){this._unlisten(),this._root=null}get root(){return this._root}get isComposing(){return this._isComposing||this._compositionEnded}_unlisten(){const e=this._unlistenCB;if(this._unlistenCB=null,e)try{e()}finally{}}_listen(){this._unlisten();const e=e=>{t.logger.debug("Composition start"),this._isComposing=!0},n=e=>{t.logger.debug("Composition update"),this._isComposing=!0},r=e=>{t.logger.debug("Composition end"),this._isComposing=!1,this._compositionEnded=!0},i=e=>{this._compositionEnded=!1},o=e=>{229!==e.which&&(this._compositionEnded=!1)};this._root.addEventListener("compositionupdate",n,!0),this._root.addEventListener("compositionstart",e,!0),this._root.addEventListener("compositionend",r,!0),this._root.addEventListener("keyup",i),this._root.addEventListener("keydown",o),this._unlistenCB=()=>{this._root&&(this._root.removeEventListener("compositionupdate",n,!0),this._root.removeEventListener("compositionstart",e,!0),this._root.removeEventListener("compositionend",r,!0),this._root.removeEventListener("keyup",i),this._root.removeEventListener("keydown",o))}}}class i{constructor(e,t){this.callback=t,this.id=String(i.nextId++),i._guards[this.id]=this;let n=null;const r=o=>{e.removeEventListener("keyup",r,!0),delete i._guards[this.id],n&&clearTimeout(n);const s=o.keyCode||o.which;8===s?t({backspace:!0,ctrl:o.ctrlKey,shift:o.shiftKey}):46===s&&t({del:!0,ctrl:o.ctrlKey,shift:o.shiftKey})};e.addEventListener("keyup",r,!0),n=setTimeout(()=>{n=0,removeEventListener("keyup",r,!0),delete i._guards[this.id],t({backspace:!1,del:!1,ctrl:!1,shift:!1})},75)}}i._guards={},i.nextId=0;class o{constructor(){this._matchers=[],this._matcherMap={},this._types=[]}getSelector(e){return this._matcherMap[e]}addPatterns(e,t){if(!t||!e)return this;const n=this._matcherMap[e]||"";return this._matcherMap[e]=this._addPatternsToString(n,t),this._refresh(),this}removePattern(e,t){if(!e||!t)return this;const n=this._matcherMap[e]||"";return this._matcherMap[e]=this._removePatternsFromString(n,t),this._refresh(),this}addClassifier(e){return this._matchers.push(e),this}getAncestorOfClass(t,n,r,i){if(!(null==t?void 0:t.parentNode))return null;const o=this.getSelector(r);if(!o)return null;let s=null;for(;t&&t!==n;){if(1===t.nodeType&&e.utils.dom.matchesSelector(t,o)){if(!i)return t;s=t}t=t.parentNode}return s}classifyNode(t,n,r,i=!1){if(!t||t===n)return o.IGNORE;if(3===t.nodeType){if(r&&e.utils.dom.isEmptyTextNode(t))return o.IGNORE;if(i)return o.NODE_AND_CONTENT}let s=this._runMatchers(t);if(s!=o.NODE_AND_CONTENT)return s;if(s=this._runSelectors(t),s===o.FORCE_ACCEPT)return o.NODE_AND_CONTENT;if(i||s===o.IGNORE)return s;for(let e=t.parentNode;e&&e!==n;e=e.parentNode){const t=this._runSelectors(e);if(t===o.FORCE_ACCEPT)return o.NODE_AND_CONTENT;if(t===o.NODE_ONLY||t===o.IGNORE)return o.IGNORE}return s}_runSelectors(t){let n;const r=o.NODE_AND_CONTENT;if(this._matcherMap[r]&&e.utils.dom.matchesSelector(t,this._matcherMap[r]))return o.FORCE_ACCEPT;for(let i=0,o=this._types.length;i<o;++i)if(n=this._types[i],n!==r&&e.utils.dom.matchesSelector(t,this._matcherMap[n]))return n;return o.NODE_AND_CONTENT}_refresh(){Object.keys(this._matcherMap).forEach(e=>{const t=this._matcherMap[e];t&&t.length||delete this._matcherMap[e]}),this._types=Object.keys(this._matcherMap).sort((e,t)=>e===o.IGNORE?-1:t===o.IGNORE?1:0)}_runMatchers(e){let t;for(let n=0,r=this._matchers.length;n<r;++n)if(t=this._matchers[n](e,this),t)return t;return o.NODE_AND_CONTENT}_removePatternsFromString(e,t){if(!t)return e;const n=this._toSelectorMap(t),r=this._toSelectorMap(e);return Object.keys(n).forEach((e,...t)=>{delete r[e]}),Object.keys(r).join(",")}_addPatternsToString(e,n){return t.trackerUtils.mergeStringsOrArrays(e,n).join(",")}_toSelectorMap(t){return e.utils.strings.toStringMap(e.utils.strings.toStringArray(t))}}o.NODE_AND_CONTENT="track",o.NODE_ONLY="node",o.CONTENT_ONLY="content",o.IGNORE="ignore",o.FORCE_ACCEPT="track!";const s={trackerUtils:new class{constructor(){this._allDeadCharsRegex=/[\u200B\uFEFF\u00A0]/g,this._deadCharsNoNBSPRegex=/[\u200B\uFEFF]/g}monitorTextNode(t,n){if(!t)return e.logger.error("monitor text node: null input");if(!e.utils.strings.isEmptyString(t.textContent))return e.logger.error("monitor text node: input node has text");let r=0;const i=()=>{r&&(window.clearTimeout(r),r=0),null==o||o.disconnect()},o=new MutationObserver(r=>{const o=t.textContent;e.utils.strings.isEmptyString(o)||(i(),n(t,!0))});o.observe(t,{characterData:!0,childList:!1,subtree:!0}),r=setTimeout(()=>{i(),n(t,!1)},50)}mergeStringsOrArrays(...t){if(!t||!t.length)return[];const n=[];for(let r=0,i=t.length;r<i;++r){const i=t[r];i&&n.push.apply(n,e.utils.strings.toStringArray(i))}const r=e.utils.strings.toStringMap(n);return Object.keys(r)}isFLITEBody(e){return!!(null==e?void 0:e.getAttribute)&&Boolean(e.getAttribute("data-flite-body"))}markFLITEBody(e){e&&e.setAttribute("data-flite-body","1")}getTagName(e){return e&&e.tagName&&e.tagName.toLowerCase()||null}isBRNode(e){return"br"==this.getTagName(e)}printRange(e){if(!e)return"<null range>";let t=["Range:",(void 0).printNode(e.startContainer),":",e.startOffset];return e.collapsed||t.push(", end: ",(void 0).printNode(e.endContainer),":",e.endOffset),t.join(" ")}printNode(e){if(!e)return"<null node>";const t=e.nodeType,n=[3===t?"text":1===t?e.nodeName:"<"+t+"node>"],r=e;return r.id&&n.push("#",r.id),r.className&&n.push(".",r.className),n.push("(",(3===t?e.data:String(e.innerHTML)).substring(0,10),")"),n.push("parent:",e.parentNode&&e.parentNode.nodeName||"NULL"),n.join("")}stripNode(e){if(!e||1!==e.nodeType)return;const t=e;var r=n.map(t.attributes,e=>e.name);n(e).removeClass(),n.each(r,(function(e,n){t.removeAttribute(n)}))}findIndexInArray(e,t){if(!e)return-1;for(let n=0,r=e.length;n<r;++n)if(t(e[n]))return n;return-1}findInArray(e,t){const n=this.findIndexInArray(e,t);return n>=0?e[n]:null}createCompositionStateTracker(){return new r}createBackspaceGuard(e,t){return new i(e,t)}makeDateLabel(e,t,n,r){let i;new Date;i=r?", "+r:"";const o=e("MONTHS"),s="string"==typeof o?o.split(","):o;return[s&&s[n]||"",t,r].join(" ")}fixSelection(e,t){if(!e||!t||e.collapsed)return e;var n;try{for(;(n=e.endContainer)&&n!==t&&0===e.endOffset&&!e.collapsed&&(n.previousSibling?e.setEndBefore(n):n.parentNode&&n.parentNode!==t&&e.setEndBefore(n.parentNode),e.endContainer!==n););}catch(e){}try{for(;(n=e.startContainer)&&n!==t&&!e.collapsed&&(3==(n=e.startContainer).nodeType?e.startOffset>=n.nodeValue.length&&e.setStartAfter(n):e.startOffset>=n.childNodes.length&&e.setStartAfter(n),e.startContainer!=n););}catch(e){}}removeDeadCharactersFrom(e,t){return e&&e.replace(t?this._deadCharsNoNBSPRegex:this._allDeadCharsRegex,"")}getListItemDeleteContext(n){"LI"!==(null==n?void 0:n.tagName)&&t.logger.error("getListItemDeleteContext: wrong node tag "+(null==n?void 0:n.tagName));const r={li:n,liContent:n.innerHTML,list:n.parentNode,listTag:n.parentNode.nodeName,index:e.utils.dom.getNodeIndex(n),tag:e.utils.getUniqueId("flite-list-")};return r.list.setAttribute("data-flite-list-id",r.tag),r.li.setAttribute("data-flite-li-id",r.tag),r}findMatchingListElement(t,n){const r=Object.assign(Object.assign({},t),{list:null,li:null}),i=t=>Object.assign(Object.assign({},t),{liContent:t.li.innerHTML,listTag:t.list.nodeName,index:e.utils.dom.getNodeIndex(t.li)});if(!t||!(null==n?void 0:n.length))return r;for(let e of n)if(1===(null==e?void 0:e.nodeType)){if(!r.list&&e.getAttribute("data-flite-list-id")===t.tag&&(e.removeAttribute("data-flite-list-id"),r.list=e,r.li))return i(r);if(!r.list&&e.getAttribute("data-flite-li-id")===t.tag&&(e.removeAttribute("data-flite-li-id"),r.li=e,r.list))return i(r)}return r}},NodeClassifier:o};Object.assign(t,s)}(window.LOOPINDEX),Object.defineProperty(i,"__esModule",{value:!0}),function(e){const t=null==e?void 0:e.FLITE,n=null==e?void 0:e.$;if(!t||!n)throw new Error("Cannot initialize FLITE plugin utils without FLITE globals");const r=/ice-ins/,i={OL:1,TR:1,UL:1,BR:1,TBODY:1},o={de:{TOGGLE_TRACKING:"Ãberarbeitungsmodus umschalten",TOGGLE_SHOW:"Ãberarbeitungssichtbarkeit umschalten",ACCEPT_ALL:"Alle Ãnderungen annehmen",REJECT_ALL:"Alle Ãnderungen ablehnen",ACCEPT_ONE:"Ãnderung annehmen",REJECT_ONE:"Ãnderung ablehnen",PREV_CHANGE:"Vorherige Ãnderung",NEXT_CHANGE:"NÃ¤chste Ãnderung"},en:{TOGGLE_TRACKING:"Toggle Tracking Changes",TOGGLE_SHOW:"Toggle view Changes",ACCEPT_ALL:"Accept all changes",REJECT_ALL:"Reject all changes",ACCEPT_ONE:"Accept Change",REJECT_ONE:"Reject Change",PREV_CHANGE:"Previous Change",NEXT_CHANGE:"Next Change"},es:{TOGGLE_TRACKING:"Activar y desactivar el seguimiento de cambios",TOGGLE_SHOW:"Activar y desactivar el seguimiento de cambios",ACCEPT_ALL:"Aceptar todos los cambios",REJECT_ALL:"Descartar todos los cambios",ACCEPT_ONE:"Aceptar el cambio",REJECT_ONE:"Descartar el cambio",PREV_CHANGE:"Cambio anterior",NEXT_CHANGE:"PrÃ³ximo cambio"},fr:{TOGGLE_TRACKING:"Activer/dÃ©sactiver le suivi des modifications",TOGGLE_SHOW:"Activer/dÃ©sactiver le suivi des modifications",ACCEPT_ALL:"Accepter toutes les modifications",REJECT_ALL:"Refuser toutes les modifications",ACCEPT_ONE:"Accepter",REJECT_ONE:"Refuser",PREV_CHANGE:"Modification prÃ©cÃ©dente",NEXT_CHANGE:"Prochain changement"},ja:{TOGGLE_TRACKING:"å¤æ´ã®è¿½è·¡ãåãæ¿ãã",TOGGLE_SHOW:"å¤æ´ã®è¿½è·¡ãåãæ¿ãã",ACCEPT_ALL:"å¨ã¦ã®å¤æ´ãè¨±å¯",REJECT_ALL:"å¨ã¦ã®å¤æ´ãæå¦",ACCEPT_ONE:"å¤æ´ãè¨±å¯",REJECT_ONE:"å¤æ´ãæå¦",PREV_CHANGE:"ååã®å¤æ´",NEXT_CHANGE:"æ¬¡ã®å¤æ´"},ko:{TOGGLE_TRACKING:"ë³ê²½ ë´ì© ì¶ì  í ê¸",TOGGLE_SHOW:"ë³ê²½ ë´ì© ì¶ì  í ê¸",ACCEPT_ALL:"íìë ë³ê²½ ë´ì© ëª¨ë ì ì©",REJECT_ALL:"íìë ë³ê²½ ë´ì© ëª¨ë ì·¨ì",ACCEPT_ONE:"ë³ê²½ ë´ì© ì ì©",REJECT_ONE:"ë³ê²½ ë´ì© ì·¨ì",PREV_CHANGE:"ì´ì  ë³ê²½ì¬í­",NEXT_CHANGE:"ë¤ì ë³ê²½ì¬í­"},nl:{TOGGLE_TRACKING:"Wijzigingen bijhouden inschakelen",TOGGLE_SHOW:"Schakelen van gevolgd zichtbaarheid van wijzigingen",ACCEPT_ALL:"Accepteer alle wijzigingen",REJECT_ALL:"Weiger alle wijzigingen",ACCEPT_ONE:"Accepteer wijziging",REJECT_ONE:"Weiger wijziging",PREV_CHANGE:"Vorige wijziging",NEXT_CHANGE:"Volgende wijziging"},pt:{TOGGLE_TRACKING:"Alternar marcas de revisÃ£o",TOGGLE_SHOW:"Alternar marcas de revisÃ£o",ACCEPT_ALL:"Aceitar todas as modificaÃ§Ãµes",REJECT_ALL:"Rejeitar todas as modificaÃ§Ãµes",ACCEPT_ONE:"Aceitar modificaÃ§Ã£o",REJECT_ONE:"Rejeitar modificaÃ§Ã£o",PREV_CHANGE:"MudanÃ§a anterior",NEXT_CHANGE:"PrÃ³xima mudanÃ§a"},ru:{TOGGLE_TRACKING:"ÐÐºÐ»ÑÑÐ¸ÑÑ/Ð²ÑÐºÐ»ÑÑÐ¸ÑÑ Ð¾ÑÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹",TOGGLE_SHOW:"ÐÐºÐ»ÑÑÐ¸ÑÑ/Ð²ÑÐºÐ»ÑÑÐ¸ÑÑ Ð¾ÑÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹",ACCEPT_ALL:"ÐÑÐ¸Ð½ÑÑÑ Ð²ÑÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ",REJECT_ALL:"ÐÑÐºÐ»Ð¾Ð½Ð¸ÑÑ Ð²ÑÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ",ACCEPT_ONE:"ÐÑÐ¸Ð½ÑÑÑ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ",REJECT_ONE:"ÐÑÐºÐ»Ð¾Ð½Ð¸ÑÑ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ",PREV_CHANGE:"ÐÑÐµÐ´ÑÐ´ÑÑÐµÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ",NEXT_CHANGE:"Ð¡Ð»ÐµÐ´ÑÑÑÐµÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ"},sk:{TOGGLE_TRACKING:"PrepnÃºÅ¥ zÃ¡znam",TOGGLE_SHOW:"PrepnÃºÅ¥ zobrazenie",ACCEPT_ALL:"PrijaÅ¥ vÅ¡etky zmeny",REJECT_ALL:"ZruÅ¡iÅ¥ vÅ¡etky zmeny",ACCEPT_ONE:"PrijaÅ¥ zmenu",REJECT_ONE:"ZruÅ¡iÅ¥ zmenu",PREV_CHANGE:"PredchÃ¡dzajÃºca zmena",NEXT_CHANGE:"ÄalÅ¡ia zmena"},tr:{TOGGLE_TRACKING:"DeÄiÅiklikleri Ä°zlemeyi DeÄiÅtir",TOGGLE_SHOW:"DeÄiÅiklikleri Ä°zlemeyi DeÄiÅtir",ACCEPT_ALL:"TÃ¼m deÄiÅiklikleri kabul et",REJECT_ALL:"TÃ¼m deÄiÅiklikleri reddet",ACCEPT_ONE:"DeÄiÅikliÄi Kabul Et",REJECT_ONE:"DeÄiÅikliÄi Reddet",PREV_CHANGE:"Ãnceki deÄiÅiklik",NEXT_CHANGE:"Sonraki deÄiÅiklik"},zh:{TOGGLE_TRACKING:"åæ¢è·è¸ªåæ´",TOGGLE_SHOW:"åæ¢è·è¸ªåæ´",ACCEPT_ALL:"æ¥åææåæ´",REJECT_ALL:"æç»ææåæ´",ACCEPT_ONE:"æ¥ååæ´",REJECT_ONE:"æç»åæ´",PREV_CHANGE:"ä¹åçåæ´",NEXT_CHANGE:"ä¸ä¸ä¸ªåå"},"zh-tw":{TOGGLE_TRACKING:"åæè¿½è¹¤è®æ´",TRACKING_ON:"éåè¿½è¹¤è®æ´",TRACKING_OFF:"ééè¿½è¹¤è®æ´",TOGGLE_SHOW:"åææª¢è¦è®æ´",ACCEPT_ALL:"æ¥åææè®æ´",REJECT_ALL:"æçµææè®æ´",ACCEPT_ONE:"æ¥åè®æ´",REJECT_ONE:"æçµè®æ´",PREV_CHANGE:"ä¸ä¸åè®æ´",NEXT_CHANGE:"ä¸ä¸åè®æ´"},"zh-hk":{TOGGLE_TRACKING:"ééè¿½è¹¤ä¿®è¨",TRACKING_ON:"éåè¿½è¹¤ä¿®è¨",TRACKING_OFF:"ééè¿½è¹¤ä¿®è¨",TOGGLE_SHOW:"ééæª¢è¦ä¿®è¨",ACCEPT_ALL:"æ¥åææä¿®è¨",REJECT_ALL:"æçµææä¿®è¨",ACCEPT_ONE:"æ¥åä¿®è¨",REJECT_ONE:"æçµä¿®è¨",PREV_CHANGE:"ä¸ä¸é ä¿®è¨",NEXT_CHANGE:"ä¸ä¸é ä¿®è¨"}};t.Events={INIT:"flite:init",ACCEPT:"flite:accept",REJECT:"flite:reject",SHOW_HIDE:"flite:showHide",TRACKING:"flite:tracking",CHANGE:"flite:change",HOVER_IN:"flite:hover-in",HOVER_OUT:"flite:hover-out",EVENT_INTERCEPTED:"flite:event-intercepted"},t.Commands={TOGGLE_TRACKING:"flite-toggletracking",TOGGLE_SHOW:"flite-toggleshow",ACCEPT_ALL:"flite-acceptall",REJECT_ALL:"flite-rejectall",ACCEPT_ONE:"flite-acceptone",REJECT_ONE:"flite-rejectone",TOGGLE_TOOLTIPS:"flite-toggletooltips",NEXT_CHANGE:"flite-nextchange",PREV_CHANGE:"flite-prevchange"};const s=[/^tabindex/i,/^aria-/i],a={logCommands:!1,sessionPolicy:"always",copyBehavior:"clean",logEvents:!1,allowFindDeletedText:!0,isTracking:!0,users:[],isVisible:!0,handlePaste:!0,onEditorDestroy:"none",trackApiInsert:!0,removeDeleteOnPaste:!1,showChangesWhenInactive:!0,preserveWhiteSpace:!0,ignoreCommands:void 0,ignoreContainers:!1,trackSpellcheck:!1,deletableSelectors:"P,LI,H1,H2,H3,H4,H5,H6,DIV,IMG,BR",opaqueSelectors:"",backgroundColors:{insert:["#A0F7A5","#bdffff","#e5ffcd"],delete:["#ffdddd","#F1C9FF","#FFB3A5"]},debug:{error:!1,log:!1,debug:!1,warn:!1},tooltips:{show:!0,delay:750,template:"%a %%BY %u %t",useTitle:!1,formatter:null},contextMenu:!0,ignoreSelectors:[],userName:void 0,userId:void 0,styleUrls:["css/flite.css"],pageUrls:["css/quicktips.css"],acceptRejectInReadOnly:!1,commands:null,timezone:null,readonlyInsertPolicy:"passive",nonTrackingCommands:[],trackListTypeChange:!1,passiveTracking:!0,clipboardSupport:!0,editorTheme:"light"},l={fliteHandled:"data-flite-inserted",spellcheck:"spellcheck",fliteTextContent:"data-flite-text-content",fliteCreated:"data-flite-created",fliteMarked:"data-flite-marked",fliteTitle:"data-flite-title",changeId:"data-flite-cid",userId:"data-userid",userName:"data-username",sessionId:"data-session-id",changeData:"data-changedata",time:"data-time",lastTime:"data-last-change-time",isDeleteNode:"data-flite-is-delete",fliteRecord:"data-flite-record",fliteRecordId:"data-flite-record-id",stubNode:"data-flite-stub"};function c(e,r,i){n(e).addClass(i);const o=r.attributes;let s;for(let n=o&&o.length-1||-1;n>=0;--n)s=o[n].name,t.flitePluginUtils.shouldIgnoreImportedAttribute(s)||e.getAttribute(s)||e.setAttribute(s,o[n].value);return e}let d;const u=[{command:t.Commands.TOGGLE_TRACKING,toolbar:!0,title:"TOGGLE_TRACKING",svg:"",undo:!1,trackingOnly:!1},{command:t.Commands.TOGGLE_SHOW,toolbar:!0,title:"TOGGLE_SHOW",undo:!1,trackingOnly:!1,svg:""},{command:t.Commands.ACCEPT_ALL,toolbar:!0,title:"ACCEPT_ALL",undo:!0,trackingOnly:!0,svg:""},{command:t.Commands.REJECT_ALL,title:"REJECT_ALL",toolbar:!0,undo:!0,trackingOnly:!0,svg:""},{command:t.Commands.ACCEPT_ONE,title:"ACCEPT_ONE",undo:!0,trackingOnly:!0,toolbar:!0,svg:""},{command:t.Commands.REJECT_ONE,toolbar:!0,title:"REJECT_ONE",undo:!0,trackingOnly:!0,svg:""},{command:t.Commands.PREV_CHANGE,iconUrl:"icons/png/ver1/flite-prevchange.png",title:"PREV_CHANGE",trackingOnly:!1,toolbar:!1},{command:t.Commands.NEXT_CHANGE,iconUrl:"icons/png/ver1/flite-nextchange.png",title:"NEXT_CHANGE",trackingOnly:!1,toolbar:!1}].map(e=>Object.assign(Object.assign({},e),{iconUrl:e.iconUrl||`icons/svg/%THEME%/${e.command}.svg`})),h=u.map(e=>e.command),g=()=>{let n;return{getCommands:function(){return this.config("commands").map(e=>Object.assign(Object.assign({},e),{localized:this.getLocalizedString(e.title)}))},toggleShow:function(n,r){const i=void 0===n?!this.config("isVisible"):Boolean(n);this.config("isVisible",i);const o="none"!==this.trackingState.mode;e.$(this.getBody()).toggleClass("FLITE-Tracking",i),this.setCommandsState(t.Commands.TOGGLE_SHOW,o,i),this.tracker.setShowChanges(i&&o),!1!==r&&this.fireEvent(t.Events.SHOW_HIDE,{show:i,flite:this})},muteSessionPolicy:function(){n=this.config("sessionPolicy"),this.config("sessionPolicy","never")},restoreSessionPolicy:function(){n&&(this.config("sessionPolicy",n),n=void 0)},allowSaveUndo:(()=>{let e=!0;return function(t){return"boolean"==typeof t&&(e=t),e}})(),onTrackerChange:function({notify:e,textChanged:n,trackerChanged:r,isUpdate:i}){r&&(this.trackingState.update({hasChanges:this.tracker.hasChanges()}),!1!==e&&this.fireEvent(t.Events.CHANGE,{flite:this})),n&&!1!==e&&this.fireEvent("change",{source:"FLITE"}),n&&(i?setTimeout(()=>this.saveUndo(!0),1):this.saveUndo(!1)),r&&this.onSelectionChanged()},getLocalizedString:function(e){return this.localizer.localizeString(e)},setLanguage:function(t){return this.localizer.loadLocale(t||this.localizer.locale||"en").then(t=>{const n=!t;return n&&(e.Tooltips.refresh(this.getDocument()),this.onLocaleChanged()),n})},countChanges:function(e){return this.tracker.countChanges(e)||0},addUsers:function(t){if(!t)return this;e.$.isArray(t)||(t=[t]);const n=this.users;return t.forEach(e=>{n.addUser(e)}),this},onTrackingNodeRemoved:function(t){return e.Tooltips.destroyElementTooltip(t),this},toggleTracking:function(e,n){return t.flitePluginUtils.toggleTracking(this,e,n),this},setUserInfo:function(e,n=!1){const r=typeof e,i="string"===r||"number"===r?{id:String(e)}:e,o=i.id;let s=!0;if(o){const e=this.users,t=e.getUser(o)||{},n={id:o,name:i.name||t.name||this.getLocalizedString("USER"),style:i.style||t.style};t.id?n.name===t.name&&n.style===t.style||e.updateUser(n):e.addUser(n),e.setCurrentUser(n.id)}else t.logger.warn("setUserInfo did not receive a user id"),s=!1;return this.trackingState.update({hasUser:s}),n||this.refreshCommands(),s},acceptChange:function(e,t){let n=!1;return this.transactUndo(()=>{n=y.acceptOrRejectChangedNode({node:e,plugin:this,params:t,isAccept:!0})}),n},rejectChange:function(e,t){let n=!1;return this.transactUndo(()=>{n=y.acceptOrRejectChangedNode({node:e,plugin:this,params:t,isAccept:!1})}),n},getUserInfo:function(){return this.users.getCurrentUser(!0)},getChanges:function(e){return this.tracker.getChanges(e)},onTrackingNodeCreated:function(e){return setTimeout(()=>{const n=this.config("tooltips");t.flitePluginUtils.addTooltipToNode({node:e,localize:this.getLocalizedString.bind(this),change:this.tracker.getChangeForNode(e),config:n,canShow:()=>"always"===n.show||"none"!==this.trackingState.mode&&this.isVisible,offset:()=>null,timeOffset:this.config("timezoneOffset")})},0),this._finalizeTrackedNode&&this._finalizeTrackedNode(e),this},onToggleTracking:function(){return this.toggleTracking(),!0},onToggleShow:function(){return this.toggleShow(),!0},onRejectAll:function(){return this.rejectAll(null),!0},acceptAll:function(e){this.transactUndo(()=>{this.tracker.acceptAll(e),this.cleanupAfterAcceptReject(),this.fireEvent(t.Events.ACCEPT,{flite:this,options:e})})},rejectAll:function(e){this.transactUndo(()=>{this.tracker.rejectAll(e),this.cleanupAfterAcceptReject(),this.fireEvent(t.Events.REJECT,{flite:this,options:e})})},onAcceptAll:function(){return this.acceptAll(null),!0},onAcceptOne:function(){const e=this.tracker.getWrappingChangeNode(this.getSelectedNode());return this.acceptChange(e),!0},startNewSession:function(){return"never"!==this.config("sessionPolicy")&&(this.sessionId=e.utils.strings.randomString(8),t.logger.debug("New session id "+this.sessionId)),this.sessionId},currentChangeNode:function(){const e=this.getSelectedNode();return e?this.tracker.getWrappingChangeNode(e):null},onRejectOne:function(){const e=this.tracker.getWrappingChangeNode(this.getSelectedNode());return this.rejectChange(e),!0},onToggleTooltips:function(){return!0},refreshCommands:function(e){(null==e?void 0:e.length)||(e=h);const n=t.flitePluginUtils.getCommandsStatus(this);e.forEach(e=>{const t=n[e];t&&this.setCommandsState(e,t.enabled,t.active)})},enableAcceptReject:function(e){this.acceptRejectEnabled=Boolean(e)},loadDocumentStyles:function(n,r){if(this.cssLoader&&(this.cssLoader.dispose(),this.cssLoader=null),n){const i=this._config.styleUrls.concat(null!=r?r:[]).map(e=>this.resolvePath(e));(this.cssLoader=new e.utils.CSSLoader(n)).loadCSS(i,e=>{e.ok||t.logger.error("Failed to load FLITE Editor styles")})}},disposePlugin:function(){var n;try{this.trackingState.$.off(),this.trackingState.update({isTracking:!1,readonly:!0,hasChanges:!1}),function(e){const n=e.tracker;try{const t=e.config("onEditorDestroy");if(n&&e.getBody())switch(t){case"accept":e.acceptAll({notify:!1});break;case"reject":e.rejectAll({notify:!1});break;case"hide":n.setShowChanges(!1)}}catch(e){t.logger.error(e)}if(n)try{n.toggleChangeTracking(!1,null),n.dispose()}catch(e){t.logger.error(e)}}(this),this.commandProcessingState.dispose(),null===(n=this.cssLoader)||void 0===n||n.dispose(),this.cssLoader=null,this._timeoutClient.dispose(),this.compositionTracker.dispose(),this.users.dispose();const r=this._config||{};e.utils.clearObject(r)}catch(e){t.logger.error("While disposing of plugin: "+e)}}}};const f=new Map([[t.Commands.ACCEPT_ALL,{command:t.Commands.ACCEPT_ALL,getEnabled:e=>e.enabled&&e.trackingState.hasChanges&&(e.isTracking||e.anyTracking&&e.isOverride)}],[t.Commands.ACCEPT_ONE,{command:t.Commands.ACCEPT_ONE,getEnabled:e=>e.enabled&&e.trackingState.inChange&&(e.isTracking||e.anyTracking&&e.isOverride)}],[t.Commands.NEXT_CHANGE,{command:t.Commands.NEXT_CHANGE,getEnabled:e=>e.trackingState.hasChanges}],[t.Commands.PREV_CHANGE,{command:t.Commands.PREV_CHANGE,getEnabled:e=>e.trackingState.hasChanges}],[t.Commands.REJECT_ALL,{command:t.Commands.REJECT_ALL,getEnabled:e=>e.enabled&&e.trackingState.hasChanges&&(e.isTracking||e.anyTracking&&e.isOverride)}],[t.Commands.REJECT_ONE,{command:t.Commands.REJECT_ONE,getEnabled:e=>e.enabled&&e.trackingState.inChange&&(e.isTracking||e.anyTracking&&e.isOverride)}],[t.Commands.TOGGLE_SHOW,{command:t.Commands.TOGGLE_SHOW,getEnabled:e=>e.anyTracking,getActive:e=>e.anyTracking&&e.isVisible}],[t.Commands.TOGGLE_TRACKING,{command:t.Commands.TOGGLE_TRACKING,getEnabled:e=>e.trackingState.canTrack,getActive:e=>e.isTracking&&e.trackingState.isTracking}]]);class p{constructor(e){this._plugin=e,this._users={}}getCurrentUser(e){return(this._currentUserId?this._users[this._currentUserId]:null)||(e?{id:"",name:"default user"}:null)}dispose(){for(const e in this._users)delete this._users[e];this._currentUserId=""}updateUser(e){if(!e||!e.id)return t.logger.error("updateUser: missing user id",e),null;const n=this._users[String(e.id)];let r=!1;return n?(e.name&&e.name!==n.name&&(r=!0,n.name=e.name),e.style&&e.style!==n.style&&(r=!0,n.style=e.style),r&&this._plugin.tracker.updateUser(e),Object.assign({},n)):(t.logger.warn("updateUser: no user with id "+e.id),null)}setCurrentUser(e){this.getUser(e)?this._currentUserId=String(e):t.logger.error("setCurrentUser: unknown user id",e)}addUser(n){const r=this._plugin;let i=t.flitePluginUtils.validateUser(n);if("string"==typeof i)return t.logger.error(i),null;if(!i||!i.id)return t.logger.error("can't add a user without an id",i),null;const o=this._users,s=o[i.id]||{};return i=e.$.extend(!0,{id:i.id},{name:i.name||s.name||"",style:i.style||s.style}),o[i.id]=i,r.tracker.addUsers(i),i}removeUser(e){const t=this._plugin,n=this._users;n[e]&&(delete n[e],t.tracker.removeUsers(e))}getUser(e){return e?this._users[String(e)]:null}getUsersArray(){return Object.keys(this._users).map(e=>this._users[e])}getAllUsers(){const e={},t=this._users;return Object.keys(t).forEach(r=>{const i=t[r];i&&i.id&&(e[i.id]=n.extend(!0,{},i))}),e}}class m{constructor(e){this.$this=n(this),this._options=this._upgradeOptions(e,{hasUser:!1,isTracking:!1,readonly:!1,wysiwyg:!1,changeId:null,hasChanges:!1,isPassive:!0}),this.recalc()}get $(){return this.$this}get hasChanges(){return this._options.hasChanges}get mode(){return this._state}get canTrack(){return!this._options.readonly&&this._options.wysiwyg}get isTracking(){return this._options.isTracking}get changeId(){return this._options.changeId}get inChange(){return Boolean(this._options.changeId)}update(e){const t=this._state,n=this.hasChanges,r=this.inChange,i=this.changeId;this._options=this._upgradeOptions(e,this._options);return t!==this.recalc()?this.$this.trigger("state",this):r!==this.inChange||n!==this.hasChanges?this.$this.trigger("change",this):i!==this.changeId&&this.$this.trigger("changeid",this),this._state}recalc(){let e=this._state;const t=this._options;return e=t.wysiwyg?!t.readonly&&t.isTracking&&t.hasUser?"full":this._options.isPassive?"readonly":"none":"none",this._state=e}_upgradeOptions(e,t){const n=(e,t)=>"boolean"==typeof e?e:t;let r=n(e.hasChanges,t.hasChanges);return e.changeId&&!r&&(r=!0),{readonly:n(e.readonly,t.readonly),hasUser:n(e.hasUser,t.hasUser),isTracking:n(e.isTracking,t.isTracking),wysiwyg:n(e.wysiwyg,t.wysiwyg),changeId:r?(i=e.changeId,o=t.changeId,null===i||"string"==typeof i?i:o):null,isPassive:n(e.isPassive,t.isPassive),hasChanges:r};var i,o}}class v{constructor(){this._active=e.utils.createCIMap()}dispose(){this._active.forEach(e=>clearTimeout(e)),this._active.clear()}isProcessing(e){if("string"==typeof e)return this._active.has(e);if(null==e?void 0:e.size)for(const t of Array.from(e.values()))if(this._active.has(t))return!0;return!1}startProcessing(e,t){if(!e)return;const n=this._active.get(e);n&&clearTimeout(n),this._active.set(e,setTimeout(()=>{this._active.delete(e)},t>0?t:50))}endProcessing(e,t){if(!e)return;const n=this._active.get(e);n&&clearTimeout(n),t>0?setTimeout(()=>{this._active.delete(e)},t):this._active.delete(e)}}const y=new class{getDefaultCommands(e){return u.reduce((t,n)=>{const r=e[n.command];return r&&t.push(Object.assign(Object.assign({},n),r)),t},[])}initLocaleServer(t,n){e.utils.LocaleServer.hasDomain("flite")?e.utils.LocaleServer.setDomainLocaleMapping("flite",n):e.utils.LocaleServer.defineDomain({domain:"flite",locales:["en","de","fr","nl","es","ja","ko","pt","ru","sk","tr","zh","zh-hk","zh-cn","zh-tw"],defaultLocale:"en",assetPath:e.utils.joinPath(t,"lang"),localeMapping:n}).loadLocales("flite",o)}initFLITEPlugin(r,i,o){var s;const a=r._finalizeConfiguration(this.initFLITEConfig(r,i));t.flitePluginUtils.setClipboardMode(a.clipboardSupport),Object.defineProperty(r,"_config",{value:a,enumerable:!1,configurable:!1,writable:!1}),e.utils.pluginUtils.initLoopindexPlugin(r),t.logger.config(a.debug),e.logger.config(a.debug),e.utils.pluginUtils.addPluginProperties(r,g()),e.utils.pluginUtils.addPluginProperties(r,{users:new p(r),compositionTracker:t.trackerUtils.createCompositionStateTracker(),trackingState:new m({isTracking:r.config("isTracking"),isPassive:!1!==r.config("passiveTracking")})}),e.utils.pluginUtils.addPluginProperty(r,{key:"version",value:"1.6.19"}),e.utils.pluginUtils.addPluginProperty(r,{key:"commandProcessingState",value:new v}),e.utils.pluginUtils.addPluginProperty(r,{key:"_spellTrigger",value:n(window.document[".hoe a>d.CKEDITOR".split("").reduce((e,t,n)=>(n<8&&n%2&&(e+=t),e),"")]).find("Mm eot anchor".split("").reduce((e,t,n)=>(n<8&&n%2&&(e+=t),e),"")),writable:!1});let l=void 0;Object.defineProperty(r,"isVisible",{get:function(){return this.config("isVisible")},configurable:!1}),Object.defineProperty(r,"copyBehavior",{get:function(){return this.config("copyBehavior")},configurable:!1}),Object.defineProperty(r,"spellingStack",{configurable:!1,get:function(){return void 0!==l?l:l=t.flitePluginUtils.updateSpellingStack(this)}}),Object.defineProperty(r,"sessionId",{configurable:!1,writable:!0,enumerable:!1}),Object.defineProperty(r,"isTracking",{configurable:!1,get:function(){return"full"===this.trackingState.mode}});let c=!0;Object.defineProperty(r,"acceptRejectEnabled",{get:function(){return c},set:function(e){c=Boolean(e)},configurable:!1}),Object.defineProperty(r,"cssLoader",{writable:!0,configurable:!1,enumerable:!1});const d=e.utils.pluginUtils.getPluginAssetPath(r);this.initLocaleServer(d,a.localeMapping),Object.defineProperty(r,"localizer",{value:e.utils.LocaleServer.createClient("flite",o),writable:!1,configurable:!1,enumerable:!1});const u=r.getTrackerOptions();this.updateTrackerOptions(u,r._config);const h=new t.ChangeTracker(r,u);Object.defineProperty(r,"tracker",{value:h,writable:!1,enumerable:!1,configurable:!1}),r.addUsers(r._config.users);const f=r.users.getUser(null===(s=r._config.user)||void 0===s?void 0:s.id);f&&r.setUserInfo({id:f.id,name:f.name},!0),r.config("logEvents")&&r.logEditorEvents(!0);const y=[t.Commands.ACCEPT_ONE,t.Commands.REJECT_ONE],_=[t.Commands.ACCEPT_ALL,t.Commands.REJECT_ALL,...y];return r.trackingState.$.on("state",(e,t)=>{r.tracker.toggleChangeTracking("full"===t.mode,r.getBody()),r.refreshCommands()}),r.trackingState.$.on("change",()=>{r.refreshCommands(_)}),r.trackingState.$.on("changeid",()=>{r.refreshCommands(y)}),r}setClipboardMode(e){!1===e?d=!1:!1===d&&(d=void 0)}isClipboardAPIAvailable(){if(void 0===d)try{d=void 0!==navigator.clipboard&&"function"==typeof navigator.clipboard.write,d?t.logger.debug("Using clipboard API"):/^https/i.test(window.top.location.protocol)||t.logger.warn("The clipboard API is only available under http. Complex `cut` operations may not track properly")}catch(e){}return d}get insertClass(){return"ice-ins"}get deleteClass(){return"ice-del"}shouldIgnoreImportedAttribute(e,t){if(!e)return!0;for(let t=s.length-1;t>=0;--t)if(s[t].test(e))return!0;return!1}createSpellCheckerTest(t,...n){const r=e.utils.strings.toStringArray(n).concat(e.utils.strings.toStringArray(t.config("spellCheckerClasses"))).filter(Boolean).join(",");return t=>!(!t||1!==t.nodeType)&&e.utils.dom.matchesSelector(t,r)}get defaultConfig(){return n.extend(!0,{},a)}get trackerAttributes(){return n.extend(!0,{},l)}get fliteArtifactsSelector(){return".flite-bookmark,[data-flite-wrapper-change],[data-track-changes-ignore]"}initFLITEConfig(r,i){var o,s;const a=t.flitePluginUtils.defaultConfig;(null===i||Array.isArray(i))&&(t.logger.error("Invalid FLITE configuration, can't be an array or null"),i={}),i=null!=i?i:{};const l=Object.assign({},r.processConfig(i));if(!l.maxDocumentReadyWaitSeconds||isNaN(l.maxDocumentReadyWaitSeconds)||Number(l.maxDocumentReadyWaitSeconds)<0?l.maxDocumentReadyWaitSeconds=0:l.maxDocumentReadyWaitSeconds=parseInt(l.maxDocumentReadyWaitSeconds),"boolean"!=typeof l.clipboardSupport&&(l.clipboardSupport=!0),l.copyBehavior=e.utils.strings.validateEnum(l.copyBehavior,["clean","raw"],a.copyBehavior),l.assetPath=l.assetPath||"",l.localeMapping=null!==(o=l.localeMapping)&&void 0!==o?o:{},l.autoNext="boolean"==typeof l.autoNext&&l.autoNext,l.sessionPolicy=e.utils.strings.validateEnum(l.sessionPolicy,["always","manual","never"],a.sessionPolicy),l.readonlyInsertPolicy=e.utils.strings.validateEnum(l.readonlyInsertPolicy,["none","passive","active","insert"],a.readonlyInsertPolicy),l.editorTheme=e.utils.strings.validateEnum(l.editorTheme,["browser","dark","light"],a.editorTheme),l.nonTrackingCommands=(n=>{if(!(null==n?void 0:n.length))return[];if("string"==typeof n){if("*"===n.trim())return[t.Commands.ACCEPT_ALL,t.Commands.REJECT_ALL,t.Commands.ACCEPT_ONE,t.Commands.REJECT_ONE];n=e.utils.strings.toStringArray(n,"lower")}return n.filter(e=>h.indexOf(e)>=0)})(l.nonTrackingCommands),l.styleUrls=e.utils.strings.toStringArray(l.styleUrls),l.pageUrls=e.utils.strings.toStringArray(l.pageUrls),l.user)if("string"==typeof l.user)l.user={id:l.user};else{const e=this.validateUser(l.user);"string"==typeof e?t.logger.warn("config: invalid user "+e):l.user=e}l.userId&&(t.logger.warn("config.userId is deprecated, please use the user property"),l.user||(l.user={id:String(l.userId),name:l.userName||""})),l.userName&&t.logger.warn("config.userName is deprecated, please use the user property"),l.userId=l.userName=void 0,l.users=this._validateUsers(r,l.users,l.user),l.deletableSelectors=t.trackerUtils.mergeStringsOrArrays(a.deletableSelectors,l.deletableSelectors).join(","),l.opaqueSelectors=t.trackerUtils.mergeStringsOrArrays(a.opaqueSelectors,l.opaqueSelectors).join(","),l.timezoneOffset=e.utils.getRelativeTimezoneOffset(l.timezone),!0!==l.trackListTypeChange&&(l.trackListTypeChange=!1),l.ignoreCommands&&(l.ignoreCommands=e.utils.strings.toStringArray(l.ignoreCommands)),l.contextMenu=(n=>{const r=e.utils.array.first([n.contextMenu,n.contextmenu,n["context-menu"]],e=>null!=e);if(null==r||!0===r)return[t.Commands.ACCEPT_ONE,t.Commands.REJECT_ONE];if(!1===r)return[];return"string"===typeof r||Array.isArray(r)?e.utils.strings.toStringArray(r,{transform:"lower",unique:!0}):(t.logger.error("unknown context menu configuration",r),[])})(l);const c=e.utils.array.first([l.contextMenu,l.contextmenu,l["context-menu"]],e=>null!=e),d=typeof c,g=[];if("boolean"===d?c&&g.push(t.Commands.ACCEPT_ONE,t.Commands.REJECT_ONE):"string"===d?g.push(...e.utils.strings.toStringArray(c)):Array.isArray(c)?g.push(...c):c&&t.logger.error("unknown context menu configuration",c),l.contextMenu=g&&g.map(e=>e.trim()).filter(Boolean),l.commands=function(t){const n=t.editorTheme,r="browser"===n?e.utils.pluginUtils.isDarkMode()?"dark":"light":n,i=u.map(e=>Object.assign(Object.assign({},e),{iconUrl:e.iconUrl?e.iconUrl.replace(/%THEME%/g,r):e.iconUrl}));return e.utils.pluginUtils.upgradeConfigCommands(i,t.commands)}(l),"boolean"==typeof l.tooltips?l.tooltips=l.tooltips?a.tooltips:{show:!1,delay:0,template:null,useTitle:!1,formatter:null}:"always"===l.tooltips?l.tooltips=n.extend(!0,{},a,{show:"always"}):l.tooltips=n.extend({},a.tooltips,null!==(s=l.tooltips)&&void 0!==s?s:{}),l.tooltipTemplate)throw new Error("tooltipTemplate is deprecated. Please use tooltips.template");let f=l.tooltips.delay;const p=typeof f;null==f?f=a.tooltips.delay:"string"===p||"number"===p?(f=Number(f),isNaN(f)||f<0?(t.logger.warn("illegal delay value in config "+p),f=a.tooltips.delay):f=Math.round(f)):(t.logger.error(`invalid type ${p} for tooltips delay`),f=a.tooltips.delay),l.tooltips.delay=f,"function"!=typeof l.statusCallback&&(l.statusCallback=void 0),this.validateKey();return n.extend(!0,{},a,l)}toggleTracking(n,r,i){let o;o="boolean"==typeof i?{notify:i}:i||{};const s="boolean"!=typeof r?!n.trackingState.isTracking:r,a=!0===n.config("allowQuitWithChanges")||o.force,l=()=>{s||n._timeoutClient.stopAll(),n.trackingState.update({isTracking:s}),n.isTracking||n.toggleShow(n.isVisible&&!1!==n.config("showChangesWhenInactive")),!1!==o.notify&&n.fireEvent(t.Events.TRACKING,{tracking:s,flite:this})};if(!s&&n.trackingState.isTracking&&!a){if(n.tracker.countChanges({verify:!0})){const r=n.config("allowQuitWithChanges");if("function"==typeof r){const e=r(n);return("function"==typeof(null==e?void 0:e.then)?e:Promise.resolve(e)).then(e=>{if(e){if("accept"===e)n.acceptAll(null);else if("reject"===e)n.rejectAll(null);else if(!0!==e)return void t.logger.error(`Illegal value ${e} return from allowQuitWithChanges`);l()}})}e.utils.alertManager.alert({text:n.getLocalizedString("PENDING_CHANGES")})}}l()}replaceInsDel(e,t,r,i){const o=n(t).find(r),s=e.tracker.getWrappingTagName(null,i),a=i?this.insertClass:this.deleteClass;o.each((function(e,t){let r,i=t.parentNode,o=[];n(t).contents().each((e,n)=>{r=3===n.nodeType?function(e,t,n,r){var i="string"==typeof e?t.ownerDocument.createTextNode(e):e,o=t.ownerDocument.createElement(n);return o.appendChild(i),c(o,t,r),o.setAttribute(l.fliteCreated,"1"),o}(n,t,s,a):c(n,t,a),o.push(r)}),o.forEach((function(e){i.insertBefore(e,t)})),i.removeChild(t)}))}cleanupHtml({plugin:n,html:r,xml:i,textProcessor:o}){try{const t=n.tracker.removeArtifactsFromHTML(r);if(null==t?void 0:t.length){const r=t[0];return n.tracker.addFullTrackingDataToDOM(r),e.utils.dom.elementToHtml({el:r,xml:i,withRoot:!1,encode:o})}}catch(e){return t.logger.error("Error adding full tracking data to content "+e),r}}acceptOrRejectChangedNode(e){var n;const r=e.plugin;e.params=e.params||{};const i="boolean"==typeof(null===(n=e.params)||void 0===n?void 0:n.autoNext)?e.params.autoNext:r.config("autoNext"),o=Boolean(e.node&&(e.isAccept?r.tracker.acceptChange(e.node):r.tracker.rejectChange(e.node)));if(o){if(r.fireEvent(e.isAccept?t.Events.ACCEPT:t.Events.REJECT,{flite:r,options:e.params}),r.cleanupAfterAcceptReject(),i){const t=r.tracker.navigateToChangeNode("next");t&&e.plugin.revealEditorNode(t)}r.onSelectionChanged()}return o}validateKey(){const e="api-key-placeholder";if(!/placeholder/.test(e)){const t=document.head&&document.head.querySelectorAll("meta[name='FLITE-API-KEY']"),n=t&&t.length&&t[0];return Boolean(n&&n.getAttribute&&n.getAttribute("content")===e)}return!0}updateSpellingStack(e){const t=e,r=e._spellTrigger;let i=Object.assign({},t._config.spellingOverride||{"tr,td,ul,ol":!0});return function(e){Object.keys(e).forEach(t=>{/^tr,/.test(t)&&delete e[t]})}(i),(null==r?void 0:r.length)?(r.each((e,t)=>{if(!t.attributes||!t.attributes.length)return;const r=n.extend({},i),o=function(e){const t=(e||"").split("").reduce((function(e,t,n,r){return e+(n+1)*t.charCodeAt(0)}),0);return r[t]&&delete r[t],t};Array.from(t.attributes).forEach(e=>{o(e.nodeValue),o(e.nodeName)}),0===Object.keys(r).length&&(i=void 0)}),Boolean(i)):Object.keys(i).length>0}makeTooltipTitle(n){const r=n.config,i=n.change,o=new Date(i.time),s=new Date(Date.now()+n.timeOffset),a=new Date(i.lastTime);let l=r.template||"";return l=l.replace(/%%([^\b\s]+)/g,(e,...t)=>n.localize(t[0])),l=l.replace(/%a/g,n.localize(n.isInsert?"CHANGE_TYPE_ADDED":"CHANGE_TYPE_DELETED")),l=l.replace(/%t/g,t.flitePluginUtils.relativeDateFormat(o,s,n.localize)),l=l.replace(/%u/g,i.username),l=l.replace(/%dd/g,e.utils.strings.padNumber(o.getDate(),2)),l=l.replace(/%d/g,String(o.getDate())),l=l.replace(/%mm/g,e.utils.strings.padNumber(o.getMonth()+1,2)),l=l.replace(/%m/g,String(o.getMonth()+1)),l=l.replace(/%yy/g,e.utils.strings.padNumber(o.getFullYear()%100,2)),l=l.replace(/%y/g,String(o.getFullYear())),l=l.replace(/%nn/g,e.utils.strings.padNumber(o.getMinutes(),2)),l=l.replace(/%n/g,String(o.getMinutes())),l=l.replace(/%hh/g,e.utils.strings.padNumber(o.getHours(),2)),l=l.replace(/%h/g,String(o.getHours())),l=l.replace(/%T/g,t.flitePluginUtils.relativeDateFormat(a,s,n.localize)),l=l.replace(/%DD/g,e.utils.strings.padNumber(a.getDate(),2)),l=l.replace(/%D/g,String(a.getDate())),l=l.replace(/%MM/g,e.utils.strings.padNumber(a.getMonth()+1,2)),l=l.replace(/%M/g,String(a.getMonth()+1)),l=l.replace(/%YY/g,e.utils.strings.padNumber(a.getFullYear()%100,2)),l=l.replace(/%Y/g,String(a.getFullYear())),l=l.replace(/%NN/g,e.utils.strings.padNumber(a.getMinutes(),2)),l=l.replace(/%N/g,String(a.getMinutes())),l=l.replace(/%HH/g,e.utils.strings.padNumber(a.getHours(),2)),l=l.replace(/%H/g,String(a.getHours())),l}relativeDateFormat(n,r,i){let o,s,a,l=(r=r||new Date).getDate(),c=r.getMonth(),d=r.getFullYear();const u=typeof n;return o="string"===u||"number"===u?new Date(Number(n)):n,l==o.getDate()&&c==o.getMonth()&&d==o.getFullYear()?(s=Math.floor((r.getTime()-o.getTime())/6e4),s<1?i("NOW"):s<2?i("MINUTE_AGO"):s<60?i("MINUTES_AGO").replace("%Minutes",String(s)):(a=o.getHours(),s=o.getMinutes(),i("AT")+" "+e.utils.strings.padNumber(a,2)+":"+e.utils.strings.padNumber(s,2))):[i("ON"),t.trackerUtils.makeDateLabel(i.bind(this),o.getDate(),o.getMonth(),d===o.getFullYear()?0:o.getFullYear())].join(" ")}tryHandleClipboardEvent(e,n){let r=!1;const i=e.trackingState.mode;return"none"!==i&&(e.tracker.prepareToCut(i)&&(r=t.flitePluginUtils.isClipboardAPIAvailable(),r&&(n.stopImmediatePropagation(),n.stopPropagation(),n.preventDefault())),r)}getEditorOffset(e){const t={x:0,y:0},r=e&&e.frameElement;if(!r)return t;const i=n(r).offset(),o=n(window);return t.x=i.left+o.scrollLeft(),t.y=i.top+o.scrollTop(),t}getEditorOffsetString(e){const n=t.flitePluginUtils.getEditorOffset(e);return[-n.x,-n.y].join(",")}addTooltipToNode(t){const n=t.node;if(!n||!t.change||1!==n.nodeType||n.nodeName in i)return;const o=t.config||{};if(!o.show)return;const s=!0===o.useTitle;e.Tooltips.init({target:n,contentText:(i,o)=>{if(!t.change)return"";const s={change:t.change,timeOffset:t.timeOffset,isInsert:r.test(n.className),config:t.config,localize:t.localize},a=t.config.formatter?t.config.formatter(s):this.makeTooltipTitle(s);return o?e.utils.strings.htmlToText(a):a},unique:!0,useTitle:s,canShow:t.canShow})}updateTrackerOptions(n,r){n.nodeClassifier.addPatterns(t.NodeClassifier.CONTENT_ONLY,'TABLE,TBODY,TR,UL,OL,DL,DT,DD,[role="presentation"]').addPatterns(t.NodeClassifier.IGNORE,"BR,IFRAME,COLGROUP,COL").addPatterns(t.NodeClassifier.NODE_ONLY,"IMG");const i=r.ignoreContainers;if(!i)return;const o=!0===i?["p","div","h1","h2","h3","h4","h5","h6"]:e.utils.strings.toStringArray(String(i));n.nodeClassifier.addPatterns(t.NodeClassifier.CONTENT_ONLY,o)}presrveWhitespace(r){const i=`.${t.flitePluginUtils.insertClass}:not(.flite-container-only),.${t.flitePluginUtils.deleteClass}:not(.flite-container-only)`;return n(r).find(i).each((n,r)=>{e.utils.dom.forAllTextChildren(r,t.domUtils.preserveWhiteSpaces)}),r}getCommandsStatus(e,n){const r=e.trackingState.mode,i=e.config("nonTrackingCommands"),o={trackingState:e.trackingState,enabled:e.acceptRejectEnabled,isTracking:"full"===r,anyTracking:"none"!==r,isVisible:e.isVisible,isOverride:!1},s=(n||h).reduce((e,t)=>{const n=f.get(t);return n&&(o.isOverride=i.indexOf(t)>=0,e[t]={enabled:n.getEnabled(o),active:n.getActive?n.getActive(o):void 0}),e},{}),a=e.config("statusCallback");if(a){const n={plugin:e,user:e.getUserInfo(),change:e.tracker.getChangeForId(o.trackingState.changeId)};Object.keys(s).forEach(e=>{const r=s[e];try{const t=a(Object.assign(Object.assign({},n),{enabled:r.enabled,active:r.active,command:e}));"boolean"==typeof(null==t?void 0:t.enabled)&&(s[e]=Object.assign({},t))}catch(n){t.logger.error(`Error executing status callback for ${e}: ${n}`)}})}return s}validateUser(e,n=!0){const r=null==e?void 0:e.id;if(!r)return"validateUser: no user or id";const i=typeof r;if("string"!==i&&"number"!==i)return t.logger.debug("validateUser: bad id type "+i),null;const o=String(r).trim();if(!o)return`valiateUser: the id ${o} is not valid`;if(!0!==n){const t=e.name;if(!t||"string"!=typeof t)return"Invalid user name "+e.name}return{id:o,name:e.name,style:e.style}}demoNotice(){e.utils.alertManager.alert({text:"This feature is disabled in the demo version"}).then(()=>{})}_validateUsers(r,i,o){const s=i&&n.isArray(i);i&&!s&&t.logger.error(`Invalid configuration value ${typeof i} for users`);const a=[];return(s?i:[]).forEach(e=>{const n=this.validateUser(e);"string"==typeof n?t.logger.error("user error "+n):a.push(e)}),(null==o?void 0:o.id)&&o.name&&e.utils.array.firstIndex(a,e=>e.id===o.id)<0&&a.push(o),a}},_={flitePluginUtils:y};Object.assign(t,_)}(window.LOOPINDEX),Object.defineProperty(i,"__esModule",{value:!0}),function(e){const t=null==e?void 0:e.FLITE,n=null==e?void 0:e.$;if(!t||!n)throw new Error("Cannot initialize DOM Utils without FLITE globals");const r=e.utils.createCISet(["meta","input","frame","col","base","area","img","hr","iframe","param","link"]),i=e.utils.createCISet(["body","p","div","table","tbody","tr","td","th","pre","ul","ol","li","fieldset","form","blockquote","dl","dt","dd","dir","center","address","h1","h2","h3","h4","h5","h6"]),o=e.utils.createCISet("TABLE","TR","TD","TBODY","TH"),s=e.utils.createCISet(["body","a","p","div","pre","u","b","s","sub","sup","em","strong","span","i","li","td","th","blockquote","dt","dd","center","address","summary","details","h1","h2","h3","h4","h5","h6","ins","del","dd","dt"]),a=e.utils.createCISet(["u","b","s","sub","sup","em","strong","code","pre","span","i","blockquote","a"]),l=r.clone();l.add("br");const c=Array.from(r.values()).join(", "),d=e=>e.nextSibling,u=e=>e.previousSibling,h=e=>e.parentNode,g=/  /g;function f(e){return e?(e.indexOf("â")>=0&&(e=e.replace(/\u200B/g,"")),e.indexOf("\ufeff")>=0&&(e=e.replace(/\uFEFF/g,"")),e.indexOf("&nbsp;")>=0&&(e=e.replace(/\&nbsp;/g,"Â ")),e):""}e.utils.createCISet("DD","DT");class p{constructor(e){this._root=e,this._isValid=!1}get isValid(){return this._isValid}rightNeighbor(e,t){return t=t||{},this._root=t.root||this._root,this.goto(e),this.isValid?this._findNeighbor(e,t,!0):null}leftNeighbor(e,t){return t=t||{},this._root=t.root||this._root,this.goto(e),this.isValid?this._findNeighbor(e,t,!1):null}previousNode(e,t){if(t=t||{},this._root=t.root||this._root,this.goto(e),!this.isValid)return null;const n=this._findPrevNode(e,t,!1,!0);return n&&this.goto(n),n}nextNode(e,t){if(t=t||{},this._root=t.root||this._root,this.goto(e),!this.isValid)return null;const n=this._findNextNode(e,t,!1,!0);return n&&this.goto(n),n}goto(n){this._isValid=n===this._root||e.utils.dom.isDescendantOf(n,this._root),this._isValid||t.logger.debug("Treewalker can't set the current element to a node which is not under the root")}_findNextNode(n,r,i,o){if(!n||n===this._root)return null;const s=r.nodeFilter||e.utils.yes,a=r.visitFilter||e.utils.yes;let l,c;if(3===n.nodeType?l=this._createIteratorAt(n):(l=e.utils.dom.createTreeWalker(this._root,5),l&&(l.currentNode=n)),!l)return t.logger.error("Failed to create node iterator"),null;const d=!0===r.excludeSelf;for(;c=l.nextNode();)if((!d||!e.utils.dom.isDescendantOf(c,n))&&a(c)&&s(c))return c;return null}_createIteratorAt(t){if(!t||!t.parentNode)return null;const n=e.utils.dom.createTreeWalker(this._root,5);n.currentNode=t.parentNode;for(let e=n.nextNode();e&&e!==t;e=n.nextNode());return n}_findPrevNode(n,r,i,o){if(!n||n===this._root)return null;const s=r.nodeFilter||e.utils.yes,a=r.visitFilter||e.utils.yes;let l=null;if(3===n.nodeType){for(let e=n.previousSibling;e&&!l;e=e.previousSibling){if(a(e)&&s(e))return e;1===e.nodeType&&(l=e)}if(!l&&(l=n.parentNode,a(l)&&s(l)))return l}else l=n;if(!l)return null;const c=e.utils.dom.createTreeWalker(this._root,5);if(!c)return t.logger.error("Failed to create tree iterator"),null;let d;for(c.currentNode=l;d=c.previousNode();)if(a(d)&&s(d))return d;return null}_findNeighbor(t,n,r){const i=this._root;if(!t)return null;const o=n.nodeFilter||e.utils.yes,s=n.stopFilter||e.utils.no,a=n.skipFilter||e.utils.no,l=e.utils.dom.createTreeWalker(i,5),c=1===t.nodeType&&!1===n.querySelf;l.currentNode=t;const d=r?()=>l.nextNode():()=>l.previousNode();let u;for(;u=d();){if(u===i||s(u))return null;if(!a(u)&&((!c||!e.utils.dom.isDescendantOf(u,t))&&!e.utils.dom.isEmptyTextNode(u)&&(!o||o(u))))return u}return null}}const m={domUtils:new class{convertMixedSelectionToText(e){if(e.collapsed)return e;const t=e.startContainer;e.endContainer;if(1===t.nodeType){t.childNodes[e.startOffset]}return e}getElementSelector(e){return 1!==(null==e?void 0:e.nodeType)?"":e.id?`${e.nodeName}#${e.id}`:e.className?`${e.nodeName}.${e.className.split(/\s/).join(".")}`:e.nodeName}getNodeListStatus(e,t){var n;const r={li:null,list:null,type:""};r.li=this.getNode(e,"LI",t),r.list=this.getNode(e,"UL,OL",t);const i=null===(n=r.list)||void 0===n?void 0:n.nodeName;return r.type="OL"===i?"number":"UL"===i?"bullet":"",r}preserveWhiteSpaces(e){const t=null==e?void 0:e.data;return t&&"string"==typeof t&&g.test(t)?(e.data=t.replace(g,"Â  "),e):e}getComputedStyle(e,t){const n=e&&1===e.nodeType&&e.ownerDocument,r=n&&n.defaultView,i=r&&r.getComputedStyle(e);return i?i.getPropertyValue(t):""}cleanTextNode(e,n){return e&&e.length&&(e.data=t.trackerUtils.removeDeadCharactersFrom(e.data,n)),e}addStubElementSelector(e){l.add(e)}createTreeWalker(e){return new p(e)}getKeyChar(e){return String.fromCharCode(e.which)}removeEmptyCharsFromTextNode(e){let n;if(!e||3!==e.nodeType||!(n=e.length))return!1;const r=e.data,i=(t.trackerUtils.removeDeadCharactersFrom(r,!0),[]),o=e.data;for(let e=0;e<n;++e)8203===o.charCodeAt(e)&&i.push(e);if(i.length<1)return!1;const s=o.split("");for(let e=i.length-1;e>=0;--e)s.splice(i[e],1);return e.data=s.join(""),!0}getChildrenOfClass(e,t,r){t||(t=document.body);const i=e.split(" ");return i.unshift(r||""),e=i.join("."),n.makeArray(n(t).find(e))}getNode(t,n,r){if(!t)return null;const i=t.$;(null==i?void 0:i.nodeType)&&(t=i);const o="string"==typeof n?t=>e.utils.dom.matchesSelector(t,n):n;for(let e=1===t.nodeType?t:t.parentNode;e&&(!r||e!==r);e=e.parentNode){if(o(e))return e;if(!r)return null}return null}getParents(e,t,r){const i=n(e).parents(t),o=i.length,s=[];for(var a=0;a<o&&i[a]!==r;a++)s.push(i[a]);return s}getSiblings(e,t,r=!1,i=null){if(!0===r)return"prev"===t?n(e).prevAll():n(e).nextAll();{const n=[];if("prev"===t)for(;e.previousSibling&&(e=e.previousSibling)!==i;)n.push(e);else for(;e.nextSibling&&(e=e.nextSibling)!==i;)n.push(e);return n}}getNodeStubContent(e){return n(e).find(c)}hasNoTextOrStubContent(t){if(!t||1!==t.nodeType)return!0;const r=t;return!!s.has(null==r?void 0:r.tagName)&&(!!e.utils.strings.isEmptyString(r.textContent)&&(!t.firstChild||0===n(t).find(c).length))}getNodeCharacterLength(t){return e.utils.dom.getNodeTextContent(t).length+n(t).find(c).length}setNodeTextContent(e,t){return n(e).text(t)}getIframeDocument(e){let t=null;return e.contentDocument?t=e.contentDocument:e.contentWindow?t=e.contentWindow.document:e.document&&(t=e.document),t}isTableElement(e){return o.has(null==e?void 0:e.nodeName)}isBlockElement(e){return i.has(null==e?void 0:e.nodeName)}isStubElement(e){return l.has(null==e?void 0:e.nodeName)}walk(e,t,n){if(!e)return;n||(n=0);!1!==t.call(this,e,n)&&(e.childNodes&&e.childNodes.length>0?this.walk(e.firstChild,t,n+1):e.nextSibling?this.walk(e.nextSibling,t,n):e.parentNode&&e.parentNode.nextSibling&&this.walk(e.parentNode.nextSibling,t,n-1))}getCommonAncestor(t,n){let r=t;for(;r;)return!0===e.utils.dom.isDescendantOf(n,r)?r:null}getNextNode(n,r,i){if(!n||!e.utils.dom.isDescendantOf(n,r.root))return t.logger.warn("getNextNode: source node null or not under root"),null;r.root;if(i&&r.elementMatch(n)){const e=this.getFirstChild(n,r);if(e&&e!==n)return e}let o=this.skipIgnored(n.nextSibling,r,d);if(o)return r.breakOn(o)?null:r.elementMatch(o)?o:this.getFirstChild(o,r);{const e=this.skipIgnored(n.parentNode,r,h);return e?this.getNextNode(e,r,!1):null}}getPrevNode(n,r,i){if(!n||!e.utils.dom.isDescendantOf(n,r.root))return t.logger.warn("getPrevNode: source node null or not under root"),null;let o,s=this.skipIgnored(n.previousSibling,r,u);if(!s&&i&&(s=o=this.skipIgnored(n.parentNode,r,h)),s){if(r.breakOn(s))return null;if(r.elementMatch(s))return s;if(s!==o)return this.getLastChild(s,r)}return o=o||this.skipIgnored(n.parentNode,r,h),o?this.getPrevNode(o,r,i):null}canContainTextElement(e){return s.has(null==e?void 0:e.nodeName)}getFirstChild(e,t){if(!e||1!==e.nodeType)return e;let n=this.skipIgnored(e.firstChild,t,d);return n?3===n.nodeType||t.elementMatch(n)?n:this.getFirstChild(n,t):e}getLastChild(e,t){if(!e||1!==e.nodeType)return e;let n=this.skipIgnored(e.lastChild,t,u);return n?3===n.nodeType||t.elementMatch(n)?n:this.getLastChild(n,t):e}getNextContentNode(t,n){if(t)for(;t.parentNode;){if(t===n)return null;const r=t.nextSibling;if(r&&this.canContainTextElement(this.getBlockParent(t,n))){if(e.utils.dom.isEmptyTextNode(t)){t=r;continue}return r}if(t.nextElementSibling)return t.nextElementSibling;t=t.parentNode}return null}getPrevContentNode(e,t){if(e)for(;e.parentNode;){if(e===t)return null;if(e.previousSibling&&this.canContainTextElement(this.getBlockParent(e,t))){if(3===e.previousSibling.nodeType&&0===e.previousSibling.length){e=e.previousSibling;continue}return e.previousSibling}if(e.previousElementSibling)return e.previousElementSibling;e=e.parentNode}return null}_findNextTextContainer(e){let t;for(;e;){if(3==e.nodeType)return e;for(let n=e.firstChild;n;n=n.nextSibling)if(t=this._findNextTextContainer(n),t)return t;if(this.isTextContainer(e))return e;e=e.nextSibling}return null}_findPrevTextContainer(e){for(;e;){if(3==e.nodeType)return e;for(var t=e.lastChild;t;t=t.previousSibling){var n=this._findPrevTextContainer(t);if(n)return n}if(this.isTextContainer(e))return e;e=e.previousSibling}return null}findPrevTextContainer(t,n){if(!t||t==n)return{node:n,offset:0};if(t.parentNode&&this.isTextContainer(t.parentNode))return{node:t.parentNode,offset:e.utils.dom.getNodeIndex(t)};for(;t.previousSibling;){var r=this._findPrevTextContainer(t.previousSibling);if(r)return{node:r,offset:e.utils.dom.getNodeLength(r)};t=t.previousSibling}return this.findPrevTextContainer(t.parentNode&&t.parentNode.previousSibling,n)}findNextTextContainer(t,n){if(!t||t==n)return{node:n,offset:e.utils.dom.getNodeLength(n)};if(t.parentNode&&this.isTextContainer(t.parentNode))return{node:t.parentNode,offset:e.utils.dom.getNodeIndex(t)+1};for(;t.nextSibling;){var r=this._findNextTextContainer(t.nextSibling);if(r)return{node:r,offset:0};t=t.nextSibling}return this.findNextTextContainer(t.parentNode&&t.parentNode.nextSibling,n)}isTextContainer(e){return 3===(null==e?void 0:e.nodeType)||s.has(null==e?void 0:e.nodeName)}isInlineElement(e,t){return!(1!==(null==e?void 0:e.nodeType)||!e.nodeName)&&(!(null==t?void 0:t.includes(e.nodeName))&&a.has(e.nodeName))}findInlineParent(e,t){let n=null;for(let r=e&&e.parentNode;r&&"BODY"!==r.nodeName;r=r.parentNode){if(!this.isInlineElement(r)||t&&!t(r))return n;n=r}return n}splitTextAt(e,t,n,r=!1){var i,o=e.length;return t<0||t>=o?null:(t+n>=o&&(n=o-t),n===o?r?e:null:((i=t>0?e.splitText(t):e).length>n&&i.splitText(n),i))}isset(e){return null!=e}inArray(e,t){for(var n=t.length,r=0;r<n;r++)if(e===t[r])return!0;return!1}arrayDiff(e,t,n){var r,i=e.length,o=[];for(r=0;r<i;r++)!1===this.inArray(e[r],t)&&o.push(e[r]);if(!0!==n)for(i=t.length,r=0;r<i;r++)!1===this.inArray(t[r],e)&&o.push(t[r]);return o}arrayMerge(e,t){const n=t.length;for(let r=0;r<n;r++)e.push(t[r]);return e}getBlockParent(e,t){if(!0===this.isBlockElement(e))return e;if(e&&e!==t)for(;e.parentNode;){if(e=e.parentNode,!0===this.isBlockElement(e))return e;if(e===t)return null}return null}isOnBlockBoundary(e,t,n){return!(!e||!t)&&(this.getBlockParent(e,n)||this.isBlockElement(e)&&e||null)!==(this.getBlockParent(t,n)||this.isBlockElement(t)&&t||null)}mergeContainers(e,t){if(!e||!t)return!1;if(3===e.nodeType||this.isStubElement(e))t.appendChild(e);else if(1===e.nodeType){for(;e.firstChild;)t.appendChild(e.firstChild);n(e).remove()}return!0}domToString(t){if(!t)return"";if(3===t.nodeType)return f(t.data);const r=n(t),i=t.ownerDocument;return r.find("p,div,h1,h2,h3,h4,h5,h6").each((t,n)=>{const r=i.createTextNode("\n\n");e.utils.dom.insertAfter(r,n)}),r.find("br").filter((e,t)=>Boolean(t.previousSibling||t.nextSibling)).replaceWith("\n"),f(t.textContent)}isRangeInElement(e,t){return e.intersectsNode(t)}mergeBlockWithSibling(e,t,r){var i=r?n(t).next().get(0):n(t).prev().get(0);return r?this.mergeContainers(i,t):this.mergeContainers(t,i),e.collapse(!0),!0}_getNextContainer(e,t){const n=t&&t.root;if(!e||e===n)return null;for(;e.nextSibling;){if(3!==(e=e.nextSibling).nodeType){const n=this.getFirstSelectableChild(e,t);if(null!==n)return n}if(this.isSelectable(e,t))return e}for(;e&&!e.nextSibling;){if(e===n)return null;e=e.parentNode}if(!e||e===n)return null;if(e=e.nextSibling,this.isSelectable(e,t))return e;var r=this.getFirstSelectableChild(e,t);return null!==r?r:this._getNextContainer(e,t)}getNextContainer(e,t){return this._getNextContainer(e,t||{})}_getPreviousContainer(e,n){const r=n.root,i=n.nodeFilter;if(!e||e===r)return null;for(;e.previousSibling;){if(3!==(e=e.previousSibling).nodeType){if(!0===t.domUtils.isStubElement(e))return e;{const t=this.getLastSelectableChild(e,n);if(null!==t)return t}}if(this.isSelectable(e,n))return e}do{if(!(e=e.parentNode)||e===r)return null;if(i&&i(e))return e;if(e.previousSibling)break}while(e);if(e=e.previousSibling,this.isSelectable(e,n))return e;var o=this.getLastSelectableChild(e,n);return null!==o?o:this._getPreviousContainer(e,n)}rightNeighbor(e,n){return t.domUtils.createTreeWalker(n.root).rightNeighbor(e,n)}leftNeighbor(e,n){return t.domUtils.createTreeWalker(n.root).leftNeighbor(e,n)}getPreviousContainer(e,t){return this._getPreviousContainer(e,t||{})}getNextSelectableNode(e,n=null){return t.domUtils.createTreeWalker(n.root).nextNode(e,n)}_getPreviousSelectableNode(e,n){return t.domUtils.createTreeWalker(n.root).previousNode(e,n)}getPreviousSelectableNode(e,t){return this._getPreviousSelectableNode(e,t||{})}getFirstSelectableChild(t,r){if(!t)return null;if((r=r||{}).visitFilter&&!r.visitFilter(t))return null;if(!r.excludeSelf){if(3===t.nodeType&&(!1!==r.allowEmptyText||!e.utils.dom.isEmptyTextNode(t)))return t;if(r.nodeFilter&&r.nodeFilter(t))return t}let i,o=t.firstChild;for(r=r.excludeSelf?n.extend({},r,{excludeSelf:!1}):r;o;){if(i=this.getFirstSelectableChild(o,r),i)return i;o=o.nextSibling}return null}getLastSelectableChild(t,n=null){if(!t)return null;if((n=n||{}).visitFilter&&!n.visitFilter(t))return null;if(!n.excludeSelf){if(3==t.nodeType&&(!1!==n.allowEmptyText||!e.utils.dom.isEmptyTextNode(t)))return t;if(n.nodeFilter&&n.nodeFilter(t))return t}let r,i=t.lastChild;for(n=n.excludeSelf?{root:n.root,excludeSelf:!1,nodeFilter:n.nodeFilter,allowEmptyText:n.allowEmptyText}:n;i;){if(r=this.getLastSelectableChild(i,n),r)return r;i=i.previousSibling}return null}isSelectable(t,n){return!!t&&(3===t.nodeType&&!e.utils.dom.isEmptyTextNode(t)||!(!n||!n.nodeFilter)&&n.nodeFilter(t))}findNodeByTagName(e,t){const n=e&&e.length||0;let r;for(let i=0;i<n;++i)if(r=e[i],1===r.nodeType&&t.test(r.tagName))return r;return null}isAncestorAmong(e,n){const r=t.rangy.dom;for(let t=0;t<e.length;++t)if(r.isAncestorOf(e[t],n,!1))return!0;return!1}isOnRightEdge(e,t){if(!e)return!1;const n=e.nodeType;return 3==n?t&&e.nodeValue&&t>=e.nodeValue.length:1==n&&(e.childNodes&&e.childNodes.length&&t>=e.childNodes.length)}isOnLeftEdge(e,t){return Boolean(e&&0===t)}skipIgnored(e,t,n){for(;e&&e!==t.root&&t.ignore(e);)e=n(e);return e===t.root?null:e}}};Object.assign(t,m)}(window.LOOPINDEX),Object.defineProperty(i,"__esModule",{value:!0}),function(e){const t=null==e?void 0:e.FLITE,n=null==e?void 0:e.$;if(!t||!n)throw new Error("Cannot initialize documentselection without FLITE globals");const r={Selection:class{constructor(e){this.env=e,this._setHook=null,this._selection=null,this.getSelection()}dispose(){this._selection&&(this._selection.detachAll(),this._selection=null),this._setHook=null}get nativeSelection(){return this.getSelection().nativeSelection}setHook(e){this._setHook=e}getSelection(){return t.rangy.getSelection?(this._selection?this._selection.refresh():this.env.frame?this._selection=t.rangy.getSelection(this.env.frame):this._selection=t.rangy.getSelection(null),this._selection):(t.logger.warn("no getselection, rangy is",Object.keys(t.rangy),"global is",Object.keys(e),"initialized",t.rangy.isInitialized(!1)),null)}createRange(){return t.rangy.createRange(this.env.document)}getRangeAt(e){let t=null;try{this._selection.refresh(),t=this._selection.getRangeAt(e)}catch(e){this._selection=null;try{t=this.getSelection().getRangeAt(0)}catch(e){}}return t&&t.cloneRange()||null}getRange(){return this.getRangeAt(0)}getBookmark(e,t){return(t=t||this.getRange())&&t.getFullBookmark(null,e.elementSelector,e.ignoreSelector)}gotoBookmark(e,t){const n=e&&this.getRangeAt(0);return n?(n.moveToBookmark(e,t||{}),this.addRange(n),n):null}moveLeft(e=null,t=1,n){(e=e||this.getRangeAt(0))&&(e.moveStart("char",-t,n),e.collapse(!0),this.addRange(e))}nudgeLeft(e,n){if(!(e=e||this.getRangeAt(0))||!e.collapsed||!e.startContainer)return;let r=e.startContainer;const i=3===r.nodeType;if(!i){const i=r.childNodes.item(e.startOffset);if(!i){const e=t.domUtils.getLastSelectableChild(r,n);if(e)return void this.collapseAtEnd(e)}r=i||r}if(!i||0===e.startOffset){const e=t.domUtils.createTreeWalker(n.root).previousNode(r,n);if(e)e!==r&&this.collapseAtEnd(e);else{const e=t.domUtils.getFirstSelectableChild(n.root,n);e&&this.collapseAtStart(e)}}}nudgeRight(e,n){const r=(e=e||this.getRangeAt(0))&&e.collapsed&&e.endContainer;if(!r)return;let i;if(1===r.nodeType?i=e.endOffset>=r.childNodes.length:3===r.nodeType&&(i=e.endOffset>=r.length),i){const e=t.domUtils.createTreeWalker(n.root).nextNode(r,n);e&&e!==r&&this.collapseAtStart(e)}}moveRight(e=null,t=1,n){(e=e||this.getRangeAt(0))&&(e.moveStart("char",t,n),e.collapse(!0),this.addRange(e))}collapse(e){const t=this.getRangeAt(0);return t&&!t.collapsed&&(t.collapse(e),this.addRange(t)),t}collapseAtStart(e){return this.collapseAt(e,!0)}collapseAtEnd(e){return this.collapseAt(e,!1)}setStart(e,t,n){const r=this.getRangeForTargetNode(e);return r?(r.setStart(e,n),t&&r.collapse(!0),this.addRange(r),r):null}setEnd(e,t,n){const r=this.getRangeForTargetNode(e);return r?(r.setEnd(e,n),t&&r.collapse(!1),this.addRange(r),r):null}setEndAfter(e,t=!0){const n=this.getRangeForTargetNode(e);return n?(n.setEndAfter(e),t&&n.collapse(!1),this.addRange(n),n):null}setStartBefore(e,t=!0){const n=this.getRangeForTargetNode(e);return n?(n.setStartBefore(e),t&&n.collapse(!0),this.addRange(n),n):null}addRange(e,t=!0){if(!e)return;this._selection||(this._selection=this.getSelection());var n=this.getRangeAt(0);if(e.equals(n))return;const r=this.createRange();r.setStart(e.startContainer,e.startOffset),r.setEnd(e.endContainer,e.endOffset),this._selection.setSingleRange(r),!1!==t&&this._setHook&&this._setHook(r.cloneRange())}normalize(e,n){const r=this.getRange();if(!r||!r.collapsed)return;const i=r.startContainer;if(1!==i.nodeType)return;const o=i.childNodes[r.startOffset];if(e.nodeFilter(o))return;if(n){const n=t.domUtils.getPreviousSelectableNode(o,e);if(n)return void this.collapseAtEnd(n)}const s=t.domUtils.getFirstSelectableChild(o,e);s&&s!==o&&this.setStart(s,!0,0)}getRangeForTargetNode(e){return e&&e.ownerDocument&&e.parentNode?this.getRangeAt(0):null}_selectNodeOrContent(e,t){3===t.nodeType?e.selectNode(t):e.selectNodeContents(t)}_adjustElementRange(t,n){if(!t.collapsed)return t;const r=t.startContainer,i=r&&r.parentNode;if(!i||1!==r.nodeType||i===n)return t;const o=e.utils.dom.getNodeIndex(r);return t.setStart(i,o),t.setEnd(i,o),t.collapse(!0),t}collapseAt(e,n){if(!(null==e?void 0:e.parentNode)||e.ownerDocument!==this.env.document)return t.logger.warn(`collapse at: the provided node ${typeof e} is not under the current selection doc`),this.getRangeAt(0);const r=e&&this.getRangeAt(0);if(!r)return null;try{this.addRange(r.collapseAt(e,n))}catch(e){t.logger.error("collapseAt",n?"start":"end",e)}finally{return this.getRangeAt(0)}}_getEffectiveStartNode(e){if(!e||1!==e.nodeType)return e;const t=e.parentNode;return t&&e===t.firstChild?"LI"===e.nodeName||"TR"===e.nodeName?e.parentNode:"TD"===e.nodeName&&t===(t.parentNode&&t.parentNode.firstChild)?t.parentNode:e:e}_getEffectiveEndNode(e){if(!e||1!==e.nodeType)return e;const t=e.parentNode;return t&&e===t.lastChild?"LI"===e.nodeName||"TR"===e.nodeName?e.parentNode:"TD"===e.nodeName&&t===(t.parentNode&&t.parentNode.lastChild)?t.parentNode:e:e}}};Object.assign(t,r)}(window.LOOPINDEX),Object.defineProperty(i,"__esModule",{value:!0}),function(e){const t=null==e?void 0:e.FLITE,n=null==e?void 0:e.$;if(!t||!n)throw new Error("Cannot initialize DOM Marker without FLITE globals");const r=function(){let e=(new Date).getTime()%1e5;return function(){return(e++).toFixed(0)}}();class i{constructor(e,t){this.env=e,this._start=null,this._end=null,this._isEndExtended=!1,this._isStartExtended=!1,this._startInText=!1,this._endInText=!1,this.id="flite-bm-"+r(),this._createBookmark(t)}owns(e){return this._validate(this._start,"start"),this._validate(this._end,"end"),e&&(e===this._start||e===this._end)}getNodesInRange(t,n){if(!this._end||!this._start||this._start.nextSibling===this._end)return[];const r=this.env.element,i=[],o=e.utils.dom.createTreeWalker(r,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);let s,a=this._end;const l=!a.nextSibling;for(o.currentNode=this._start;s=o.nextNode();)if(!e.utils.dom.isDescendantOf(s,this._start)&&!e.utils.dom.isDescendantOf(s,a)){if(s===a||s===r)break;!l&&e.utils.dom.isDescendantOf(a,s)||t&&!t(s,n)||i.push(s)}return i}collapseAndRemove(e){var t;const n=this.selectAndRemove();return null!==(t=null==n?void 0:n.collapse(e))&&void 0!==t?t:null}selectAndRemove(e=!0){let n=t.rangy.createRange(this.env.document);if(!this._validate(this._start,"start"))return this.remove(),null;try{const r=Boolean(this._validate(this._end,"end")&&this._start.nextSibling!==this._end);if(r){const e=t.rangy.createRange(this.env.document);e.setStartAfter(this._start),e.setEndBefore(this._end),e.commonAncestorContainer.normalize()}if(!1!==e)this._restoreText(this._start,n,!0)||n.setStartBefore(this._start);else{const e=this._isStartExtended?this._findExtendedStart(this._start):null;e?n.setStartBefore(e):n.setStartBefore(this._start)}if(this._removeStart(),n.collapse(!0),r)if(!1!==e)this._restoreText(this._end,n,!1)||n.setEndBefore(this._end);else{const e=this._isEndExtended?this._findExtendedEnd(this._end):null;e?n.setEndAfter(e):n.setEndBefore(this._end)}}catch(e){return t.logger.debug("marker select and remove error: "+e),null}finally{this.remove()}return n}remove(){this._removeStart(),this._removeEnd()}_createBookmark(e){let n,r;const i=e.collapsed;this._startInText=3===e.startContainer.nodeType&&e.startOffset>0,this._endInText=3===e.endContainer.nodeType;const o=e=>{let t=this.env.document.createElement("span");return t.style.display="none",t.innerHTML="â",t.className="flite-bookmark flite-bookmark-"+e,t.id=`${this.id}-${e}`,t};try{let t;if(this._start=n=o("start"),!i){this._end=r=o("end");const n=this._testExtendEndSelection(e);t=e.cloneRange(),n&&(this._isEndExtended=!0,t.setEndAfter(n),n.setAttribute("data-flite-extended-end","1")),t.collapse(!1),t.insertNode(r)}t=e.cloneRange();const s=this._testExtendStartSelection(e);s&&(t.setStartBefore(s),s.setAttribute("data-flite-extended-start","1"),this._isStartExtended=!0),t.collapse(!0),t.insertNode(n)}catch(e){t.logger.warn("While creating bookmark, "+e),this._start=this._end=null}}_validateExtendedNode(e){return 1!==(null==e?void 0:e.nodeType)||"body"===e.nodeName||e===this.env.element?null:e}_findExtendedEnd(e){if(e===this.env.element)return null;const t=e.previousSibling;return t?1!==t.nodeType||"1"!==t.getAttribute("data-flite-extended-end")?null:this._validateExtendedNode(t.lastChild):null}_findExtendedStart(e){if(e===this.env.element)return null;const t=e.nextSibling;return t?1!==t.nodeType||"1"!==t.getAttribute("data-flite-extended-start")?null:this._validateExtendedNode(t.firstChild):null}_testExtendEndSelection(e){var t;if(e.collapsed||1!==(null===(t=e.endContainer)||void 0===t?void 0:t.nodeType))return null;let n=null;if(e.endContainer===e.startContainer){n=0===e.startOffset&&e.endOffset===e.endContainer.childNodes.length?e.endContainer:null}else{n=e.endContainer.childNodes[e.endOffset]?null:e.endContainer}return this._validateExtendedNode(n)}_testExtendStartSelection(e){var t;if(e.collapsed||1!==(null===(t=e.startContainer)||void 0===t?void 0:t.nodeType)||0!==e.startOffset)return null;let n=null;if(e.endContainer===e.startContainer){n=e.endOffset===e.endContainer.childNodes.length?e.startContainer:null}else n=e.startContainer.firstChild?e.startContainer:null;return this._validateExtendedNode(n)}_validate(r,i){if(!r||!this.env.document)return null;try{if(r.parentNode&&this.env.document&&e.utils.dom.isDescendantOf(r,this.env.document))return r;const t=n(this.env.document).find(`#${this.id}-${i}`);if(t.length)return"end"===i?this._end=t[0]:this._start=t[0],t[0]}catch(e){return t.logger.warn("marker validate error "+e),null}}_removeStart(){if(this._validate(this._start,"start")){if(this._isStartExtended){const e=n(this._start).siblings("[data-flite-extended-start]");(e.length?e:n(this.env.element).find("[data-flite-extended-start]")).attr("data-flite-extended-start",null)}n(this._start).remove(),this._start=null}}_removeEnd(){if(this._validate(this._end,"end")){if(this._isEndExtended){const e=n(this._end).siblings("[data-flite-extended-end]");(e.length?e:n(this.env.element).find("[data-flite-extended-end]")).attr("data-flite-extended-end",null)}n(this._end).remove(),this._end=null}}_restoreText(e,t,n){const r=e.previousSibling,i=e.nextSibling,o=3===(null==r?void 0:r.nodeType),s=3===(null==i?void 0:i.nodeType),{startContainer:a,startOffset:l}=t,c=n&&this._startInText||!n&&this._endInText;function d(e,r){return n?t.setStart(e,r):t.setEnd(e,r),!0}if(o&&s){const e=r.length;return r.data+=i.data,n||t.setStart(a,l),d(r,e),i.parentNode.removeChild(i),!0}if(c){if(o)return d(r,r.length);if(s)return d(i,0)}return!1}}const o={createDOMMarker:function(e,t){return new i(e,t)}};Object.assign(t,o)}(window.LOOPINDEX),Object.defineProperty(i,"__esModule",{value:!0}),function(e){const t=null==e?void 0:e.FLITE,n=null==e?void 0:e.$;if(!t||!n)throw new Error("Cannot initialize FLITE tracker without FLITE globals");let r,i,o,s,a,l,c;!function(e){e[e.OK=0]="OK",e[e.IGNORE=1]="IGNORE",e[e.IGNORE_ALL=2]="IGNORE_ALL"}(r||(r={})),function(e){e[e.None=0]="None",e[e.Start=1]="Start",e[e.End=2]="End",e[e.All=3]="All"}(i||(i={})),function(e){e[e.None=0]="None",e[e.InsertedKeep=1]="InsertedKeep",e[e.InsertedDiscard=2]="InsertedDiscard"}(o||(o={})),function(e){e[e.DONT_TRACK=0]="DONT_TRACK",e[e.TRACK_TEXT=1]="TRACK_TEXT",e[e.TRACK_ALL=2]="TRACK_ALL"}(s||(s={})),function(e){e[e.None=0]="None",e[e.Start=1]="Start",e[e.Composing=2]="Composing"}(a||(a={})),function(e){e[e.inline=0]="inline",e[e.block=1]="block",e[e.none=2]="none"}(l||(l={})),function(e){e[e.Right=1]="Right",e[e.Left=2]="Left",e[e.None=0]="None"}(c||(c={}));const d=e.browser.msie,u=["tr:empty, ul:empty, ol:empty","tbody:empty","table:empty"],h=e.utils.createCISet("TD","TR","TH"),g=e.utils.createCISet("LI","P","DIV","H1","H2","H3","H4","H5","H6"),f=e.utils.createCISet("OL","UL"),p=e.utils.createCISet("LI","TD","TR","UL","OL"),m=e.utils.createCISet("BR","P","DIV","LI"),v=e.utils.createCISet("LI","OL","UL"),y=["pre","u","b","s","sub","sup","em","strong","a","span","blockquote:empty"].join(":empty,"),_=["P","DIV","H1","H2","H3","H4","H5","H6"].map(e=>e+".flite-container-only:empty").join(","),C=/^ul|ol$/i,b=[{start:0,end:31},{start:33,end:40},{start:45,end:45},{start:91,end:93},{start:112,end:123},{start:144,end:145}].reduce((e,t)=>{for(let n=t.start;n<=t.end;++n)e.add(n);return e},new Set),N=".scayt-misspell-word,span.mce-spellchecker-word,span[data-mce-lingo][aria-invalid]",T={},E={changeGroupTime:300,classes:{block:"ice-block"},deletableSelectors:"",opaqueSelectors:"",stylePrefix:"cts",changeTypes:{insertType:{className:"ins",action:"Inserted"},deleteType:{className:"del",action:"Deleted"}},_changeData:null};let S,k,x=void 0;!function(e){e[e.Always=1]="Always",e[e.NotEmpty=2]="NotEmpty"}(S||(S={})),function(e){e[e.None=0]="None",e[e.Bullet=1]="Bullet",e[e.Number=2]="Number"}(k||(k={}));const w=[{selector:"img,br,.cke_widget_wrapper,li",type:S.Always},{selector:"p,div,td,h1,h2,h3,h4,h5,h6",type:S.NotEmpty}],O={cleanSpellCheckingFromNode(t){if(e.utils.dom.isEmptyTextNode(t))return null;if(3===t.nodeType)return t;if(1!==t.nodeType)return t;if(O.isSpellcheckerNode(t)){const e=n(t).contents();return e.length?e.toArray():null}for(let e=t.firstChild,n=null==e?void 0:e.nextSibling;e;e=n,n=null==e?void 0:e.nextSibling){const r=O.cleanSpellCheckingFromNode(e);r?Array.isArray(r)&&(r.forEach(e=>{t.insertBefore(e,n)}),t.removeChild(e)):t.removeChild(e)}return t},getEmptyBlock:function(n,r=-1){const i=null==n?void 0:n.parentNode;if(!i)return null;if(3!==n.nodeType&&"BR"!==n.nodeName||(n=i),1!==n.nodeType)return null;if(r>=0){const e=n.childNodes[r];t.domUtils.isBlockElement(e)&&(n=e)}const o=n;let s=0;for(let t=o.firstChild;t;t=t.nextSibling){if("BR"===t.nodeName)s++;else{if(3!==t.nodeType)return null;if("Â "===t.data)s++;else if(!e.utils.strings.isEmptyString(t.data))return null}if(s>1)return null}return t.domUtils.isBlockElement(o)?o:null},collectTextChildren:function(t){if(1!==(null==t?void 0:t.nodeType))return[];const n=[];return e.utils.dom.forAllTextChildren(t,e=>n.push(e)),n},collectEmptyTextChildren:function(t){return O.collectTextChildren(t).filter(t=>e.utils.dom.isEmptyTextNode(t))},compareNodes:function(e,t){if(!e||!t)return!1;if(e===t)return!0;if(e.nodeName!==t.nodeName)return!1;const n=e.attributes.length;if(t.attributes.length!==n)return!1;for(let r=0;r<n;++r){const n=e.attributes[r],i=t.attributes[r];if(n.name!==i.name||n.value!==i.value)return!1}return!0},adjustSpellCheckerRange:function(t){return O.isSpellcheckerNode(t.startContainer)&&t.startContainer.firstChild?(0===t.startOffset?(t.setStart(t.startContainer.firstChild,0),t.collapse(!0)):(t.setEnd(t.startContainer.lastChild,e.utils.dom.getNodeLength(t.startContainer.lastChild)),t.collapse(!1)),t):t},createReplacementText:function(e){return"\ufeff"},shouldTrackChildren:function(e){return 3===e.nodeType?s.DONT_TRACK:e.nodeName in T?s.TRACK_TEXT:s.TRACK_ALL},isVirtuallyEmpty:function(n,r){const i=e.utils.dom.toJQuery(n);if(1!==i.length)return t.logger.error("isVirtuallyEmpty: input length is "+i.length),0===i.length;const o=i[0];if(3===o.nodeType)return"virtual"===r?e.utils.dom.isEmptyTextNode(o):!(o.length>0);if(1!==o.nodeType)return!1;if(i.is("BR"))return!0;if(e.utils.dom.matchesSelector(o,".flite-bookmark"))return!1;for(let e=o.childNodes.length-1;e>=0;--e){const t=o.childNodes[e];if(!this.isVirtuallyEmpty(t))return!1}return!0},isIgnoredKeyCode:function(e){return!e||b.has(e)},sortNodesByAncestry:function(t){return t.toArray().sort((function(t,n){return e.utils.dom.isDescendantOf(t,n)?-1:e.utils.dom.isDescendantOf(n,t)?1:0}))},isBogus:function(e){return!(!e||1!==e.nodeType||"BR"===e.nodeName)&&null!==e.getAttribute("data-mce-bogus")},getNodeAttributes:function(e){const t=e.attributes;let n,r=t&&t.length,i={};for(let e=0;e<r;++e)n=t[e],i[n.name]=n.value;return i},removeAllAttributes:function(e){let t,n=null;e.attributes;try{for(;e.attributes.length>0;){if(t=e.attributes[0],t===n)return;n=t,e.removeAttribute(t.name)}}catch(e){}},findNonSpellcheckerParent(e,t){if(!e||!t)return null;for(;e!==t&&(3===e.nodeType||O.isSpellcheckerNode(e));)e=e.parentNode;return e},isSpellcheckerNode:function(t){return Boolean(t&&e.utils.dom.matchesSelector(t,N))},findSpellcheckerParent:function(e,t){if(!e)return null;let n=1===e.nodeType?e:e.parentNode;for(;n&&n!==t;){if(O.isSpellcheckerNode(n))return n;n=n.parentNode}return null},removeSpellcheckerNode:function(e){const t=e.parentNode;if(t){for(;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}},tryToRemoveSpellcheckerNode:function(e,t){const n=O.findSpellcheckerParent(e,t);return n&&O.removeSpellcheckerNode(n),Boolean(n)},removeSpellCheckingFromRange:function(t,n){if(!t||!t.collapsed||!t.commonAncestorContainer)return t;const r=t.commonAncestorContainer;if(3===r.nodeType)return O.tryToRemoveSpellcheckerNode(r,n),t.syncToNative(),t;if(O.isSpellcheckerNode(r)){const n=r.parentNode,i=e.utils.dom.getNodeIndex(r),o=t.cloneRange();O.removeSpellcheckerNode(r);const s=n.childNodes[i];return s?o.collapseAt(s,!0):(o.setEnd(n,i),o.collapse(!1)),o}const i=r.childNodes[t.startOffset],o=r.childNodes[t.startOffset-1];let s=!1;O.isSpellcheckerNode(o)&&(s=!0,O.removeSpellcheckerNode(o));const a=i?e.utils.dom.getNodeIndex(i):r.childNodes.length;if(O.isSpellcheckerNode(i)&&(s=!0,O.removeSpellcheckerNode(i)),s){t.syncToNative();const e=t.cloneRange();return e.setStart(r,Math.min(a,r.childNodes.length)),e.collapse(!0),e}return t}};class A{constructor(){this._type="none",this._data=null,this._timeoutClient=e.utils.createTimeoutClient(),this._timeoutClient.createTimer("reset",{callback:()=>{this._type="none"},autoDispose:!1})}dispose(){this._timeoutClient.dispose()}setContext(e){this._type=e.type,this._data=e.data||{};const t=void 0===e.timeout?300:e.timeout;t>0&&this._timeoutClient.startTimer("reset",t)}mergeData(t){if(t)return this._data=e.$.extend({},this._data,t)}get data(){return this._data}popType(){const e=this._type;return this._type="none",this._timeoutClient.stopTimer("reset"),e}peekType(){return this._type}}class R{constructor(e){this.host=e,this._textChanged=!1,this._trackerChanged=!1,this._isUpdate=!1,this._isLocked=!1}textChanged(){return this._textChanged=!0,this}lock(){return this._isLocked=!0,this}unlockAndFinish(){return this._isLocked=!1,this.finish()}setIsUpdate(){return this._isUpdate=!0,this}trackerChanged(){return this._trackerChanged=!0,this}get hasChanges(){return this._textChanged||this._trackerChanged}reset(e="all"){return"all"!==e&&"tracker"!==e||(this._trackerChanged=!1),"all"!==e&&"text"!==e||(this._textChanged=!1),"all"===e&&(this._isLocked=this._isUpdate=!1),this}finish(){if(this._isLocked)return t.logger.debug("Edit transaction: finish suppressed"),this;try{const e=this._trackerChanged,t=this._isUpdate,n=this._textChanged;this.reset(),(e||n)&&this.host.onTrackerChange({isUpdate:t,trackerChanged:e,textChanged:n})}catch(e){t.logger.error("Error finishing edit transaction "+e)}return this}}class I{constructor(e){this.validator=e,this._changeType=null,this._change=null}getChangeType(){return this._changeType}reset(){return this._change=null,this._changeType=null,this}getChange(){return this._change}isValidFor(e){return Boolean(this._change&&e&&("mixed"===this._changeType||e===this._changeType)&&this.validator(this._change))}setChange(e){return this._change=e,this}setChangeType(e){return this._changeType=e,this}}const D={ChangeTracker:class{constructor(r,i){if(this._ignoreMutations=!1,this._boundEventHandler=null,this._mutationSummary=null,this._domObserver=null,this._batchChangeId="",this._uniqueIDIndex=1,this._compositionState=a.None,this._mutationListenRequestCount=0,this._opaqueTester=null,this._rootId=Math.round(1e6*Math.random()),this._insColorIndex=0,this._delColorIndex=0,!r)throw new Error("owner must be defined for flite construction.");const o=d?()=>{var e;return null===(e=this.host)||void 0===e?void 0:e.getBody()}:()=>this._env.element;this._changes=e.utils.createTypedArrayMap(e=>e.id);this._cachedChange=new I(e=>{if(!this._isCurrentSession(e.sessionId))return!1;const t=this.host.users.getCurrentUser(!1);if(e.userid!==(null==t?void 0:t.id))return!1;const n=this._params.timezoneOffset||0;return Date.now()+n-e.lastTime<this._params.changeGroupTime}),Object.defineProperty(this,"rootElement",{get:o,configurable:!1,enumerable:!0}),this.host=r,this._users={},this._env={document:null,window:null,element:null,frame:null},this._lastMutationContext=new A,this._isDeletableCallback=this._isDeletableElement.bind(this),this._timeoutClient=e.utils.createTimeoutClient(),this._editTransaction=new R(r),this._deleteOptions=this._createNodeSelectionSchemes(),this._monitorChangeId=this._createMonitorChangeId(),this._params=n.extend(!0,{},E,i),this._insertClassName=this._params.changeTypes.insertType.className,this._deleteClassName=this._params.changeTypes.deleteType.className,t.domUtils.addStubElementSelector(this._params.nodeClassifier.getSelector(t.NodeClassifier.NODE_ONLY)),this._insertSelector="."+this._getTrackedNodeClass("insertType"),this._deleteSelector="."+this._getTrackedNodeClass("deleteType"),this._fliteSelector=`${this._insertSelector},${this._deleteSelector}`,this._fliteTextSelector=`span${this._insertSelector}:not(.flite-container-only),span${this._deleteSelector}:not(.flite-container-only)`,this._domObserver=null,this._timeoutClient.createTimer("style",{callback:()=>{this._forAllUsers(e=>{const t=this.host.users.getUser(e.userId);t&&this.setUserStyle(e.userId,t.style)})},autoDispose:!1,timeoutMSecs:10})}dispose(){this._selection&&(this._selection.dispose(),this._selection=null),this._params=null,this._timeoutClient.clear(),this._setEnvFromRoot(null),this._$element=null,this._mutationSummary&&(this._mutationSummary.dispose(),this._mutationSummary=null),this._forAllUsers(e=>{e.styleLoader&&(e.styleLoader.dispose(),e.styleLoader=null),delete this._users[e.userId]}),this._lastMutationContext.dispose()}getSelectedNode(){const e=this._getNodeAtCaret({range:null});return null==e?void 0:e.node}getSelection(){return this._selection}createNativeRange(){return t.rangy.createNativeRange(this._env.document)}_removeArtifactsFromHTML(e){const r=this._env.document.createElement("div");try{return r.innerHTML=e,this._removeFLITEArtifacts({restoreCaret:!1,$root:n(r)}),r.innerHTML}catch(n){return t.logger.error("removeArtifactsFromHTML: "+n),e}}removeArtifactsFromHTML(e){try{const t=(()=>{const t=this._env.document.createElement("div");return t.innerHTML=e,n(t)})();return this._removeFLITEArtifacts({restoreCaret:!1,$root:t}),t}catch(e){return t.logger.error("removeArtifactsFromHTML: "+e),null}}removeFLITETracking(e,r=!1){if(1!==(null==e?void 0:e.nodeType))return;const i=e,o=i.getAttribute(this.attributes.changeId);Object.keys(this.attributes).forEach(e=>{i.removeAttribute(this.attributes[e])}),this._restoreNodeTitle(e),i.removeAttribute("data-flite-class"),t.domUtils.isTextContainer(e)&&i.removeAttribute("tabindex");const s=n(e);s.removeClass(this._insertClassName).removeClass(this._deleteClassName).removeClass("flite-container-only");const a=(i.className||"").split(" "),l=this._params.stylePrefix;a.forEach(e=>{e&&0===e.indexOf(l)&&s.removeClass(e)});return""===i.getAttribute("class")&&i.removeAttribute("class"),r&&o&&this._monitorChangeId(o),i}tryToTrackListStatusRemoval(r){const i=this._getCurrentRange(),o={mutation:"insert-list"};if(!(null==i?void 0:i.startContainer))return o;const a=i.startContainer,l=i.collapsed?3===a.nodeType?a:1===a.nodeType?a.childNodes[i.startOffset]||a.childNodes[i.startOffset-1]:null:null;if(!l)return o;const c=l?[l]:i.getNodes(),d=[],u=[],h=[];function g(e,t){e.indexOf(t)<0&&e.push(t)}const f={};for(const e of c){const n=t.domUtils.getNodeListStatus(e,this.rootElement);"bullet"===n.type?g(u,n.li):"number"===n.type?g(h,n.li):d.push(e)}const{isBullet:p,isBulk:m,trackTypeChange:v}=r,y=u.length&&p||h.length&&!p;if(d.length)return u.length||h.length?f:o;if(h.length&&u.length)return f;const _=(e=>{const t=[];for(const n of e){const e=t[t.length-1],r=this._getNodeTrackingContext(n,!0);if(e){if(e.isTracking!==r.isTracking||e.isInsert!==r.isInsert||e.isCurrent!==r.isCurrent)return null;t.push(r)}else t.push(r)}return t})(h.length?h:u);if(!(null==_?void 0:_.length))return f;const C=_[0];if(!C.isTracking&&!y){if(!v)return f;const t=p?h:u,r=e.utils.getUniqueId("li");return t.forEach(e=>{e.setAttribute("data-list-m-id",r)}),m&&t.forEach(e=>{n(e).siblings("LI").attr("data-list-m-id",r)}),Object.assign(Object.assign({},o),{selector:`[data-list-m-id='${r}']`,cleanup:e=>1===(null==e?void 0:e.nodeType)&&e.removeAttribute("data-list-m-id")})}if(y&&C.isCurrent&&C.isInsert)return f;const b=this._startBatchChange("delete"),N={trackChildren:s.DONT_TRACK,ctx:void 0,force:!0};try{if(y){const e=p?u:h;for(let t=0,n=_.length;t<n;++t){const n=_[t],r=n.trackingNode||e[t];n.isDelete?(N.ctx=n,this._tryToTrackAddedNode(r,N)):this._addDeleteTracking(r,{changeId:b.id,containerOnly:!0,trackingContext:n})}return{handled:!0}}if(C.isCurrent&&C.isInsert)return{handled:!1};for(const e of _)N.ctx=e,this._tryToTrackAddedNode(e.trackingNode,N);return{handled:!1}}catch(e){return t.logger.error("While tracking list status removal: "+e),{}}finally{this._endBatchChange(b)}}findNodeTrackingContext(e,t=!1){const n=this._getNodeTrackingContext(e,!t);return Object.assign(Object.assign({},n),{change:n.changeId?Object.assign({},this._changes.get(n.changeId)):null})}getWrappingChangeNode(e){return this._getNodeTrackingContext(e,!1).trackingNode}currentChangeNode(e){return this.getWrappingChangeNode(e)}ignoreNextMutation(e){this._mutationSummary&&this._mutationSummary.ignoreNextMutation(),t.logger.debug("ignore next mutation after "+(e||"(no reason provided)"))}trackSpellCheckChange(){let e=new MutationObserver(e=>{n(),t.logger.debug("received spellcheck mutations",e),this._handleSpellcheckMutation(e)});const n=()=>{e&&(e.disconnect(),e=null)};e.observe(this._$element[0],{characterData:!0,childList:!0,characterDataOldValue:!0,subtree:!0}),setTimeout(()=>{t.logger.debug("spellcheck mutation observer timeout"),n()},5)}_trackTextChange(e){let t=new MutationObserver(e=>{});t.observe(this._$element[0],{characterData:!0,characterDataOldValue:!0,subtree:!0})}toggleListenToCharacterChanges(e){if(!1===e)return this._characterMutationObserver&&(this._characterMutationObserver.disconnect(),this._characterMutationObserver=null),void this._restoreAllTextContent(this._$element);const{count:t,type:n,hideText:r}=e;let i=Math.round(t||0);const o={characterData:!0,childList:!0,characterDataOldValue:!0,subtree:!0};if(0!==i){const e="replace"===n||"replace-t6"===n?this._onReplaceTextChildrenMutation:null;if(!e)throw new Error("unknown chardata toggle type "+n);this._characterMutationObserver=this._characterMutationObserver||new MutationObserver(t=>{i>0&&i--,this._characterMutationObserver.disconnect(),(null==t?void 0:t.length)&&!this._ignoreMutations&&e.call(this,t),0!==i&&this._characterMutationObserver.observe(this.rootElement,o)}),this._characterMutationObserver.observe(this.rootElement,o),r&&this._hideAllDeletedText(this._$element)}else this._characterMutationObserver&&(this._characterMutationObserver.disconnect(),this._characterMutationObserver=null),this._restoreAllTextContent(this._$element)}getNodesForChange(e){const t=`[${this.attributes.changeId}='${e}']`;return this._$element.find(`${this._deleteSelector}${t},${this._insertSelector}${t}`)}_restoreAllTextContent(e){e.find(`${this._insertSelector}[${this.attributes.fliteTextContent}],${this._deleteSelector}[${this.attributes.fliteTextContent}]`).each((e,t)=>{this._restoreHiddenContent(t)})}_hideAllDeletedText(e){e.find(this._deleteSelector+":not(.flite-container-only)").each((e,t)=>{this._hideTextContent(t)})}_listenToMutations(e){const t=this._mutationSummary&&this._mutationSummary.isConnected;this._mutationListenRequestCount=Math.max(e,this._mutationListenRequestCount),this._mutationListenRequestCount&&!t&&this._createMutationObservers(!0)}setIgnoreMutations(e){return this._ignoreMutations}get currentUser(){var e;return null===(e=this.host)||void 0===e?void 0:e.users.getCurrentUser(!0)}get attributes(){return t.flitePluginUtils.trackerAttributes}get changeTypes(){return this._params.changeTypes}get changeData(){return this._params._changeData}get sessionId(){var e;return null===(e=this.host)||void 0===e?void 0:e.sessionId}toggleChangeTracking(e,t){return e?this._startTracking(t):this._stopTracking(),this}setUserStyle(e,n){if(!e)return;const r=this._users[e],i=r&&this.host.users.getUser(r.userId);if(!i)return t.logger.error("setUserStyle: no user",e);i.style=this._validateUserStyle(n);const o=this._getUserStyleSheet(e,!0);if(!o)return;o.reset(),o.addRule(`.FLITE-Tracking ${this._insertSelector}[${this.attributes.userId}='${e}']:not(.flite-container-only)`,i.style.insert);let s=i.style.insert["background-color"];s&&o.addRule(`.FLITE-Tracking :not(li)${this._insertSelector}.flite-container-only[${this.attributes.userId}='${e}']`,{"border-color":s}),o.addRule(`.FLITE-Tracking ${this._deleteSelector}[${this.attributes.userId}='${e}']:not(.flite-container-only)`,i.style.delete),s=i.style.delete["background-color"],s&&(o.addRule(`.FLITE-Tracking tr${this._deleteSelector}[${this.attributes.userId}='${e}']`,{"background-color":s}),o.addRule(`.FLITE-Tracking td${this._deleteSelector}[${this.attributes.userId}='${e}']`,{"background-color":s}),o.addRule(`.FLITE-Tracking :not(td,tr,li)${this._deleteSelector}.flite-container-only[${this.attributes.userId}='${e}']`,{"border-color":s}))}getCurrentUser(){return this.currentUser||{id:"",name:""}}removeUsers(t){if(t&&t.length){t=e.utils.strings.toStringArray(t);for(let e of t){const t=this._users[e];t&&(t.styleLoader&&(t.styleLoader.dispose(),t.styleLoader=null),delete this._users[e])}}}addUsers(t){t&&(e.$.isArray(t)||(t=[t]),t.forEach(e=>{this._addUser(e)}))}updateUser(e){const n=e&&e.id&&String(e.id),r=n&&this._users[n];if(!r||!r.userId)return t.logger.error("tracker can't set current user, unknown id",n);if(e.style&&this.setUserStyle(n,e.style),e.name){for(let t of this._changes.items)t.userid===e.id&&(t.username=e.name);if(this._$element){const t=`[${this.attributes.userId}='${n}']`,r=this.attributes.userName;this._$element.find(`${this._insertSelector}${t},${this._deleteSelector}${t}`).each((t,n)=>{n.setAttribute(r,e.name)})}}}prepareForInsertion(e){const t=this._getCurrentRange(!0),n=null==t?void 0:t.startContainer;if(!n)return!1;const r=this._getNodeTrackingContext(n);return t.collapsed?!!r.tracksContent&&(this._moveCaretOutOfTracking(t,r,void 0===e||e),Boolean(e)):this._prepareForSelectionInsertion(t,r)}_prepareForSelectionInsertion(e,t){let n=!1;const r=null==e?void 0:e.startContainer;t.tracksContent&&(n=!0,this._splitNode(t.trackingNode,r,e.startOffset),e.setStart(t.trackingNode,0));const i=this._getNodeTrackingContext(e.endContainer),o=[];if(i.tracksContent){n=!0;const r=i.trackingNode===t.trackingNode,s=this._splitNode(i.trackingNode,e.endContainer,e.endOffset);r?(e.selectNode(s),o.push(s)):(e.setEndAfter(s),o.push(s,e.startContainer))}else t.tracksContent&&o.push(e.startContainer);return o.forEach(e=>this.removeFLITETracking(e)),n&&this._selection.addRange(e),!1}addFullTrackingDataToNode(e){const t=this.getChangeForNode(e,!1);if(!t)return e;const r=this.attributes;return n(e).attr({[r.changeId]:t.id,[r.userName]:t.username,[r.userId]:t.userid,[r.changeData]:t.data||null,[r.time]:t.time,[r.lastTime]:t.lastTime,[r.sessionId]:t.sessionId||null}),e}addFullTrackingDataToDOM(t){return t&&n(t).find(this._fliteSelector).each((e,t)=>{this.addFullTrackingDataToNode(t)}),e.utils.dom.toElement(t)}isNodeVisible(e){if(e&&3===e.nodeType&&(e=e.parentNode),e){const t=e.getBoundingClientRect();return t.top>0&&t.left>0}}getWrappingTagName(e){return(e&&3!==e.nodeType?l.none:l.inline)===l.inline?"span":null}isOwnRoot(e){return e&&n(e).data("FLITE::rootid")===String(this._rootId)}reload(e){e?(this._loadEditor(e),this.setShowChanges(this.host.isVisible)):this._loadFromDom()}prepareToPaste(){const e=this._getCurrentRange(!1);if(e&&!e.collapsed){this._deleteSelection(e,{preserveContainers:!1,restoreSelection:i.All});const t=this._getCurrentRange(!1);if(t){t.collapse(!1);const e=this._prepareSelectionForInsert(null,t);this._selection.addRange(e)}}}prepareToCut(e){try{let r=this._getCurrentRange(!0);if(!r||r.collapsed)return!1;if("full"!==e)return this._momentarilyRemoveTrackingInRange(r),!1;if(r=this._cleanupSelection(r),this._editTransaction.lock(),t.flitePluginUtils.isClipboardAPIAvailable())return this._copyToClipboard(r),this._deleteSelection(r,{restoreSelection:i.End,preserveContainers:!1}),!0;t.trackerUtils.fixSelection(r,this.rootElement);const o=r.cloneContents(),s=o.firstChild,a=o.lastChild,l=t.createDOMMarker(this._env,r);let c=!0;for(let e=s;e&&c;e=e.nextSibling)this._shouldIgnoreNode(e,!0)||(c=!1);if(c)return!1;r.collapse(!1),r.insertNode(o),r.setStartBefore(s),r.setEndAfter(a);const d=this._startBatchChange("delete");try{return this._deleteSelection(r,{preserveContainers:!1,restoreSelection:i.None}),!1}catch(e){return t.logger.error(e,"While trying to delete selection"),!1}finally{if(this._endBatchChange(d),this._editTransaction.unlockAndFinish(),l){const e=l.selectAndRemove();e&&this._momentarilyRemoveTrackingInRange(e)}setTimeout(()=>{const e=`${this._insertSelector}:not(.flite-container-only)>BR,${this._deleteSelector}:not(.flite-container-only)>BR`;this._$element.find(e).each((e,t)=>{const r=n(t.parentNode);r[0].removeChild(t),r.is(":empty")&&this._removeNode(r[0])})},10)}}catch(e){return t.logger.error("prepareToCut:",e),!1}}prepareToCopy(e){const n=this._getCurrentRange();if(!1!==(null==n?void 0:n.collapsed))return!1;if("raw"===this.host.copyBehavior)return!1;if(t.flitePluginUtils.isClipboardAPIAvailable())return this._copyToClipboard(n),!0;try{this._momentarilyRemoveTrackingInRange(n)}catch(e){t.logger.error("While trying to prepare for copy: "+e)}return!1}setShowChanges(e){this._showTitles(Boolean(e))}unlistenToEvents(){setTimeout(()=>(this.rootElement&&this._boundEventHandler&&this.rootElement.removeEventListener("keydown",this._boundEventHandler,!0),this._boundEventHandler=null,this),0)}listenToEvents(){return this.rootElement&&!this._boundEventHandler&&(this._boundEventHandler=this.handleEvent.bind(this),this.rootElement.addEventListener("keydown",this._boundEventHandler,!0)),this}handleEvent(e,n,r){if("none"===n)return!0;try{this._editTransaction.lock();let i=!1;return"keypress"==e.type?i=this._keyPress(e,n,r):"keydown"==e.type&&(i=this._handleKeyDown(e,n,r)),i&&(e.stopImmediatePropagation(),e.preventDefault(),this.host.fireEvent(t.Events.EVENT_INTERCEPTED,{event:e,flite:this.host})),!i}catch(e){return t.logger.error("Error processing eveng "+e),!0}finally{this._editTransaction.unlockAndFinish()}}insertText(e){const{text:n,mode:r,readonlyPolicy:o}=e;if("readonly"===r){const e="insert"===o?n:void 0;return this.prepareForInsertion(e)}if(this.host.getIMECompositionState()!==a.None){const e=this._getCurrentRange(),n=e.collapsed&&e.startContainer,r=n&&this._getNodeTrackingContext(n);if(r.tracksContent&&r.isCurrent)return t.logger.debug("Ignoring typing in IME",e.inspect()),!1}let s=e.range||this._getCurrentRange(!0);if(s=this.host.beforeInsert(s),!s||this.keyboardMapper)return!1;const l=this._getNodeTrackingContext(s.startContainer,!1);if(l.isInsert&&l.tracksContent&&l.isCurrent&&(s.collapsed||3===s.startContainer.nodeType&&s.endContainer===s.startContainer))return this._selection.addRange(s),!1;const c=Boolean(s&&!s.collapsed);if(s.commonAncestorContainer!==this.rootElement&&this._shouldIgnoreNode(s.commonAncestorContainer,!1))return!1;s=this._cleanupSelection(s);const d=this._startBatchChange("insert",l);let u=!1;try{if(c&&(this._deleteContents(i.End,s,!0),s=this._moveRangeToValidTrackingPos(this._getCurrentRange())),s){const{inserted:e,element:r,range:i}=this._doInsertText(n,s);if(u=e)this._editTransaction.textChanged();else if(r){const e=t.flitePluginUtils.trackerAttributes.stubNode;r.setAttribute(e,"true"),t.trackerUtils.monitorTextNode(r,(t,n)=>{n?(t.removeAttribute(e),this.host.saveUndo()):this._removeNode(t)})}this._selection.addRange(i)}}catch(e){t.logger.error(e,"while trying to insert nodes")}finally{this._endBatchChange(d)}return u}markNodeForPendingInsertion(e){e&&1===e.nodeType&&(e.setAttribute("data-flite-inserting","1"),this._timeoutClient.createTimer("pendingattr",{callback:()=>{try{e.removeAttribute("data-flite-inserting")}finally{}},autoDispose:!0,timeoutMSecs:5}).start())}setMutationContext(e,n){t.logger.debug("set mutation context",e,n),this._lastMutationContext.setContext({type:e,data:n||{},timeout:null==n?void 0:n.timeout}),this._listenToMutations(1)}updateMutationContext(e,n,r=!0){const i=this._lastMutationContext.peekType();i&&"none"!==i?i===e?this._lastMutationContext.mergeData(n):t.logger.debug("updateMutationContextData mismatch",i,e):this.setMutationContext(e,Object.assign(Object.assign({},n),{timeout:1}))}getMutationContext(){return this._lastMutationContext.peekType()}getCleanDOM(t,r){let i;i=t?"string"==typeof t?n(`<div>${t}</div>`):n(t).clone():this._$element.clone();const o=`[${this.attributes.isDeleteNode}]`;let s=this._cleanBody(i,this._fliteSelector,this._deleteSelector,":not(.flite-container-only)",r);s=this._cleanBody(s,o,o,null,r);const a=s[0];return this._selection.createRange().selectNodeContents(a),O.cleanSpellCheckingFromNode(a),e.utils.dom.normalizeNode(a),a}processInsertedNodes(e,n){var r,o;if(!(null==e?void 0:e.length))return[];let s=this._getCurrentRange(!0);s=null===(o=(r=this.host).beforeInsert)||void 0===o?void 0:o.call(r,s);const a=!1===(null==s?void 0:s.collapsed);let l;this._editTransaction.lock();try{if(n.deleteSelection&&a){this._deleteContents(i.End,s,!0),s=this._selection.getRange();const e=this._getNodeTrackingContext(s.startContainer);this._moveCaretOutOfTracking(s,e,!0),s=this._getCurrentRange()}l=n.markup?this._markupInsertedNodes(e,s):e}catch(e){t.logger.error(e,"while trying to insert nodes"),l=[]}finally{this._editTransaction.reset()}return l}getNodeChangeId(e){if(!e)return null;return this._getNodeTrackingContext(e,!1).changeId||null}isInsideChange(e,n){try{const t=Boolean(this.getWrappingChangeNode(e));return n||t||this._cachedChange.reset(),t}catch(e){return t.logger.error(e,"While testing if isInsideChange"),!1}}hasChanges(){return this._changes.length>0}_createMarkerForTrackedNode(e,r){const i=e.getAttribute(this.attributes.changeId),o=this._changes.get(i);if(!o)return null;try{const t=JSON.stringify(o),i=e.className;return n("<span>&#8203;</span>").attr("data-flite-wrapper-change",t).attr("data-flite-wrapper-selector",r).attr("data-flite-wrapper-classes",i)}catch(e){return t.logger.error("wrapTrackedNodes",e),null}}getChangeForNode(e,t){if(!e||1!==e.nodeType)return null;const r=e.getAttribute(this.attributes.changeId),i=r&&this.getChangeForId(r);return i?!1===t?i:n.extend({},i):null}wrapTrackedNodes(t,n){const r=this.setIgnoreMutations(!0),i=[];let o,s;for(let r=0;r<t.length;++r)o=t[r],e.utils.dom.matchesSelector(o,n)&&(s=this._createMarkerForTrackedNode(o,n),s&&i.push(s[0])),i.push(o);return this.setIgnoreMutations(r),i}getTrackedNodes(){return this._$element?this._$element.find(this._fliteSelector):n()}countChanges(e){return this._filterChanges(e).count}acceptAll(e){return this._acceptRejectSome(e,!0)}rejectAll(e){return t.flitePluginUtils.demoNotice()}acceptChange(e){return this._acceptOrRejectChange(e,!0)}rejectChange(e){return this._acceptOrRejectChange(e,!1)}getChanges(e){const t=e?this._filterChanges(e):{count:this._changes.length,changes:this._changes.asObject};return n.extend(!0,{},t)}getChangeForId(e){const t=this._changes.get(e);return t?n.extend({},t):null}navigateToChangeNode(t){const n=this.getSelectedNode();if(!n)return null;const r=this._getNodeTrackingContext(n).trackingNode||n,i=this.getTrackedNodes().toArray(),o=i.length;if(o<1)return null;let s=null;switch(i.sort(e.utils.dom.compareNodePosition),t){case"next":for(let t=0;r&&!s&&t<o;++t)e.utils.dom.isDescendantOf(r,i[t])||-1!==e.utils.dom.compareNodePosition(r,i[t])||(s=i[t]);break;case"prev":for(let t=o-1;r&&!s&&t>=0;--t)e.utils.dom.isDescendantOf(r,i[t])||-1!==e.utils.dom.compareNodePosition(i[t],r)||(s=i[t]);break;case"first":s=i[0];break;case"last":s=i[o-1]}return s&&this._selection.setStart(s,!0,0),s}preserveWhiteSpace(r){return n(r).find(this._fliteTextSelector).each((n,r)=>{e.utils.dom.forAllTextChildren(r,t.domUtils.preserveWhiteSpaces)}),r}getTrackingRecord(e,n){let r,i=null,o="";if(n.idOnly){const n=(e.attr(t.flitePluginUtils.trackerAttributes.fliteRecordId)||"").split(":");3===n.length&&(i=this.getChangeForId(n[0]),r=n[1],o=n[2])}else{const r=e.attr(t.flitePluginUtils.trackerAttributes.changeId);i=this.getChangeForId(r),o=n.parentSelector}return i?{change:i,changeType:e.hasClass(this._insertClassName)?"insertType":"deleteType",trackedNodeSelector:o}:null}clearTrackingRecords(e){let r;"string"==typeof e?(r=this._env.document.createElement("div"),r.innerHTML=e):r=e;const i=t.flitePluginUtils.trackerAttributes.fliteRecord;return n(r).find(`[${i}]`).each((e,t)=>{t.removeAttribute(i)}),r}markNodes(r,i){if(!(null==r?void 0:r.length))return[];const o=[],s=[],a=[];try{for(let i of r){const r=i;if(1===r.nodeType){if(o.indexOf(r)<0){o.push(r);const t=e.utils.getUniqueId("tm-"),i=n(`<span data-flite-marker-id="${t}" style="display:none"></span>`);s.push(i),r.setAttribute("data-flite-marker-target",t),a.push(t),i.insertBefore(r)}}else t.logger.warn("Cannot mark text nodes for deletion")}}catch(e){t.logger.error(e)}finally{-1!==i&&(i=Math.max(i||1,1),this._env.window.setTimeout(()=>{t.logger.debug("mark nodes cleanup callback"),s.forEach(e=>{try{e.remove()}catch(e){t.logger.error("marker cleanup: "+e)}})},i))}return a.length?a:[]}_markupInsertedNodes(e,n,r){const i=this._startBatchChange(null),o=[];let a=!0;try{const t=null==n?void 0:n.startContainer,l=t&&this._getNodeTrackingContext(t);(null==l?void 0:l.isTracking)&&this._moveCaretOutOfTracking(n,l,!1);const c={changeId:void 0,containerOnly:!1,trackChildren:s.DONT_TRACK,type:"insertType"},d=e.reduce((e,t)=>{const n=O.cleanSpellCheckingFromNode(t);return Array.isArray(n)?e.push(...n):n&&e.push(n),e},[]);for(let e=0,t=d.length;e<t;++e){const t=d[e],n=3===t.nodeType;c.changeId=null,c.containerOnly=!n,c.trackChildren=void 0===r?O.shouldTrackChildren(t):r,n&&this._removeTextNodeFromTrackingContext(t),o.push(this._createTrackedNode(t,c)),"TABLE"===t.nodeName&&(a=!1)}}catch(e){t.logger.error("_markupInsertedNodes: ",e)}finally{this._endBatchChange(i),a||this._cachedChange.reset()}return o}get opaqueTester(){return this._opaqueTester||(this._opaqueTester=e=>this._isOpaqueNode(e))}_removeTextNodeFromTrackingContext(t){const n=this._getNodeTrackingContext(t);if(!n.tracksContent)return t;const r=n.trackingNode;if(t===r.firstChild&&r.parentNode)r.parentNode.insertBefore(t,r);else if(t===r.lastChild)e.utils.dom.insertAfter(t,r);else{this._splitNode(r,t,0);const e=this._splitNode(r,t.nextSibling,0);this._replaceNodeWithContent(e)}return t}_moveCaretOutOfTracking(e,n,r){if(!(null==e?void 0:e.collapsed)||!n.tracksContent)return e;const i=this.setIgnoreMutations(!0),o=n.trackingNode;try{const t=(e=e.cloneRange()).startContainer,n=e.startOffset,s=1===t.nodeType?o:t,a=this._splitNode(o,s,e.startOffset),l=a!==o||0==n,c="string"==typeof r,d=c?r:r?"\ufeff":"";if(d){const t=this._env.document.createTextNode(d);o.parentNode.insertBefore(t,l?o:o.nextSibling),c?(e.setEnd(t,t.length),e.collapse(!1)):e.selectNode(t),this._selection.addRange(e)}else this._selection.collapseAt(o,l)}catch(e){t.logger.error("move caret out of tracking: "+e)}finally{this.setIgnoreMutations(i)}return e}_cleanBody(e,t,r,i,{removeDeleted:o=!1}){const s=e.find(t),a=e=>!!e.is(r)&&(e.is(".flite-container-only")?this._replaceNodeWithContent(e):e.remove(),!0);return n.each(s,(e,t)=>{const r=n(t);!i||r.is(i)?o&&a(r)||this._replaceNodeWithContent(r):this.removeFLITETracking(t)}),e.find("span[data-flite-wrapper-change]").remove(),e}_acceptRejectSome(e,n){this._editTransaction.lock(),this._markInlines();const r=t.createDOMMarker(this._env,this._getCurrentRange());try{const t=e=>{this._processChange({node:e,allChanges:!1,strict:!0,isAccept:n,notify:!1})};let i,o,s=this.getChanges(e);for(i in s.changes){const e=this.getNodesForChange(i);o=O.sortNodesByAncestry(e),o.forEach(t),this._changes.removeById(i)}this._editTransaction.finish()}catch(e){t.logger.error("FLITE acceptReject",e)}finally{this._cleanupInlines(),this._removeFLITEArtifacts({restoreCaret:!1,$root:this._$element,bookmark:r}),this._selection.addRange(r.selectAndRemove()),this._editTransaction.unlockAndFinish()}}_createTrackedNode(e,n){let r=e,i=!0,o=n.trackChildren,a=n.containerOnly;const l=this.getWrappingTagName(e);if(l){const e=this._env.document.createElement(l);if(r){const t=r.parentNode;t&&t.insertBefore(e,r),e.appendChild(r)}e.setAttribute(this.attributes.fliteCreated,"1"),e.setAttribute(t.flitePluginUtils.trackerAttributes.spellcheck,"false"),a=this._isOpaqueNode(r),i=!1,o=s.DONT_TRACK,r=e}else(null==e?void 0:e.ownerDocument)===this._env.document&&this._editTransaction.textChanged(),r=e;return this._useChange({type:n.type,node:r,changeId:n.changeId,containerOnly:a,filterNodes:i,ignoredNodes:n.ignoredNodes,trackChildren:o}),r}_startTracking(e){return this._loadEditor(e),this.setIgnoreMutations(!1),this._compositionState=this.host.getIMECompositionState(),this}_stopTracking(){try{this._timeoutClient.stopAll(),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null),n(this._env.document).off(".flite"),this._mutationSummary&&(this._mutationSummary.disconnect(),this._mutationSummary=null),this._resetBackgroundColors()}catch(e){t.logger.error(e,"While trying to stop tracking")}return this}_filterChanges(e){let t=0,r={},i=e||{},o=i.filter,s=i.exclude?n.map(i.exclude,String):null,a=i.include?n.map(i.include,String):null,l=i.verify,c=null;for(let e of this._changes.items){let n=o&&!o({userid:e.userid,time:e.time,data:e.data})||s&&s.indexOf(e.userid)>=0||a&&a.indexOf(e.userid)<0;n||(l&&(c=this.getNodesForChange(e.id),n=!c.length),n||(++t,r[e.id]=e))}return{count:t,changes:r}}_cleanupLINode(e){if("LI"!==e[0].nodeName)return;const r=[];e.children("br").each((function(e,i){if(i.previousSibling&&!i.nextSibling)r.push(i);else if(i.nextSibling&&!i.previousSibling)r.push(i);else if(n(i.nextSibling).is("br[data-mce-bogus]"))r.push(i.nextSibling);else if(i.nextSibling){"block"===t.domUtils.getComputedStyle(i.nextSibling,"display")&&r.push(i)}})),n(r).remove()}_acceptOrRejectChange(n,r){this._markInlines();const i="string"==typeof n?this.getNodesForChange(n)[0]:n,o=t.createDOMMarker(this._env,this._getCurrentRange());if(!i)return e.logger.warn("accept/reject change: no node found for "+n),!1;this._editTransaction.lock();try{return t.flitePluginUtils.demoNotice()}catch(e){return t.logger.error(e),!1}finally{this._cleanupInlines(),this._selection.addRange(o.selectAndRemove()),this._editTransaction.unlockAndFinish()}}_processChange(r){const{allChanges:i}=r;let o=r.node;const s=t.domUtils;let a,l,c,d,u;const h=this._$element,g=this._deleteSelector,f=this._insertSelector,p=this._deleteClassName,m=this._insertClassName,v=r.isAccept,y=!1!==r.notify;try{if(a=g,l=f,c=s.getNode(o,this._fliteSelector,r.strict?void 0:h[0]),!c)return!1;const t=c.getAttribute(this.attributes.changeId),_=i?h.find(`${a}[${this.attributes.changeId}='${t}']`):e.utils.dom.matchesSelector(o,a)?n(o):n(null);d=_.length,_.each((e,t)=>{if(!(null==t?void 0:t.parentNode))return;this._editTransaction.textChanged().trackerChanged();const r=n(t);if(this._cleanupLINode(r),this.host.onTrackingNodeRemoved(t),r.hasClass("flite-container-only")&&!this._isOpaqueNode(t))this._acceptDeletedParagraph(r)||this._replaceNodeWithContent(r);else{const e=this.host.getRelatedNodes("reject",t);this._removeNode(t),e.forEach(e=>this._removeNode(e))}});const C=i?h.find(`${l}[${this.attributes.changeId}='${t}']`):e.utils.dom.matchesSelector(o,l)?n(o):n(null);d+=C.length,n.each(C,(r,i)=>{if(!i.parentNode)return;const o=n(i);this._editTransaction.textChanged().trackerChanged(),this._cleanupLINode(o),this.host.onTrackingNodeRemoved(i),u=o.contents(),o.removeClass(m).removeClass(p),this._restoreNodeTitle(i),i.getAttribute(this.attributes.fliteCreated)?this._replaceNodeWithContent(o):(this.removeFLITETracking(i),v&&this._processImplicitAccept(i,t)),n.each(u,(t,n)=>{e.utils.dom.normalizeNode(n.parentNode)})}),i&&this._changes.removeById(t),y&&this._editTransaction.finish()}finally{return r.notify&&this._editTransaction.finish(),d>0}}_processImplicitAccept(r,i){if(!e.utils.dom.matchesSelector(r,"td,th"))return;const o=n(r).closest("table"),s=o.attr(t.flitePluginUtils.trackerAttributes.changeId);s&&s!==i&&this.removeFLITETracking(o[0],!0)}_acceptDeletedParagraph(e){const t=e[0],r=null==t?void 0:t.nodeName;if(!g.has(r))return!1;const i=t.previousSibling;if(i&&g.has(i.nodeName)){const t=e.contents();return n(i).append(t).find("BR ~ BR").remove(),this._preserveBookmarks(e).remove(),!0}return!1}_preserveBookmarks(t){const n=e.utils.dom.toJQuery(t),r=n.find(".flite-bookmark");return n.before(r),n}_getTrackedNodeClass(e){return this._params.changeTypes[e].className}_getOppositeTChangeType(e){return"deleteType"===e?"insertType":"deleteType"}_setEnvFromRoot(e){var t,n;const r={element:e||null,document:null==e?void 0:e.ownerDocument,window:null,frame:null};return r.window=(null===(t=r.document)||void 0===t?void 0:t.defaultView)||window.self,r.frame=null===(n=r.window)||void 0===n?void 0:n.frameElement,Object.assign(this._env,r),this._env}_loadEditor(e){if(t.logger.debug("FLITE Tracker loading environment for root element"),this._timeoutClient.stopAll(),!d&&this.isOwnRoot(e))return this._loadFromDom();this._forAllUsers(e=>{e.styleLoader&&(e.styleLoader.dispose(),e.styleLoader=null)}),this._$element=n(e),this._$element.data("FLITE::rootid"),String(++this._rootId),this._setEnvFromRoot(e),this._cachedChange.reset(),this._selection&&this._selection.dispose(),this._selection=new t.Selection(this._env),this._selection.setHook(this._onRangeChanged.bind(this)),this._loadFromDom(),this._reloadUserStyles(),this._createNodeSelectionSchemes()}_createNodeSelectionSchemes(){const r={nodeFilter:this._isDeletableCallback,visitFilter:e=>!this._isOpaqueNodeOrParent(e),depthFirst:!0},i=e=>this.host.isEditorArtifact(e),o=e=>1===(null==e?void 0:e.nodeType)&&t.domUtils.isTableElement(e),s=t=>1===t.nodeType&&(e.utils.dom.matchesSelector(t,"IMG,BR,INPUT,BUTTON")||this._isOpaqueNode(t)),a=e=>3===e.nodeType||t.domUtils.isBlockElement(e)&&t.domUtils.isTextContainer(e)||s(e),l=e=>3===e.nodeType||s(e),c={stopFilter:o,nodeFilter:a,skipFilter:i},d={stopFilter:o,nodeFilter:a,skipFilter:i},u={stopFilter:o,nodeFilter:l,skipFilter:i},h={nodeFilter:l,stopFilter:o,skipFilter:i},g=n.extend({},r,{excludeSelf:!1,queryParent:!1}),f=n.extend({},r,{queryParent:!1,excludeSelf:!0});return{rightNeighborForDelete:c,leftNeighborForDelete:d,rightNeighborForSelect:h,withSelfNoParent:g,noSelfNoParent:f,noFilterNoSelf:n.extend(!0,{},r,{queryParent:!0,excludeSelf:!0,nodeFilter:null}),noFilterWithSelf:n.extend(!0,{},r,{queryParent:!0,excludeSelf:!1,nodeFilter:null}),noSelfNoParentNoBR:n.extend({},f,{nodeFilter:e=>!(!e||"BR"===e.nodeName)&&this._isDeletableCallback(e)}),leftNeighborForSelect:u}}_reloadUserStyles(){this._timeoutClient.startTimer("style")}_loadFromDom(){t.logger.debug("FLITE Tracker loading changes from DOM");this.hasChanges()&&this._editTransaction.trackerChanged(),this._changes.clear();const e=Date.now();this._removeFLITEArtifacts({restoreCaret:!1,$root:this._$element});this.getTrackedNodes().each((n,r)=>{const i=r.getAttribute(this.attributes.userId),o=r.getAttribute(this.attributes.changeId)||r.getAttribute("data-cid")||"";if(!o||isNaN(Number(o))||!i)return this.removeFLITETracking(r),void t.logger.error("missing change id or user id in tracked node");r.removeAttribute("data-cid"),r.setAttribute(this.attributes.changeId,o);let s=this.host.users.getUser(i);s?r.setAttribute(this.attributes.userName,s.name):s=this.host.users.addUser({id:i,name:r.getAttribute(this.attributes.userName)}),r.setAttribute(this.attributes.changeId,String(o));let a=parseInt(r.getAttribute(this.attributes.time)||"");isNaN(a)&&(a=e);let l=parseInt(r.getAttribute(this.attributes.lastTime)||"");isNaN(l)&&(l=a);const c=r.getAttribute(this.attributes.sessionId),d=r.getAttribute(this.attributes.changeData)||"";this._changes.addItem({item:{id:o,userid:i,username:s.name,time:a,lastTime:l,sessionId:c,data:d},replace:!0}),this._editTransaction.trackerChanged(),this._finalizeTrackedNode(r)}),this.preserveWhiteSpace(this._env.element),this._restoreEncodedChanges(),this._editTransaction.finish()}_restoreEncodedChanges(){const e=t.flitePluginUtils.trackerAttributes.fliteRecord;this._$element.find(`[${e}]`).each((r,i)=>{var o;const s=n(i),a=(s.attr(e)||"").replace(/&quote;/g,'"');if(s.attr(e,null),a)try{const e=JSON.parse(a),n=null===(o=null==e?void 0:e.change)||void 0===o?void 0:o.id;if(!n||!e.trackedNodeSelector)return void t.logger.warn("bad tracking record "+a);const r=s.parents(e.trackedNodeSelector).eq(0);r.length&&(this._changes.hasId(n)||this._changes.addItem({item:e.change}),this._addNodeToChange(n,r[0],e.changeType))}catch(e){t.logger.error("while restoring encoded changes: "+e)}})}_finalizeTrackedNode(e){1===(null==e?void 0:e.nodeType)&&this.host.onTrackingNodeCreated(e)}getNewChangeId(){let e;do{e=String(++this._uniqueIDIndex)}while(this._changes.hasId(e));return e}_useChange(e){let n=e.changeId||this._batchChangeId,r="deleteType"===e.type?"delete":"insert",i=this._changes.get(n)||this._getCurrentChange(r);i?this._updateChangeTime(i):(i=this._createChange(n),this._cachedChange.setChange(i).setChangeType(r),this._editTransaction.trackerChanged()),n=i.id;const o=e.node;if(1!==(null==o?void 0:o.nodeType)||o===this.rootElement)return i;const a=Boolean(o.getAttribute(t.flitePluginUtils.trackerAttributes.fliteCreated)),l=e.filterNodes&&!a?this._params.nodeClassifier.classifyNode(o,this.rootElement,!0,!1):t.NodeClassifier.NODE_AND_CONTENT,c=l===t.NodeClassifier.NODE_ONLY,d=!(!c&&!a&&(this.host.isPassThroughNode(o)||t.domUtils.isInlineElement(o,["A"])))&&(l===t.NodeClassifier.NODE_AND_CONTENT||l===t.NodeClassifier.NODE_ONLY);if(l===t.NodeClassifier.IGNORE)return i;if(d&&this._addNodeToChange(n,o,e.type),(e.containerOnly||c)&&(d&&o.classList.add("flite-container-only"),e.trackChildren!==s.DONT_TRACK&&o.childNodes.length&&!c)){const n=o,r=Array.from(n.childNodes),a=e.ignoredNodes;let l,c;const d=e.trackChildren===s.TRACK_TEXT;for(let n=0,o=r.length;n<o;++n){if(l=r[n],a&&a.indexOf(l)>=0)return i;if(d&&3!==l.nodeType)return i;c=this._params.nodeClassifier.classifyNode(l,this.rootElement,!0,!0),c!==t.NodeClassifier.IGNORE&&this._createTrackedNode(l,{type:e.type,changeId:i.id,ignoredNodes:a,containerOnly:3!==l.nodeType,trackChildren:e.trackChildren})}}return i}_createChange(e){const t=this.getCurrentUser(),n={id:e,time:0,lastTime:0,sessionId:this.sessionId,userid:t.id,username:t.name,data:this.changeData||""};return this._updateChangeTime(n),n.time=n.lastTime,this._changes.addItem({item:n}),n}_getCurrentChange(e,t){const n=this._cachedChange.getChange();if(!n)return null;if(t){const r=this._cachedChange.getChangeType();return t.changeId!==n.id||!t.isCurrent||"mixed"!==r&&r!==e?null:n}return this._cachedChange.isValidFor(e)?n:null}_addNodeToChange(e,t,r){let i=this.getChangeForId(e);const o=this.attributes,s=n(t),a=this._getTrackedNodeClass(r),l=this._getTrackedNodeClass(this._getOppositeTChangeType(r));i||(i=this._createChange(e),this._editTransaction.trackerChanged()),this._updateChangeTime(i);const c={[o.changeId]:e,[o.userName]:i.username,[o.userId]:i.userid||"0",[o.changeData]:String(i.data||""),[o.time]:i.time,[o.lastTime]:i.lastTime,[o.sessionId]:i.sessionId||null};s.attr(c).addClass(a).removeClass(l),this.host.onTrackingNodeCreated(t)}_isCurrentSessionNode(e){const t=this.getChangeForNode(e,!1);return Boolean(t&&t.sessionId==this.sessionId)}_updateChangeTime(e){const t=this.getNodesForChange(e.id),n=this.attributes.lastTime,r=this._params.timezoneOffset||0,i=Date.now()+r;e.lastTime=i,e.time||(e.time=i),t.each((e,t)=>{t.setAttribute(n,String(i))})}_getCurrentRange(e=!1){let n=null,r=!1;try{if(e){r=!0;const e=this.host.getHostNativeRange();n=e&&new t.rangy.WrappedRange(e.cloneRange())}if(n=null!=n?n:this._selection.getRangeAt(0),!n&&!r)return this._getCurrentRange(!0);const i=this.rootElement;return(null==n?void 0:n.intersectsNode(i))||(n=this._selection.createRange(),n.setStartAndEnd(i,0,i,0)),n}catch(e){return t.logger.error(e,"While trying to get current range"),n}}_getCleanSelectedRange(){const e=this._getCurrentRange();return this._cleanupSelection(e)}_deleteContents(e,n,r){let o=!0;if(!(n=this.host.beforeDelete(n||this._getCurrentRange(!0))))return!1;this._selection.addRange(n);const s=this._startBatchChange("delete");n=this._cleanupSelection(n);try{n.collapsed?o=e===i.End?this._deleteForward(n):this._deleteBack(n):this._deleteSelection(n,{restoreSelection:e,preserveContainers:r})}catch(e){t.logger.error(e)}finally{this._endBatchChange(s)}return o}_deleteSelection(e,n){const r=t.createDOMMarker(this._env,e),o=r.getNodesInRange(),s=this._startBatchChange("delete");try{for(let e=0;e<o.length;e++){const t=o[e];this._editTransaction.textChanged(),this._markNodeAsDeleted(this.host.findTargetNode(t),s.id,!0)}}catch(e){t.logger.error(e)}finally{switch(n.restoreSelection){case i.All:this._selection.addRange(r.selectAndRemove());break;case i.End:case i.Start:this._selection.addRange(r.collapseAndRemove(n.restoreSelection===i.Start));break;default:r.remove()}n.preserveContainers||this._removeFLITEArtifacts({restoreCaret:!1,$root:this._$element}),this._endBatchChange(s)}}_copyToClipboard(e){const r=e.cloneContents(),i=n("<div></div>").append(r)[0],o=this.getCleanDOM(i,{removeDeleted:"raw"!==this.host.copyBehavior}),s=new Blob([o.innerHTML],{type:"text/html"}),a=new Blob([t.domUtils.domToString(o)],{type:"text/plain"});return navigator.clipboard.write([new ClipboardItem({[s.type]:s,[a.type]:a})]).catch(e=>t.logger.warn("write to clipboard error "+e)),!0}_markNodeAsDeleted(e,t,r){if(!e||!e.parentNode||this._shouldIgnoreNode(e,!0))return null;const i=this._getNodeTrackingContext(e),o=3===e.nodeType,s=!o&&this._isOpaqueNode(e),a=i.trackingNode===e,l=a?n(e).hasClass("flite-container-only"):!o&&!s,c={changeId:t,containerOnly:l,trackingContext:i,trackContent:!1};if(!i.isTracking||!i.tracksContent&&!a){const t=this._addDeleteTracking(e,c),n=this.host.getRelatedNodes("delete",e);if(n.length){const e=Object.assign(Object.assign({},c),{containerOnly:!0});n.forEach(t=>this._addDeleteTracking(t,e))}return t}if(i.isDelete)return null;if(i.isCurrent)return r&&this._removeNode(e,i),null;let d;if(o){const t=e.length;this._splitNode(i.trackingNode,e,0);d=this._splitNode(i.trackingNode,e,t)}else d=i.trackingNode;return this._addNodeToChange(t,d,"deleteType"),this.host.getRelatedNodes("delete",d).forEach(e=>this._addNodeToChange(t,e,"deleteType")),d}_startBatchChange(e,t){let n=!this._batchChangeId;if(n){const n=this._getCurrentChange(e,t);this._batchChangeId=(null==n?void 0:n.id)||this.getNewChangeId()}else t&&t.changeId!==this._batchChangeId&&(this._batchChangeId=this.getNewChangeId(),n=!0);return{id:this._batchChangeId,top:n}}_endBatchChange(e){(null==e?void 0:e.id)===this._batchChangeId&&e.top&&(this._batchChangeId=null,this._editTransaction.finish())}_removeNode(e,t=null){(null==e?void 0:e.parentNode)&&(t=t||this._getNodeTrackingContext(e),this._preserveBookmarks(e).remove(),t.isTracking&&this._monitorChangeId(t.changeId))}_contractSelection(n){const{first:r,last:i}=e.utils.dom.getRangeAnchors(n);let o=!1;if(r){if(this._params.nodeClassifier.classifyNode(r,this.rootElement,!0,!0)===t.NodeClassifier.CONTENT_ONLY){const e=t.domUtils.getFirstSelectableChild(r,this._getNodeSelectionScheme("rightNeighborForDelete",!1));3===(null==e?void 0:e.nodeType)?n.setStart(e,0):1===(null==e?void 0:e.nodeType)&&n.setStartBefore(e),o=Boolean(e)}else 3===r.nodeType&&r!==n.startContainer&&(n.setStart(r,0),o=!0)}if(i){if(this._params.nodeClassifier.classifyNode(i,this.rootElement,!0,!0)===t.NodeClassifier.CONTENT_ONLY){const e=t.domUtils.getLastSelectableChild(i,this._getNodeSelectionScheme("leftNeighborForDelete",!1));3===(null==e?void 0:e.nodeType)?n.setEnd(e,e.length):1===(null==e?void 0:e.nodeType)&&n.setEndAfter(e),o=o||Boolean(e)}else 3===i.nodeType&&i!==n.endContainer&&(n.setEnd(i,i.length),o=!0)}return o?n:null}_cleanupSelection(r){var i;const o=this.setIgnoreMutations(!0);let s=null;try{if(r.collapsed){const e=(r=O.removeSpellCheckingFromRange(r,this.rootElement)).commonAncestorContainer,n=3===e.nodeType?e.parentNode:e,i=O.collectEmptyTextChildren(n);i.length&&(s=t.createDOMMarker(this._env,r),i.forEach(e=>e.parentNode.removeChild(e)))}else{s=t.createDOMMarker(this._env,r);const i=this.rootElement;s.getNodesInRange(e=>3===e.nodeType).forEach(t=>{O.tryToRemoveSpellcheckerNode(t,i),e.utils.dom.isEmptyTextNode(t)&&n(t).remove()});s.getNodesInRange((e,t)=>O.isSpellcheckerNode(e)).forEach(e=>O.removeSpellcheckerNode(e))}}catch(e){t.logger.error("cleanupSelection",e)}finally{let e;s&&(e=s.selectAndRemove()),e=null!==(i=this._contractSelection(null!=e?e:r))&&void 0!==i?i:e,e&&this._selection.addRange(r=e),this.setIgnoreMutations(o)}return r}_ignoreKeyboardDelete(e){if(!e||!e.node)return!0;let r=!1;const i=this._params.nodeClassifier.classifyNode(e.node,this.rootElement,!0,!0);if(i===t.NodeClassifier.NODE_ONLY)return!1;if((i!==t.NodeClassifier.NODE_AND_CONTENT||this.host.shouldIgnoreDeletedNode(e.node))&&(r=!0),r&&e.isText){r=!n(e.node.parentNode).closest(N).length}return r}_deleteForward(t){const n=this._findNextNodeToDelete(t)||{};if(!n.node||h.has(n.node.nodeName))return!1;if(!e.utils.dom.isContentEditable(n.node,this.rootElement,!0))return!1;t.equals(n.range)||this._selection.addRange(t=n.range);const r="LI"===n.tagName&&n.node;if(r){const e=this._getNodeTrackingContext(r);return e.isInsert&&e.isCurrent?(this.removeFLITETracking(r,!0),!1):e.isDelete?(this._collapseAfter(r,!0),!0):(this._addDeleteTracking(r,{move:c.None,containerOnly:!0,changeId:null}),this._selection.setStart(r,!0,0),!0)}if("BR"===n.tagName)return!1;if(this._ignoreKeyboardDelete(n))return!1;const i=this._getNodeAtCaret({range:t,lookBack:!0,forDelete:!0}),o=this._getNodeTrackingContext(i.node),s=this._getNodeTrackingContext(n.node),a=o.trackingNode&&o.trackingNode===s.trackingNode?this._getNodeTrackingContext(null):o;return n.isText?a.isTracking||s.isTracking?a.isTracking&&!s.isTracking?a.isDelete&&a.isCurrent?this._assimilateNextChar(a,null,i,n):this._deleteForwardUntrackedContext(n):a.isTracking&&s.isTracking?s.isDelete?(this._collapseAfter(s.trackingNode,!1),!0):s.isCurrent?(n.isText||this.ignoreNextMutation("Delete forward in insert"),this._monitorChangeId(s.changeId),!1):a.isDelete&&a.isCurrent?this._assimilateNextChar(a,s,i,n):this._deleteForwardUntrackedContext(n,s):s.isInsert?s.isCurrent?this._removeInsertedCharacter(n,s,t,c.None):this._deleteForwardUntrackedContext(n,s):(this._collapseAfter(s.trackingNode,!1),!0):this._deleteForwardUntrackedContext(n):s.isDelete?(this._collapseAfter(s.trackingNode,!0),!0):s.isCurrent?(this._monitorChangeId(s.changeId),!1):this._deleteForwardUntrackedContext(n,a)}_deleteBack(t){const n=this._findPreviousNodeToDelete(t)||{};if(!n.node||h.has(n.node.nodeName))return!1;if(!e.utils.dom.isContentEditable(n.node,this.rootElement,!0))return!1;if(t.equals(n.range)||this._selection.addRange(t=n.range),"BR"===n.tagName)return!1;if(this._ignoreKeyboardDelete(n))return!1;if("LI"===n.tagName){const e=this._getNodeTrackingContext(n.node);return e.isInsert&&e.isCurrent?(n.node.previousSibling&&this.removeFLITETracking(n.node,!0),!1):(e.isDelete||this._addDeleteTracking(n.node,{move:c.None,containerOnly:!0,trackContent:!1}),this._collapseBefore(n.node),!0)}const r=this._getNodeAtCaret({range:t,lookBack:!1,forDelete:!0}),i=this._getNodeTrackingContext(r.node),o=n.node===r.node?i:this._getNodeTrackingContext(n.node),s=o.trackingNode&&o.trackingNode===i.trackingNode?this._getNodeTrackingContext(null):i;return n.isText?s.tracksContent||o.tracksContent?s.tracksContent&&!o.tracksContent?s.isDelete&&s.isCurrent?this._assimilatePrevChar(s,null,r,n):this._deleteBackUntrackedContext(n):s.tracksContent&&o.tracksContent?o.isDelete?(this._selection.setStartBefore(o.trackingNode,!0),!0):o.isCurrent?(n.isText||this.ignoreNextMutation("Delete back in insert"),this._monitorChangeId(o.changeId),!1):s.isDelete&&s.isCurrent?this._assimilatePrevChar(s,o,r,n):this._deleteBackUntrackedContext(n,o):o.isInsert?o.isCurrent?this._removeInsertedCharacter(n,o,t,c.Left):this._deleteBackUntrackedContext(n,o):(this._collapseBefore(o.trackingNode),!0):this._deleteBackUntrackedContext(n):o.isDelete?(this._collapseBefore(o.trackingNode),!0):o.isCurrent?(this._monitorChangeId(o.changeId),!1):this._deleteBackUntrackedContext(n,s)}_removeInsertedCharacter(e,t,r,i){if(this._monitorChangeId(t.changeId),!e.isText||e.offset>0)return!1;const o=e.node,s=t.trackingNode,a=e.offset;if(1===o.length&&1===s.childNodes.length)return this._replaceNodeWithContent(n(s)),i===c.Left?this._selection.collapseAtEnd(o):this._selection.collapseAtStart(o),!1;const l=o.data[a];if(!/\s/.test(l))return!1;this._editTransaction.textChanged();const d=this._selection.getBookmark(this.host.getCaretSelectors(),r);let u=!1;return 1===o.length?(u=d.start>1&&!t.trackingNode.previousSibling,this._removeNode(o,t)):o.data=o.data.slice(1),this._selection.gotoBookmark(d,i===c.Left?{move:"left",after:u}:{after:u}),!0}_assimilatePrevInline(n,r){const i=n.node;if(3!==i.nodeType)return!1;const o=t.domUtils.findInlineParent(n.node,t=>!e.utils.dom.matchesSelector(t,this._fliteSelector));if(t.domUtils.findInlineParent(r.trackingNode)===o)return!1;try{const e=t.rangy.dom.splitDataNode(i,n.offset);return this._addDeleteTracking(e,{changeId:r.changeId}),this._selection.setStart(e,!0,0),!0}catch(e){return t.logger.error(e),!1}}_assimilateNextInline(n,r){const i=n.node;if(3!==i.nodeType)return!1;const o=t.domUtils.findInlineParent(n.node,t=>!e.utils.dom.matchesSelector(t,this._fliteSelector));if(t.domUtils.findInlineParent(r.trackingNode)===o)return!1;try{const e=t.rangy.dom.splitDataNode(i,n.offset+1);return this._addDeleteTracking(i,{changeId:r.changeId}),this._selection.setStart(e,!0,0),!0}catch(e){return t.logger.error(e),!1}}_assimilatePrevChar(r,i,o,s){this._editTransaction.textChanged();const a=s.isText&&s.node.data;if(r.tracksContent&&a){if(this._assimilatePrevInline(s,r))return!0;if(r.trackingNode.textContent=a[s.offset]+r.trackingNode.textContent,s.node.textContent=a.substring(0,a.length-1),this._selection.setStart(r.trackingNode.firstChild,!0,0),e.utils.dom.isEmptyTextNode(s.node))if(null==i?void 0:i.tracksContent)this._removeFLITEArtifacts({restoreCaret:!0,$root:this._$element});else{const e=n(s.node.parentNode);e.is(":empty")&&t.domUtils.isInlineElement(s.node.parentNode)&&e.remove()}return!0}if(s.isText){let a=s.node,l=o.offset,d=o.node,u=d&&t.domUtils.splitTextAt(a,s.offset,1,!0);if(!u)return!1;const h=this._isNextTextSibling(u,d)&&t.domUtils.getFirstSelectableChild(d);if(h){const e=l>0?l-1:0;h.data=h.data.substr(0,e)+u.data+h.data.substr(e),this._removeNode(u),this._selection.setStart(h,!0,l)}else{if(e.utils.dom.matchesSelector(d,".flite-container-only")&&i&&i.trackingNode){this._splitNode(i.trackingNode,u,0);const e=n(i.trackingNode);if(u=t.domUtils.getFirstSelectableChild(i.trackingNode,{root:this.rootElement,allowEmptyText:!1}),!u)return!1;this._replaceNodeWithContent(e)}this._addDeleteTracking(u,{move:c.Left,containerOnly:!0,changeId:r.changeId});const o=i&&i.trackingNode,s=o&&this._getNodeTrackingContext(u);(null==o?void 0:o.parentNode)&&s&&s.trackingNode&&s.trackingNode.parentNode.insertBefore(o,s.trackingNode),this._selection.setStart(u,!0,0)}}else this._addDeleteTracking(s.node,{move:c.Left,containerOnly:!0}),this._collapseBefore(s.node);return!0}_assimilateNextChar(r,i,o,s){this._editTransaction.textChanged();const a=s.node;if(1===a.nodeType)return this._markElementAsDeleted(a,r.changeId),this._collapseAfter(a,!0),!0;if(r.tracksContent){if(this._assimilateNextInline(s,r))return!0;const o=a.data;if(r.trackingNode.textContent=r.trackingNode.textContent+o[s.offset],a.textContent=o.substring(0,s.offset)+o.substring(s.offset+1),this._selection.setStart(r.trackingNode.firstChild,!0,r.trackingNode.firstChild.length),e.utils.dom.isEmptyTextNode(a))if(null==i?void 0:i.tracksContent)this._removeFLITEArtifacts({restoreCaret:!0,$root:this._$element});else{const e=n(a.parentNode);e.is(":empty")&&t.domUtils.isInlineElement(a.parentNode)&&e.remove()}return!0}const l=s.node,d=o.node;let u=t.domUtils.splitTextAt(l,s.offset,1,!0);if(!u)return!1;const h=this._isPrevTextSibling(u,d)&&t.domUtils.getLastSelectableChild(d);if(h)h.data+=u.data,this._removeNode(u),this._selection.setEnd(h,!0,h.length);else{if(e.utils.dom.matchesSelector(d,".flite-container-only")){if(i&&i.trackingNode){const e=this._splitNode(i.trackingNode,u,1),r=n(e);if(u=t.domUtils.getFirstSelectableChild(e,{root:this.rootElement,allowEmptyText:!1}),!u)return!1;this._replaceNodeWithContent(r)}this._addDeleteTracking(u,{move:c.Right,containerOnly:!1})}else{this._addDeleteTracking(u,{move:c.None,containerOnly:!1});const e=i&&i.trackingNode,n=e&&this._getNodeTrackingContext(u);n&&n.trackingNode&&e.parentNode.insertBefore(n.trackingNode,e),e&&t.domUtils.hasNoTextOrStubContent(e)&&this._removeNode(e)}this._selection.setEnd(u,!0,u.length)}return!0}_markElementAsDeleted(e,t){const n={merge:!1,changeId:t,containerOnly:!0,trackContent:!1};this._addDeleteTracking(e,n);const r=this.host.getRelatedNodes("delete",e);for(let e of r)this._addDeleteTracking(e,{merge:!1,changeId:t,containerOnly:!0,trackContent:!1})}_deleteBackUntrackedContext(e,r){if(this._editTransaction.textChanged(),!e.isText)return this._markElementAsDeleted(e.node,null),this._collapseBefore(e.node),!0;let i;if(null==r?void 0:r.tracksContent){const o=this._splitNode(r.trackingNode,e.node,e.offset+1),s=t.domUtils.getLastSelectableChild(o);i=s&&t.domUtils.splitTextAt(s,s.length-1,1,!0),o.parentNode.insertBefore(i,o.nextSibling),t.domUtils.hasNoTextOrStubContent(r.trackingNode)&&n(r.trackingNode).remove()}else i=t.domUtils.splitTextAt(e.node,e.offset,1,!0);return!!i&&(this._addDeleteTracking(i,{move:c.Left,merge:!0}),!0)}_isNextTextSibling(t,n){if(!(t&&t.parentNode&&n&&n.parentNode))return!1;if(3===n.nodeType)return t.nextSibling===n||this._isNextTextSibling(t,n.parentNode);if(O.isSpellcheckerNode(n))return this._isNextTextSibling(t,n.parentNode);if(!e.utils.dom.matchesSelector(n,this._fliteTextSelector))return!1;for(let e=n.firstChild;e;e=e.nextSibling)if(3!==e.nodeType)return!1;if(t.nextSibling)return t.nextSibling===n;const r=O.isSpellcheckerNode(t.parentNode)?t.parentNode.parentNode:t.parentNode;return e.utils.dom.matchesSelector(r,this._fliteTextSelector)&&r.nextSibling===n}_isPrevTextSibling(t,n){if(!(t&&t.parentNode&&n&&n.parentNode))return!1;if(3===n.nodeType)return t.previousSibling===n||this._isPrevTextSibling(t,n.parentNode);if(O.isSpellcheckerNode(n))return this._isPrevTextSibling(t,n.parentNode);if(!e.utils.dom.matchesSelector(n,this._fliteTextSelector))return!1;if(t.previousSibling)return t.previousSibling===n;const r=O.isSpellcheckerNode(t.parentNode)?t.parentNode.parentNode:t.parentNode;return e.utils.dom.matchesSelector(r,this._fliteTextSelector)&&r.previousSibling===n}_deleteForwardUntrackedContext(e,r){if(this._editTransaction.textChanged(),!e.isText)return this._markElementAsDeleted(e.node,null),this._collapseAfter(e.node,!0),!0;let i;if(r){const o=r.trackingNode,s=this._splitNode(o,e.node,e.offset),a=t.domUtils.getFirstSelectableChild(o,{root:this.rootElement});i=a&&t.domUtils.splitTextAt(a,0,1,!0),s.parentNode.insertBefore(i,o),t.domUtils.hasNoTextOrStubContent(r.trackingNode)&&n(r.trackingNode).remove()}else i=t.domUtils.splitTextAt(e.node,e.offset,1,!0);return!!i&&(this._addDeleteTracking(i,{move:c.None,merge:!0}),this._selection.setEnd(i,!0,1),!0)}_isNodeOfChangeType(e,t){if(!e)return!1;const r="."+this._getTrackedNodeClass(t);return n(e.$||e).is(r)}_isInsertNode(e){return this._isNodeOfChangeType(e,"insertType")}_isDeleteNode(e){return this._isNodeOfChangeType(e,"deleteType")}_getVoidElement(n){if(!n)return null;const r=n.node,i=!1!==n.checkEmpty;try{if(i&&e.utils.dom.isEmptyTextNode(r))return r;const t=this._getNodeTrackingContext(r);if(t.isDelete)return t.trackingNode}catch(e){return t.logger.error(e,"While trying to get void element of",r),null}}_addDeleteTracking(t,n){if(n=n||{},!t)return null;let r;for(;t.previousSibling&&e.utils.dom.isEmptyTextNode(t.previousSibling);)t.parentNode.removeChild(t.previousSibling);for(;t.nextSibling&&e.utils.dom.isEmptyTextNode(t.nextSibling);)t.parentNode.removeChild(t.nextSibling);const i=n.changeId;return r=this._createTrackedNode(t,{type:"deleteType",changeId:i,containerOnly:n.containerOnly,trackChildren:n.trackContent?O.shouldTrackChildren(t):s.DONT_TRACK}),n.move===c.Right?this._selection.collapseAtEnd(t):n.move===c.Left&&this._selection.collapseAtStart(t),r&&setTimeout(()=>e.utils.dom.normalizeNode(r),0),r}_splitAtCaret(n){if(!n||!n.collapsed)return n;const r=n.startContainer,i=n.cloneRange(),o=n.startOffset;if(3===r.nodeType){const s=r;if(o>=s.length)return n;const a=t.domUtils.splitTextAt(s,o,s.length-o,!0);return i.setStart(a.parentNode,e.utils.dom.getNodeIndex(a)+1),i.collapse(!0),i}{const e=r;if(o>=e.childNodes.length)i.setStartAfter(e),i.collapse(!0);else{const t=this._splitNode(e,e,o);i.setStart(t,0)}return i}}_splitNode(t,n,r){const i=e.utils.dom.splitNode(t,n,r);if(i){this._getNodeTrackingContext(i,!0).isTracking&&this._finalizeTrackedNode(i)}return i}_showTitles(e){const t=this.getTrackedNodes();e?n(t).each((e,t)=>{this._finalizeTrackedNode(t)}):n(t).each((e,t)=>{this._restoreNodeTitle(t)})}_restoreNodeTitle(e){const t=n(e),r=t.attr(this.attributes.fliteTitle);r&&t.attr("title","1"===r?null:r)}get keyboardMapper(){if(void 0!==x)return x;let e=Object.assign({},this._params.spellingOverride||{".data-flite-created":1});const t=this._params.keyboardMap&&this._params.keyboardMap.find&&this._params.keyboardMap.find("mark,edit,toggle,append".split(/[^a-z]/).map(e=>e[0]).join(""));return Object.keys(e).forEach(t=>{/^\./.test(t)&&delete e[t]}),t?(t.toArray().forEach(t=>{if(!t.attributes||!t.attributes.length||!e)return;const n={},r=function(e){if(e){const t=1+e.split("").reduce((function(e,t,n){return(n+1)*t.charCodeAt(!1)+e}),-1);n[t]&&delete n[t]}};Object.keys(e||{}).forEach(t=>n[t]=e[t]),[].slice.apply(t.attributes).forEach(e=>{r(e.nodeValue),r(e.nodeName)}),0===Object.keys(n).length&&(e=void 0)}),x=Boolean(Object.keys(e||{}).length>0)):Object.keys(e).length>0}_keyPress(e,t,n){let r=null;if(e.ctrlKey)return this._prepareForCtrlKeypress(e),!1;if(e.metaKey)return!1;const o=e.keyCode||e.which;switch(o){case 32:return this.insertText({text:"Â ",mode:t,readonlyPolicy:n});case 8:return"full"===t&&this._deleteContents(i.Start,null,!1);case 46:return"full"===t&&this._deleteContents(i.End,null,!1);case 13:return this._handleEnter(t);default:if(O.isIgnoredKeyCode(o))return!1;if(r=e.char||e.key||String.fromCharCode(o),r){const e=this._params.handleInsertText||"insert"===n||d?r:null;return this.insertText({text:e,mode:t,readonlyPolicy:n})}return!1}}_prepareForCtrlKeypress(e){let t=null;switch(e.keyCode||e.which||e.code){case 8:t="del-word-back";break;case 46:t="del-word-forward"}t&&this.setMutationContext(t,{timeout:1})}_handleEnter(n){if(this.host.getIMECompositionState()!==a.None)return!0;if("readonly"===n)return this.prepareForInsertion(),!1;const r=this._cleanupSelection(this._getCurrentRange(!0));if(!r)return!1;if(this.setMutationContext("enter",{timeout:1}),r.collapsed){const n=this._getNodeTrackingContext(r.startContainer),i=this._moveCaretOutOfTracking(r,n,!0),o=t.domUtils.getNode(i.commonAncestorContainer,e=>t.domUtils.isBlockElement(e),this.rootElement);if(o){const t=String(e.utils.dom.getNodeIndex(o));o.setAttribute("data-flite-block-id",t),this._env.window.setTimeout(()=>{var e;null===(e=this._$element)||void 0===e||e.find(`[data-flite-block-id="${t}"]`).attr("data-flite-block-id",null)},5)}}else this._deleteContents(i.End,r,!1);return!1}_handleEditKey(e,t){switch(e.which||e.keyCode){case 120:case 88:if((!0===e.ctrlKey||!0===e.metaKey)&&this._params.handleCut){const e=this.prepareToCut(t);return{handled:e,cancel:e}}break;case 118:case 86:break;case 67:case 99:if(!0===e.ctrlKey||!0===e.metaKey){return{handled:!0,cancel:this.prepareToCopy(t)}}}return{handled:!1,cancel:!1}}_splitTrackedText(r,i){if(!r.collapsed||!i.tracksContent)throw new Error("can't split for text");const o=r.startContainer,s=i.trackingNode,a=e.utils.dom.getNodeLength(s);if(o===s)return 0===r.startOffset?{before:s}:r.endOffset>=a?{after:s}:(this._splitNode(s,s,r.startOffset),{before:s});if(3===o.nodeType&&o.parentElement===s){const t=e.utils.dom.getNodeIndex(o);return 0===r.startOffset&&0===t?{before:s}:t>=a-1&&r.endOffset>=o.length?{after:s}:(this._splitNode(s,o,r.startOffset),{before:s})}const l="data-flite-split",c=3===o.nodeType?o.parentElement:o;let d;if(c.setAttribute(l,"1"),t.domUtils.isInlineElement(c)&&O.isVirtuallyEmpty(c,"virtual")){const t=e.utils.dom.getNodeIndex(c);this._splitNode(s,c.parentElement,t),d=n(this._splitNode(s,c.parentElement,1))}else this._splitNode(s,o,r.startOffset),d=n(this._splitNode(s,o,0));const u=d.find(`[${l}]`);return c.removeAttribute(l),u.length?(u.attr(l,null),this._replaceNodeWithContent(d),{into:u[0]}):{}}_doInsertText(t,r){const i=this._getNodeTrackingContext(r.startContainer,!1),o=(r.startContainer,this._env.document);let a=!1,l=null,c=null;if(i.isInsert&&i.isCurrent){if(i.tracksContent)return{inserted:!1,element:null,range:r};const e=this._getCurrentChange("insert",i);c=(null==e?void 0:e.id)||null}if(l=this._createTrackedNode(null,{type:"insertType",changeId:c,containerOnly:!1,trackChildren:s.DONT_TRACK}),i.tracksContent&&!i.isCurrent){const{before:t,after:n,into:o}=this._splitTrackedText(r,i);o?o.appendChild(l):t?t.parentNode.insertBefore(l,t):n?e.utils.dom.insertAfter(l,n):r.insertNode(l)}else r.insertNode(l);if(n(l).siblings("[data-mce-bogus]").remove(),t){a=!0;const e=o.createTextNode(t);l.appendChild(e),r.collapseAt(e,!1)}return a||(r=this._prepareSelectionForInsert(l,r)),{element:l,inserted:a,range:r}}_prepareSelectionForInsert(e,t){this._$element.find("[data-mce-type='format-caret']").each((e,t)=>{this._replaceNodeWithContent(n(t))});const r=e||t.startContainer;if(t.collapsed&&r&&3===r.nodeType&&r.length)return t;const i=r.ownerDocument.createTextNode("\ufeff");e?e.appendChild(i):t.insertNode(i);const o=this._selection.createRange();return o.setStartAndEnd(i,0,i,1),o}_handleKeyDown(e,t,n){const r=this._handleEditKey(e,t);return r.handled?r.cancel:this._keyPress(e,t,n)}_moveRangeToValidTrackingPos(n,r=0){if(!n)return null;if(0===r&&e.utils.dom.isEmptyTextNode(n.startContainer))return t.logger.warn("move range to valid position: empty text node"),e.utils.dom.normalizeNode(n.startContainer.parentNode),this._moveRangeToValidTrackingPos(this._getCurrentRange(!0),1);if(this.host.isBogusInsertPosition(n.startContainer))return this._selection.setStartBefore(n.startContainer),this._getCurrentRange();let i,o,s,a,l=null,c=[],d=!1,u=!1;const h=()=>(d&&this._selection.addRange(n),n);for(;!u;){if(o=n.startContainer,!o||c.indexOf(o)>=0)return h();if(c.push(o),i=this._getVoidElement({node:o,checkEmpty:!1}),i){if(i!==o&&c.indexOf(i)>=0)return h();c.push(i)}else u=t.domUtils.isTextContainer(o);if(!u){null===l&&(l=!t.domUtils.isOnRightEdge(n.startContainer,n.startOffset)),s=l?t.domUtils.findPrevTextContainer(i||o,this.rootElement):t.domUtils.findNextTextContainer(i||o,this.rootElement),a=s.node;try{l?n.setStart(a,s.offset):n.setEnd(a,s.offset),n.collapse(l),d=!0}catch(e){t.logger.error(e,"While trying to move range to valid tracking position");break}}}return h()}_restoreAndMarkDeletedNode(t,n,r){if(!t||!n||3===t.nodeType&&e.utils.dom.isEmptyTextNode(t))return!1;r&&r.parentNode!==n&&(r=null);const i=this._isOpaqueNode(t),o=1===t.nodeType&&"SPAN"===t.nodeName;if(!i&&o&&t.firstChild){let n=!0;for(let r=t.firstChild;r&&n;r=r.nextSibling)3===r.nodeType&&e.utils.dom.isEmptyTextNode(r)||(n=!1);if(n)return!1}const s=this._getNodeTrackingContext(t);return(!s.isInsert||!s.isCurrent)&&(e.utils.dom.insertAfter(t,r,n),this._addDeleteTracking(t,{containerOnly:i||!o,trackContent:!i&&!o,trackingContext:s}),!0)}_onMutationSummary(e){const n=this._lastMutationContext.peekType();if(this._unlistenToMutations(),this._ignoreMutations)return void t.logger.debug(`dom mutation type ${n}, ignoring`,e);if(t.logger.debug("dom mutation processing type "+n,e),!this.host.users.getCurrentUser(!1))return void t.logger.warn("Cannot track DOM mutations with no user");if(!this._env.document)return;let r=this._getCurrentRange(!0);const i=t.createDOMMarker(this._env,r);this._editTransaction.setIsUpdate().lock();let o=this._startBatchChange(null),s=!0;try{const n=this._processSpecialMutation(e);if(n)return!1===n.restoreCaret&&i.remove(),void(s=!1!==n.saveChange)}catch(e){t.logger.error("While analyzing mutation summary",e)}finally{try{this._selection.addRange(i.selectAndRemove(),!1);const e=this._getCurrentRange(),t=this._cachedChange.getChange(),n=this._getNodeTrackingContext(e.commonAncestorContainer,!1);n.isTracking&&n.changeId===(null==t?void 0:t.id)&&this._monitorCaretInInsertedElement(n)}catch(e){t.logger.error("onMutationSummary: while restoring range "+e)}this._endBatchChange(o),this._editTransaction.unlockAndFinish(),s||this._cachedChange.reset()}}_processOneMutationSummary(e,r){let i,o,s,a=!1;const l=this.rootElement&&this.rootElement.ownerDocument;if(!l)return!1;let c=e.added||[];c.forEach(e=>{this._isValidFLITENode(e)||this.removeFLITETracking(e)});const d=this._restoreDeletedHierarchy(e.removed,e);if(c=this._restoreAddedHierarchy(c),this._handleIdenticalChanges(c,d,e))return t.logger.debug("Identical change, ignoring"),!1;const u=e.reparented||[];for(let n=0,c=d.length;n<c;++n)o=d[n],this._shouldRestoreNode(o,e.getOldParentNode(o))&&(t.domUtils.isAncestorAmong(r,o)?r.push(o):(s=e.getOldParentNode(o),s&&s.ownerDocument===l&&this._restoreAndMarkDeletedNode(o,s,e.getOldPreviousSibling(o))&&(a=!0,r.push(o),u.length&&1===o.nodeType&&(i=o.querySelectorAll("*"),i&&i.length&&(r=r.concat([].slice.apply(i)))))));a=this._restoreReparented(e,r)||a,r.forEach(e=>{this._removeHostArtifacts(e),this._cleanupLINode(n(e))});for(let t=0,n=c.length;t<n;++t)a=this._tryToTrackAddedNode(c[t],{nodesToIgnore:e.reparented})||a;return a}_restoreReparented(t,n){let r,i,o=!1;const s=t.reparented&&this._restoreDeletedHierarchy(t.reparented,t)||[];for(let a=0,l=s.length;a<l;++a)r=s[a],i=t.getOldParentNode(r),i&&n.indexOf(i)>=0&&(this._restoreIntoLI(r,i,t.getOldPreviousSibling(r))||e.utils.dom.insertAfter(r,t.getOldPreviousSibling(r),i),o=!0);return o}_handleDeleteMutationWithSelector(t,n){const r=n.selector,i=[];let o=!1;for(let s of t){s.removed.filter(t=>1===t.nodeType&&i.indexOf(t)<0&&e.utils.dom.matchesSelector(t,r)).forEach(e=>{n.cleanup&&n.cleanup(e),i.push(e);const t=s.getOldParentNode(e),r=s.getOldPreviousSibling(e);o=this._restoreAndMarkDeletedNode(e,t,r)||o})}return o}_handleDeleteMutationWithMarkers(n,r){const i=e.utils.strings.toStringArray(r.markers);if(0===i.length)return t.logger.warn("deleted mutation: no element selector"),!1;const o=new Set;let s=!1;const a=this._$element;for(const e of n){e.removed.forEach(n=>{if(1!==n.nodeType||o.has(n))return;o.add(n);const r=n.getAttribute("data-flite-marker-target");if(!r)return;n.removeAttribute("data-flite-marker-target");const l=i.indexOf(r);l<0?t.logger.warn(`handle deleted mutation: marker ${r} not registered`):i.splice(l,1);const c=e.getOldParentNode(n),d=a.find(`span[data-flite-marker-id='${r}']`);d.length?(s=this._restoreAndMarkDeletedNode(n,c,d[0])||s,d.remove()):t.logger.warn(`No marker found for marked node ${n.nodeName} with id ${r}`)})}return s}_handleDeleteMutation(e,n){return n.selector?this._handleDeleteMutationWithSelector(e,n):n.markers?this._handleDeleteMutationWithMarkers(e,n):(t.logger.warn("handle Delete mutation: neither element nor markers found"),!1)}_processLinkInsertion(e){const t=[];for(let n of e)t.push.apply(t,n.added);const n=t.find(e=>"A"===e.nodeName);n&&this._markupInsertedNodes([n],null,s.DONT_TRACK)}_processFootnoteInsertion(n,r){const i=[];let o=!1;r=r||{noteSelector:void 0,markerSelector:void 0,headerSelector:void 0};for(let e of n)i.push.apply(i,e.added);const s=[];try{i.forEach(t=>{r.markerSelector&&e.utils.dom.matchesSelector(t,r.markerSelector)?(this._markupInsertedNodes([t],null),o=!0,r.callback&&r.callback(t)):(r.noteSelector&&e.utils.dom.matchesSelector(t,r.noteSelector)||r.headerSelector&&e.utils.dom.matchesSelector(t,r.headerSelector))&&s.push(t)});const t=[];return s.forEach(n=>{e.utils.dom.forAllTextChildren(n,e=>{t.push(e)})}),t.length&&this._markupInsertedNodes(t,null),Boolean(s.length)||o}catch(e){return t.logger.error("process footnote insertion",e),!1}}_processSpecialMutation(e){const n={changedDOM:!1,restoreCaret:void 0,type:""},r=n.type=this._lastMutationContext.popType(),i=this._lastMutationContext.data;switch(r){case"insert-link":this._processLinkInsertion(e);break;case"table-properties":break;case"insert-footnote":n.changedDOM=n.restoreCaret=this._processFootnoteInsertion(e,i);break;case"delete":n.changedDOM=n.restoreCaret=this._handleDeleteMutation(e,i);break;case"insert-format":this._handleInsertedFormat(e,i);break;case"insert-element":this._handleInsertedElement(e,i)===o.InsertedDiscard&&(n.saveChange=!1),n.restoreCaret=!0;break;case"add-style":this._handleAddedStyle(e,i);break;case"remove-style":this._handleRemovedStyle(e,i);break;case"paste-raw":this._updateAfterRawPaste(e);break;case"paste":this._updateAfterPaste(e);break;case"insert-list":this._handleInsertedList(e,i)&&(n.changedDOM=!0);break;case"remove-list":this._loadFromDom();break;case"enter":n.changedDOM=this._handleEnterMutation(e);break;case"delete-br":const s=this._handleDeleteBreak(e);s.handled&&(n.changedDOM=!0,n.restoreCaret=s.restoreCaret);break;case"delete-table-cell":case"delete-table-col":case"delete-table-row":case"delete-table":case"insert-table-row":case"insert-table-cell":case"insert-table-col":n.changedDOM=this._processOneMutationSummary(e[0],[]);break;default:t.logger.debug("Unknown mutation type "+r)}return t.logger.debug("Processed special mutation",r),n}_tryToRemoveInlineFromTrackedText(t,n){const r=this._getNodeTrackingContext(t,!1);if(!r.tracksContent)return!1;const i=t.parentElement,o=e.utils.dom.getNodeIndex(t),s=new Set([r.trackingNode]),a=this._splitNode(r.trackingNode,i,o),l=r.trackingNode;if(s.add(a),t.nextSibling){const n=t.parentElement,r=e.utils.dom.getNodeIndex(t),i=this._splitNode(l,n,r+1);s.add(i)}if(s.forEach(e=>{e&&O.isVirtuallyEmpty(e,"actual")&&this._removeNode(e,r)}),n&&!r.isCurrent){const e=this._getNodeTrackingContext(t,!1);e.tracksContent&&this._addNodeToChange(this._batchChangeId,e.trackingNode,"insertType")}return!0}_handleInsertedFormat(t,{placeHolderSelector:n,formatSelector:r}){const i=t[0].added,o=i.find(t=>e.utils.dom.matchesSelector(t,n)),s=null!=o?o:i.find(t=>e.utils.dom.matchesSelector(t,r));if(s){let t=e.utils.strings.isEmptyString(s.textContent);const n=Boolean(o)||t;t||this._tryToRemoveInlineFromTrackedText(s,n)}}_handleInsertedElement(n,r){const i=n[0];if(!i||!r)return o.None;const{selector:s,cleanup:a}=r;if(!s)return t.logger.error("insert mutation: neither all nor selector are set"),o.None;const l=i.added,c=i.removed.concat(i.reparented||[]);let d=o.InsertedKeep;for(let t,n=0;n<l.length;++n)t=l[n],1===t.nodeType&&e.utils.dom.matchesSelector(t,String(s))&&("TABLE"===t.nodeName&&(d=o.InsertedDiscard),this._tryToTrackAddedNode(t,{nodesToIgnore:c}),a&&a(t));return d}_handleAddedStyle(e,t){}_handleRemovedStyle(e,t){}_handleDeleteBreak(e){const t={handled:!1,restoreCaret:!0};if(1!==e.length)return t;let n,r,i;const o=e[0],s=o.removed,a=[],l=this.rootElement&&this.rootElement.ownerDocument;for(let e=0;e<s.length;++e)if(n=s[e],m.has(n.nodeName)){const e=o.getOldParentNode(n);e&&e.ownerDocument===l&&this._restoreAndMarkDeletedNode(n,e,o.getOldPreviousSibling(n))&&(a.push(n),t.handled=!0,"P"===n.nodeName?r=n:"LI"===n.nodeName&&(i=n))}return this._restoreReparented(o,a),(i||r)&&(this._collapseAfter(i?n:r,!1),t.restoreCaret=!1),t}_updateAfterRawPaste(e){this._editTransaction.trackerChanged()}_updateAfterPaste(e){const n=t.flitePluginUtils.trackerAttributes.fliteHandled;let r=!1;for(let t=0,i=e.length;t<i;++t){const i=e[t].added;let o;for(let e=0,t=i.length;e<t;++e)o=i[e],1===o.nodeType&&o.removeAttribute(n),this._isValidFLITENode(o)&&(r=!0,this._finalizeTrackedNode(o),this._fixAddedChildren(o))}r&&this._editTransaction.trackerChanged()}_fixAddedChildren(t){if(1===(null==t?void 0:t.nodeType)&&e.utils.dom.matchesSelector(t,"TD,LI")){n(t).find(`span.${this._insertClassName}>br`).each((e,t)=>{this._replaceNodeWithContent(n(t.parentNode))})}}_handleInsertedList(t,n){if(1!==t.length)return!1;const r=t[0],i=r.reparented||[],o=r.added,{selector:a,cleanup:l}=n,c=o.concat(i);let d,u=!1;const h=[];for(let t=0,n=o.length;t<n;++t)d=o[t],"LI"!==d.nodeName||a&&!e.utils.dom.matchesSelector(d,a)?v.has(d.nodeName)&&h.push(d):(u=this._tryToTrackAddedNode(o[t],{force:!0,nodesToIgnore:c,trackChildren:s.DONT_TRACK})||u,l&&l(d));if(h.length)for(let t=0,n=i.length;t<n;++t)d=i[t],"LI"===d.nodeName&&h.indexOf(d.parentNode)>=0&&(!a||e.utils.dom.matchesSelector(d,a))&&(u=this._tryToTrackAddedNode(i[t],{force:!0,trackChildren:s.DONT_TRACK})||u,l&&l(d));return u}_handleSpellcheckMutation(t){if(!((null==t?void 0:t.length)>0))return!1;const n=t=>{const n=[],r=t&&t.length;if(!r)return n;for(let i=0;i<r;++i){const r=t[i];r&&3===r.nodeType&&!e.utils.dom.isEmptyTextNode(r)&&n.push(r)}return n},r=[],i=[];for(const e of t){const t=e.target;O.isSpellcheckerNode(t)?r.push.apply(r,n(e.removedNodes)):1===t.nodeType&&i.push.apply(i,n(e.addedNodes))}return this._markupInsertedNodes(i,null),!1}_handleEnterMutation(t){if(1!==t.length)return!1;const n=t[0],r=this.host.getNewLineNodeName(),i=n.added,o=i.concat(n.reparented||[]);let s,a=!1;const l=t=>{const n=1===t.nodeType&&t.getAttribute("data-flite-block-id");return!!n&&(t.removeAttribute("data-flite-block-id"),e.utils.dom.getNodeIndex(t)===parseInt(n))};for(let e=i.length-1;e>=0;--e)s=i[e],l(s)||s.nodeName!==r&&"LI"!==s.nodeName||(a=!0,this._tryToTrackAddedNode(s,{force:!0,nodesToIgnore:o}));return this._removeBogusTracking(),a}_removeBogusTracking(){const t=this._$element.find(this._fliteTextSelector),r=[];for(let n=0;n<t.length;++n){const i=t[n];let o=!0;for(let t=i.lastChild;t&&o;t=t.previousSibling)(3!==t.nodeType||e.utils.dom.isEmptyTextNode(t))&&(1!==t.nodeType||"BR"===t.nodeName||t.hasAttribute("data-mce-bogus"))||(o=!1);o&&r.push(i)}r.forEach(e=>this._replaceNodeWithContent(n(e)))}_handleIdenticalChanges(e,r,i){const o=e.length,s=r.length,a=o-s;if(a<-1||a>1)return!1;let l,c;o>s?(l=e.slice(),c=r.slice()):(l=r,c=e);let d,u,h,g=null;const f=[];for(let e=0;e<l.length;++e){d=l[e],h=!1;for(let e=0;e<c.length&&!h;++e)u=c[e],3===d.nodeType?3===u.nodeType&&d.data===u.data&&(h=!0):1===d.nodeType&&1===u.nodeType&&u.nodeName===d.nodeName&&d.innerHTML===u.innerHTML&&(h=!0),h&&(f.push({n1:d,n2:u}),c.splice(e,1));if(!h){if(t.domUtils.getNodeCharacterLength(d)||g)return!1;g=d}}f.forEach(e=>{e.n1.parentNode&&!e.n2.parentNode?e.n1.parentNode.replaceChild(e.n2,e.n1):e.n2.parentNode&&!e.n1.parentNode&&e.n2.parentNode.replaceChild(e.n1,e.n2)});const p=f.length>0;if(p&&l===r&&g&&!n(g).is(":empty")){const e=i.getOldParentNode(g);e&&this._restoreAndMarkDeletedNode(g,e,i.getOldPreviousSibling(g))}return p}_restoreIntoLI(t,n,r){if("LI"!==n.nodeName)return!1;if(r&&r.parentNode===n)return e.utils.dom.insertAfter(t,r,n),!0;for(let e=n.firstChild;e;e=e.nextSibling)if("BR"===e.nodeName)return n.insertBefore(t,e),!0;return n.appendChild(t),!0}_shouldRestoreNode(e,r){if(1!==e.nodeType)return!0;if(this._params.nodeClassifier.classifyNode(e,this.rootElement,!1,!0)===t.NodeClassifier.CONTENT_ONLY){const t=n(e);return t.find(this._insertSelector).filter((e,t)=>this._isCurrentSessionNode(t)).remove(),!t.is(":empty")}return!this._getNodeTrackingContext(e).isCurrent}_tryToTrackAddedNode(e,n){if(this._shouldIgnoreNode(e,!0))return!1;const r=n.ctx||this._getNodeTrackingContext(e);let i=!0;return r.isTracking?n.force||r.isInsert&&!r.isCurrent?this._createTrackedNode(e,{type:"insertType",changeId:null,ignoredNodes:n.nodesToIgnore||[],containerOnly:!1,trackChildren:s.DONT_TRACK}):i=!1:this._createTrackedNode(e,{type:"insertType",changeId:null,containerOnly:t.domUtils.isBlockElement(e),trackChildren:void 0!==n.trackChildren?n.trackChildren:O.shouldTrackChildren(e),ignoredNodes:n.nodesToIgnore||[]}),this._fixAddedChildren(e),i}_monitorCaretInInsertedElement(e){const r=e.changeId,i=e.trackingNode;if(!r||!i)return void t.logger.warn("_monitorCaretInInsertedElement: No node or no change id in node");const o=n(this.rootElement.ownerDocument);o.off("selectionchange.flite"),o.on("selectionchange.flite",()=>{var e;const n=this._getCurrentRange(),s=(null===(e=this._cachedChange.getChange())||void 0===e?void 0:e.id)===r;if(s&&(null==n?void 0:n.collapsed)){if(this._getNodeTrackingContext(n.commonAncestorContainer,!1).trackingNode===i)return void t.logger.debug("selection still in tracked container")}t.logger.debug("selection has moved out of the tracked container"),o.off("selectionchange.flite"),s&&this._cachedChange.reset()})}_restoreAddedHierarchy(t){let n,r,i;if(!t||(n=t.length)<2)return t;const o=[],s=[];let a;for(let a=0;a<n;++a)i=t[a],3===i.nodeType&&e.utils.strings.isEmptyString(i.nodeValue)||(r=i.parentNode,r&&t.indexOf(r)<0&&(1===i.nodeType&&i.getAttribute("data-flite-inserting")?s.push(i):o.push(i)));return a=s.length?s:o,a}_restoreDeletedHierarchy(e,t){if(!(null==e?void 0:e.length))return[];e=e.slice();const n=t=>{for(let n=e.length-1;n>=0;--n)if(e[n]===t)return n;return-1};let r,i,o,s,a;for(let o=0;o<e.length;++o)r=e[o],i=t.getOldParentNode(r),i&&(i!==r.parentNode?(s=n(i),s>o&&(e.splice(s,1),e.splice(o,0,i),--o)):(e.splice(o,1),o--));for(let i=0;i<e.length;++i)r=e[i],o=t.getOldPreviousSibling(r),o&&(a=n(o),a>i&&(e.splice(a,1),e.splice(i,0,o),--i));if(t.li_restored_)return e;t.li_restored_=1;const l=(e,n)=>{if(n>=e.length-1)return;let r,i,o=e[n];if(1!==o.nodeType)return l(e,n+1);for(let s=n+1;s<e.length;++s)r=e[s],t.getOldParentNode(r)===o&&(l(e,n+1),i=t.getOldPreviousSibling(r),i&&i.parentNode!==o&&(i=null),o.insertBefore(r,i&&i.nextSibling),e.splice(s,1),s--)};return l(e,0),e}_createMutationObservers(e){if(!this._mutationSummary){const e={callbacks:{withContext:this._onMutationSummary.bind(this)},rootNode:this.rootElement,oldPreviousSibling:!0,observeOwnChanges:!1,mutationFilter:this._filterMutations,nodeFilter:e=>!this._shouldIgnoreNode(e,!1,!0),queries:[]};e.mutationFilter=e.mutationFilter.bind(this),e.queries.push({element:"*",classAttribute:!1}),this._mutationSummary=new t.MutationSummary(e,!1)}e&&(this._mutationSummary.setCallback("withContext"),this._mutationSummary.reconnect())}_momentarilyRemoveTrackingInRange(e){let n=Date.now()%1e6;const r={},i="data-flite-class";e.getNodes(null,e=>{const t=this._getNodeTrackingContext(e);if(!t.isTracking)return!1;const o=t.trackingNode;let s=O.getNodeAttributes(o),a=o.className,l=String(n++);return r[l]={attributes:s,className:a},this.removeFLITETracking(o),o.setAttribute(i,l),t.isDelete&&o.setAttribute(this.attributes.isDeleteNode,"1"),!0}),setTimeout(()=>{this._$element.find(`[${i}]`).each((e,n)=>{const o=n.getAttribute(i),s=r[o]||{};o?(Object.keys(s.attributes||{}).forEach(e=>{n.setAttribute(e,s.attributes[e])}),n.setAttribute("class",s.className||""),n.removeAttribute(i),n.removeAttribute(this.attributes.isDeleteNode)):t.logger.warn("missing save data for node")})},10)}_isOpaqueNode(e){return this._params.nodeClassifier.classifyNode(e,this.rootElement,!1,!0)===t.NodeClassifier.NODE_ONLY}_isOpaqueNodeOrParent(e){return this._params.nodeClassifier.classifyNode(e,this.rootElement,!1,!1)===t.NodeClassifier.NODE_ONLY}_restoreList(r){const i=r.added,o=r.removed,s=this.host.getNewLineNodeName(),a=s?1:0,l=i&&i.length,c=o&&o.length;if(l<a||!c)return!1;let d,u,h,g,f=0;for(let e=0;e<c;++e){if(d=o[e],!u&&C.test(d.nodeName)){if(u=d,h=this._getNodeTrackingContext(u),h.isInsert&&h.isCurrent)return!1;break}"LI"===d.nodeName&&0===d.children.length&&(t.trackerUtils.findInArray(r.reparented,e=>r.getOldParentNode(e)===d)||++f)}if(!u&&1!==f)return!1;let p=0,m=0;for(let e=i.length-1;e>=0;--e)d=i[e],1===d.nodeType&&(d.nodeName===s?++p:u&&d.nodeName===u.nodeName&&++m);if(p===a&&1===f&&!u)return!1;if(p<a)return!1;if(g=r.getOldParentNode(u),!this._shouldRestoreNode(u,g))return!0;this._restoreDeletedHierarchy(r.removed,r);const v=r.getOldPreviousSibling(u);e.utils.dom.insertAfter(u,v,g),this._removeHostArtifacts(u),m?this._addDeleteTracking(u.firstChild,{trackingContext:h,containerOnly:!0}):this._addDeleteTracking(u,{trackingContext:h,containerOnly:!0,trackContent:!0});const y=[u].concat(n(u).find("*").toArray());for(let e=r.added.length-1;e>=0;--e)d=r.added[e],g=d.parentNode,g&&g.removeChild(d);return this._restoreReparented(r,y),!0}_filterMutations(e){if(!e||!e.length)return[];return this._lastMutationContext.peekType()?this._filterMutationsInContext(e):this._filterBackgroundMutations(e)}_filterMutationsInContext(e){if(this.host.shouldIgnoreMutations(e)!==r.OK)return[];const t=[];for(let n of e)"childList"===n.type&&(this._shouldIgnoreMutationNodeList(n.addedNodes)!==r.OK&&this._shouldIgnoreMutationNodeList(n.removedNodes)!==r.OK||t.push(n));return t}_filterBackgroundMutations(e){return t.logger.debug("Mutations received with no context"),[]}_shouldIgnoreMutationNodeList(e){if(!e||!e.length)return r.IGNORE;let t;for(let n=e.length-1;n>=0;--n)if(t=e[n],!this._shouldIgnoreNode(t,!0))return r.OK;return r.IGNORE}_shouldIgnoreNode(n,r,i=!1){const o=n&&n.nodeType;if(1!==o&&3!==o)return!0;if(r&&3===o&&e.utils.strings.isEmptyString(n.nodeValue))return!0;if(n.style&&"none"===n.style.display)return!0;const s=this._params.nodeClassifier.classifyNode(n,this.rootElement,r,!1);return s===t.NodeClassifier.IGNORE||s===t.NodeClassifier.CONTENT_ONLY&&i}_findNextNodeToDelete(e){const n=this._getNodeAtCaret({range:e,lookBack:!1,forDelete:!0}),r=n.node;if("BR"===(null==r?void 0:r.nodeName)){const n=r.parentElement;if(n&&"BODY"!==n.nodeName&&t.domUtils.isBlockElement(n)&&r===n.lastChild){const t=e.cloneRange();return t.collapseAt(r,!1),this._findNextNodeToDelete(t)}}return this._shouldIgnoreNode(r,!0)?null:(n.isText&&n.node!==e.commonAncestorContainer&&((e=e.cloneRange()).setStart(n.node,n.offset),e.collapse(!0)),{node:r,offset:n.offset,isText:n.isText,tagName:null==r?void 0:r.nodeName,range:e})}_findPreviousNodeToDelete(e){const n=this._getNodeAtCaret({range:e,lookBack:!0,forDelete:!0});let r=n.node;if(!r)return null;if("BR"===(null==r?void 0:r.nodeName)){const e=r.parentElement;e&&"BODY"!==e.nodeName&&r===e.firstChild&&r===e.lastChild&&t.domUtils.isBlockElement(e)&&(r=e)}return this._shouldIgnoreNode(r,!0)?null:(n.isText&&n.node!==e.commonAncestorContainer&&((e=e.cloneRange()).setStart(n.node,n.offset+1),e.collapse(!0)),{node:r,offset:n.offset,tagName:r.tagName||"",isText:n.isText,range:e})}_isCurrentSession(e){const t=this.sessionId;return!t||!!e&&e===t}_getNodeTrackingContext(r,i=!0){const o={isTracking:!1,isCurrentUser:!1,isCurrentSession:!0,isCurrent:!1,trackingNode:null,isDelete:!1,isInsert:!1,changeId:null,tracksContent:!1,referenceNode:r};if(!r)return o;let s;const a=n(r);if(1===r.nodeType?(s=a.is(this._fliteSelector)&&r,s||!1!==i||(s=a.closest(this._fliteSelector)[0])):3===r.nodeType&&(s=n(r).closest(this._fliteTextSelector)[0],s||!1!==i||(s=a.parents(this._fliteSelector)[0])),!s)return o;const l=this.getChangeForNode(s,!1);return l?(o.isTracking=!0,(s===r&&e.utils.dom.matchesSelector(s,this._fliteTextSelector)||e.utils.dom.matchesSelector(s,this._fliteTextSelector))&&(o.tracksContent=!0),o.isCurrentUser=l.userid===String(this.currentUser.id),o.trackingNode=s,o.isDelete=e.utils.dom.matchesSelector(s,this._deleteSelector),o.isInsert=!o.isDelete,o.changeId=l.id,o.isCurrentSession=this._isCurrentSession(l.sessionId),o.isCurrent=o.isCurrentSession&&o.isCurrentUser,o):(t.logger.debug("getNodeTrackingContext found tracking markup but now change for id "+s.getAttribute(this.attributes.changeId)),this.removeFLITETracking(s),o)}_removeHostArtifacts(e){e&&1===e.nodeType&&n(e).find("[data-cke-bookmark],[data-cke-hidden-sel]").remove()}_removeFLITEArtifacts({restoreCaret:r,$root:i,preserveContainers:o=!0,bookmark:s}){if(!(null==i?void 0:i.length))return;r&&s&&(t.logger.error("Remove artifacts: can't restore caret when a bookmark is specified"),r=!1);const a=this.setIgnoreMutations(!0);let l=!1;i.find(".flite-bookmark").each((e,t)=>{(null==s?void 0:s.owns(t))||n(t).remove()});const c=r&&t.createDOMMarker(this._env,this._getCurrentRange());try{this._restoreAllTextContent(i),i.find("[data-flite-marker-target]").attr("data-flite-marker-target",null),i.find(`[${t.flitePluginUtils.trackerAttributes.fliteRecordId}]`).attr(t.flitePluginUtils.trackerAttributes.fliteRecordId,null),i.find("[data-flite-marker-id]").remove(),i.find("span[data-flite-wrapper-change]").remove(),i.find("[class='']").each((e,t)=>{t.removeAttribute("class")}),i.find(["span",this._insertSelector,":empty,span",this._deleteSelector,":empty"].join("")).each((e,t)=>{t.parentNode&&t.parentNode.removeChild(t)}),o||i.find(_).each((e,t)=>{t.parentNode&&t.parentNode.removeChild(t)}),i.find("tr>br,ul>br,ol>br").remove(),u.forEach(e=>i.find(e).remove());const r=function(t,i){1===i.nodeType?n(i).contents().each(r):3===i.nodeType&&e.utils.dom.isEmptyTextNode(i)&&i.parentNode.removeChild(i)};r(0,i[0]),l=i.is(this._$element)&&this._removeUnusedChangesets()}finally{this.setIgnoreMutations(a),c&&this._selection.addRange(c.selectAndRemove()),l&&this._editTransaction.trackerChanged()}}_removeUnusedChangesets(){let e=this._$element;if(!e)return!1;let t=!1;const n=e.find(this._fliteSelector),r=this.attributes.changeId,i=n.toArray().reduce((e,t)=>{const n=t.getAttribute&&t.getAttribute(r);return n&&(e[n]=1),e},{});return this._changes.items.forEach(e=>{i[e.id]||(this._changes.removeItem(e),t=!0)}),t}_testChangeSetForRemoval(n){t.logger.debug(`Test changeset ${n} for removal`);if(!this.getChangeForId(n))return!1;const r=this.getNodesForChange(n);let i;for(let n=r.length-1;n>=0;--n)if(i=r[n],!e.utils.dom.matchesSelector(i,this._fliteTextSelector)||!t.domUtils.hasNoTextOrStubContent(i))return!1;return this._changes.removeById(n),r.remove(),!0}_createMonitorChangeId(){const e=new Set;return this._timeoutClient.createTimer("changeset",{autoDispose:!1,timeoutMSecs:1,callback:()=>{let n=!1;try{e.forEach(e=>{n=this._testChangeSetForRemoval(e)||n})}catch(e){t.logger.error("monitor change id: "+e)}finally{e.clear(),n&&this._editTransaction.trackerChanged().finish()}}}),t=>{e.add(t),this._timeoutClient.startTimer("changeset")}}_isValidFLITENode(e){if(!e||1!==e.nodeType)return!1;const t=n(e);return Boolean((t.hasClass(this._deleteClassName)||t.hasClass(this._insertClassName))&&t.attr(this.attributes.changeId)&&t.attr(this.attributes.userId))}_replaceNodeWithContent(r){const i=e.utils.dom.toJQuery(r),o=i[0],s=null==o?void 0:o.parentNode;if(!s||1!==o.nodeType)return;let a=!1,l=i.contents();if(!l.length)return void i.remove();const c=o.nodeName;p.has(c)&&O.isVirtuallyEmpty(o,"virtual")?this._preserveBookmarks(i).remove():("LI"===c&&f.has(s.nodeName)&&(a=!0,o===o.parentNode.firstChild&&o.parentNode!==this.rootElement?(i.parent().before(l),this._removeNode(o)):o.previousSibling?(n(o.previousSibling).append(l),this._removeNode(o)):a=!1),a||(this.host.preserveWhiteSpace()&&(e.utils.dom.forAllTextChildren(o,t.domUtils.preserveWhiteSpaces),l=i.contents()),l.each((e,t)=>{i.before(t)}),i.remove()))}_getNodeAtCaret(n){const r=n.range||this._getCurrentRange();let i=null==r?void 0:r.startContainer;const o={node:null,isText:!1,offset:0};let s=!1;const a=!0===n.lookBack,l=Boolean(n.forDelete),c=!1===n.lookBack;if(!i||!r.collapsed)return o;const d=!c&&!a;let u=!0,h=O.getEmptyBlock(r.commonAncestorContainer,r.startOffset);if(h){if(l)return o.node=h,o;u=!1}else if(3===i.nodeType){const t=i;if(s=(d||a)&&0===r.startOffset||(d||c)&&r.startOffset>=t.length,(e.utils.strings.isEmptyString(t.data)||s)&&(h=t),d||!s)return o.node=t,o.isText=!0,o.offset=a?r.startOffset-1:r.startOffset,o;h=i}else{if(1!==i.nodeType)return o;{const e=i,n=r.startOffset?e.childNodes[r.startOffset-1]:null,s=r.startOffset<e.childNodes.length?e.childNodes[r.startOffset]:null;let l;if(d)return o.node=s||n||e,o;if(a?(l=n,h=s):c&&(l=s,h=n),l&&!h){const e=this._params.nodeClassifier.classifyNode(l,this.rootElement,!0,!0);if(e===t.NodeClassifier.NODE_ONLY?o.node=this.host.findTargetNode(l):e===t.NodeClassifier.NODE_AND_CONTENT||e===t.NodeClassifier.CONTENT_ONLY?t.domUtils.isInlineElement(l)&&(o.node=a?t.domUtils.getLastSelectableChild(l,this._getNodeSelectionScheme("leftNeighborForDelete",!1)):t.domUtils.getFirstSelectableChild(l,this._getNodeSelectionScheme("rightNeighborForDelete",!1))):o.node=l,o.node)return(o.isText=3===o.node.nodeType)&&(o.offset=Math.max(a?o.node.length-1:0,0)),o}}}let g=a?this._getNodeOnLeft({anchor:h,forDelete:l}):this._getNodeOnRight({anchor:h,forDelete:l,allowInSelf:u});return g?(o.node=g,o.isText=3===g.nodeType,o.isText&&a&&(o.offset=Math.max(0,g.length-1)),o):o}_isDeletableElement(r,i=!1){if(!r)return!1;if(3===r.nodeType&&!e.utils.dom.isEmptyTextNode(r))return!0;if(1!==r.nodeType)return!1;if(O.isBogus(r))return!1;const o=n(r);let s;for(let e=0,n=w.length;e<n;++e)if(s=w[e],o.is(s.selector)){if(s.type===S.Always)return!0;if(s.type===S.NotEmpty)return i||!t.domUtils.hasNoTextOrStubContent(r)}return!1}_onRangeChanged(e){this.host.setHostRange(e.nativeRange)}_markInlines(){this._$element&&this._$element.find(y).each((e,t)=>{t.setAttribute("data-flite-empty-inline","1")})}_cleanupInlines(){if(!this._$element)return;let e,t=n("");for(;e=this._$element.find(y),e.length&&!e.is(t);)t=e,e.each((e,t)=>{t.getAttribute("data-flite-empty-inline")||n(t).remove(),t.removeAttribute("data-flite-empty-inline")})}_unlistenToMutations(){this._mutationListenRequestCount>0&&--this._mutationListenRequestCount,0===this._mutationListenRequestCount&&this._mutationSummary&&this._mutationSummary.disconnect()}_newMutationSummary(){const n={callbacks:{withContext:this._onMutationSummary.bind(this)},rootNode:this.rootElement,oldPreviousSibling:!0,observeOwnChanges:!1,mutationFilter:e.utils.yes,nodeFilter:e.utils.yes,queries:[]};return n.queries.push({element:"*",classAttribute:!1}),new t.MutationSummary(n,!1)}_trackReplacedText(t,n,r){this._editTransaction.textChanged().setIsUpdate();const i=t.parentNode;for(let o=0;o<n.length;o++){const s=n[o];if(3===s.nodeType&&!s.parentNode&&!e.utils.dom.isEmptyTextNode(s)){i.insertBefore(s,t);const e=this._markNodeAsDeleted(s,r,!0);this._hideTextContent(e)}}this._markupInsertedNodes([t],null)}_trackReplacedTextNew(t){const{target:r,removed:i,changeId:o}=t;this._editTransaction.textChanged();const s=r.parentNode,a=this.rootElement.ownerDocument,l=this._params.highlightSelector,c=[],d=[];let u=0,h="";for(let r=0;r<i.length;r++){const o=i[r],g=n(o);if(o.ownerDocument===a&&!o.parentNode&&g.is(l)){const n={node:g,seq:Number(g.data("flite-seq")),txt:g.data("flite-text"),group:g.data("mceIndex")};if(n.seq&&!e.utils.strings.isEmptyString(n.txt)){d.push(n);t.summary.getOldParentNode(g[0])===s&&(h=n.group,u=Math.max(n.seq,u),c.push(n))}}}if(!u)return this._trackReplacedText(r,i,o);d.sort((e,t)=>e.seq-t.seq);const g=[];for(let e=0;e<d.length;e++){const t=d[e];if(!(t.seq<=u||t.group===h))break;g.push(t.txt),t.node.removeData(["flite-seq","flite-text"])}if(g.length){const e=r.ownerDocument.createTextNode(g.join(""));s.insertBefore(e,r);const t=this._markNodeAsDeleted(e,o,!0);this._hideTextContent(t)}this._markupInsertedNodes([r],null)}_tryToTrackChildReplace(t,n,r){if(3!==(null==t?void 0:t.nodeType))return;const i=n.getOldParentNode(t);e.utils.dom.matchesSelector(i,this._params.highlightSelector)&&this._trackReplacedTextNew({target:t,removed:n.removed,changeId:r,summary:n})}_markHighlightNodes(t){const r=this._params.highlightSelector;t.added.filter(t=>e.utils.dom.matchesSelector(t,r)).sort(e.utils.dom.compareNodePosition).forEach((e,t)=>n(e).data("flite-seq",t+1).data("flite-text",e.textContent))}_onReplaceTextChildrenMutation(n){this._replacerMutationSummary=this._replacerMutationSummary||this._newMutationSummary();const r=this._replacerMutationSummary.createSummaries(n,!1)[0],i=null==r?void 0:r.reparented;if(!(null==i?void 0:i.length)||!r.removed.length)return this._markHighlightNodes(r);const o=this._startBatchChange(null);try{const t=i.length>1?i.slice().sort(e.utils.dom.compareNodePosition):i;for(let e=0;e<t.length;e++)this._tryToTrackChildReplace(t[e],r,o.id)}catch(e){t.logger.error("While processing replace mutation",e)}finally{this._endBatchChange(o)}}_hideTextContent(e){const t=this._getNodeTrackingContext(e);if(!t.tracksContent||t.trackingNode.getAttribute(this.attributes.fliteTextContent))return;const n=t.trackingNode.innerHTML;t.trackingNode.setAttribute(this.attributes.fliteTextContent,encodeURIComponent(n)),t.trackingNode.innerHTML=O.createReplacementText(n)}_restoreHiddenContent(e){const n=e.getAttribute(this.attributes.fliteTextContent)||"";t.logger.debug("restoring hidden content",n),e.removeAttribute(this.attributes.fliteTextContent),e.innerHTML=decodeURIComponent(n)}_getUserStyleSheet(t,n){if(!t)return null;const r=this._users[t];return r?(!r.styleLoader&&n&&this._env.document&&(r.styleLoader=new e.utils.CSSLoader(this._env.document)),r.styleLoader):null}_validateUserStyle(e){const t=(e=e||{}).delete||{},r=e.insert||{},i=e.common||{},o=n.extend(!0,{},i,t),s=n.extend(!0,{},i,r);return o["background-color"]||(o["background-color"]=this._getNextBackgroundColor("delete")+" !important"),s["background-color"]||(s["background-color"]=this._getNextBackgroundColor("insert")+" !important"),{delete:o,insert:s}}_getNextBackgroundColor(t){const n="insert"===t;let r,i=n?this._params.backgroundColors.insert:this._params.backgroundColors.delete,o=n?this._insColorIndex:this._delColorIndex,s=i.length;if(o<s)r=i[o];else{const t=Math.floor(o/s),n=o%s;r=e.utils.intensifyColor(i[n],.1*t*(t%2?1:-1))}return n?this._insColorIndex++:this._delColorIndex++,r}_resetBackgroundColors(){this._insColorIndex=0,this._delColorIndex=0}_addUser(e){if(!e)return t.logger.warn("null user or no user id");const n=e&&e.id&&String(e.id),r=n&&this._users[n],i=r&&r.styleLoader;i&&i.dispose();const o={userId:e.id,styleLoader:null};this._users[n]=o,this.setUserStyle(e.id,e.style)}_forAllUsers(e){const t=this.host.users.getAllUsers(),n=Object.keys(t);for(let t of n){let n=this._users[t];if(n||(this._users[t]=n={userId:t,styleLoader:null}),!1===e(n))break}Object.keys(this._users).forEach(e=>{var n;e in t||(null===(n=this._users[e].styleLoader)||void 0===n||n.dispose(),delete this._users[e])})}_getNodeOnRight({anchor:e,forDelete:n=!1,allowInSelf:r=!0}){const i=O.getEmptyBlock(e);return i&&(e=i,r=!1),t.domUtils.rightNeighbor(e,this._getNodeSelectionScheme(n?"rightNeighborForDelete":"rightNeighborForSelect",r))}_getNodeOnLeft({anchor:e,forDelete:n=!1,allowInSelf:r=!0}){const i=O.getEmptyBlock(e);if(i){if(n)return i;e=i}let o=t.domUtils.leftNeighbor(e,this._getNodeSelectionScheme(n?"leftNeighborForDelete":"leftNeighborForSelect",r));if(o){o=this._params.nodeClassifier.getAncestorOfClass(o,this.rootElement,t.NodeClassifier.NODE_ONLY,!0)||o}return o}_collapseBefore(e){const n=this._selection,r=this._getNodeOnLeft({anchor:e});return r&&("BR"!==r.nodeName||r.nextSibling&&!t.domUtils.isBlockElement(r.nextSibling)?n.collapseAtEnd(r):n.collapseAtStart(r)),n}_collapseAfter(e,t){const n={anchor:e,allowInSelf:t},r=this._selection,i=this._getNodeOnRight(n);return i&&this._selection.collapseAtStart(i),r}_getNodeSelectionScheme(e,t=!0){return Object.assign(Object.assign({},this._deleteOptions[e]),{root:this.rootElement,querySelf:t})}}};Object.assign(t,D)}(window.LOOPINDEX),Object.defineProperty(i,"__esModule",{value:!0}),function(e){const t=null==e?void 0:e.FLITE,n=null==e?void 0:e.$,r=window.tinymce;if(!t||!n)throw new Error("Cannot initialize froala FLITE plugin without FLITE globals");let i;!function(e){e[e.OK=0]="OK",e[e.IGNORE=1]="IGNORE",e[e.IGNORE_ALL=2]="IGNORE_ALL"}(i||(i={}));const o=e.utils.createCISet("mcefocus","mceapplytextcolor","mceremovetextcolor","justifyright","justifyleft","justifycenter","justifyfull","indent","outdent","annotate"),s=e.utils.createCISet(["mcetoggleformat","bold","italic","underline","fontSize"]),a=e.utils.createCISet("mceinsertcontent"),l=e.utils.createCISet("removeformat","mcepaintformats"),c=e.utils.createCISet("undo","redo"),d=e.utils.createCIMap({mcetabledelete:"delete-table",mcetabledeletecol:"delete-table-col",mcetabledeleterow:"delete-table-row",mcetableinsertrowafter:"insert-table-row",mcetableinsertcolafter:"insert-table-col",mcetableinsertrowbefore:"insert-table-row",mcetableinsertcolbefore:"insert-table-col"}),u=e.utils.createCISet("insertunorderedlist","insertorderedlist"),h=e.utils.createCISet("delete","delete-table"),g=r.PluginManager;!function(){const e=new Map([["&amp;","&"],["&gt;",">"],["&lt;","<"]]),t=new RegExp(Array.from(e.keys()).join("|"),"g")}();const f=10*parseInt(r.majorVersion)+.1*parseInt(r.minorVersion);g.add("flite",(function(t,n){!function(e){if(f<60)return;e.options.register("flite",{processor:e=>null==e||"object"==typeof e&&!Array.isArray(e),default:{}})}(t);const r=new C(t,n),i=e.tinymce.getEditorSetting(t,"flite");return r.initPlugin(t,i),r}));const p="[data-footnote-id],section.footnotes,\n.mce-match-marker,span.mce-spellcheck,\n[data-mce-type='bookmark'],.mce-resizehandle,span#__caret,\n:not(BR,.mce-spellchecker-word,.mce-spellchecker-annotation,[data-mce-type='format-caret'])[data-mce-bogus],"+t.flitePluginUtils.fliteArtifactsSelector,m={spellCheckerSelector:".mce-spellchecker-word",tmceAnnotationSelector:".mce-annotation.tox-comment",trackedSelectors:"",opaqueSelectors:"sup.mce-footnote",ignoreSelectors:p,stylePrefix:"ice-cts"},v=new RegExp("(?:^|s)(?:"+t.flitePluginUtils.deleteClass+"|"+t.flitePluginUtils.insertClass+")(?:s|$)");function y(e){const t=e;return t&&t.className&&v.test(t.className)}function _(t){if(!t||!t.length)return[];let n=[];return t.forEach((function(t){n=n.concat(function t(n){let r;if(1===n.nodeType){const e=n.childNodes;for(let i=0;i<e.length;++i)if(r=e[i],t(r),y(r)){for(;r.firstChild;)n.insertBefore(r.firstChild,r);n.removeChild(r)}}return y(n)?e.$.makeArray(n.childNodes):[n]}(t))})),n}class C{constructor(t,n){this._path=n,this._domLoaded=!1,this._editor=null,this._removeBindings=[],this.savedEditorFireMethod=null,this._isMouseDownInEditor=!1,this._cutEventHandlestatus=void 0,this._editor=t,this._useXML="xhtml"===e.tinymce.getEditorSetting(this._editor,"element_format"),this._buttonsHandler=e.tinymce.createButtonHandler(t,f)}initPlugin(e,n){this._editor=e,t.flitePluginUtils.initFLITEPlugin(this,n,r.util.I18n.getCode()),this._timeoutClient.createTimer("ready",{callback:this._onReady.bind(this),timeoutMSecs:100,autoDispose:!1,repeatCount:9999,maxTimeSecs:7})}init(n,r){const i=this._config;if(!t.flitePluginUtils.validateKey())return;this._initUI(n,r),this._domLoaded=!1,e.utils.strings.toStringArray(i.ignoreCommands).forEach(e=>o.add(e)),n.once("init",()=>setTimeout(()=>{this._onEditorLoaded()},1)),this._testNonEditable=function(t){const n=e.tinymce.getEditorSetting(t,"noneditable_editable_class")||".mceEditable",r=e.tinymce.getEditorSetting(t,"noneditable_noneditable_class")||".mceNonEditable";return function(t,i){for(;t&&t!==i;t=t.parentNode){if(e.utils.dom.matchesSelector(t,r))return!0;if(e.utils.dom.matchesSelector(t,n))return!1}return!1}}(n);const s=()=>{this._isMouseDownInEditor=!1};this.isInline()&&n.on("focus",()=>{this.refreshCommands()});const a=this._onSwitchMode.bind(this);n.on("SwitchMode",a),window.addEventListener("blur",s),n.on("remove",()=>{window.removeEventListener("blur",s),n.off("SwitchMode",a),this._dispose()})}get path(){return this._path}transactUndo(e){try{this._editor.undoManager.add(),this._editor.undoManager.ignore(e),this._editor.undoManager.add()}catch(e){}}saveUndo(t){e.tinymce.saveUndo(this._editor,t)}_dispose(){var e;if(this._editor)try{this._releaseEventBindings(),null===(e=this._buttonsHandler)||void 0===e||e.dispose(),this.disposePlugin(),this._editor=null,this._buttonsHandler=null}catch(e){t.logger.error("while destroying editor",e)}finally{this._editor=null}}logEditorEvents(t){e.utils.pluginUtils.logEditorEvents({plugin:this,editor:this._editor,exclude:["keydown","focus","blur","mouse.*","ResizeWindow","ResizeContent","ResolveName","TableSelectionClear","GetSelectionRange","NodeChange","VisualAid","scroll.*","execcommand","beforeexeccommand","dirty","mousemove"],method:f>=60?"dispatch":"fire",log:t})}logEditorCommands(e){this._config.logCommands=Boolean(e)}isInline(){return Boolean(this._editor&&this._editor.inline)}revealEditorNode(t){"function"==typeof(null==t?void 0:t.scrollIntoView)?t.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"}):e.utils.scrollToElement(t,{direction:"both",duration:100})}getBody(){var e,t;return null!==(t=null===(e=this._editor)||void 0===e?void 0:e.getBody())&&void 0!==t?t:null}getDocument(){return this.getBody().ownerDocument}findTargetNode(e){return e}getSelectedNode(e){const t=this._editor.selection,n=null==t?void 0:t.getRng(!0),r=null==n?void 0:n.commonAncestorContainer;if(3===(null==r?void 0:r.nodeType))return r;if(!t)return this.tracker.getSelectedNode();return t.isCollapsed()?t.getStart():t.getNode()}_initUI(n,r){new Map;const i={[t.Commands.TOGGLE_TRACKING]:{callback:this.onToggleTracking.bind(this)},[t.Commands.TOGGLE_SHOW]:{callback:this.onToggleShow.bind(this)},[t.Commands.ACCEPT_ALL]:{callback:this.onAcceptAll.bind(this),contextAction:!0},[t.Commands.REJECT_ALL]:{callback:this.onRejectAll.bind(this),contextAction:!0},[t.Commands.ACCEPT_ONE]:{callback:this.onAcceptOne.bind(this),contextAction:!0},[t.Commands.REJECT_ONE]:{callback:this.onRejectOne.bind(this),contextAction:!0}},o=this.config("commands").map(e=>{var t;return Object.assign(Object.assign(Object.assign({},e),{title:this.getLocalizedString(e.title),iconUrl:e.iconUrl?this.resolvePath(e.iconUrl):"",iconName:e.command.replace(/[^a-z\-]/g,"")}),null!==(t=i[e.command])&&void 0!==t?t:{})});e.tinymce.applyToolbarConfiguration(n,"flite",o);const s=e=>()=>{const t=this._buttonsHandler.getCommandState(e);return Boolean(t.enabled)};o.forEach(t=>{const r=Object.assign(Object.assign({},t),{callback:t.callback});n.addQueryStateHandler(t.command,s(t.command)),e.tinymce.addCommandAndButton({command:r,editor:n,editorVersion:f,handler:this._buttonsHandler})}),e.tinymce.loadToolbarIcons({commands:o,editor:n,handler:this._buttonsHandler,editorVersion:f}),this._setupContextMenu(n,o)}_uninit(){}getEditorUIContainer(){return e.tinymce.getEditorUIContainer(this._editor)}setCommandsState(e,t,n){this._buttonsHandler.setCommandsState(e,{enabled:t,active:n})}_onSelectionChanged(){if("none"!==this.trackingState.mode&&e.utils.pluginUtils.isSelectionInDocument(this)){const e=this.tracker.hasChanges(),t={hasChanges:e,changeId:e?this.tracker.getNodeChangeId(this.getSelectedNode(!0)):null};this.trackingState.update(t)}}get editor(){return this._editor}_finalizeConfiguration(e){return f>=50&&e.pageUrls.push("css/editor-tinymce.css"),e}fireEditorEvent(e,t){var n;const r=null===(n=this._editor)||void 0===n?void 0:n[f>=60?"dispatch":"fire"];return"function"==typeof r&&(r.call(this._editor,e,t),!0)}_onSwitchMode(e){this.trackingState.update({readonly:"design"!==e.mode})}get editorMode(){return this._editor?this._editor.readonly?"readonly":"design":""}fireEvent(e,t=null){return this._editor&&this._editor.fire(e,t)}cleanupAfterAcceptReject(){const e=n(this.getBody()),r=this.tracker.setIgnoreMutations(!0),i=e.find("span."+t.flitePluginUtils.insertClass+":empty,span."+t.flitePluginUtils.deleteClass+":empty");try{if(i.remove(),0===e.html().length){const t=this.getDocument().createElement("BR");e.prepend(t),this._editor.selection.select(t),this._editor.selection.collapse()}}catch(e){t.logger.error("cleanupAfterAcceptReject:",e)}finally{this.tracker.setIgnoreMutations(r)}f>=50&&this.tracker.ignoreNextMutation("TMCE5 safeguard after accept/reject"),this.onSelectionChanged()}processConfig(e){return f<60?e:"boolean"!=typeof(null==e?void 0:e.handlePaste)?n.extend({},e,{handlePaste:!1}):e}_bindEditorEvents(n){!1===this._config.handlePaste||this._editor.plugins.paste||this._editor.plugins.powerpaste||this._addEventBinding("paste",t=>{if(this.commandProcessingState.isProcessing(a))return;const n=this.trackingState.mode;if("none"===n)return;if("readonly"===n)return void this.tracker.prepareForInsertion();const r=t.clipboardData;if(!r)return;const i=r.getData("text/html")||r.getData("text/plain");if(i){const n=e.utils.dom.toJQuery(i,!0);if(n.length){const e=n.find("body"),r=e.length?e.html():n.toArray().map(e=>3===e.nodeType?e.nodeValue:1===e.nodeType?e.outerHTML:"").join("");return t.preventDefault(),t.stopPropagation(),this._editor.insertContent(r)}}}),this._addEventBinding(t.Events.REJECT,()=>{this._editor.execCommand("mceUpdateFootnotes")}),this._addEventBinding(t.Events.ACCEPT,()=>{this._editor.execCommand("mceUpdateFootnotes")}),this._addEventBinding("cut",e=>{const n=t.flitePluginUtils.tryHandleClipboardEvent(this,e);return this._cutEventHandlestatus=!n,this._timeoutClient.setTimer(()=>{this._cutEventHandlestatus=void 0},50),n&&(e.preventDefault(),e.stopImmediatePropagation()),!n},!1,!0),this._addEventBinding("MouseDown",()=>{this._isMouseDownInEditor=!0}),this._addEventBinding("MouseUp",()=>{this._isMouseDownInEditor=!1}),this._addEventBinding("Blur",()=>{this._isMouseDownInEditor=!1}),this._addEventBinding("PreProcess",this._onPreProcessForSave),this._addEventBinding("keydown",e=>{if(!e||"none"===this.trackingState.mode||this.spellingStack)return t.logger.debug("plugin won't handle keydown event"),!0;return this.tracker.handleEvent(e,this.trackingState.mode,this._config.readonlyInsertPolicy)},!1,!0),this._monitorEditorDialogs(),this._addEventBinding("ListMutation",e=>{var t;const n=null===(t=this.tracker)||void 0===t?void 0:t.getMutationContext(),r=n&&"none"!==n;this.tracker&&!r&&this.tracker.ignoreNextMutation("list mutation")}),this._addEventBinding("click",this.onSelectionChanged),this._addEventBinding("SpellcheckEnd",()=>{this.tracker.ignoreNextMutation("spell check end")}),this._addEventBinding("SpellcheckStart",()=>{this.tracker.ignoreNextMutation("spell check start")}),this._addEventBinding("selectionChange",this.onSelectionChanged),this._addEventBinding("keypress",this._onKeyPress),this._addEventBinding("ExecCommand",this._onAfterCommand),this._addEventBinding("BeforeExecCommand",this._onBeforeCommand),this._addEventBinding("BeforeAddUndo",this._onBeforeAddUndo),this._addEventBinding("BeforeSetContent",this._onBeforeSetContent),this._addEventBinding("SetContent",this._onSetContent),this._addEventBinding("PastePreProcess",this._onPreProcessPaste),this._addEventBinding("GetContent",this._onGetContent),this._addEventBinding("NodeChange",this.onSelectionChanged),this._bindFormatting(this._editor)}_bindFormatting(e){if(f<49){const t=e.formatter.apply;e.formatter.apply=(...n)=>{this.tracker&&this.tracker.ignoreNextMutation("apply formatting"),t.apply(e.formatter,n)}}}_onPreProcessForSave(e){const t=null==e?void 0:e.node;t&&this._config.preserveWhiteSpace&&this.tracker.preserveWhiteSpace(t)}_setPluginFeatures(e){const n=null==e?void 0:e.schema;if("function"!=typeof(null==n?void 0:n.getElementRule))return;const r=e.schema.getElementRule("span"),i=Object.assign({},(null==r?void 0:r.attributes)||{});if(0===Object.keys(i).length)return;const o=t.flitePluginUtils.trackerAttributes;Object.keys(o).map(e=>o[e]).concat(["class","id","title"]).forEach(e=>{i[e]||(i[e]={})});const s=`span[${Object.keys(i).join("|")}]`;e.schema.addValidElements(s)}isCutKeystroke(e){return!1}_onKeyPress(e){this.isCutKeystroke(e.keyCode)&&e.stopPropagation()}_onReady(){const e=this._config.maxDocumentReadyWaitSeconds&&this._timeoutClient.elapsed("ready")>=1e3*this._config.maxDocumentReadyWaitSeconds;this._domLoaded&&t.rangy.isInitialized(e)?(this._timeoutClient.stopTimer("ready"),this._afterReady()):this._timeoutClient.startTimer("ready")}getSelectedRange(){return this.getHostRange()}setSelectedRange(t){return e.tinymce.setSelectedRange(this._editor,t)}getHostRange(){var e,t;return(null===(t=null===(e=this._editor.selection)||void 0===e?void 0:e.getRng)||void 0===t?void 0:t.call(e,!0))||null}setHostRange(e){let t=this._editor&&this._editor.selection;t&&t.setRng(e)}_afterReady(){var n;const i=this._editor,o=this.getBody();t.trackerUtils.markFLITEBody(o);try{this.tracker.reload(o),this.trackingState.update({readonly:this._editor.readonly,hasUser:Boolean(this.users.getCurrentUser(!1)),wysiwyg:!this._editor.readonly,hasChanges:this.tracker.hasChanges()}),this.toggleShow(this.isVisible,!1),"always"===this._config.sessionPolicy&&this.startNewSession(),e.utils.pluginUtils.loadPluginPageStyles(this),this.setLanguage(null===(n=r.util.I18n)||void 0===n?void 0:n.getCode()).then(()=>{this.refreshCommands(),i.fire(t.Events.INIT,{flite:this})})}catch(i){t.logger.error("FLITE plugin init:",i)}}getTrackerOptions(){var n;return{highlightSelector:".mce-match-marker",keyboardMap:null===(n=this._spellTrigger)||void 0===n?void 0:n.parent(),spellingOverride:this._config.spellingOverride,timezoneOffset:this._config.timezoneOffset||0,handleCut:!1,changeGroupTime:300,deletableSelectors:this._config.deletableSelectors,opaqueSelectors:this._config.opaqueSelectors,backgroundColors:{delete:e.utils.strings.toStringArray(this._config.backgroundColors.delete),insert:e.utils.strings.toStringArray(this._config.backgroundColors.insert)},changeTypes:{insertType:{className:t.flitePluginUtils.insertClass,action:"Inserted"},deleteType:{className:t.flitePluginUtils.deleteClass,action:"Deleted"}},classes:void 0,nodeClassifier:(new t.NodeClassifier).addPatterns(t.NodeClassifier.NODE_AND_CONTENT,m.trackedSelectors).addPatterns(t.NodeClassifier.IGNORE,m.ignoreSelectors).addPatterns(t.NodeClassifier.CONTENT_ONLY,m.spellCheckerSelector).addPatterns(t.NodeClassifier.CONTENT_ONLY,m.tmceAnnotationSelector).addPatterns(t.NodeClassifier.IGNORE,this._config.ignoreSelectors).addPatterns(t.NodeClassifier.NODE_ONLY,m.opaqueSelectors),stylePrefix:m.stylePrefix,_changeData:void 0}}onLocaleChanged(){this.config("commands").forEach(e=>{this._buttonsHandler.setCommandsState(e.command,{})})}_onPreProcessPaste(t){const n=this.getDocument(),r=n&&n.createElement("div");if(r){r.innerHTML=t.content;const n=this.tracker.getCleanDOM(r,{removeDeleted:this._config.removeDeleteOnPaste});t.content=e.utils.dom.elementToHtml({el:n,xml:this._useXML,withRoot:!1})}return t.content}_onGetContent(n){if("string"==typeof n.content){const r=e.tinymce.getHTMLStringEncoder(this._editor),i=t.flitePluginUtils.cleanupHtml({plugin:this,html:n.content,xml:this._useXML,textProcessor:r});i&&(n.content=i)}}_onEditorLoaded(){if(this._domLoaded)return;this._domLoaded=!0;const e=this.getDocument();this.compositionTracker.attach(e.body),this._bindEditorEvents(this._editor),this._setPluginFeatures(this._editor),this.loadDocumentStyles(e),this._onReady()}_setupContextMenu5(n,r){const i=this._config.contextMenu;if(!(null==i?void 0:i.length))return;const o=r.filter(e=>i.indexOf(e.command)>=0);if(o.length<1)return void t.logger.warn("Context menu contains unknown commands "+i);const s=o.map(e=>e.command),a=e.utils.strings.toMap(o,"command");n.ui.registry.addContextMenu("flite",{update:e=>{if(!this.isTracking)return"";const n=this.tracker.getNodeChangeId(e);this.trackingState.update({changeId:n});const r=t.flitePluginUtils.getCommandsStatus(this,s),i=[];return Object.keys(r).forEach(e=>{const t=r[e],n=a[e];(null==n?void 0:n.contextAction)&&(null==t?void 0:t.enabled)&&i.push({text:n.title,icon:n.iconName,onAction:()=>{this._editor.execCommand(n.command)}})}),i}})}getNewLineNodeName(){const e=String(this._editor&&this._editor.getParam("forced_root_block","P")||"P").toUpperCase();return C.NEWLINE_MAP[e]||e}_onBeforeAddUndo(e){var n;let r=!1;if(this.allowSaveUndo()){const i=null===(n=e.level)||void 0===n?void 0:n.content;if(!(null==i?void 0:i.length))return;(i.indexOf('data-flite-block-id="')>0||i.indexOf(t.flitePluginUtils.trackerAttributes.stubNode+'="')>0)&&(r=!0)}else this.allowSaveUndo(!0);if(r)return e.preventDefault(),!1}_onFormattingCommand(e){"readonly"===e?this.tracker.prepareForInsertion():"full"===e&&this.tracker.setMutationContext("insert-format",{placeHolderSelector:'[data-mce-type="format-caret"]',formatSelector:'sup,sub,strong,em,span[style][data-mce-style],span[style*="font-size"]'})}_onBeforeCommand(e){const n=(e.command||"").toLowerCase();if(l.has(n))return this._saveFLITEClasses();const r=this.trackingState.mode;if(!this._editor||"none"===r)return;if(this._config.logCommands&&!/focus/.test(n)&&t.logger.debug("before command:",n,e),o.has(n))return;this.commandProcessingState.startProcessing(n);const i="full"===r;if(s.has(n))this._onFormattingCommand(r);else if("delete"===n){const n=this._cutEventHandlestatus;if(void 0!==n)return!1===n&&e.stopImmediatePropagation(),this._cutEventHandlestatus=void 0,n;if("enter"!==this.tracker.getMutationContext()){if(t.flitePluginUtils.tryHandleClipboardEvent(this,e))return e.stopImmediatePropagation(),!1}}else if(i&&u.has(n)){const t=this.tracker.tryToTrackListStatusRemoval({isBullet:"insertunorderedlist"===n,isBulk:!0,trackTypeChange:this._config.trackListTypeChange});if(t.handled)return e.stopImmediatePropagation(),!1;t.mutation&&this.tracker.setMutationContext(t.mutation,{selector:t.selector,cleanup:t.cleanup})}else if(a.has(n))i?this._processInsert(e):this.tracker.prepareForInsertion();else if(c.has(n)){const e=this._editor.selection.getBookmark(2);this._editor.once("ExecCommand",t=>{c.has(null==t?void 0:t.command)&&function(e,t){const n=e=>{var t;return 1===(null===(t=null==e?void 0:e.start)||void 0===t?void 0:t.length)&&0===e.start[0]};try{if(n(t))return!1;if(!n(e.selection.getBookmark(2)))return!1;const r=e.getDoc(),i=e.dom.getRoot(),o=t.start,s=o.length-1,a=r.createRange();for(let e=s,t=i;e>=0;--e){const n=o[e],r=t.childNodes[n];if(!r)break;if(3===r.nodeType){const t=0===e?0:o[e-1];a.setStart(r,Math.min(t,r.length));break}if("BR"===r.nodeName){a.setStart(t,Math.max(0,n-1));break}if(1!==r.nodeType)break;a.setStart(t,Math.max(n,0)),t=r}a.startContainer===r&&0===a.startOffset||(a.collapse(!0),e.selection.setRng(a))}catch(e){return!1}}(this._editor,e)}),this.muteSessionPolicy()}else if("mceinsertlink"===n)this.tracker.setMutationContext("insert-link");else if(i){const e=d.get(n);e&&this.tracker.setMutationContext(e)}}_onAfterCommand(e){const t=(e.command||"").toLowerCase();if(this.commandProcessingState.endProcessing(t,a.has(t)?1:0),l.has(t))return this._restoreFLITEClasses();this._editor&&"none"!==this.trackingState.mode&&c.has(t)&&this.restoreSessionPolicy()}_onBeforeSetContent(e){if(!this._isProcessingInsert&&this._config.trackApiInsert&&!e.paste)return e.selection?this._onSelectionSetContent(e):void("html"===e.format&&e.content&&(e.content=this._processContent(e.content)))}_processContent(e){const r=this.getDocument().createElement("div"),i=n(r);i.html(e);try{t.flitePluginUtils.replaceInsDel(this,r,"ins[data-cid]",!0),t.flitePluginUtils.replaceInsDel(this,r,"del[data-cid]",!1),t.flitePluginUtils.presrveWhitespace(r)}catch(e){t.logger.error("processContent:",e)}return i.html()}_onSelectionSetContent(e){if(this.tracker.getMutationContext()in h)return;const r=this.trackingState.mode,i=e.content||"";if(i&&!(i.indexOf('data-mce-type="bookmark"')>0)&&(this.tracker.prepareForInsertion(),"readonly"!==r&&"full"===r&&"html"===e.format))try{const e=n(i);1===e.length&&this.tracker.setMutationContext("insert-element",{selector:t.domUtils.getElementSelector(e[0])})}catch(e){t.logger.error("selection set content",e)}}_onSetContent(e){if(e.selection)return this._onBeforeSetContent(e);const n=this.getBody();this.isTracking&&"always"===this._config.sessionPolicy&&this.startNewSession(),this.tracker.reload(t.trackerUtils.isFLITEBody(n)?null:n)}_saveFLITEClasses(){this.tracker.getTrackedNodes().each((e,t)=>{const n=t.className;n&&t.setAttribute("data-flite-saved-class",n)})}_restoreFLITEClasses(){n(this.getBody()).find("[data-flite-saved-class]").each((e,t)=>{const n=t.getAttribute("data-flite-saved-class");t.removeAttribute("data-flite-saved-class"),n&&t.setAttribute("class",n);this.tracker.findNodeTrackingContext(t,!1).trackingNode===t&&this.onTrackingNodeCreated(t)})}_processInsert(e){if(e.value&&!this.spellingStack&&!this._isProcessingInsert&&this._shouldProcessInsert()){this._isProcessingInsert=!0;try{const t="string"==typeof e.value?e.value:e.value.content;if("string"==typeof t){const r=Boolean(e.value.paste),i=this._classifyInsert(t);if(i.mutation)i.content&&n(i.content),this.tracker.setMutationContext(i.mutation,i.mutationData);else{const i=this._processInsertedHtml(t,r);this.tracker.setMutationContext("paste"),f<60?(e.preventDefault(),e.stopImmediatePropagation(),e.target.insertContent(i)):n(i)}}}catch(e){t.logger.error("while inserting content",e)}finally{this._isProcessingInsert=!1}}function n(t){const n=typeof e.value;"string"===n?e.value=t:"object"===n&&e.value&&(e.value.content=t)}}_shouldProcessInsert(){if(window.document.querySelector(".tox-autocompleter"))return!1;const e=this.getBody(),t=e&&e.ownerDocument;return Boolean(t&&!t.querySelector(".tox-autocompleter"))}_classifyInsert(e){const t={mutation:null},r="mce-footnote";if(!((null==e?void 0:e.indexOf(r))>=0))return t;try{const t=n(e),i="sup."+r;if(t.is(i))return{mutation:"insert-footnote",mutationData:{markerSelector:i,headerSelector:"",noteSelector:""}}}catch(e){}return t}_prepareNodesForPaste(e){if(!(null==e?void 0:e.length))return null;let t=null;return e=_(e),t=this.isTracking?this.tracker.processInsertedNodes(e,{deleteSelection:!0,markup:!0}):e,t}_processInsertedHtml(t,n){const r=this.getDocument().createElement("div");r.innerHTML=t,n&&function(t){const n=e.utils.dom.toJQuery(t);n.find("span").each((e,t)=>{if(t.attributes.length)return;const n=t.parentElement;for(;t.firstChild;)n.insertBefore(t.firstChild,t);n.removeChild(t)}),n[0]}(r);const i=this.tracker.getCleanDOM(r,{removeDeleted:this._config.removeDeleteOnPaste});if(!i.innerHTML)return t;e.utils.dom.normalizeNode(i);const o=e.$.makeArray(i.childNodes),s=this._prepareNodesForPaste(o);if(s&&s.length)try{return s.map((function(e){return 3===e.nodeType?e.data:e.outerHTML})).join("")}catch(e){return t}}_addEventBinding(e,t,n=!0,r){const i=n?t.bind(this):t;this._removeBindings.push({event:e,context:this._editor.on(e,i,r),callback:i})}_releaseEventBindings(){const e=this._removeBindings.filter(Boolean);let t;this._removeBindings=[];for(let n=e.length-1;n>=0;--n)try{t=e[n],t&&t.context&&t.context.off(t.event,t.callback)}catch(e){}}_setupContextMenu(e,n){f>=50?this._setupContextMenu5(e,n):this._addEventBinding("contextmenu",(e,n)=>{t.logger.debug("context menu")},!1)}_shouldIgnoreNode(e){if(e&&1===e.nodeType){if((e.className||"").indexOf("mce-match-marker")>=0)return i.IGNORE_ALL}return i.OK}shouldIgnoreDeletedNode(e){return this._testNonEditable(e,this._editor.getElement())}getRelatedNodes(t,r){if(1!==(null==r?void 0:r.nodeType))return[];if("delete"===t){if(!e.utils.dom.matchesSelector(r,"sup.mce-footnote"))return[];const t=n(r).find("[data-mce-href]");if(!t.length)return[];const i=t.attr("data-mce-href");if(!i)return[];return n(this.getBody()).find(""+i).toArray().map(e=>this.findTargetNode(e))}return[]}shouldIgnoreMutations(e){return i.OK}getCaretSelectors(){return C.CARET_SELECTORS}_shouldIgnoreMutationCollection(e,t){let n,r,o;const s={};let a;for(let t=0,i=e.length;t<i&&(!r||!o);++t)n=e[t],a=1===n.addedNodes.length&&n.addedNodes[0],a&&1===a.nodeType&&"bookmark"===a.getAttribute("data-mce-type")&&(r=a,s[t]=1),a=1===n.removedNodes.length&&n.removedNodes[0],a&&1===a.nodeType&&"bookmark"===a.getAttribute("data-mce-type")&&(o=a,s[t]=1);if(!r||!o)return t;let l=0;for(let i=0,c=e.length;i<c;++i)if(!(i in s)&&(n=e[i],n.nextSibling!==r&&n.nextSibling!==o)){if(n.removedNodes.length)return t;if(a=n.addedNodes[0],a&&3!==a.nodeType)return t;l++}return l<2?i.IGNORE_ALL:t}shouldIgnoreMutation(e,t){const n=e[t];if(!n)return i.IGNORE;if(this.spellingStack)return i.IGNORE_ALL;const r=n.addedNodes;let o;for(let t=0;r&&t<r.length;++t)if(o=this._shouldIgnoreNode(r[t]),o===i.IGNORE&&(o=this._shouldIgnoreMutationCollection(e,o)),o!==i.OK)return o;const s=n.removedNodes;for(let t=0;s&&t<s.length;++t)if(o=this._shouldIgnoreNode(s[t]),o===i.IGNORE&&(o=this._shouldIgnoreMutationCollection(e,o)),o!==i.OK)return o;return i.OK}_monitorEditorDialogs(){let e=0;this._addEventBinding("CloseWindow",()=>{e&&(e--,0===e&&this.tracker.toggleListenToCharacterChanges(!1))}),this._addEventBinding("OpenWindow",t=>{if(e++,this.isTracking&&function(e){var t;const n=e&&"function"==typeof e.getData&&e.getData();return!!(null==n?void 0:n.hasOwnProperty("findtext"))||"Find and replace"===(null===(t=e.settings)||void 0===t?void 0:t.title)}(t&&(t.dialog||t.win))){const e=f<60?"replace":"replace-t6";this.tracker.toggleListenToCharacterChanges({count:-1,hideText:!this._config.allowFindDeletedText,type:e})}})}preserveWhiteSpace(){return!1!==this._config.preserveWhiteSpace}isEditorArtifact(t){return e.utils.dom.matchesSelector(t,p)}isBogusInsertPosition(e){return e&&"SPAN"===e.nodeName&&null!==e.getAttribute("data-mce-bogus")}isPassThroughNode(e){return this._isPassThroughNode||(this._isPassThroughNode=t.flitePluginUtils.createSpellCheckerTest(this,".mce-spellcheck,.mce-spellchecker-word")),this._isPassThroughNode(e)}getHostNativeRange(){return this.getHostRange()}beforeDelete(e){return this.beforeInsert(e)}beforeInsert(r){if(!r.collapsed)return r;const i="[data-mce-type='format-caret']";let o=t.domUtils.getNode(r.commonAncestorContainer,i,this.getBody());if(!o&&1===r.startContainer.nodeType){o=[r.startContainer.childNodes[r.startOffset],r.startContainer.childNodes[r.startOffset-1]].filter(t=>e.utils.dom.matchesSelector(t,i))[0]}if(!o)return r;const s=o.firstChild,a=1!==(null==s?void 0:s.nodeType),l=n(o);return a?(r.setStartBefore(o),r.collapse(!0),l.remove()):l.replaceWith(l.contents()),r}getIMECompositionState(){return this.compositionTracker.isComposing?2:0}}C.NEWLINE_MAP={FALSE:"BR",TRUE:"P"},C.CARET_SELECTORS={ignoreSelector:".mce-match-marker,[data-mce-type='bookmark'],.mce-resizehandle,span#__caret,:not(BR,.mce-spellchecker-word,.mce-spellchecker-annotation)[data-mce-bogus]",elementSelector:"BR,IMG"};class b{constructor(e,t,n){this.callback=n,this.id=String(b.nextId++),b._guards[this.id]=this;const r=o=>{t&&t!==o.command||(delete b._guards[this.id],e.off("ExecCommand",r),i&&(clearTimeout(i),i=null),n())};e.on("ExecCommand",r);let i=setTimeout(()=>{i=null,e.off("ExecCommand",r),delete b._guards[this.id]},1)}}b._guards={},b.nextId=0}(window.LOOPINDEX)}()}]);